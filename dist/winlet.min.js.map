{"version":3,"file":"winlet.min.js","names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","module","d","this","v","k","__esModule","Array","isArray","arrayLikeToArray","ReferenceError","asyncGeneratorStep","value","done","Promise","resolve","then","arguments","apply","_next","_throw","TypeError","isNativeReflectConstruct","setPrototypeOf","Reflect","construct","push","bind","prototype","toPropertyKey","_defineProperties","enumerable","configurable","writable","Object","defineProperty","key","_getPrototypeOf","getPrototypeOf","__proto__","create","constructor","default","Function","toString","indexOf","_isNativeReflectConstruct","Boolean","valueOf","Symbol","iterator","from","l","next","_typeof","assertThisInitialized","regeneratorDefine","_regenerator","toStringTag","Generator","y","G","GeneratorFunction","GeneratorFunctionPrototype","displayName","w","m","regeneratorAsyncGen","regenerator","regeneratorAsyncIterator","OverloadYield","AsyncIterator","asyncIterator","_regeneratorDefine","_invoke","unshift","pop","regeneratorAsync","regeneratorKeys","regeneratorValues","_regeneratorRuntime","name","throw","return","break","continue","stop","catch","abrupt","delegateYield","resultName","finish","_t","prev","sent","wrap","reverse","isGeneratorFunction","mark","awrap","async","keys","values","isNaN","_setPrototypeOf","arrayWithHoles","iterableToArrayLimit","unsupportedIterableToArray","nonIterableRest","arrayWithoutHoles","iterableToArray","nonIterableSpread","toPrimitive","String","Number","slice","test","isNativeFunction","_wrapNativeSuper","Map","has","get","set","Wrapper","runtime","regeneratorRuntime","accidentalStrictMode","globalThis","defaultConfig","id","ifExists","title","icon","x","width","height","minWidth","minHeight","virtualizable","animationOrigin","windowOptions","resizableX","resizableY","movable","closable","minimizable","maximizable","maximizableOnDblClick","focus","alwaysOnTop","useGhostWindow","opacity","modal","content","html","iframe","src","srcdoc","allow","referrerPolicy","loading","sandbox","loadWinLet","template","splitView","direction","panes","statusBar","enabled","text","allowHTML","search","caseSensitive","showCaseSensitiveButton","showRegexButton","showWholeWordButton","targetSelector","menu","menuStyle","tabs","tabStyle","tabOptions","reorderable","addable","detachable","mergeable","allowIncomingMerge","onAdd","undefined","onMergeAttempt","taskbarOptions","showIconOnly","contextMenu","customControls","enableShortcuts","controlsPosition","showLoadingIndicator","lazyLoad","disableMoveEvent","disableResizeEvent","virtualizationStrategy","virtualizationRestoreMode","showVirtualizationRefreshButton","onOpen","onClose","onFocus","onBlur","onResize","onMove","onReload","onBeforeClose","onMoveStart","onMoveEnd","onResizeStart","onResizeEnd","_isPopup","_parent","_taskbarItem","WinLetBaseError","_Error","message","_this","_classCallCheck2","_callSuper","BuiltInError","captureStackTrace","_inherits2","_createClass2","_wrapNativeSuper2","SimpleError","_WinLetBaseError","WinLetError","_SimpleError","LIBRARY_NAME","TIMEOUT_RESULT","CLOSE_BUTTON_RESULT","_config","_errors","_types","_baseclass","_interopRequireDefault","_utils","_window_manager","ownKeys","getOwnPropertySymbols","filter","getOwnPropertyDescriptor","_objectSpread","forEach","_defineProperty2","getOwnPropertyDescriptors","defineProperties","_WinLetBaseClass","WinLetWindow","options","manager","_getPrototypeOf2","_possibleConstructorReturn2","regex","wholeWord","generateId","concat","existingEl","document","getElementById","classList","contains","deepMerge","deepCopy","parentWindow","searchOptionsState","throttlingOptions","getGlobalConfig","eventThrottling","delay","moveDelay","emitMove","emit","throttledEmitMove","throttle","_delay","resizeDelay","emitResize","throttledEmitResize","el","createDOM","add","setAttribute","titleBarEl","querySelector","iconEl","titleEl","mainContentEl","contentEl","loaderEl","canvasOverlayEl","debugOverlayEl","statusBarEl","applyOptions","setupEventListeners","updateDebugOverlay","on","origin","originX","originY","winRect","getBoundingClientRect","animateFromTaskbar","HTMLElement","rect","left","top","_rect","MouseEvent","clientX","clientY","_typeof2","relativeX","relativeY","_this$options$customC","windowEl","createElement","className","state","handles","resizableHandlesHTML","join","hasMenu","hasTabs","isMergedMenu","isMergedTabs","customControlsHTML","map","refreshBtnHTML","controlsHTML","titleBarContentHTML","loaderHTML","statusBarHTML","debugHTML","canvasOverlayHTML","innerHTML","isContentLoaded","createSplitView","createTabs","renderContent","setTitle","setIcon","setSize","style","showLoader","_renderInitialContent","createMenu","setStatusBarText","display","container","_this2","hideLoader","virtualizationLevel","tagName","appendChild","cloneNode","console","warn","isNonEmptyObject","iframeConfig","finalSrcDoc","globalConfig","libraryPath","scriptTag","addEventListener","querySelectorAll","dd","isMenuOpen","_this3","menuBar","menuItemData","_menuItemData$name","menuItemEl","textContent","items","dropdownEl","createDropdownMenu","stopPropagation","isVisible","closeAllMenus","passive","_this4","itemData","itemEl","separator","_itemData$name","shortcut","_itemData$action","action","subMenuEl","_this$options$tabOpti","_this5","tabBar","tabOpts","tabData","index","createTabElement","addTabBtn","_tabOpts$onAdd","newTabItem","addTab","setupTabBarDropZone","activateTab","_this6","_e$dataTransfer","dataTransfer","types","includes","preventDefault","dropEffect","remove","_e$dataTransfer2","_e$dataTransfer3","_e$dataTransfer4","_this6$manager$contai","tabDataJSON","getData","sourceWindowId","sourceTabId","draggingEl","sourceWindow","getWindow","_sourceOpts$mergeable","_targetOpts$allowInco","sourceOpts","targetOpts","isMergeable","allowsIncoming","customFilterPassed","JSON","parse","closeTab","parseInt","updateTabOrderFromDOM","_this$options$tabOpti2","_this7","tabEl","dataset","tabId","insertBefore","closeBtn","indexToClose","findIndex","tabContentEl","splice","makeTabReorderable","_this8","draggable","setData","tabIndex","stringify","onTabDragStart","onTabDragEnd","_this8$manager$draggi","draggingTabInfo","isAfter","parent","parentNode","nextSibling","_this$tabs$index","wasActive","tab","newActiveIndex","Math","max","close","isActive","toggle","searchBarEl","_performSearch","tabItem","setActive","newIndex","tabElements","newTabs","newOptionsTabs","oldTabs","_toConsumableArray2","oldOptionsTabs","oldIndex","_this9","splitViewEl","paneOptions","paneEl","size","flex","minSize","resizerEl","resizable","makePaneResizable","pointerEvents","resizer","prevPane","startX","startY","startWidth","offsetWidth","startHeight","offsetHeight","onPointerMove","moveE","newWidth","flexBasis","newHeight","_onPointerUp","removeEventListener","_this0","boundGlobalClickHandler","controlsEl","button","target","closest","_this0$popupCloseCall","popupCloseCallback","toggleMaximize","minimize","unvirtualize","control","find","makeMovable","makeResizable","showContextMenu","pointerType","contextMenuTimer","window","setTimeout","MOBILE_CONTEXT_MENU_TIMEOUT","clearContextMenuTimer","clearTimeout","focused","ctrlKey","openSearch","closeSearch","_this1","initialLeft","initialTop","_this1$manager$contai","isDragging","ghostEl","offsetLeft","offsetTop","_this1$el","_this1$throttledEmitM","isConnected","deltaX","abs","deltaY","DRAG_THRESHOLD","setPointerCapture","pointerId","restoredWidth","lastState","clickRatio","titleBarRect","offsetY","posX","posY","restore","setPosition","newLeft","newTop","_onPointerUp2","releasePointerCapture","_asyncToGenerator2","_callee","_context","updateVirtualization","_this10","handle","_this10$manager$conta","replace","_this10$el","startLeft","startTop","_this10$options","_this10$throttledEmit","_onPointerUp3","_callee2","_context2","classStr","classes","trim","split","hasPrefix","some","hasIcon","pos","getPosition","getSize","round","zIndex","_virtualize","_callee3","level","currentIndex","targetIndex","img","_t2","_context3","getUnsafeContentLevel","virtualizationHierarchy","cleanupVirtualizationStyles","capture","canvasSnapshot","error","updateTaskbarItem","_x","_this11","previousLevel","requestAnimationFrame","results","destroyWindow","_this12","doMinimize","blur","_globalConfig$virtual","enableVirtualization","minimizeVirtualizeTimer","virtualize","virtualizationDelay","enableAnimations","transformOrigin","_calculateTransformOrigin","once","maximize","_this13","doMaximize","maxBtn","_this14","doRestore","removeAttribute","transition","_doRestore","_callee4","_context4","restoreMode","focusWindow","_this15","_this16","reloadContent","_iframe$contentWindow","contentWindow","location","reload","activeTabIndex","activeTab","tabContentOptions","contentContainer","childManager","applyGlobalConfig","init","_this17","_input","select","s","caseBtn","regexBtn","wordBtn","firstChild","updateSearchButtonState","input","shiftKey","navigateSearch","clearSearchHighlights","searchResults","currentSearchIndex","updateSearchResults","highlightCurrentResult","_this18","scrollIntoView","behavior","block","area","replaceChild","createTextNode","normalize","current","total","query","searchRoot","contentArea","escapeRegex","RegExp","borderColor","currentNode","newHighlights","nodesToModify","walker","createTreeWalker","NodeFilter","SHOW_TEXT","node","_node$parentElement","_node$parentElement2","_node$parentElement3","parentElement","FILTER_REJECT","FILTER_ACCEPT","nextNode","_textNode$textContent","textNode","matches","match","_loop","_nodesToModify$_i","_nodesToModify","_i","part","highlight","removeChild","type","postMessage","getChildManager","createWindow","winOptions","popup","assign","popupOptionsWithParent","popupAsync","_capture","_callee5","canvas","_e","_t3","_this19","_context5","html2canvas","reject","allowTaint","useCORS","logging","onclone","clonedDoc","_clonedDoc$querySelec","toDataURL","stack","_printFrame$contentWi","_printFrame$contentWi4","contentSource","getContent","printFrame","position","border","transform","body","frameDoc","open","write","getTitle","outerHTML","_ref4","_printFrame$contentWi5","doPrint","_callee6","_printFrame$contentWi2","_printFrame$contentWi3","_context6","print","readyState","_iframe$contentWindow2","_iframe$contentWindow3","sanitizeHTML","isFontAwesome","alt","finalX","finalY","parentRect","winWidth","winHeight","min","clampedOpacity","setOpacity","_styles","_dark","_default","_highContrast","_window2","_createForOfIteratorHelper","_arrayLikeToArray","_unsupportedIterableToArray","_n","F","WindowManager","initialConfig","registerTheme","defaultTheme","darkTheme","highContrastTheme","_isInitialized","enableDebugMode","enableTaskbar","taskbarEl","createTaskbar","updateTaskbarLayout","flexDirection","autoDetectBootstrapTheme","startBootstrapThemeObserver","stopBootstrapThemeObserver","parentEl","styleTag","getStyleData","head","containerEl","workspaceEl","getComputedStyle","theme","setTheme","activeEl","activeElement","winEl","win","windows","activeWindow","clickedContextMenu","hideContextMenu","clickedWindow","clickedTaskbar","active","event","data","_step","isSourceValid","_iterator","source","err","setupShortcutListeners","newTab","cleanSourceOptions","mergedWindowOptions","_targetWindow$options","_targetWindow$options2","windowSwitchShortcut","parseShortcut","toLowerCase","ctrl","altKey","shift","targetWindow","startsWith","keyNum","numTabs","getTabs","_findAndExecShortcut","menuItems","_step2","_iterator2","item","_item$action","_shortcut","toUpperCase","replaceStringVariable","str","_options$ifExists","ensureInitialized","existingWindow","creationOptions","nextPos","containerRect","centerPos","resetCascade","lastAutoPosition","_step3","lastPosWindowFound","_iterator3","_win","CASCADE_OFFSET","allWindows","createTaskbarItem","zIndexCounterOnTop","zIndexCounter","_options$modal","_options$alwaysOnTop","_options$focus","buttons","buttonPresets","Ok","OkCancel","Yes","YesNo","YesNoCancel","Retry","RetryCancel","AbortRetryIgnore","timeoutId","closeCallback","result","_options$onClose","messageHTML","buttonsHTML","btn","contentHTML","autoWidth","_this$workspaceEl","_this$workspaceEl2","temp","visibility","whiteSpace","lastPopupPosition","_step4","_iterator4","_win2","timeout","opt","tmpOnClose","deactivateFocusTrap","nextWin","_this$activeWindow","_win$options$_taskbar","enableFocusTrapping","activateFocusTrap","_w$options$_taskbarIt","element","_this$workspaceEl3","_this$workspaceEl4","contextWindow","contextMenuEl","_this$contextMenuEl","menuWidth","menuHeight","_window","screenWidth","innerWidth","screenHeight","innerHeight","_this$contextMenuEl2","themes","themeObj","activeTheme","_Object$entries","entries","variables","_Object$entries$_i","_slicedToArray2","removeProperty","_i2","_Object$entries2","_Object$entries2$_i","_key","_value","setProperty","taskbar","order","paddingTop","paddingBottom","paddingLeft","paddingRight","computedStyle","taskbarHeight","taskbarWidth","windowId","updateTaskbarItemContent","_win$options","indicateVirtualizationInTaskbar","boundTabPressHandler","focusableElements","hasAttribute","nextIndex","_updateVirtualization","_this$globalConfig$vi","threshold","_iterator5","_step5","viewportRect","targetWin","targetRect","samplePoints","_i3","_samplePoints","point","pointIsOccluded","j","_occluderWin$getOpaci","occluderWin","occluderRect","virtualizationThreshold","sort","b","right","bottom","getOpacity","bootstrapThemeObserver","highContrastMatcher","matchMedia","highContrastListener","stopAutoThemeListener","applyBootstrapTheme","documentElement","getAttribute","targetNode","MutationObserver","mutationsList","_this0$highContrastMa","_step6","_iterator6","mutation","attributeName","themeValue","observe","attributes","attributeFilter","disconnect","startAutoThemeListener","prefersColorSchemeListener","prefersDarkMatcher","_document","_version","currentScript","api","setGlobalConfig","eventName","listener","off","_len","args","createPopup","createAsyncPopup","getWindowFromElement","getActiveWindow","setDefaultConfig","isInitialized","getRegisteredThemes","getTheme","version","LIB_VERSION","POPUP_TIMEOUT_RESULT","POPUP_CLOSE_BUTTON_RESULT","WinLet","WinLetBaseClass","events","handler","original","handlers","h","handlerObj","Utils","random","substring","seen","WeakMap","Date","getTime","copiedMap","Set","copiedSet","arrCopy","copiedObj","hasOwnProperty","output","sourceValue","targetValue","obj","_","string","func","lastArgs"],"sources":["node_modules/browser-pack/_prelude.js","node_modules/@babel/runtime/helpers/OverloadYield.js","node_modules/@babel/runtime/helpers/arrayLikeToArray.js","node_modules/@babel/runtime/helpers/arrayWithHoles.js","node_modules/@babel/runtime/helpers/arrayWithoutHoles.js","node_modules/@babel/runtime/helpers/assertThisInitialized.js","node_modules/@babel/runtime/helpers/asyncToGenerator.js","node_modules/@babel/runtime/helpers/classCallCheck.js","node_modules/@babel/runtime/helpers/construct.js","node_modules/@babel/runtime/helpers/createClass.js","node_modules/@babel/runtime/helpers/defineProperty.js","node_modules/@babel/runtime/helpers/getPrototypeOf.js","node_modules/@babel/runtime/helpers/inherits.js","node_modules/@babel/runtime/helpers/interopRequireDefault.js","node_modules/@babel/runtime/helpers/isNativeFunction.js","node_modules/@babel/runtime/helpers/isNativeReflectConstruct.js","node_modules/@babel/runtime/helpers/iterableToArray.js","node_modules/@babel/runtime/helpers/iterableToArrayLimit.js","node_modules/@babel/runtime/helpers/nonIterableRest.js","node_modules/@babel/runtime/helpers/nonIterableSpread.js","node_modules/@babel/runtime/helpers/possibleConstructorReturn.js","node_modules/@babel/runtime/helpers/regenerator.js","node_modules/@babel/runtime/helpers/regeneratorAsync.js","node_modules/@babel/runtime/helpers/regeneratorAsyncGen.js","node_modules/@babel/runtime/helpers/regeneratorAsyncIterator.js","node_modules/@babel/runtime/helpers/regeneratorDefine.js","node_modules/@babel/runtime/helpers/regeneratorKeys.js","node_modules/@babel/runtime/helpers/regeneratorRuntime.js","node_modules/@babel/runtime/helpers/regeneratorValues.js","node_modules/@babel/runtime/helpers/setPrototypeOf.js","node_modules/@babel/runtime/helpers/slicedToArray.js","node_modules/@babel/runtime/helpers/toConsumableArray.js","node_modules/@babel/runtime/helpers/toPrimitive.js","node_modules/@babel/runtime/helpers/toPropertyKey.js","node_modules/@babel/runtime/helpers/typeof.js","node_modules/@babel/runtime/helpers/unsupportedIterableToArray.js","node_modules/@babel/runtime/helpers/wrapNativeSuper.js","node_modules/@babel/runtime/regenerator/index.js","src/const/config.ts","src/const/errors.ts","src/const/types.ts","src/function/window.ts","src/function/window_manager.ts","src/index.ts","src/libs/baseclass.ts","src/libs/utils.ts","src/style/styles.ts","src/style/themes/dark.ts","src/style/themes/default.ts","src/style/themes/high-contrast.ts","src/version.ts"],"sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","function _OverloadYield(e, d) {\n  this.v = e, this.k = d;\n}\nmodule.exports = _OverloadYield, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _arrayLikeToArray(r, a) {\n  (null == a || a > r.length) && (a = r.length);\n  for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e];\n  return n;\n}\nmodule.exports = _arrayLikeToArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _arrayWithHoles(r) {\n  if (Array.isArray(r)) return r;\n}\nmodule.exports = _arrayWithHoles, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var arrayLikeToArray = require(\"./arrayLikeToArray.js\");\nfunction _arrayWithoutHoles(r) {\n  if (Array.isArray(r)) return arrayLikeToArray(r);\n}\nmodule.exports = _arrayWithoutHoles, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _assertThisInitialized(e) {\n  if (void 0 === e) throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  return e;\n}\nmodule.exports = _assertThisInitialized, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function asyncGeneratorStep(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c),\n      u = i.value;\n  } catch (n) {\n    return void e(n);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator(n) {\n  return function () {\n    var t = this,\n      e = arguments;\n    return new Promise(function (r, o) {\n      var a = n.apply(t, e);\n      function _next(n) {\n        asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n);\n      }\n      function _throw(n) {\n        asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n);\n      }\n      _next(void 0);\n    });\n  };\n}\nmodule.exports = _asyncToGenerator, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _classCallCheck(a, n) {\n  if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\");\n}\nmodule.exports = _classCallCheck, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var isNativeReflectConstruct = require(\"./isNativeReflectConstruct.js\");\nvar setPrototypeOf = require(\"./setPrototypeOf.js\");\nfunction _construct(t, e, r) {\n  if (isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments);\n  var o = [null];\n  o.push.apply(o, e);\n  var p = new (t.bind.apply(t, o))();\n  return r && setPrototypeOf(p, r.prototype), p;\n}\nmodule.exports = _construct, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var toPropertyKey = require(\"./toPropertyKey.js\");\nfunction _defineProperties(e, r) {\n  for (var t = 0; t < r.length; t++) {\n    var o = r[t];\n    o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, toPropertyKey(o.key), o);\n  }\n}\nfunction _createClass(e, r, t) {\n  return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", {\n    writable: !1\n  }), e;\n}\nmodule.exports = _createClass, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var toPropertyKey = require(\"./toPropertyKey.js\");\nfunction _defineProperty(e, r, t) {\n  return (r = toPropertyKey(r)) in e ? Object.defineProperty(e, r, {\n    value: t,\n    enumerable: !0,\n    configurable: !0,\n    writable: !0\n  }) : e[r] = t, e;\n}\nmodule.exports = _defineProperty, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _getPrototypeOf(t) {\n  return module.exports = _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) {\n    return t.__proto__ || Object.getPrototypeOf(t);\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports, _getPrototypeOf(t);\n}\nmodule.exports = _getPrototypeOf, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var setPrototypeOf = require(\"./setPrototypeOf.js\");\nfunction _inherits(t, e) {\n  if (\"function\" != typeof e && null !== e) throw new TypeError(\"Super expression must either be null or a function\");\n  t.prototype = Object.create(e && e.prototype, {\n    constructor: {\n      value: t,\n      writable: !0,\n      configurable: !0\n    }\n  }), Object.defineProperty(t, \"prototype\", {\n    writable: !1\n  }), e && setPrototypeOf(t, e);\n}\nmodule.exports = _inherits, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _interopRequireDefault(e) {\n  return e && e.__esModule ? e : {\n    \"default\": e\n  };\n}\nmodule.exports = _interopRequireDefault, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _isNativeFunction(t) {\n  try {\n    return -1 !== Function.toString.call(t).indexOf(\"[native code]\");\n  } catch (n) {\n    return \"function\" == typeof t;\n  }\n}\nmodule.exports = _isNativeFunction, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _isNativeReflectConstruct() {\n  try {\n    var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n  } catch (t) {}\n  return (module.exports = _isNativeReflectConstruct = function _isNativeReflectConstruct() {\n    return !!t;\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports)();\n}\nmodule.exports = _isNativeReflectConstruct, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _iterableToArray(r) {\n  if (\"undefined\" != typeof Symbol && null != r[Symbol.iterator] || null != r[\"@@iterator\"]) return Array.from(r);\n}\nmodule.exports = _iterableToArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _iterableToArrayLimit(r, l) {\n  var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"];\n  if (null != t) {\n    var e,\n      n,\n      i,\n      u,\n      a = [],\n      f = !0,\n      o = !1;\n    try {\n      if (i = (t = t.call(r)).next, 0 === l) {\n        if (Object(t) !== t) return;\n        f = !1;\n      } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0);\n    } catch (r) {\n      o = !0, n = r;\n    } finally {\n      try {\n        if (!f && null != t[\"return\"] && (u = t[\"return\"](), Object(u) !== u)) return;\n      } finally {\n        if (o) throw n;\n      }\n    }\n    return a;\n  }\n}\nmodule.exports = _iterableToArrayLimit, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nmodule.exports = _nonIterableRest, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nmodule.exports = _nonIterableSpread, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var _typeof = require(\"./typeof.js\")[\"default\"];\nvar assertThisInitialized = require(\"./assertThisInitialized.js\");\nfunction _possibleConstructorReturn(t, e) {\n  if (e && (\"object\" == _typeof(e) || \"function\" == typeof e)) return e;\n  if (void 0 !== e) throw new TypeError(\"Derived constructors may only return object or undefined\");\n  return assertThisInitialized(t);\n}\nmodule.exports = _possibleConstructorReturn, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var regeneratorDefine = require(\"./regeneratorDefine.js\");\nfunction _regenerator() {\n  /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */\n  var e,\n    t,\n    r = \"function\" == typeof Symbol ? Symbol : {},\n    n = r.iterator || \"@@iterator\",\n    o = r.toStringTag || \"@@toStringTag\";\n  function i(r, n, o, i) {\n    var c = n && n.prototype instanceof Generator ? n : Generator,\n      u = Object.create(c.prototype);\n    return regeneratorDefine(u, \"_invoke\", function (r, n, o) {\n      var i,\n        c,\n        u,\n        f = 0,\n        p = o || [],\n        y = !1,\n        G = {\n          p: 0,\n          n: 0,\n          v: e,\n          a: d,\n          f: d.bind(e, 4),\n          d: function d(t, r) {\n            return i = t, c = 0, u = e, G.n = r, a;\n          }\n        };\n      function d(r, n) {\n        for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) {\n          var o,\n            i = p[t],\n            d = G.p,\n            l = i[2];\n          r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0));\n        }\n        if (o || r > 1) return a;\n        throw y = !0, n;\n      }\n      return function (o, p, l) {\n        if (f > 1) throw TypeError(\"Generator is already running\");\n        for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) {\n          i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u);\n          try {\n            if (f = 2, i) {\n              if (c || (o = \"next\"), t = i[o]) {\n                if (!(t = t.call(i, u))) throw TypeError(\"iterator result is not an object\");\n                if (!t.done) return t;\n                u = t.value, c < 2 && (c = 0);\n              } else 1 === c && (t = i[\"return\"]) && t.call(i), c < 2 && (u = TypeError(\"The iterator does not provide a '\" + o + \"' method\"), c = 1);\n              i = e;\n            } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break;\n          } catch (t) {\n            i = e, c = 1, u = t;\n          } finally {\n            f = 1;\n          }\n        }\n        return {\n          value: t,\n          done: y\n        };\n      };\n    }(r, o, i), !0), u;\n  }\n  var a = {};\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n  t = Object.getPrototypeOf;\n  var c = [][n] ? t(t([][n]())) : (regeneratorDefine(t = {}, n, function () {\n      return this;\n    }), t),\n    u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c);\n  function f(e) {\n    return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, regeneratorDefine(e, o, \"GeneratorFunction\")), e.prototype = Object.create(u), e;\n  }\n  return GeneratorFunction.prototype = GeneratorFunctionPrototype, regeneratorDefine(u, \"constructor\", GeneratorFunctionPrototype), regeneratorDefine(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction), GeneratorFunction.displayName = \"GeneratorFunction\", regeneratorDefine(GeneratorFunctionPrototype, o, \"GeneratorFunction\"), regeneratorDefine(u), regeneratorDefine(u, o, \"Generator\"), regeneratorDefine(u, n, function () {\n    return this;\n  }), regeneratorDefine(u, \"toString\", function () {\n    return \"[object Generator]\";\n  }), (module.exports = _regenerator = function _regenerator() {\n    return {\n      w: i,\n      m: f\n    };\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports)();\n}\nmodule.exports = _regenerator, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var regeneratorAsyncGen = require(\"./regeneratorAsyncGen.js\");\nfunction _regeneratorAsync(n, e, r, t, o) {\n  var a = regeneratorAsyncGen(n, e, r, t, o);\n  return a.next().then(function (n) {\n    return n.done ? n.value : a.next();\n  });\n}\nmodule.exports = _regeneratorAsync, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var regenerator = require(\"./regenerator.js\");\nvar regeneratorAsyncIterator = require(\"./regeneratorAsyncIterator.js\");\nfunction _regeneratorAsyncGen(r, e, t, o, n) {\n  return new regeneratorAsyncIterator(regenerator().w(r, e, t, o), n || Promise);\n}\nmodule.exports = _regeneratorAsyncGen, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var OverloadYield = require(\"./OverloadYield.js\");\nvar regeneratorDefine = require(\"./regeneratorDefine.js\");\nfunction AsyncIterator(t, e) {\n  function n(r, o, i, f) {\n    try {\n      var c = t[r](o),\n        u = c.value;\n      return u instanceof OverloadYield ? e.resolve(u.v).then(function (t) {\n        n(\"next\", t, i, f);\n      }, function (t) {\n        n(\"throw\", t, i, f);\n      }) : e.resolve(u).then(function (t) {\n        c.value = t, i(c);\n      }, function (t) {\n        return n(\"throw\", t, i, f);\n      });\n    } catch (t) {\n      f(t);\n    }\n  }\n  var r;\n  this.next || (regeneratorDefine(AsyncIterator.prototype), regeneratorDefine(AsyncIterator.prototype, \"function\" == typeof Symbol && Symbol.asyncIterator || \"@asyncIterator\", function () {\n    return this;\n  })), regeneratorDefine(this, \"_invoke\", function (t, o, i) {\n    function f() {\n      return new e(function (e, r) {\n        n(t, i, e, r);\n      });\n    }\n    return r = r ? r.then(f, f) : f();\n  }, !0);\n}\nmodule.exports = AsyncIterator, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _regeneratorDefine(e, r, n, t) {\n  var i = Object.defineProperty;\n  try {\n    i({}, \"\", {});\n  } catch (e) {\n    i = 0;\n  }\n  module.exports = _regeneratorDefine = function regeneratorDefine(e, r, n, t) {\n    if (r) i ? i(e, r, {\n      value: n,\n      enumerable: !t,\n      configurable: !t,\n      writable: !t\n    }) : e[r] = n;else {\n      var o = function o(r, n) {\n        _regeneratorDefine(e, r, function (e) {\n          return this._invoke(r, n, e);\n        });\n      };\n      o(\"next\", 0), o(\"throw\", 1), o(\"return\", 2);\n    }\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports, _regeneratorDefine(e, r, n, t);\n}\nmodule.exports = _regeneratorDefine, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _regeneratorKeys(e) {\n  var n = Object(e),\n    r = [];\n  for (var t in n) r.unshift(t);\n  return function e() {\n    for (; r.length;) if ((t = r.pop()) in n) return e.value = t, e.done = !1, e;\n    return e.done = !0, e;\n  };\n}\nmodule.exports = _regeneratorKeys, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var OverloadYield = require(\"./OverloadYield.js\");\nvar regenerator = require(\"./regenerator.js\");\nvar regeneratorAsync = require(\"./regeneratorAsync.js\");\nvar regeneratorAsyncGen = require(\"./regeneratorAsyncGen.js\");\nvar regeneratorAsyncIterator = require(\"./regeneratorAsyncIterator.js\");\nvar regeneratorKeys = require(\"./regeneratorKeys.js\");\nvar regeneratorValues = require(\"./regeneratorValues.js\");\nfunction _regeneratorRuntime() {\n  \"use strict\";\n\n  var r = regenerator(),\n    e = r.m(_regeneratorRuntime),\n    t = (Object.getPrototypeOf ? Object.getPrototypeOf(e) : e.__proto__).constructor;\n  function n(r) {\n    var e = \"function\" == typeof r && r.constructor;\n    return !!e && (e === t || \"GeneratorFunction\" === (e.displayName || e.name));\n  }\n  var o = {\n    \"throw\": 1,\n    \"return\": 2,\n    \"break\": 3,\n    \"continue\": 3\n  };\n  function a(r) {\n    var e, t;\n    return function (n) {\n      e || (e = {\n        stop: function stop() {\n          return t(n.a, 2);\n        },\n        \"catch\": function _catch() {\n          return n.v;\n        },\n        abrupt: function abrupt(r, e) {\n          return t(n.a, o[r], e);\n        },\n        delegateYield: function delegateYield(r, o, a) {\n          return e.resultName = o, t(n.d, regeneratorValues(r), a);\n        },\n        finish: function finish(r) {\n          return t(n.f, r);\n        }\n      }, t = function t(r, _t, o) {\n        n.p = e.prev, n.n = e.next;\n        try {\n          return r(_t, o);\n        } finally {\n          e.next = n.n;\n        }\n      }), e.resultName && (e[e.resultName] = n.v, e.resultName = void 0), e.sent = n.v, e.next = n.n;\n      try {\n        return r.call(this, e);\n      } finally {\n        n.p = e.prev, n.n = e.next;\n      }\n    };\n  }\n  return (module.exports = _regeneratorRuntime = function _regeneratorRuntime() {\n    return {\n      wrap: function wrap(e, t, n, o) {\n        return r.w(a(e), t, n, o && o.reverse());\n      },\n      isGeneratorFunction: n,\n      mark: r.m,\n      awrap: function awrap(r, e) {\n        return new OverloadYield(r, e);\n      },\n      AsyncIterator: regeneratorAsyncIterator,\n      async: function async(r, e, t, o, u) {\n        return (n(e) ? regeneratorAsyncGen : regeneratorAsync)(a(r), e, t, o, u);\n      },\n      keys: regeneratorKeys,\n      values: regeneratorValues\n    };\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports)();\n}\nmodule.exports = _regeneratorRuntime, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var _typeof = require(\"./typeof.js\")[\"default\"];\nfunction _regeneratorValues(e) {\n  if (null != e) {\n    var t = e[\"function\" == typeof Symbol && Symbol.iterator || \"@@iterator\"],\n      r = 0;\n    if (t) return t.call(e);\n    if (\"function\" == typeof e.next) return e;\n    if (!isNaN(e.length)) return {\n      next: function next() {\n        return e && r >= e.length && (e = void 0), {\n          value: e && e[r++],\n          done: !e\n        };\n      }\n    };\n  }\n  throw new TypeError(_typeof(e) + \" is not iterable\");\n}\nmodule.exports = _regeneratorValues, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _setPrototypeOf(t, e) {\n  return module.exports = _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports, _setPrototypeOf(t, e);\n}\nmodule.exports = _setPrototypeOf, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var arrayWithHoles = require(\"./arrayWithHoles.js\");\nvar iterableToArrayLimit = require(\"./iterableToArrayLimit.js\");\nvar unsupportedIterableToArray = require(\"./unsupportedIterableToArray.js\");\nvar nonIterableRest = require(\"./nonIterableRest.js\");\nfunction _slicedToArray(r, e) {\n  return arrayWithHoles(r) || iterableToArrayLimit(r, e) || unsupportedIterableToArray(r, e) || nonIterableRest();\n}\nmodule.exports = _slicedToArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var arrayWithoutHoles = require(\"./arrayWithoutHoles.js\");\nvar iterableToArray = require(\"./iterableToArray.js\");\nvar unsupportedIterableToArray = require(\"./unsupportedIterableToArray.js\");\nvar nonIterableSpread = require(\"./nonIterableSpread.js\");\nfunction _toConsumableArray(r) {\n  return arrayWithoutHoles(r) || iterableToArray(r) || unsupportedIterableToArray(r) || nonIterableSpread();\n}\nmodule.exports = _toConsumableArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var _typeof = require(\"./typeof.js\")[\"default\"];\nfunction toPrimitive(t, r) {\n  if (\"object\" != _typeof(t) || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != _typeof(i)) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nmodule.exports = toPrimitive, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var _typeof = require(\"./typeof.js\")[\"default\"];\nvar toPrimitive = require(\"./toPrimitive.js\");\nfunction toPropertyKey(t) {\n  var i = toPrimitive(t, \"string\");\n  return \"symbol\" == _typeof(i) ? i : i + \"\";\n}\nmodule.exports = toPropertyKey, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return module.exports = _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports, _typeof(o);\n}\nmodule.exports = _typeof, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var arrayLikeToArray = require(\"./arrayLikeToArray.js\");\nfunction _unsupportedIterableToArray(r, a) {\n  if (r) {\n    if (\"string\" == typeof r) return arrayLikeToArray(r, a);\n    var t = {}.toString.call(r).slice(8, -1);\n    return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? arrayLikeToArray(r, a) : void 0;\n  }\n}\nmodule.exports = _unsupportedIterableToArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var getPrototypeOf = require(\"./getPrototypeOf.js\");\nvar setPrototypeOf = require(\"./setPrototypeOf.js\");\nvar isNativeFunction = require(\"./isNativeFunction.js\");\nvar construct = require(\"./construct.js\");\nfunction _wrapNativeSuper(t) {\n  var r = \"function\" == typeof Map ? new Map() : void 0;\n  return module.exports = _wrapNativeSuper = function _wrapNativeSuper(t) {\n    if (null === t || !isNativeFunction(t)) return t;\n    if (\"function\" != typeof t) throw new TypeError(\"Super expression must either be null or a function\");\n    if (void 0 !== r) {\n      if (r.has(t)) return r.get(t);\n      r.set(t, Wrapper);\n    }\n    function Wrapper() {\n      return construct(t, arguments, getPrototypeOf(this).constructor);\n    }\n    return Wrapper.prototype = Object.create(t.prototype, {\n      constructor: {\n        value: Wrapper,\n        enumerable: !1,\n        writable: !0,\n        configurable: !0\n      }\n    }), setPrototypeOf(Wrapper, t);\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports, _wrapNativeSuper(t);\n}\nmodule.exports = _wrapNativeSuper, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","// TODO(Babel 8): Remove this file.\n\nvar runtime = require(\"../helpers/regeneratorRuntime\")();\nmodule.exports = runtime;\n\n// Copied from https://github.com/facebook/regenerator/blob/main/packages/runtime/runtime.js#L736=\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  if (typeof globalThis === \"object\") {\n    globalThis.regeneratorRuntime = runtime;\n  } else {\n    Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n  }\n}\n","import { WindowOptions } from \"./types\";\r\n\r\n// Partial<WindowOptions>ではなく、全てのキーを定義して型安全にする\r\nexport const defaultConfig: Required<WindowOptions> = {\r\n\tid: null,\r\n\tifExists: \"focus\",\r\n\ttitle: \"New Window\",\r\n\ticon: null,\r\n\tx: \"auto\",\r\n\ty: \"auto\",\r\n\twidth: 500,\r\n\theight: 400,\r\n\tminWidth: 200,\r\n\tminHeight: 150,\r\n\tvirtualizable: true,\r\n\tanimationOrigin: null,\r\n\twindowOptions: {\r\n\t\tresizableX: true,\r\n\t\tresizableY: true,\r\n\t\tmovable: true,\r\n\t\tclosable: true,\r\n\t\tminimizable: true,\r\n\t\tmaximizable: true,\r\n\t\tmaximizableOnDblClick: true,\r\n\t\tfocus: true,\r\n\t\talwaysOnTop: false,\r\n\t\tuseGhostWindow: false,\r\n\t\topacity: 1.0,\r\n\t\tmodal: false,\r\n\t},\r\n\tcontent: {\r\n\t\thtml: \"\",\r\n\t\tiframe: {\r\n\t\t\tsrc: \"\",\r\n\t\t\tsrcdoc: \"\",\r\n\t\t\tallow: \"\",\r\n\t\t\treferrerPolicy: \"\",\r\n\t\t\tloading: \"lazy\",\r\n\t\t\tsandbox: \"\",\r\n\t\t\tloadWinLet: false,\r\n\t\t},\r\n\t\ttemplate: \"\",\r\n\t},\r\n\tsplitView: {\r\n\t\tdirection: \"horizontal\",\r\n\t\tpanes: [],\r\n\t},\r\n\tstatusBar: {\r\n\t\tenabled: false,\r\n\t\ttext: \"\",\r\n\t\tallowHTML: false,\r\n\t},\r\n\tsearch: {\r\n\t\tenabled: false,\r\n\t\tcaseSensitive: false,\r\n\t\tshowCaseSensitiveButton: true,\r\n\t\tshowRegexButton: true,\r\n\t\tshowWholeWordButton: true,\r\n\t\ttargetSelector: \"\",\r\n\t},\r\n\tmenu: [],\r\n\tmenuStyle: \"default\",\r\n\ttabs: [],\r\n\ttabStyle: \"default\",\r\n\ttabOptions: {\r\n\t\treorderable: false,\r\n\t\tclosable: false,\r\n\t\taddable: false,\r\n\t\tdetachable: false,\r\n\t\tmergeable: false,\r\n\t\tallowIncomingMerge: false,\r\n\t\tonAdd: undefined,\r\n\t\tonMergeAttempt: undefined,\r\n\t},\r\n\ttaskbarOptions: {\r\n\t\tshowIconOnly: true,\r\n\t},\r\n\tcontextMenu: [],\r\n\tcustomControls: [],\r\n\tenableShortcuts: true,\r\n\tcontrolsPosition: \"right\",\r\n\tshowLoadingIndicator: true,\r\n\tlazyLoad: false,\r\n\tdisableMoveEvent: false,\r\n\tdisableResizeEvent: false,\r\n\tvirtualizationStrategy: \"standard\",\r\n\tvirtualizationRestoreMode: \"auto\",\r\n\tshowVirtualizationRefreshButton: true,\r\n\tonOpen: () => {},\r\n\tonClose: () => {},\r\n\tonFocus: () => {},\r\n\tonBlur: () => {},\r\n\tonResize: () => {},\r\n\tonMove: () => {},\r\n\tonReload: () => {},\r\n\tonBeforeClose: () => {},\r\n\tonMoveStart: () => {},\r\n\tonMoveEnd: () => {},\r\n\tonResizeStart: () => {},\r\n\tonResizeEnd: () => {},\r\n\r\n\t_isPopup: false,\r\n\t_parent: null,\r\n\t_taskbarItem: null,\r\n};\r\n","interface ErrorConstructor {\n\tcaptureStackTrace?(targetObject: object, constructorOpt?: Function): void;\n}\n\n/**\n * すべてのカスタムエラーの基底クラス\n */\nexport class WinLetBaseError extends Error {\n\tconstructor(message: string) {\n\t\tsuper(message);\n\t\tthis.name = this.constructor.name;\n\n\t\tconst BuiltInError: ErrorConstructor = Error as ErrorConstructor;\n\t\tif (BuiltInError.captureStackTrace) {\n\t\t\tBuiltInError.captureStackTrace(this, this.constructor);\n\t\t}\n\t}\n}\n\n/**\n * 単純なメッセージのみのエラー\n */\nexport class SimpleError extends WinLetBaseError {\n\tconstructor(message: string) {\n\t\tsuper(message);\n\t}\n}\n\nexport class WinLetError extends SimpleError {}\n","export const LIBRARY_NAME = \"winlet\";\r\n\r\nexport type WindowState = \"normal\" | \"minimized\" | \"maximized\";\r\n/**\r\n * ウィンドウの仮想化レベル\r\n * - `none`: 仮想化されていない状態\r\n * - `frozen`: ウィンドウのコンテンツは保持されるが、インタラクションは停止\r\n * - `suspended`: ウィンドウのコンテンツはDOMから非表示にされ、描画負荷を削減\r\n * - `unloaded`: ウィンドウのコンテンツはメモリから解放され、リソースを最大限制御\r\n */\r\nexport type VirtualizationLevel = \"none\" | \"frozen\" | \"suspended\" | \"unloaded\";\r\n\r\n/**\r\n * アニメーションの基点\r\n * - string: DOMセレクタ\r\n * - HTMLElement: DOM要素\r\n * - MouseEvent: マウスイベント\r\n * - object: 座標 { x: number; y: number }\r\n */\r\nexport type AnimationOrigin = string | HTMLElement | MouseEvent | { x: number; y: number };\r\n\r\n/**\r\n * アニメーションのオプション\r\n */\r\nexport interface AnimationOptions {\r\n\torigin?: AnimationOrigin;\r\n}\r\n\r\nexport interface WindowContentOptions {\r\n\t/**\r\n\t * 直接埋め込むHTML\r\n\t */\r\n\thtml?: string;\r\n\t/**\r\n\t * iframe設定\r\n\t */\r\n\tiframe?: {\r\n\t\tsrc?: HTMLIFrameElement[\"src\"];\r\n\t\tsrcdoc?: HTMLIFrameElement[\"srcdoc\"];\r\n\t\tallow?: HTMLIFrameElement[\"allow\"];\r\n\t\treferrerPolicy?: HTMLIFrameElement[\"referrerPolicy\"];\r\n\t\tloading?: HTMLIFrameElement[\"loading\"];\r\n\t\tsandbox?: string[] | string;\r\n\t\t/**\r\n\t\t * srcdocで生成されるiframe内にWinLetライブラリ自身を読み込むかどうか。\r\n\t\t * trueにする場合、GlobalConfigOptionsでlibraryPathを指定する必要があります。\r\n\t\t */\r\n\t\tloadWinLet?: boolean;\r\n\t};\r\n\t/**\r\n\t * HTMLテンプレートのselector\r\n\t */\r\n\ttemplate?: string;\r\n}\r\n\r\n/**\r\n * 分割ビューのペイン定義\r\n */\r\nexport interface SplitViewPane {\r\n\tid: string;\r\n\tcontent: WindowContentOptions;\r\n\tsize?: string; // \"50%\", \"200px\" など\r\n\tminSize?: string;\r\n\tresizable?: boolean;\r\n}\r\n\r\n/**\r\n * 分割ビューのレイアウト定義\r\n */\r\nexport interface SplitViewOptions {\r\n\tdirection: \"horizontal\" | \"vertical\";\r\n\tpanes: SplitViewPane[];\r\n}\r\n\r\n/**\r\n * ステータスバーのオプション\r\n */\r\nexport interface StatusBarOptions {\r\n\t/**\r\n\t * ステータスバーを表示するかどうか\r\n\t * @default false\r\n\t */\r\n\tenabled?: boolean;\r\n\t/**\r\n\t * 初期テキスト\r\n\t */\r\n\ttext?: string;\r\n\t/**\r\n\t * HTMLを許可するか\r\n\t * @default false\r\n\t */\r\n\tallowHTML?: boolean;\r\n}\r\n\r\n/**\r\n * ウィンドウ内検索機能のオプション\r\n */\r\nexport interface SearchOptions {\r\n\t/**\r\n\t * 検索UIを有効にするか\r\n\t * @default true\r\n\t */\r\n\tenabled?: boolean;\r\n\t/**\r\n\t * 検索時に大文字小文字を区別するか\r\n\t * @default false\r\n\t */\r\n\tcaseSensitive?: boolean;\r\n\t/**\r\n\t * 「大文字/小文字の区別」ボタンを表示するか\r\n\t * @default true\r\n\t */\r\n\tshowCaseSensitiveButton?: boolean;\r\n\t/**\r\n\t * 「正規表現」ボタンを表示するか\r\n\t * @default true\r\n\t */\r\n\tshowRegexButton?: boolean;\r\n\t/**\r\n\t * 「単語単位」ボタンを表示するか\r\n\t * @default true\r\n\t */\r\n\tshowWholeWordButton?: boolean;\r\n\t/**\r\n\t * 検索対象のセレクタ\r\n\t * 指定しない場合はウィンドウのコンテンツ全体\r\n\t */\r\n\ttargetSelector?: string;\r\n}\r\n\r\nexport interface ListenerOptions {\r\n\tonce?: boolean;\r\n}\r\n\r\nexport interface WindowEventMap {\r\n\topen: (win: IWindow) => void;\r\n\tclose: (win: IWindow) => void;\r\n\t\"before-close\": (win: IWindow) => boolean | void;\r\n\tfocus: (win: IWindow) => void;\r\n\tblur: (win: IWindow) => void;\r\n\t\"move-start\": (win: IWindow) => void;\r\n\t\"move-end\": (win: IWindow) => void;\r\n\tmove: (win: IWindow) => void;\r\n\t\"resize-start\": (win: IWindow) => void;\r\n\t\"resize-end\": (win: IWindow) => void;\r\n\tresize: (win: IWindow) => void;\r\n\treload: (win: IWindow) => boolean | void;\r\n\t[key: string]: (...args: any[]) => any;\r\n}\r\n\r\nexport interface GlobalEventMap {\r\n\t\"window-created\": (win: IWindow) => void;\r\n\t\"window-destroyed\": (win: IWindow) => void;\r\n\t[key: string]: (...args: any[]) => any;\r\n}\r\n\r\n// IWindowインターフェースを先に定義することで循環参照を回避\r\nexport interface IWindow {\r\n\treadonly id: string;\r\n\toptions: Required<WindowOptions>;\r\n\tel: HTMLElement;\r\n\tstate: WindowState;\r\n\r\n\ton<K extends keyof WindowEventMap>(eventName: K, listener: WindowEventMap[K], options?: ListenerOptions): void;\r\n\toff<K extends keyof WindowEventMap>(eventName: K, listener: WindowEventMap[K]): void;\r\n\temit<K extends keyof WindowEventMap>(eventName: K, ...args: Parameters<WindowEventMap[K]>): ReturnType<WindowEventMap[K]>[] | undefined;\r\n\r\n\t// --- Public API ---\r\n\t/**\r\n\t * ウィンドウを閉じます。\r\n\t */\r\n\tclose(): void;\r\n\t/**\r\n\t * ウィンドウを最小化します。\r\n\t * @param options - アニメーションのオプション\r\n\t */\r\n\tminimize(options?: AnimationOptions): void;\r\n\t/**\r\n\t * ウィンドウを最大化/元に戻します。\r\n\t */\r\n\ttoggleMaximize(): void;\r\n\t/**\r\n\t * ウィンドウを最大化します。\r\n\t */\r\n\tmaximize(): void;\r\n\t/**\r\n\t * ウィンドウを元に戻します。\r\n\t * @param options - アニメーションのオプション\r\n\t */\r\n\trestore(options?: AnimationOptions): void;\r\n\t/**\r\n\t * ウィンドウをフォーカスします。\r\n\t */\r\n\tfocus(): void;\r\n\t/**\r\n\t * ウィンドウからフォーカスを外します。\r\n\t */\r\n\tblur(): void;\r\n\t/**\r\n\t * 注意を引くためにウィンドウを揺らします。\r\n\t */\r\n\tshake(): void;\r\n\t/**\r\n\t * ウィンドウの内容をキャプチャして、画像データとして取得します。\r\n\t * @returns PNG形式のデータURLを含むPromise\r\n\t * @see https://github.com/niklasvh/html2canvas\r\n\t */\r\n\tcapture(): Promise<string>;\r\n\t/**\r\n\t * ウィンドウのコンテンツを印刷します。\r\n\t */\r\n\tprint(): void;\r\n\tgetTitle(): string;\r\n\tsetTitle(title: string): void;\r\n\tsetIcon(icon: string | null): void;\r\n\tgetPosition(): { x: number; y: number };\r\n\tsetPosition(x: number | \"center\" | \"left\" | \"right\" | \"auto\", y: number | \"center\" | \"top\" | \"bottom\" | \"auto\"): void;\r\n\tgetSize(): { width: number; height: number };\r\n\tsetSize(width: number | string, height: number | string): void;\r\n\t/**\r\n\t * ウィンドウの不透明度を設定します。\r\n\t * @param opacity 0.0 (透明) から 1.0 (不透明) の間の値\r\n\t */\r\n\tsetOpacity(opacity: number): void;\r\n\t/**\r\n\t * ウィンドウをリロードします。\r\n\t */\r\n\treload(): void;\r\n\r\n\t/**\r\n\t * ウィンドウのコンテンツ要素（またはiframe要素）を取得します。\r\n\t * @returns コンテンツを内包するHTMLElement、またはiframeウィンドウの場合はHTMLIFrameElement\r\n\t */\r\n\tgetContent(): HTMLElement | HTMLIFrameElement;\r\n\r\n\t/**\r\n\t * ステータスバーのテキストを更新します。\r\n\t * @param text - 表示するテキストまたはHTML\r\n\t */\r\n\tsetStatusBarText(text: string): void;\r\n\r\n\t/**\r\n\t * ウィンドウ内検索UIを開きます。\r\n\t */\r\n\topenSearch(): void;\r\n\r\n\t/**\r\n\t * ウィンドウ内検索UIを閉じます。\r\n\t */\r\n\tcloseSearch(): void;\r\n\r\n\t/**\r\n\t * このウィンドウの内部に新しいウィンドウを作成します。\r\n\t * @param options - 新しいウィンドウのオプション\r\n\t * @returns 作成されたIWindowインスタンス\r\n\t */\r\n\tcreateWindow(options?: WindowOptions): IWindow;\r\n\r\n\t/**\r\n\t * このウィンドウの内部に新しいポップアップを作成します。\r\n\t * @param options - 新しいポップアップのオプション\r\n\t * @returns 作成されたIWindowインスタンス\r\n\t */\r\n\tcreatePopup(options: PopupOptions): IWindow;\r\n\t/**\r\n\t * このウィンドウの内部に新しいポップアップを作成します。\r\n\t * @param options - 新しいポップアップのオプション\r\n\t * @returns Promiseオブジェクト\r\n\t */\r\n\tcreateAsyncPopup(options: PopupOptions): Promise<PopupResult>;\r\n\r\n\t/**\r\n\t * ウィンドウのオプションを動的に変更します。\r\n\t *\r\n\t * (初期化時に使用されるオプションは変更されず、警告なども出力されません。)\r\n\t *\r\n\t * @param options - 変更したいオプション\r\n\t */\r\n\tsetOptions(options: Partial<WindowOptions>): void;\r\n}\r\n\r\nexport interface MenuItem {\r\n\tname?: string;\r\n\taction?: (win: IWindow) => void;\r\n\titems?: MenuItem[];\r\n\tseparator?: boolean;\r\n\tshortcut?: string;\r\n}\r\n\r\nexport interface TabItem {\r\n\ttitle: string;\r\n\tcontent: WindowContentOptions;\r\n}\r\n\r\nexport interface ContextMenuItem {\r\n\tname?: string;\r\n\taction?: (win: IWindow) => void;\r\n\tseparator?: boolean;\r\n}\r\n\r\nexport interface CustomControlButton {\r\n\t/**\r\n\t * ボタンを識別するための一意の名前\r\n\t */\r\n\tname: string;\r\n\t/**\r\n\t * ボタンのHTMLコンテンツ (例: '<i class=\"fa fa-question\"></i>')\r\n\t */\r\n\thtml: string;\r\n\t/**\r\n\t * ボタンのツールチップテキスト\r\n\t */\r\n\ttitle?: string;\r\n\t/**\r\n\t * ボタンクリック時のアクション\r\n\t */\r\n\taction: (win: IWindow) => void;\r\n}\r\n\r\nexport interface WindowOptions {\r\n\t/**\r\n\t * ウィンドウのID\r\n\t */\r\n\tid?: string | null;\r\n\t/**\r\n\t * 既に同名のウィンドウが存在する場合の動作\r\n\t *\r\n\t * focus (デフォルト): 既存のウィンドウを復元し、フォーカスします。\r\n\t * prevent: 新しいウィンドウを作成せず、処理を中断します。\r\n\t * create: IDの重複を無視して、常に新しいウィンドウを作成します。\r\n\t */\r\n\tifExists?: \"focus\" | \"prevent\" | \"create\";\r\n\t/**\r\n\t * ウィンドウのタイトル\r\n\t */\r\n\ttitle?: string;\r\n\t/**\r\n\t * ウィンドウのアイコン\r\n\t *\r\n\t * url / font-awesomeのクラス名の指定可能\r\n\t */\r\n\ticon?: string | null;\r\n\t/**\r\n\t * ウィンドウのX座標\r\n\t */\r\n\tx?: number | \"center\" | \"left\" | \"right\" | \"auto\";\r\n\t/**\r\n\t * ウィンドウのY座標\r\n\t */\r\n\ty?: number | \"center\" | \"top\" | \"bottom\" | \"auto\";\r\n\t/**\r\n\t * ウィンドウのサイズX\r\n\t */\r\n\twidth?: number;\r\n\t/**\r\n\t * ウィンドウのサイズY\r\n\t */\r\n\theight?: number;\r\n\t/**\r\n\t * ウィンドウの最小サイズX\r\n\t */\r\n\tminWidth?: number;\r\n\t/**\r\n\t * ウィンドウの最小サイズY\r\n\t */\r\n\tminHeight?: number;\r\n\t/**\r\n\t * ウィンドウが仮想化の対象となるかどうか。\r\n\t * `enableVirtualization` がtrueの場合にのみ有効です。\r\n\t * @default true\r\n\t */\r\n\tvirtualizable?: boolean;\r\n\t/**\r\n\t * 拡大・縮小アニメーションの基点を指定します。\r\n\t * - セレクタ文字列 (e.g., '#my-button')\r\n\t * - HTMLElement\r\n\t * - MouseEvent\r\n\t * - 座標オブジェクト {x: number, y: number}\r\n\t */\r\n\tanimationOrigin?: AnimationOrigin | null;\r\n\t/**\r\n\t * ウィンドウのオプション\r\n\t */\r\n\twindowOptions?: {\r\n\t\t/**\r\n\t\t * 水平方向のリサイズ\r\n\t\t */\r\n\t\tresizableX?: boolean;\r\n\t\t/**\r\n\t\t * 垂直方向のリサイズ\r\n\t\t */\r\n\t\tresizableY?: boolean;\r\n\t\t/**\r\n\t\t * ウィンドウの移動\r\n\t\t */\r\n\t\tmovable?: boolean;\r\n\t\t/**\r\n\t\t * ウィンドウを閉じるボタンの表示\r\n\t\t */\r\n\t\tclosable?: boolean;\r\n\t\t/**\r\n\t\t * ウィンドウを最小化するボタンの表示\r\n\t\t */\r\n\t\tminimizable?: boolean;\r\n\t\t/**\r\n\t\t * ウィンドウを最大化するボタンの表示\r\n\t\t */\r\n\t\tmaximizable?: boolean;\r\n\t\t/**\r\n\t\t * タイトルバーのダブルクリックで最大化\r\n\t\t */\r\n\t\tmaximizableOnDblClick?: boolean;\r\n\t\t/**\r\n\t\t * ウィンドウを常に最前面に表示するかどうか\r\n\t\t */\r\n\t\talwaysOnTop?: boolean;\r\n\t\t/**\r\n\t\t * ドラッグ・リサイズ時にゴーストウィンドウ（輪郭）を表示するか\r\n\t\t */\r\n\t\tuseGhostWindow?: boolean;\r\n\t\t/**\r\n\t\t * 作成時にウィンドウにフォーカスを当てるか\r\n\t\t */\r\n\t\tfocus?: boolean;\r\n\t\t/**\r\n\t\t * ウィンドウの不透明度 (0.0 - 1.0)\r\n\t\t */\r\n\t\topacity?: number;\r\n\t\t/**\r\n\t\t * ウィンドウをモーダルとして扱うか\r\n\t\t * trueの場合、このウィンドウ以外は操作できなくなります。\r\n\t\t */\r\n\t\tmodal?: boolean;\r\n\t};\r\n\t/**\r\n\t * ウィンドウのコンテンツ\r\n\t */\r\n\tcontent?: WindowContentOptions;\r\n\t/**\r\n\t * 分割ビューの定義。\r\n\t * `content`オプションと同時に指定された場合、こちらが優先されます。\r\n\t */\r\n\tsplitView?: SplitViewOptions;\r\n\t/**\r\n\t * ステータスバーのオプション\r\n\t */\r\n\tstatusBar?: StatusBarOptions;\r\n\t/**\r\n\t * ウィンドウ内検索のオプション\r\n\t */\r\n\tsearch?: SearchOptions;\r\n\t/**\r\n\t * メニュー\r\n\t */\r\n\tmenu?: MenuItem[];\r\n\t/**\r\n\t * メニューの表示形式\r\n\t * - default: 通常のメニューバー\r\n\t * - merged: タイトルバーに統合\r\n\t */\r\n\tmenuStyle?: \"default\" | \"merged\";\r\n\t/**\r\n\t * タブ\r\n\t */\r\n\ttabs?: TabItem[];\r\n\t/**\r\n\t * タブの表示形式\r\n\t * - default: 通常のタブバー\r\n\t * - merged: タイトルバーに統合されたChrome風タブ\r\n\t */\r\n\ttabStyle?: \"default\" | \"merged\";\r\n\ttabOptions?: {\r\n\t\t/**\r\n\t\t * タブの入れ替え\r\n\t\t */\r\n\t\treorderable?: boolean;\r\n\t\t/**\r\n\t\t * タブを閉じるボタン\r\n\t\t */\r\n\t\tclosable?: boolean;\r\n\t\t/**\r\n\t\t * タブ追加ボタン\r\n\t\t */\r\n\t\taddable?: boolean;\r\n\t\t/**\r\n\t\t * タブをドラッグして新しいウィンドウとして分離できるようにするか\r\n\t\t */\r\n\t\tdetachable?: boolean;\r\n\t\t/**\r\n\t\t * タブを別の既存のウィンドウにマージすることができます。\r\n\t\t */\r\n\t\tmergeable?: boolean;\r\n\t\t/**\r\n\t\t * このウィンドウが他のウィンドウからマージされたタブを受け入れることができます。\r\n\t\t */\r\n\t\tallowIncomingMerge?: boolean;\r\n\t\t/**\r\n\t\t * 追加ボタン押下時の処理\r\n\t\t */\r\n\t\tonAdd?: (win: IWindow) => TabItem;\r\n\t\t/**\r\n\t\t * マージが許可されているかどうかを動的に決定するコールバック関数。\r\n\t\t * @param sourceWindow タブの元ウィンドウ\r\n\t\t * @param targetWindow ドロップされたタブのウィンドウ\r\n\t\t * @returns true:マージ許可 false:マージ禁止\r\n\t\t */\r\n\t\tonMergeAttempt?: (sourceWindow: IWindow, targetWindow: IWindow) => boolean;\r\n\t};\r\n\t/**\r\n\t * タスクバーアイテムの表示設定\r\n\t */\r\n\ttaskbarOptions?: {\r\n\t\t/**\r\n\t\t * trueにすると、タスクバーにタイトルではなくアイコンを表示します。\r\n\t\t * アイコンが設定されている必要があります。\r\n\t\t */\r\n\t\tshowIconOnly?: boolean;\r\n\t};\r\n\t/**\r\n\t * 右クリックメニュー\r\n\t */\r\n\tcontextMenu?: ContextMenuItem[];\r\n\t/**\r\n\t * タイトルバーに追加するカスタムコントロールボタン\r\n\t */\r\n\tcustomControls?: CustomControlButton[];\r\n\t/**\r\n\t * ショートカットキーを有効化\r\n\t */\r\n\tenableShortcuts?: boolean;\r\n\t/**\r\n\t * コントロールの位置\r\n\t */\r\n\tcontrolsPosition?: \"left\" | \"right\";\r\n\t/**\r\n\t * iframeや非同期コンテンツの読み込み中にローディングインジケーターを表示するか\r\n\t */\r\n\tshowLoadingIndicator?: boolean;\r\n\t/**\r\n\t * コンテンツの読み込みを初回フォーカス時まで遅延させるか\r\n\t * @default false\r\n\t */\r\n\tlazyLoad?: boolean;\r\n\t/**\r\n\t * moveイベントの発火を無効にするか\r\n\t * @default false\r\n\t */\r\n\tdisableMoveEvent?: boolean;\r\n\t/**\r\n\t * resizeイベントの発火を無効にするか\r\n\t * @default false\r\n\t */\r\n\tdisableResizeEvent?: boolean;\r\n\t/**\r\n\t * このウィンドウに適用する仮想化戦略\r\n\t * 'standard': DOMを非表示/解放 (デフォルト)\r\n\t * 'canvas': コンテンツをCanvasに描き出してDOMを解放\r\n\t */\r\n\tvirtualizationStrategy?: \"standard\" | \"canvas\";\r\n\t/**\r\n\t * 仮想化からの復帰モード\r\n\t * 'auto': ウィンドウが可視になった際に自動で復帰 (デフォルト)\r\n\t * 'manual': ユーザーのアクション（クリック、フォーカス、更新ボタン）で復帰\r\n\t */\r\n\tvirtualizationRestoreMode?: \"auto\" | \"manual\";\r\n\t/**\r\n\t * 手動復帰モードの際に更新ボタンを表示するか\r\n\t * @default true\r\n\t */\r\n\tshowVirtualizationRefreshButton?: boolean;\r\n\t/**\r\n\t * ウィンドウオープン時\r\n\t */\r\n\tonOpen?: (win: IWindow) => void;\r\n\t/**\r\n\t * ウィンドウクローズ時\r\n\t */\r\n\tonClose?: (win: IWindow) => void;\r\n\t/**\r\n\t * ウィンドウが閉じる前に呼び出され、falseを返すとクローズをキャンセルします。\r\n\t */\r\n\tonBeforeClose?: (win: IWindow) => boolean | void;\r\n\t/**\r\n\t * ウィンドウフォーカス時\r\n\t */\r\n\tonFocus?: (win: IWindow) => void;\r\n\t/**\r\n\t * ウィンドウブラー時\r\n\t */\r\n\tonBlur?: (win: IWindow) => void;\r\n\t/**\r\n\t * ウィンドウリサイズ時\r\n\t */\r\n\tonResize?: (win: IWindow) => void;\r\n\t/**\r\n\t * ウィンドウの移動開始時\r\n\t */\r\n\tonMoveStart?: (win: IWindow) => void;\r\n\t/**\r\n\t * ウィンドウの移動終了時\r\n\t */\r\n\tonMoveEnd?: (win: IWindow) => void;\r\n\t/**\r\n\t * ウィンドウのリサイズ開始時\r\n\t */\r\n\tonResizeStart?: (win: IWindow) => void;\r\n\t/**\r\n\t * ウィンドウのリサイズ終了時\r\n\t */\r\n\tonResizeEnd?: (win: IWindow) => void;\r\n\t/**\r\n\t * ウィンドウ移動時\r\n\t */\r\n\tonMove?: (win: IWindow) => void;\r\n\t/**\r\n\t * ウィンドウリロード時\r\n\t *\r\n\t * デフォルトのリロード動作（iframeの再読み込みやhtmlの再描画）をキャンセルする場合は `false` を返します。\r\n\t */\r\n\tonReload?: (win: IWindow) => boolean | void;\r\n\r\n\t// 内部利用フラグ\r\n\t_isPopup?: boolean;\r\n\t/**\r\n\t * 親ウィンドウのインスタンス (内部利用)\r\n\t */\r\n\t_parent?: IWindow | null;\r\n\t/**\r\n\t * タスクバーのアイテム要素 (内部利用)\r\n\t */\r\n\t_taskbarItem?: HTMLElement | null;\r\n}\r\n\r\n// --- Popup ---\r\nexport const TIMEOUT_RESULT = Symbol(\"timeout\");\r\nexport const CLOSE_BUTTON_RESULT = Symbol(\"close\");\r\n\r\nexport type PopupResult = string | number | symbol | null;\r\n\r\nexport interface PopupButton {\r\n\ttext: string;\r\n\tvalue: PopupResult;\r\n}\r\n\r\nexport type PopupButtonPreset = \"Ok\" | \"OkCancel\" | \"Yes\" | \"YesNo\" | \"YesNoCancel\" | \"Retry\" | \"RetryCancel\" | \"AbortRetryIgnore\";\r\n\r\nexport interface PopupOptions {\r\n\tmessage: string;\r\n\ttitle?: string;\r\n\ticon?: string | null;\r\n\tbuttons?: PopupButton[] | PopupButtonPreset;\r\n\ttimeout?: number;\r\n\tautoWidth?: boolean;\r\n\tfocus?: boolean;\r\n\talwaysOnTop?: boolean;\r\n\tmodal?: boolean;\r\n\r\n\t/**\r\n\t * ウィンドウクローズ時\r\n\t */\r\n\tonClose?: (result: PopupResult) => void;\r\n\t/**\r\n\t * ウィンドウフォーカス時\r\n\t */\r\n\tonFocus?: (win: IWindow) => void;\r\n\t/**\r\n\t * ウィンドウブラー時\r\n\t */\r\n\tonBlur?: (win: IWindow) => void;\r\n}\r\n\r\nexport interface TaskbarOptions {\r\n\t/**\r\n\t * タスクバーの表示位置\r\n\t * @default 'bottom'\r\n\t */\r\n\tposition?: \"top\" | \"bottom\" | \"left\" | \"right\";\r\n}\r\n\r\nexport interface GlobalConfigOptions {\r\n\twindowSwitchShortcut?: string | null; // 例: \"Ctrl+`\"\r\n\t/**\r\n\t * ウィンドウマネージャを内包する親要素。\r\n\t * セレクタ文字列またはHTMLElementを指定します。\r\n\t * 未指定の場合はbody直下に配置されます。\r\n\t */\r\n\tcontainer?: string | HTMLElement;\r\n\t/**\r\n\t * `srcdoc` iframeでWinLetを自己読込する場合のライブラリのパス。\r\n\t */\r\n\tlibraryPath?: string;\r\n\t/**\r\n\t * ウィンドウ操作時のアニメーションを有効にするか\r\n\t * @default true\r\n\t */\r\n\tenableAnimations?: boolean;\r\n\t/**\r\n\t * 最小化・復元時にタスクバーのアイコンからアニメーションさせるか\r\n\t * @default true\r\n\t */\r\n\tanimateFromTaskbar?: boolean;\r\n\t/**\r\n\t * タスクバーを表示するか\r\n\t * @default false\r\n\t */\r\n\tenableTaskbar?: boolean;\r\n\t/**\r\n\t * タスクバーの設定\r\n\t */\r\n\ttaskbar?: TaskbarOptions;\r\n\t/**\r\n\t * モーダルウィンドウのフォーカストラップを有効にするか\r\n\t * @default true\r\n\t */\r\n\tenableFocusTrapping?: boolean;\r\n\t/**\r\n\t * ウィンドウ仮想化を有効にするか。\r\n\t * 大量のウィンドウを扱う際のパフォーマンスを向上させます。\r\n\t * @default true\r\n\t */\r\n\tenableVirtualization?: boolean;\r\n\t/**\r\n\t * 仮想化されたウィンドウをタスクバーで視覚的に示すか\r\n\t * @default true\r\n\t */\r\n\tindicateVirtualizationInTaskbar?: boolean;\r\n\t/**\r\n\t * グローバルな仮想化戦略\r\n\t * 'standard': DOMを非表示/解放 (デフォルト)\r\n\t * 'canvas': コンテンツをCanvasに描き出してDOMを解放\r\n\t */\r\n\tvirtualizationStrategy?: \"standard\" | \"canvas\";\r\n\t/**\r\n\t * グローバルな仮想化からの復帰モード\r\n\t * 'auto': ウィンドウが可視になった際に自動で復帰 (デフォルト)\r\n\t * 'manual': ユーザーのアクション（クリック、フォーカス、更新ボタン）で復帰\r\n\t */\r\n\tvirtualizationRestoreMode?: \"auto\" | \"manual\";\r\n\t/**\r\n\t * 仮想化がアクティブになる最小ウィンドウ数。\r\n\t * この数を超えると、非表示のウィンドウの仮想化が開始されます。\r\n\t * @default 5\r\n\t */\r\n\tvirtualizationThreshold?: number;\r\n\t/**\r\n\t * 最小化されたウィンドウを仮想化するまでの遅延時間（ミリ秒）。\r\n\t * `enableVirtualization` がtrueの場合にのみ有効です。\r\n\t * @default 10000\r\n\t */\r\n\tvirtualizationDelay?: number;\r\n\t/**\r\n\t * イベントのスロットリング設定 (ミリ秒)\r\n\t */\r\n\teventThrottling?: {\r\n\t\tmoveDelay?: number;\r\n\t\tresizeDelay?: number;\r\n\t};\r\n\t/**\r\n\t * 初期テーマ\r\n\t * 'dark'などの登録済みテーマ名、またはThemeオブジェクトを指定\r\n\t * @default 'default'\r\n\t */\r\n\ttheme?: string | Theme;\r\n\t/**\r\n\t * Bootstrapのカラースキームを自動検出し、テーマを同期させるか\r\n\t * @default true\r\n\t */\r\n\tautoDetectBootstrapTheme?: boolean;\r\n\t/**\r\n\t * デバッグモードを有効にするか。\r\n\t * ウィンドウにID、座標、状態などのデバッグ情報をオーバーレイ表示します。\r\n\t * @default false\r\n\t */\r\n\tenableDebugMode?: boolean;\r\n}\r\n\r\n/**\r\n * テーマの定義\r\n */\r\nexport interface Theme {\r\n\tname: string;\r\n\tvariables: Record<string, string>;\r\n}\r\n\r\n// WinLetの公開APIの型\r\nexport interface WinLetApi {\r\n\tinit: (options?: GlobalConfigOptions) => void;\r\n\ton<K extends keyof GlobalEventMap>(eventName: K, listener: GlobalEventMap[K], options?: ListenerOptions): void;\r\n\toff<K extends keyof GlobalEventMap>(eventName: K, listener: GlobalEventMap[K]): void;\r\n\temit<K extends keyof GlobalEventMap>(eventName: K, ...args: Parameters<GlobalEventMap[K]>): ReturnType<GlobalEventMap[K]>[] | undefined;\r\n\t/**\r\n\t * ウィンドウを作成します。\r\n\t * @param options - 新しいウィンドウのオプション\r\n\t * @returns 作成されたIWindowインスタンス\r\n\t */\r\n\tcreateWindow: (options?: WindowOptions) => IWindow;\r\n\t/**\r\n\t * ポップアップウィンドウを作成します。\r\n\t * @param options - 新しいポップアップのオプション\r\n\t * @returns 作成されたIWindowインスタンス\r\n\t */\r\n\tcreatePopup: (options: PopupOptions) => IWindow;\r\n\t/**\r\n\t * ポップアップウィンドウを作成します。\r\n\t * @param options - 新しいポップアップのオプション\r\n\t * @returns Promiseオブジェクト\r\n\t */\r\n\tcreateAsyncPopup(options: PopupOptions): Promise<PopupResult>;\r\n\t/**\r\n\t * 指定されたIDのウィンドウインスタンスを取得します。\r\n\t * @param id - 取得するウィンドウのID\r\n\t */\r\n\tgetWindow: (id: string) => IWindow | undefined;\r\n\t/**\r\n\t * 指定されたDOM要素を内包するウィンドウインスタンスを取得します。\r\n\t * 入れ子ウィンドウの場合、最も内側にある子ウィンドウを返します。\r\n\t * @param element - 検索の起点となるDOM要素\r\n\t * @returns 発見されたIWindowインスタンス、またはundefined\r\n\t */\r\n\tgetWindowFromElement: (element: HTMLElement) => IWindow | undefined;\r\n\t/**\r\n\t * 現在アクティブなウィンドウを取得します。\r\n\t */\r\n\tgetActiveWindow: () => IWindow | null;\r\n\t/**\r\n\t * タスクバーのアイテムを更新します。\r\n\t * @param win - 更新するウィンドウ\r\n\t * @param state - 更新する状態\r\n\t */\r\n\tupdateTaskbarItem: (win: IWindow, state: \"minimized\" | \"restored\" | \"titleChanged\" | \"iconChanged\" | \"virtualized\" | \"unvirtualized\") => void;\r\n\t/**\r\n\t * ウィンドウのデフォルトの設定を変更します。\r\n\t * @param options - 新しいウィンドウのオプション\r\n\t */\r\n\tsetDefaultConfig: (options: WindowOptions) => void;\r\n\t/**\r\n\t * グローバル設定を変更します。\r\n\t * @param options - 新しいウィンドウのオプション\r\n\t */\r\n\tsetGlobalConfig: (options: GlobalConfigOptions) => void;\r\n\t/**\r\n\t * 表示テーマを登録します。\r\n\t * @param theme - 登録するテーマ\r\n\t */\r\n\tregisterTheme: (theme: Theme) => void;\r\n\t/**\r\n\t * 登録済みのテーマ名の配列を取得します。\r\n\t * @returns 登録済みのテーマ名の配列\r\n\t */\r\n\tgetRegisteredThemes: () => string[];\r\n\t/**\r\n\t * 表示テーマを変更します。\r\n\t * @param theme - 登録済みのテーマ名（'default', 'dark'など）またはThemeオブジェクト\r\n\t */\r\n\tsetTheme: (theme: string | Theme) => void;\r\n\t/**\r\n\t * 現在の表示テーマを取得します。\r\n\t * @returns 現在の表示テーマ\r\n\t */\r\n\tgetTheme: () => Theme | null;\r\n\t/**\r\n\t * WinLetのバージョンを取得します。\r\n\t */\r\n\tget version(): string;\r\n\tPOPUP_TIMEOUT_RESULT: typeof TIMEOUT_RESULT;\r\n\tPOPUP_CLOSE_BUTTON_RESULT: typeof CLOSE_BUTTON_RESULT;\r\n}\r\n\r\n// グローバルスコープのWindowにWinLetプロパティを追加\r\ndeclare global {\r\n\tinterface Window {\r\n\t\tWinLet: WinLetApi;\r\n\r\n\t\t// 外部ライブラリを追加\r\n\t\thtml2canvas?: (element: HTMLElement, options?: any) => Promise<HTMLCanvasElement>;\r\n\t}\r\n}\r\n","import { defaultConfig } from \"../const/config\";\r\nimport { WinLetError } from \"../const/errors\";\r\nimport { AnimationOptions, AnimationOrigin, CLOSE_BUTTON_RESULT, IWindow, LIBRARY_NAME, MenuItem, PopupOptions, PopupResult, SplitViewOptions, TabItem, VirtualizationLevel, WindowContentOptions, WindowEventMap, WindowOptions, WindowState } from \"../const/types\";\r\nimport WinLetBaseClass from \"../libs/baseclass\";\r\nimport Utils from \"../libs/utils\";\r\nimport WindowManager from \"./window_manager\";\r\n\r\nexport default class WinLetWindow extends WinLetBaseClass<WindowEventMap> implements IWindow {\r\n\tpublic readonly id: string;\r\n\tpublic options: Required<WindowOptions>;\r\n\tpublic el: HTMLElement;\r\n\tpublic state: WindowState = \"normal\";\r\n\r\n\tprivate manager: WindowManager;\r\n\tprivate lastState = { x: 0, y: 0, width: 0, height: 0 };\r\n\tprivate focused: boolean = false;\r\n\tprivate readonly DRAG_THRESHOLD = 5;\r\n\r\n\tprivate titleBarEl: HTMLElement;\r\n\tprivate iconEl: HTMLElement;\r\n\tprivate titleEl: HTMLElement;\r\n\tprivate mainContentEl: HTMLElement;\r\n\tprivate contentEl: HTMLElement;\r\n\tprivate loaderEl: HTMLElement;\r\n\tprivate tabs: { tabEl: HTMLElement; contentEl: HTMLElement }[] = [];\r\n\tprivate addTabBtn: HTMLElement | null = null;\r\n\tprivate isMenuOpen = false;\r\n\tprivate boundGlobalClickHandler: ((event: MouseEvent) => void) | null = null;\r\n\r\n\tprivate statusBarEl: HTMLElement | null = null;\r\n\tprivate searchBarEl: HTMLElement | null = null;\r\n\tprivate searchResults: HTMLElement[] = [];\r\n\tprivate currentSearchIndex = -1;\r\n\r\n\t// 検索オプションのライブ状態\r\n\tprivate searchOptionsState = {\r\n\t\tcaseSensitive: false,\r\n\t\tregex: false,\r\n\t\twholeWord: false,\r\n\t};\r\n\r\n\t// モバイル対応\r\n\tprivate readonly MOBILE_CONTEXT_MENU_TIMEOUT = 700;\r\n\tprivate contextMenuTimer: number | null = null;\r\n\r\n\t// Popup用\r\n\tpublic popupCloseCallback: ((result: PopupResult) => void) | null = null;\r\n\r\n\tprivate childManager: WindowManager | null = null;\r\n\tprivate parentWindow: IWindow | null;\r\n\r\n\tprivate debugOverlayEl: HTMLElement | null = null;\r\n\tprivate isContentLoaded = false;\r\n\tprivate throttledEmitMove: (() => void) | null = null;\r\n\tprivate throttledEmitResize: (() => void) | null = null;\r\n\tprivate canvasSnapshot: string | null = null;\r\n\tprivate canvasOverlayEl: HTMLElement | null = null;\r\n\tpublic virtualizationLevel: VirtualizationLevel = \"none\";\r\n\tprivate minimizeVirtualizeTimer: number | null = null;\r\n\tprivate readonly virtualizationHierarchy: readonly VirtualizationLevel[] = [\"none\", \"frozen\", \"suspended\", \"unloaded\"];\r\n\r\n\tconstructor(options: WindowOptions, manager: WindowManager) {\r\n\t\tsuper();\r\n\t\tthis.id = options.id || Utils.generateId(`${LIBRARY_NAME}-window`);\r\n\t\tif (options.id) {\r\n\t\t\tconst existingEl = document.getElementById(options.id);\r\n\t\t\tif (existingEl && existingEl.classList.contains(`${LIBRARY_NAME}-window`)) {\r\n\t\t\t\tthrow new WinLetError(`WinLet: Window with ID \"${options.id}\" already exists. New window will not be created.`);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.manager = manager;\r\n\t\tthis.options = Utils.deepMerge(Utils.deepCopy(defaultConfig), options) as Required<WindowOptions>;\r\n\t\tthis.parentWindow = options._parent || null;\r\n\r\n\t\t// 検索オプションの初期状態を設定\r\n\t\tthis.searchOptionsState.caseSensitive = !!this.options.search.caseSensitive;\r\n\r\n\t\t// イベントスロットリングのセットアップ\r\n\t\tconst throttlingOptions = this.manager.getGlobalConfig().eventThrottling;\r\n\t\tif (!this.options.disableMoveEvent) {\r\n\t\t\tconst delay = throttlingOptions?.moveDelay;\r\n\t\t\tconst emitMove = () => this.emit(\"move\", this);\r\n\t\t\tthis.throttledEmitMove = delay && delay > 0 ? Utils.throttle(emitMove, delay) : emitMove;\r\n\t\t}\r\n\t\tif (!this.options.disableResizeEvent) {\r\n\t\t\tconst delay = throttlingOptions?.resizeDelay;\r\n\t\t\tconst emitResize = () => this.emit(\"resize\", this);\r\n\t\t\tthis.throttledEmitResize = delay && delay > 0 ? Utils.throttle(emitResize, delay) : emitResize;\r\n\t\t}\r\n\r\n\t\tthis.el = this.createDOM();\r\n\r\n\t\t// _isPopupによってクラスを追加\r\n\t\tif (this.options._isPopup) {\r\n\t\t\tthis.el.classList.add(`${LIBRARY_NAME}-popup-window`);\r\n\t\t}\r\n\t\t// tabStyleとmenuStyleによってクラスを追加\r\n\t\tif (this.options.tabStyle === \"merged\") {\r\n\t\t\tthis.el.classList.add(`${LIBRARY_NAME}-tab-style-merged`);\r\n\t\t}\r\n\t\tif (this.options.menuStyle === \"merged\") {\r\n\t\t\tthis.el.classList.add(`${LIBRARY_NAME}-menu-style-merged`);\r\n\t\t}\r\n\t\t// 最前面/モーダル指定によりクラスを追加\r\n\t\tif (this.options.windowOptions.alwaysOnTop) {\r\n\t\t\tthis.el.classList.add(`${LIBRARY_NAME}-always-on-top`);\r\n\t\t}\r\n\t\tif (this.options.windowOptions.modal) {\r\n\t\t\tthis.el.classList.add(`${LIBRARY_NAME}-modal`);\r\n\t\t\tthis.el.setAttribute(\"aria-modal\", \"true\");\r\n\t\t}\r\n\r\n\t\tthis.titleBarEl = this.el.querySelector<HTMLElement>(`.${LIBRARY_NAME}-title-bar`)!;\r\n\t\tthis.iconEl = this.el.querySelector<HTMLElement>(`.${LIBRARY_NAME}-icon`)!;\r\n\t\tthis.titleEl = this.el.querySelector<HTMLElement>(`.${LIBRARY_NAME}-title`)!;\r\n\t\tthis.mainContentEl = this.el.querySelector<HTMLElement>(`.${LIBRARY_NAME}-main-content`)!;\r\n\t\tthis.contentEl = this.mainContentEl.querySelector<HTMLElement>(`.${LIBRARY_NAME}-content`)!;\r\n\t\tthis.loaderEl = this.mainContentEl.querySelector<HTMLElement>(`.${LIBRARY_NAME}-loader-overlay`)!;\r\n\t\tthis.canvasOverlayEl = this.mainContentEl.querySelector<HTMLElement>(`.${LIBRARY_NAME}-canvas-overlay`)!;\r\n\t\tthis.debugOverlayEl = this.el.querySelector<HTMLElement>(`.${LIBRARY_NAME}-debug-overlay`);\r\n\t\tthis.statusBarEl = this.el.querySelector<HTMLElement>(`.${LIBRARY_NAME}-statusbar`);\r\n\r\n\t\tthis.applyOptions();\r\n\t\tthis.setupEventListeners();\r\n\t\tthis.updateDebugOverlay();\r\n\r\n\t\t// Register onXX handlers\r\n\t\tif (this.options.onOpen) this.on(\"open\", this.options.onOpen);\r\n\t\tif (this.options.onClose) this.on(\"close\", this.options.onClose);\r\n\t\tif (this.options.onBeforeClose) this.on(\"before-close\", this.options.onBeforeClose);\r\n\t\tif (this.options.onFocus) this.on(\"focus\", this.options.onFocus);\r\n\t\tif (this.options.onBlur) this.on(\"blur\", this.options.onBlur);\r\n\t\tif (this.options.onMove) this.on(\"move\", this.options.onMove);\r\n\t\tif (this.options.onMoveStart) this.on(\"move-start\", this.options.onMoveStart);\r\n\t\tif (this.options.onMoveEnd) this.on(\"move-end\", this.options.onMoveEnd);\r\n\t\tif (this.options.onResize) this.on(\"resize\", this.options.onResize);\r\n\t\tif (this.options.onResizeStart) this.on(\"resize-start\", this.options.onResizeStart);\r\n\t\tif (this.options.onResizeEnd) this.on(\"resize-end\", this.options.onResizeEnd);\r\n\t\tif (this.options.onReload) this.on(\"reload\", this.options.onReload);\r\n\r\n\t\tthis.emit(\"open\", this);\r\n\t}\r\n\r\n\tprivate _calculateTransformOrigin(origin?: AnimationOrigin | null): string {\r\n\t\tlet originX = 0;\r\n\t\tlet originY = 0;\r\n\r\n\t\tconst winRect = this.el.getBoundingClientRect();\r\n\r\n\t\t// No origin, default to taskbar item if available and enabled\r\n\t\tif (!origin && this.manager.getGlobalConfig().animateFromTaskbar && this.options._taskbarItem) {\r\n\t\t\torigin = this.options._taskbarItem;\r\n\t\t}\r\n\r\n\t\tif (origin instanceof HTMLElement) {\r\n\t\t\tconst rect = origin.getBoundingClientRect();\r\n\t\t\toriginX = rect.left + rect.width / 2;\r\n\t\t\toriginY = rect.top + rect.height / 2;\r\n\t\t} else if (typeof origin === \"string\") {\r\n\t\t\tconst el = document.querySelector(origin);\r\n\t\t\tif (el) {\r\n\t\t\t\tconst rect = el.getBoundingClientRect();\r\n\t\t\t\toriginX = rect.left + rect.width / 2;\r\n\t\t\t\toriginY = rect.top + rect.height / 2;\r\n\t\t\t}\r\n\t\t} else if (origin instanceof MouseEvent) {\r\n\t\t\toriginX = origin.clientX;\r\n\t\t\toriginY = origin.clientY;\r\n\t\t} else if (origin && typeof origin === \"object\" && \"x\" in origin && \"y\" in origin) {\r\n\t\t\toriginX = origin.x;\r\n\t\t\toriginY = origin.y;\r\n\t\t} else {\r\n\t\t\t// Default to window center if no valid origin is provided\r\n\t\t\treturn `50% 50%`;\r\n\t\t}\r\n\r\n\t\t// ウィンドウの左上からの相対座標を計算\r\n\t\tconst relativeX = originX - winRect.left;\r\n\t\tconst relativeY = originY - winRect.top;\r\n\r\n\t\treturn `${relativeX}px ${relativeY}px`;\r\n\t}\r\n\r\n\tprivate createDOM(): HTMLElement {\r\n\t\tconst windowEl = document.createElement(\"div\");\r\n\t\twindowEl.className = `${LIBRARY_NAME}-window`;\r\n\t\twindowEl.id = this.id;\r\n\r\n\t\t// ARIA属性\r\n\t\twindowEl.setAttribute(\"role\", \"application\");\r\n\t\twindowEl.setAttribute(\"aria-labelledby\", `${this.id}-title`);\r\n\t\tif (this.state === \"minimized\") {\r\n\t\t\twindowEl.setAttribute(\"inert\", \"\");\r\n\t\t\twindowEl.setAttribute(\"aria-hidden\", \"true\");\r\n\t\t}\r\n\r\n\t\tconst handles: string[] = [];\r\n\t\tif (this.options.windowOptions.resizableY) {\r\n\t\t\thandles.push(`<div class=\"${LIBRARY_NAME}-resize-handle ${LIBRARY_NAME}-n\"></div>`, `<div class=\"${LIBRARY_NAME}-resize-handle ${LIBRARY_NAME}-s\"></div>`);\r\n\t\t}\r\n\t\tif (this.options.windowOptions.resizableX) {\r\n\t\t\thandles.push(`<div class=\"${LIBRARY_NAME}-resize-handle ${LIBRARY_NAME}-w\"></div>`, `<div class=\"${LIBRARY_NAME}-resize-handle ${LIBRARY_NAME}-e\"></div>`);\r\n\t\t}\r\n\t\tif (this.options.windowOptions.resizableX && this.options.windowOptions.resizableY) {\r\n\t\t\thandles.push(`<div class=\"${LIBRARY_NAME}-resize-handle ${LIBRARY_NAME}-nw\"></div>`, `<div class=\"${LIBRARY_NAME}-resize-handle ${LIBRARY_NAME}-ne\"></div>`, `<div class=\"${LIBRARY_NAME}-resize-handle ${LIBRARY_NAME}-sw\"></div>`, `<div class=\"${LIBRARY_NAME}-resize-handle ${LIBRARY_NAME}-se\"></div>`);\r\n\t\t}\r\n\t\tconst resizableHandlesHTML = handles.join(\"\");\r\n\r\n\t\tconst hasMenu = this.options.menu.length > 0;\r\n\t\tconst hasTabs = this.options.tabs.length > 0;\r\n\t\tconst isMergedMenu = this.options.menuStyle === \"merged\" && hasMenu;\r\n\t\tconst isMergedTabs = this.options.tabStyle === \"merged\" && hasTabs;\r\n\r\n\t\tconst customControlsHTML = (this.options.customControls ?? []).map((c) => `<button class=\"${LIBRARY_NAME}-control-btn ${LIBRARY_NAME}-custom-control-btn\" data-name=\"${c.name}\" title=\"${c.title || \"\"}\" aria-label=\"${c.title || c.name}\">${c.html}</button>`).join(\"\");\r\n\r\n\t\tconst refreshBtnHTML = `<button class=\"${LIBRARY_NAME}-control-btn ${LIBRARY_NAME}-refresh-btn\" title=\"Refresh Content\" aria-label=\"Refresh Content\"><i class=\"fas fa-sync-alt\"></i></button>`;\r\n\t\tconst controlsHTML = `\r\n            <div class=\"${LIBRARY_NAME}-controls\">\r\n\t\t\t\t${customControlsHTML}\r\n\t\t\t\t${refreshBtnHTML}\r\n                ${this.options.windowOptions.minimizable ? `<input class=\"${LIBRARY_NAME}-control-btn ${LIBRARY_NAME}-minimize-btn\" type=\"button\" value=\"\\uff3f\" title=\"Minimize\" aria-label=\"Minimize\"/>` : \"\"}\r\n                ${this.options.windowOptions.maximizable ? `<input class=\"${LIBRARY_NAME}-control-btn ${LIBRARY_NAME}-maximize-btn\" type=\"button\" value=\"\\u25a1\" title=\"Maximize\" aria-label=\"Maximize\"/>` : \"\"}\r\n                ${this.options.windowOptions.closable ? `<input class=\"${LIBRARY_NAME}-control-btn ${LIBRARY_NAME}-close-btn\" type=\"button\" value=\"\\u2573\" title=\"Close\" aria-label=\"Close\"/>` : \"\"}\r\n            </div>`;\r\n\r\n\t\tconst titleBarContentHTML = `\r\n            <div class=\"${LIBRARY_NAME}-icon\"></div>\r\n            ${isMergedMenu ? `<div class=\"${LIBRARY_NAME}-menu-bar\"></div>` : \"\"}\r\n            <div id=\"${this.id}-title\" class=\"${LIBRARY_NAME}-title\"></div>\r\n            ${isMergedTabs ? `<div class=\"${LIBRARY_NAME}-tab-bar\"></div>` : \"\"}\r\n            ${controlsHTML}\r\n        `;\r\n\r\n\t\tconst loaderHTML = `\r\n            <div class=\"${LIBRARY_NAME}-loader-overlay\" style=\"display: none;\">\r\n                <div class=\"${LIBRARY_NAME}-loader-spinner\"></div>\r\n            </div>\r\n        `;\r\n\r\n\t\tconst statusBarHTML = this.options.statusBar.enabled ? `<div class=\"${LIBRARY_NAME}-statusbar\"></div>` : \"\";\r\n\t\tconst debugHTML = `<div class=\"${LIBRARY_NAME}-debug-overlay\"></div>`;\r\n\t\tconst canvasOverlayHTML = `<div class=\"${LIBRARY_NAME}-canvas-overlay\"></div>`;\r\n\r\n\t\twindowEl.innerHTML = `\r\n\t\t\t${debugHTML}\r\n            <div class=\"${LIBRARY_NAME}-title-bar ${LIBRARY_NAME}-us-none\">\r\n                ${titleBarContentHTML}\r\n            </div>\r\n            <div class=\"${LIBRARY_NAME}-main-content\">\r\n                ${!isMergedMenu && hasMenu ? `<div class=\"${LIBRARY_NAME}-menu-bar\" role=\"menubar\"></div>` : \"\"}\r\n                ${!isMergedTabs && hasTabs ? `<div class=\"${LIBRARY_NAME}-tab-bar\" role=\"tablist\"></div>` : \"\"}\r\n                <div class=\"${LIBRARY_NAME}-content\"></div>\r\n\t\t\t\t${loaderHTML}\r\n\t\t\t\t${canvasOverlayHTML}\r\n            </div>\r\n\t\t\t${statusBarHTML}\r\n            ${resizableHandlesHTML}\r\n        `;\r\n\t\treturn windowEl;\r\n\t}\r\n\r\n\tprivate _renderInitialContent(): void {\r\n\t\tif (this.isContentLoaded) return;\r\n\r\n\t\t// 分割ビューが定義されていれば、そちらを優先\r\n\t\tif (this.options.splitView && this.options.splitView.panes.length > 0) {\r\n\t\t\tthis.createSplitView(this.contentEl, this.options.splitView);\r\n\t\t} else if (this.options.tabs.length > 0) {\r\n\t\t\tthis.createTabs();\r\n\t\t} else {\r\n\t\t\tthis.renderContent(this.contentEl, this.options.content);\r\n\t\t}\r\n\t\tthis.isContentLoaded = true;\r\n\t}\r\n\r\n\tprivate applyOptions(): void {\r\n\t\tthis.setTitle(this.options.title);\r\n\t\tthis.setIcon(this.options.icon);\r\n\t\tthis.setSize(this.options.width, this.options.height);\r\n\t\tthis.el.style.minWidth = `${this.options.minWidth}px`;\r\n\t\tthis.el.style.minHeight = `${this.options.minHeight}px`;\r\n\r\n\t\tif (this.options.controlsPosition === \"left\") {\r\n\t\t\tthis.titleBarEl.classList.add(`${LIBRARY_NAME}-controls-left`);\r\n\t\t}\r\n\r\n\t\tif (!this.options.lazyLoad) {\r\n\t\t\tthis._renderInitialContent();\r\n\t\t} else {\r\n\t\t\tthis.showLoader();\r\n\t\t}\r\n\r\n\t\tif (this.options.menu.length > 0) {\r\n\t\t\tthis.createMenu();\r\n\t\t}\r\n\t\tif (this.statusBarEl) {\r\n\t\t\tthis.setStatusBarText(this.options.statusBar.text || \"\");\r\n\t\t}\r\n\t}\r\n\r\n\tprivate showLoader(): void {\r\n\t\tif (this.options.showLoadingIndicator) {\r\n\t\t\tthis.loaderEl.style.display = \"flex\";\r\n\t\t}\r\n\t}\r\n\r\n\tprivate hideLoader(): void {\r\n\t\tthis.loaderEl.style.display = \"none\";\r\n\t}\r\n\r\n\tprivate renderContent(container: HTMLElement, content: WindowContentOptions): void {\r\n\t\tcontainer.innerHTML = \"\";\r\n\t\tthis.hideLoader();\r\n\r\n\t\tif (this.virtualizationLevel === \"unloaded\") {\r\n\t\t\treturn; // 仮想化された場合、コンテンツをレンダリングしない\r\n\t\t}\r\n\r\n\t\tif (content.template) {\r\n\t\t\tconst template = document.querySelector<HTMLTemplateElement>(content.template);\r\n\t\t\tif (template?.tagName === \"TEMPLATE\") {\r\n\t\t\t\tcontainer.appendChild(template.content.cloneNode(true));\r\n\t\t\t} else {\r\n\t\t\t\tcontainer.innerHTML = \"Error: Template not found or invalid.\";\r\n\t\t\t\tconsole.warn(\"WinLet Warning: Template not found or invalid.\");\r\n\t\t\t}\r\n\t\t} else if (content.html) {\r\n\t\t\tcontainer.innerHTML = content.html;\r\n\t\t} else if (Utils.isNonEmptyObject(content.iframe) && (content.iframe.src || content.iframe.srcdoc)) {\r\n\t\t\tthis.showLoader();\r\n\t\t\tconst iframe = document.createElement(\"iframe\");\r\n\t\t\tconst iframeConfig = content.iframe;\r\n\t\t\tif (iframeConfig.src) {\r\n\t\t\t\tiframe.src = iframeConfig.src;\r\n\t\t\t}\r\n\t\t\tif (iframeConfig.srcdoc) {\r\n\t\t\t\tlet finalSrcDoc = iframeConfig.srcdoc;\r\n\t\t\t\tif (iframeConfig.loadWinLet) {\r\n\t\t\t\t\tconst globalConfig = this.manager.getGlobalConfig();\r\n\t\t\t\t\tif (globalConfig.libraryPath) {\r\n\t\t\t\t\t\tconst scriptTag = `<script src=\"${globalConfig.libraryPath}\"><\\/script>`;\r\n\t\t\t\t\t\tconst initScript = `<script>document.addEventListener('DOMContentLoaded', () => window.WinLet.init({ container: document.body }));<\\/script>`;\r\n\t\t\t\t\t\tfinalSrcDoc = `<!DOCTYPE html><html><head><meta charset=\"UTF-8\">${scriptTag}${initScript}</head><body>${iframeConfig.srcdoc}</body></html>`;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.warn(\"WinLet Warning: `loadWinLet` is true, but `libraryPath` is not set in global config.\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tiframe.srcdoc = finalSrcDoc;\r\n\t\t\t}\r\n\t\t\tif (iframeConfig.allow) {\r\n\t\t\t\tiframe.allow = iframeConfig.allow;\r\n\t\t\t}\r\n\t\t\tif (iframeConfig.referrerPolicy) {\r\n\t\t\t\tiframe.referrerPolicy = iframeConfig.referrerPolicy;\r\n\t\t\t}\r\n\t\t\tif (iframeConfig.loading) {\r\n\t\t\t\tiframe.loading = iframeConfig.loading;\r\n\t\t\t}\r\n\t\t\tif (iframeConfig.sandbox) {\r\n\t\t\t\tif (!Array.isArray(iframeConfig.sandbox)) {\r\n\t\t\t\t\tiframeConfig.sandbox = [iframeConfig.sandbox];\r\n\t\t\t\t}\r\n\t\t\t\tif (iframeConfig.sandbox.length > 0) {\r\n\t\t\t\t\tiframe.setAttribute(\"sandbox\", iframeConfig.sandbox.join(\" \"));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tiframe.addEventListener(\"load\", () => this.hideLoader());\r\n\t\t\tiframe.addEventListener(\"error\", () => this.hideLoader());\r\n\t\t\tcontainer.appendChild(iframe);\r\n\t\t} else {\r\n\t\t\tcontainer.innerHTML = \"\";\r\n\t\t}\r\n\t}\r\n\r\n\tprivate closeAllMenus(): void {\r\n\t\tthis.el.querySelectorAll<HTMLElement>(`.${LIBRARY_NAME}-menu-item > .${LIBRARY_NAME}-menu-dropdown`).forEach((dd) => {\r\n\t\t\tdd.style.display = \"none\";\r\n\t\t});\r\n\t\tthis.isMenuOpen = false;\r\n\t}\r\n\r\n\tprivate createMenu(): void {\r\n\t\tconst menuBar = this.el.querySelector<HTMLElement>(`.${LIBRARY_NAME}-menu-bar`)!;\r\n\t\tmenuBar.innerHTML = \"\";\r\n\r\n\t\tthis.options.menu.forEach((menuItemData) => {\r\n\t\t\tconst menuItemEl = document.createElement(\"div\");\r\n\t\t\tmenuItemEl.className = `${LIBRARY_NAME}-menu-item ${LIBRARY_NAME}-us-none`;\r\n\t\t\tmenuItemEl.textContent = menuItemData.name ?? \"\";\r\n\t\t\tmenuItemEl.setAttribute(\"role\", \"menu\");\r\n\r\n\t\t\tif (menuItemData.items) {\r\n\t\t\t\tconst dropdownEl = this.createDropdownMenu(menuItemData.items);\r\n\r\n\t\t\t\tmenuItemEl.addEventListener(\r\n\t\t\t\t\t\"click\",\r\n\t\t\t\t\t(e) => {\r\n\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\tconst isVisible = dropdownEl.style.display === \"block\";\r\n\t\t\t\t\t\tthis.closeAllMenus();\r\n\t\t\t\t\t\tif (!isVisible) {\r\n\t\t\t\t\t\t\tdropdownEl.style.display = \"block\";\r\n\t\t\t\t\t\t\tthis.isMenuOpen = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{ passive: false }\r\n\t\t\t\t);\r\n\r\n\t\t\t\tmenuItemEl.addEventListener(\r\n\t\t\t\t\t\"mouseenter\",\r\n\t\t\t\t\t() => {\r\n\t\t\t\t\t\tif (this.isMenuOpen) {\r\n\t\t\t\t\t\t\tthis.closeAllMenus();\r\n\t\t\t\t\t\t\tdropdownEl.style.display = \"block\";\r\n\t\t\t\t\t\t\tthis.isMenuOpen = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{ passive: true }\r\n\t\t\t\t);\r\n\r\n\t\t\t\tmenuItemEl.appendChild(dropdownEl);\r\n\t\t\t}\r\n\t\t\tmenuBar.appendChild(menuItemEl);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate createDropdownMenu(items: MenuItem[]): HTMLUListElement {\r\n\t\tconst dropdownEl = document.createElement(\"ul\");\r\n\t\tdropdownEl.className = `${LIBRARY_NAME}-menu-dropdown`;\r\n\r\n\t\titems.forEach((itemData) => {\r\n\t\t\tconst itemEl = document.createElement(\"li\");\r\n\t\t\tif (itemData.separator) {\r\n\t\t\t\titemEl.className = `${LIBRARY_NAME}-separator`;\r\n\t\t\t} else {\r\n\t\t\t\tlet text = itemData.name ?? \"\";\r\n\t\t\t\ttext = `<span>${text}</span>`;\r\n\t\t\t\tif (this.options.enableShortcuts && itemData.shortcut) {\r\n\t\t\t\t\ttext += `<span class=\"${LIBRARY_NAME}-shortcut-text\">(${itemData.shortcut})</span>`;\r\n\t\t\t\t}\r\n\t\t\t\titemEl.innerHTML = `<div class=\"${LIBRARY_NAME}-menu-dropdown-item\" role=\"menuitem\">${text}</div>`;\r\n\t\t\t\titemEl.addEventListener(\r\n\t\t\t\t\t\"click\",\r\n\t\t\t\t\t(e) => {\r\n\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\tthis.closeAllMenus();\r\n\t\t\t\t\t\titemData.action?.(this);\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{ passive: false }\r\n\t\t\t\t);\r\n\t\t\t\tif (itemData.items) {\r\n\t\t\t\t\titemEl.classList.add(`${LIBRARY_NAME}-has-submenu`); // スタイル付けのためのクラス\r\n\t\t\t\t\tconst subMenuEl = this.createDropdownMenu(itemData.items);\r\n\t\t\t\t\titemEl.appendChild(subMenuEl);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tdropdownEl.appendChild(itemEl);\r\n\t\t});\r\n\t\treturn dropdownEl;\r\n\t}\r\n\r\n\tprivate createTabs(): void {\r\n\t\tconst tabBar = this.el.querySelector<HTMLElement>(`.${LIBRARY_NAME}-tab-bar`)!;\r\n\t\ttabBar.innerHTML = \"\";\r\n\t\tthis.tabs = [];\r\n\t\tconst tabOpts = this.options.tabOptions ?? {};\r\n\r\n\t\tthis.options.tabs.forEach((tabData, index) => {\r\n\t\t\tthis.createTabElement(tabData, index);\r\n\t\t});\r\n\r\n\t\tif (tabOpts.addable) {\r\n\t\t\tthis.addTabBtn = document.createElement(\"div\");\r\n\t\t\tthis.addTabBtn.className = `${LIBRARY_NAME}-tab-add-btn`;\r\n\t\t\tthis.addTabBtn.textContent = \"+\";\r\n\t\t\tthis.addTabBtn.addEventListener(\r\n\t\t\t\t\"click\",\r\n\t\t\t\t(e) => {\r\n\t\t\t\t\tconst newTabItem = tabOpts.onAdd?.(this);\r\n\t\t\t\t\tif (newTabItem) {\r\n\t\t\t\t\t\tthis.addTab(newTabItem);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{ passive: true }\r\n\t\t\t);\r\n\t\t\ttabBar.appendChild(this.addTabBtn);\r\n\t\t}\r\n\t\t// タブの並び替えと統合のためのドロップゾーンを設定\r\n\t\tthis.setupTabBarDropZone();\r\n\r\n\t\tif (this.tabs.length > 0) this.activateTab(0);\r\n\t}\r\n\r\n\tprivate setupTabBarDropZone(): void {\r\n\t\tconst tabBar = this.el.querySelector<HTMLElement>(`.${LIBRARY_NAME}-tab-bar`)!;\r\n\t\tif (!tabBar || !this.options.tabOptions.reorderable) return;\r\n\r\n\t\ttabBar.addEventListener(\r\n\t\t\t\"dragover\",\r\n\t\t\t(e) => {\r\n\t\t\t\tif (e.dataTransfer?.types.includes(\"application/winlet-tab\")) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tif (e.dataTransfer) e.dataTransfer.dropEffect = \"move\";\r\n\t\t\t\t\ttabBar.classList.add(`${LIBRARY_NAME}-drag-over`);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{ passive: false }\r\n\t\t);\r\n\t\ttabBar.addEventListener(\r\n\t\t\t\"dragleave\",\r\n\t\t\t() => {\r\n\t\t\t\ttabBar.classList.remove(`${LIBRARY_NAME}-drag-over`);\r\n\t\t\t},\r\n\t\t\t{ passive: true }\r\n\t\t);\r\n\t\ttabBar.addEventListener(\r\n\t\t\t\"drop\",\r\n\t\t\t(e) => {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\ttabBar.classList.remove(`${LIBRARY_NAME}-drag-over`);\r\n\r\n\t\t\t\tconst tabDataJSON = e.dataTransfer?.getData(\"application/winlet-tab\");\r\n\t\t\t\tconst sourceWindowId = e.dataTransfer?.getData(\"application/winlet-source-window-id\");\r\n\t\t\t\tconst sourceTabId = e.dataTransfer?.getData(\"text/plain\");\r\n\t\t\t\tif (!tabDataJSON || !sourceWindowId || !sourceTabId) return;\r\n\r\n\t\t\t\tconst draggingEl = this.manager.container?.querySelector<HTMLElement>(`.${LIBRARY_NAME}-tab.${LIBRARY_NAME}-dragging`);\r\n\r\n\t\t\t\t// 自分自身のウィンドウ内での並び替え\r\n\t\t\t\tif (sourceWindowId === this.id) {\r\n\t\t\t\t\tif (draggingEl) {\r\n\t\t\t\t\t\t// ドロップされた位置に挿入\r\n\t\t\t\t\t\tthis.updateTabOrderFromDOM();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// 外部ウィンドウからのタブ統合\r\n\t\t\t\tconst sourceWindow = this.manager.getWindow(sourceWindowId);\r\n\t\t\t\tif (sourceWindow) {\r\n\t\t\t\t\tconst sourceOpts = sourceWindow.options.tabOptions;\r\n\t\t\t\t\tconst targetOpts = this.options.tabOptions;\r\n\r\n\t\t\t\t\tconst isMergeable = sourceOpts.mergeable ?? sourceOpts.detachable; // ソースをマージできるかどうかを確認\r\n\t\t\t\t\tconst allowsIncoming = targetOpts.allowIncomingMerge ?? true; // ターゲットが受け入れるかどうかを確認\r\n\t\t\t\t\tconst customFilterPassed = !targetOpts.onMergeAttempt || targetOpts.onMergeAttempt(sourceWindow, this);\r\n\r\n\t\t\t\t\tif (!isMergeable || !allowsIncoming || !customFilterPassed) {\r\n\t\t\t\t\t\treturn; // 条件が満たされていない場合は、マージを中止\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst tabData: TabItem = JSON.parse(tabDataJSON);\r\n\t\t\t\t\tthis.addTab(tabData, true);\r\n\r\n\t\t\t\t\tsourceWindow.closeTab(parseInt(sourceTabId, 10));\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{ passive: false }\r\n\t\t);\r\n\t}\r\n\r\n\tprivate createTabElement(tabData: TabItem, index: number): void {\r\n\t\tconst tabBar = this.el.querySelector<HTMLElement>(`.${LIBRARY_NAME}-tab-bar`)!;\r\n\t\tconst tabOpts = this.options.tabOptions ?? {};\r\n\r\n\t\tconst tabEl = document.createElement(\"div\");\r\n\t\ttabEl.className = `${LIBRARY_NAME}-tab`;\r\n\t\ttabEl.setAttribute(\"role\", \"tab\");\r\n\t\ttabEl.dataset.tabId = index.toString(); // IDを紐付け\r\n\r\n\t\tconst titleEl = document.createElement(\"span\");\r\n\t\ttitleEl.textContent = tabData.title;\r\n\t\ttabEl.appendChild(titleEl);\r\n\r\n\t\t// +ボタンが存在すればその前に、なければ末尾に追加\r\n\t\ttabBar.insertBefore(tabEl, this.addTabBtn);\r\n\r\n\t\tif (tabOpts.closable) {\r\n\t\t\tconst closeBtn = document.createElement(\"span\");\r\n\t\t\tcloseBtn.className = `${LIBRARY_NAME}-tab-close-btn`;\r\n\t\t\tcloseBtn.innerHTML = \"&times;\";\r\n\t\t\tcloseBtn.addEventListener(\r\n\t\t\t\t\"click\",\r\n\t\t\t\t(e) => {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t// クロージャのindexに依存せず、クリックされた時点の最新のインデックスを探す\r\n\t\t\t\t\tconst indexToClose = this.tabs.findIndex((t) => t.tabEl === tabEl);\r\n\t\t\t\t\tif (indexToClose !== -1) {\r\n\t\t\t\t\t\tthis.closeTab(indexToClose);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{ passive: false }\r\n\t\t\t);\r\n\t\t\ttabEl.appendChild(closeBtn);\r\n\t\t}\r\n\r\n\t\t// タブコンテント生成ロジック\r\n\t\tconst tabContentEl = document.createElement(\"div\");\r\n\t\ttabContentEl.className = `${LIBRARY_NAME}-tab-content`;\r\n\t\ttabContentEl.setAttribute(\"role\", \"tabpanel\");\r\n\t\tthis.contentEl.appendChild(tabContentEl);\r\n\t\tthis.renderContent(tabContentEl, tabData.content);\r\n\r\n\t\ttabEl.addEventListener(\r\n\t\t\t\"click\",\r\n\t\t\t(e) => {\r\n\t\t\t\tthis.activateTab(+tabEl.dataset.tabId!);\r\n\t\t\t},\r\n\t\t\t{ passive: false }\r\n\t\t);\r\n\t\tthis.tabs.splice(index, 0, { tabEl, contentEl: tabContentEl }); // 指定位置に挿入\r\n\r\n\t\tif (tabOpts.reorderable) {\r\n\t\t\tthis.makeTabReorderable(tabEl);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate makeTabReorderable(tabEl: HTMLElement) {\r\n\t\ttabEl.draggable = true;\r\n\t\ttabEl.addEventListener(\r\n\t\t\t\"dragstart\",\r\n\t\t\t(e) => {\r\n\t\t\t\te.dataTransfer!.setData(\"text/plain\", tabEl.dataset.tabId!);\r\n\t\t\t\ttabEl.classList.add(`${LIBRARY_NAME}-dragging`);\r\n\r\n\t\t\t\t// 分離機能が有効な場合、追加情報をセット\r\n\t\t\t\tif (this.options.tabOptions.detachable) {\r\n\t\t\t\t\tconst tabIndex = parseInt(tabEl.dataset.tabId!, 10);\r\n\t\t\t\t\tif (!isNaN(tabIndex) && this.options.tabs[tabIndex]) {\r\n\t\t\t\t\t\tconst tabData = this.options.tabs[tabIndex];\r\n\t\t\t\t\t\te.dataTransfer!.setData(\"application/winlet-tab\", JSON.stringify(tabData));\r\n\t\t\t\t\t\te.dataTransfer!.setData(\"application/winlet-source-window-id\", this.id);\r\n\r\n\t\t\t\t\t\tthis.manager.onTabDragStart(this.id);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{ passive: true }\r\n\t\t);\r\n\t\ttabEl.addEventListener(\r\n\t\t\t\"dragend\",\r\n\t\t\t() => {\r\n\t\t\t\ttabEl.classList.remove(`${LIBRARY_NAME}-dragging`);\r\n\t\t\t\tthis.manager.onTabDragEnd();\r\n\t\t\t},\r\n\t\t\t{ passive: true }\r\n\t\t);\r\n\r\n\t\ttabEl.addEventListener(\r\n\t\t\t\"dragover\",\r\n\t\t\t(e) => {\r\n\t\t\t\tif (this.manager.draggingTabInfo?.sourceWindowId !== this.id) {\r\n\t\t\t\t\treturn; //タブが別のウィンドウからである場合、何もしない\r\n\t\t\t\t}\r\n\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tconst draggingEl = document.querySelector<HTMLElement>(`.${LIBRARY_NAME}-tab.${LIBRARY_NAME}-dragging`);\r\n\t\t\t\tif (draggingEl && draggingEl !== tabEl) {\r\n\t\t\t\t\tconst rect = tabEl.getBoundingClientRect();\r\n\t\t\t\t\t// カーソルの位置によって挿入位置を左右に決める\r\n\t\t\t\t\tconst isAfter = e.clientX > rect.left + rect.width / 2;\r\n\t\t\t\t\tconst parent = tabEl.parentNode!;\r\n\t\t\t\t\tif (isAfter) {\r\n\t\t\t\t\t\tparent.insertBefore(draggingEl, tabEl.nextSibling);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tparent.insertBefore(draggingEl, tabEl);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{ passive: false }\r\n\t\t);\r\n\r\n\t\ttabEl.addEventListener(\r\n\t\t\t\"drop\",\r\n\t\t\t(e) => {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t},\r\n\t\t\t{ passive: false }\r\n\t\t);\r\n\t}\r\n\r\n\t// タブを閉じるロジック\r\n\tpublic closeTab(index: number) {\r\n\t\t// アクティブなタブが閉じられるかチェック\r\n\t\tconst wasActive = this.tabs[index]?.tabEl.classList.contains(`${LIBRARY_NAME}-active`);\r\n\r\n\t\t// DOMから要素を削除\r\n\t\tthis.tabs[index].tabEl.remove();\r\n\t\tthis.tabs[index].contentEl.remove();\r\n\t\t// 配列から削除\r\n\t\tthis.tabs.splice(index, 1);\r\n\t\tthis.options.tabs.splice(index, 1);\r\n\r\n\t\t// IDの再割り当て\r\n\t\tthis.tabs.forEach((tab, i) => (tab.tabEl.dataset.tabId = i.toString()));\r\n\r\n\t\t// アクティブなタブを再設定\r\n\t\tif (this.tabs.length > 0) {\r\n\t\t\tif (wasActive) {\r\n\t\t\t\tconst newActiveIndex = Math.max(0, index - 1);\r\n\t\t\t\tthis.activateTab(newActiveIndex);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// タブが0になったらウィンドウを閉じる\r\n\t\t\tthis.close();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * タブをアクティブにします。\r\n\t * @param index - アクティブにするタブのインデックス\r\n\t */\r\n\tpublic activateTab(index: number): void {\r\n\t\tif (index < 0 || index >= this.tabs.length) return;\r\n\r\n\t\tthis.tabs.forEach((tab, i) => {\r\n\t\t\tconst isActive = i === index;\r\n\t\t\ttab.tabEl.classList.toggle(`${LIBRARY_NAME}-active`, isActive);\r\n\t\t\ttab.tabEl.setAttribute(\"aria-selected\", String(isActive));\r\n\t\t\ttab.contentEl.classList.toggle(`${LIBRARY_NAME}-active`, isActive);\r\n\t\t});\r\n\r\n\t\t// 検索バーが開いていれば、再検索を実行\r\n\t\tif (this.searchBarEl) {\r\n\t\t\tthis._performSearch();\r\n\t\t}\r\n\t}\r\n\r\n\tpublic addTab(tabItem: TabItem, setActive: boolean = true): void {\r\n\t\tthis.options.tabs.push(tabItem);\r\n\t\tconst newIndex = this.options.tabs.length - 1;\r\n\t\tthis.createTabElement(tabItem, newIndex);\r\n\t\tif (setActive) {\r\n\t\t\tthis.activateTab(newIndex);\r\n\t\t\t// タブが追加されアクティブになったウィンドウにフォーカスを当てる\r\n\t\t\tthis.focus();\r\n\t\t}\r\n\t}\r\n\r\n\tpublic getTabs(): { tabEl: HTMLElement; contentEl: HTMLElement }[] {\r\n\t\treturn this.tabs;\r\n\t}\r\n\r\n\tprivate updateTabOrderFromDOM(): void {\r\n\t\tconst tabElements = Array.from(this.el.querySelectorAll<HTMLElement>(`.${LIBRARY_NAME}-tab-bar > .${LIBRARY_NAME}-tab`));\r\n\r\n\t\tconst newTabs: typeof this.tabs = [];\r\n\t\tconst newOptionsTabs: TabItem[] = [];\r\n\r\n\t\tconst oldTabs = [...this.tabs];\r\n\t\tconst oldOptionsTabs = [...this.options.tabs];\r\n\r\n\t\ttabElements.forEach((tabEl) => {\r\n\t\t\t// dataset.tabIdはもはや信頼できない可能性があるため、DOM要素で直接比較する\r\n\t\t\tconst oldIndex = oldTabs.findIndex((t) => t.tabEl === tabEl);\r\n\t\t\tif (oldIndex !== -1) {\r\n\t\t\t\tnewTabs.push(oldTabs[oldIndex]);\r\n\t\t\t\tnewOptionsTabs.push(oldOptionsTabs[oldIndex]);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.tabs = newTabs;\r\n\t\tthis.options.tabs = newOptionsTabs;\r\n\r\n\t\t// 新しい順序でdataset.tabIdを再設定\r\n\t\tthis.tabs.forEach((tab, i) => (tab.tabEl.dataset.tabId = i.toString()));\r\n\t}\r\n\r\n\tprivate createSplitView(container: HTMLElement, options: SplitViewOptions) {\r\n\t\tcontainer.innerHTML = \"\"; // コンテナをクリア\r\n\t\tconst splitViewEl = document.createElement(\"div\");\r\n\t\tsplitViewEl.className = `${LIBRARY_NAME}-split-view ${LIBRARY_NAME}-split-view-${options.direction}`;\r\n\t\tcontainer.appendChild(splitViewEl);\r\n\r\n\t\toptions.panes.forEach((paneOptions, index) => {\r\n\t\t\tconst paneEl = document.createElement(\"div\");\r\n\t\t\tpaneEl.className = `${LIBRARY_NAME}-split-pane`;\r\n\t\t\tpaneEl.id = paneOptions.id;\r\n\r\n\t\t\tif (paneOptions.size) {\r\n\t\t\t\tpaneEl.style.flex = `0 0 ${paneOptions.size}`;\r\n\t\t\t} else {\r\n\t\t\t\tpaneEl.style.flex = \"1 1 0\";\r\n\t\t\t}\r\n\t\t\tif (paneOptions.minSize) {\r\n\t\t\t\tif (options.direction === \"horizontal\") {\r\n\t\t\t\t\tpaneEl.style.minWidth = paneOptions.minSize;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpaneEl.style.minHeight = paneOptions.minSize;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// コンテンツを描画\r\n\t\t\tthis.renderContent(paneEl, paneOptions.content);\r\n\t\t\tsplitViewEl.appendChild(paneEl);\r\n\r\n\t\t\t// 最後以外のペインの後ろにリサイザーを追加\r\n\t\t\tif (index < options.panes.length - 1) {\r\n\t\t\t\tconst resizerEl = document.createElement(\"div\");\r\n\t\t\t\tresizerEl.className = `${LIBRARY_NAME}-split-resizer`;\r\n\t\t\t\tif (paneOptions.resizable !== false) {\r\n\t\t\t\t\tthis.makePaneResizable(resizerEl, paneEl, options.direction);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresizerEl.style.pointerEvents = \"none\";\r\n\t\t\t\t}\r\n\t\t\t\tsplitViewEl.appendChild(resizerEl);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprivate makePaneResizable(resizer: HTMLElement, prevPane: HTMLElement, direction: \"horizontal\" | \"vertical\") {\r\n\t\tresizer.addEventListener(\r\n\t\t\t\"pointerdown\",\r\n\t\t\t(e: PointerEvent) => {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tconst startX = e.clientX;\r\n\t\t\t\tconst startY = e.clientY;\r\n\t\t\t\tconst startWidth = prevPane.offsetWidth;\r\n\t\t\t\tconst startHeight = prevPane.offsetHeight;\r\n\r\n\t\t\t\tconst onPointerMove = (moveE: PointerEvent) => {\r\n\t\t\t\t\tif (direction === \"horizontal\") {\r\n\t\t\t\t\t\tconst newWidth = startWidth + (moveE.clientX - startX);\r\n\t\t\t\t\t\tprevPane.style.flexBasis = `${newWidth}px`;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst newHeight = startHeight + (moveE.clientY - startY);\r\n\t\t\t\t\t\tprevPane.style.flexBasis = `${newHeight}px`;\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\tconst onPointerUp = () => {\r\n\t\t\t\t\tdocument.removeEventListener(\"pointermove\", onPointerMove);\r\n\t\t\t\t\tdocument.removeEventListener(\"pointerup\", onPointerUp);\r\n\t\t\t\t};\r\n\r\n\t\t\t\tdocument.addEventListener(\"pointermove\", onPointerMove, { passive: true });\r\n\t\t\t\tdocument.addEventListener(\"pointerup\", onPointerUp, { passive: true });\r\n\t\t\t},\r\n\t\t\t{ passive: false }\r\n\t\t);\r\n\t}\r\n\r\n\tprivate setupEventListeners(): void {\r\n\t\tthis.el.addEventListener(\"click\", () => this.focus(), true);\r\n\r\n\t\t// iframeなどにフォーカスが移った際にウィンドウ自体をアクティブにする\r\n\t\tthis.el.addEventListener(\"focusin\", () => this.focus(), { passive: true });\r\n\r\n\t\t// グローバルクリックリスナーを追加して、外側をクリックするときにメニューを閉じる\r\n\t\tthis.boundGlobalClickHandler = () => {\r\n\t\t\tif (this.isMenuOpen) {\r\n\t\t\t\tthis.closeAllMenus();\r\n\t\t\t}\r\n\t\t};\r\n\t\tdocument.addEventListener(\"click\", this.boundGlobalClickHandler, { passive: true });\r\n\r\n\t\tconst controlsEl = this.el.querySelector<HTMLElement>(`.${LIBRARY_NAME}-controls`);\r\n\t\tcontrolsEl?.addEventListener(\r\n\t\t\t\"click\",\r\n\t\t\t(e) => {\r\n\t\t\t\tconst target = e.target as HTMLElement;\r\n\t\t\t\tconst button = target.closest<HTMLElement>(`.${LIBRARY_NAME}-control-btn`);\r\n\t\t\t\tif (!button) return;\r\n\r\n\t\t\t\t// 標準ボタン\r\n\t\t\t\tif (button.classList.contains(`${LIBRARY_NAME}-close-btn`)) {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\tif (this.options._isPopup) {\r\n\t\t\t\t\t\tthis.popupCloseCallback?.(CLOSE_BUTTON_RESULT);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.close();\r\n\t\t\t\t} else if (button.classList.contains(`${LIBRARY_NAME}-maximize-btn`)) {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\tthis.toggleMaximize();\r\n\t\t\t\t} else if (button.classList.contains(`${LIBRARY_NAME}-minimize-btn`)) {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\tthis.minimize();\r\n\t\t\t\t} else if (button.classList.contains(`${LIBRARY_NAME}-refresh-btn`)) {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\tthis.unvirtualize();\r\n\t\t\t\t}\r\n\t\t\t\t// カスタムボタン\r\n\t\t\t\telse if (button.classList.contains(`${LIBRARY_NAME}-custom-control-btn`)) {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\tconst name = button.dataset.name;\r\n\t\t\t\t\tconst control = this.options.customControls.find((c) => c.name === name);\r\n\t\t\t\t\tcontrol?.action(this);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{ passive: false }\r\n\t\t);\r\n\r\n\t\tif (this.options.windowOptions.movable) this.makeMovable();\r\n\t\tif (this.options.windowOptions.resizableX || this.options.windowOptions.resizableY) this.makeResizable();\r\n\t\tif (this.options.contextMenu.length > 0) {\r\n\t\t\t// PC用: 右クリック\r\n\t\t\tthis.titleBarEl.addEventListener(\r\n\t\t\t\t\"contextmenu\",\r\n\t\t\t\t(e) => {\r\n\t\t\t\t\tconst target = e.target as HTMLElement;\r\n\t\t\t\t\t// 操作UI（コントロールボタン、メニュー、タブ）の上では発火しないようにする\r\n\t\t\t\t\tif (target.closest(`.${LIBRARY_NAME}-control-btn, .${LIBRARY_NAME}-menu-item, .${LIBRARY_NAME}-tab`)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tthis.manager.showContextMenu(e.clientX, e.clientY, this.options.contextMenu, this);\r\n\t\t\t\t},\r\n\t\t\t\t{ passive: false }\r\n\t\t\t);\r\n\t\t\t// モバイル用: 長押し\r\n\t\t\tthis.titleBarEl.addEventListener(\r\n\t\t\t\t\"pointerdown\",\r\n\t\t\t\t(e) => {\r\n\t\t\t\t\tif (e.pointerType !== \"touch\") return;\r\n\t\t\t\t\tthis.contextMenuTimer = window.setTimeout(() => {\r\n\t\t\t\t\t\tthis.contextMenuTimer = null;\r\n\t\t\t\t\t\tthis.manager.showContextMenu(e.clientX, e.clientY, this.options.contextMenu, this);\r\n\t\t\t\t\t}, this.MOBILE_CONTEXT_MENU_TIMEOUT);\r\n\t\t\t\t},\r\n\t\t\t\t{ passive: true }\r\n\t\t\t);\r\n\t\t\tconst clearContextMenuTimer = () => {\r\n\t\t\t\tif (this.contextMenuTimer) {\r\n\t\t\t\t\tclearTimeout(this.contextMenuTimer);\r\n\t\t\t\t\tthis.contextMenuTimer = null;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tthis.titleBarEl.addEventListener(\"pointermove\", clearContextMenuTimer, { passive: true });\r\n\t\t\tthis.titleBarEl.addEventListener(\"pointerup\", clearContextMenuTimer, { passive: true });\r\n\t\t\tthis.titleBarEl.addEventListener(\"pointercancel\", clearContextMenuTimer, { passive: true });\r\n\t\t}\r\n\r\n\t\t// 検索ショートカット (Ctrl+F)\r\n\t\tdocument.addEventListener(\r\n\t\t\t\"keydown\",\r\n\t\t\t(e) => {\r\n\t\t\t\tif (!this.focused) return;\r\n\t\t\t\tif (this.options.search.enabled && e.ctrlKey && e.key === \"f\") {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tthis.openSearch();\r\n\t\t\t\t}\r\n\t\t\t\tif (e.key === \"Escape\" && this.searchBarEl) {\r\n\t\t\t\t\tthis.closeSearch();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{ passive: false }\r\n\t\t);\r\n\t}\r\n\r\n\tprivate makeMovable(): void {\r\n\t\tconst onPointerDown = (e: PointerEvent) => {\r\n\t\t\tconst target = e.target as HTMLElement;\r\n\t\t\t// 操作UI要素の上なら移動させない\r\n\t\t\tif (target.closest(`.${LIBRARY_NAME}-control-btn, .${LIBRARY_NAME}-resize-handle, .${LIBRARY_NAME}-menu-item, .${LIBRARY_NAME}-tab, .${LIBRARY_NAME}-tab-add-btn`)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// メインボタン（マウスの左ボタン、タッチ）でのみ移動\r\n\t\t\tif (e.button !== 0) return;\r\n\r\n\t\t\te.preventDefault();\r\n\t\t\tthis.focus();\r\n\r\n\t\t\tconst { clientX: startX, clientY: startY } = e;\r\n\t\t\tlet isDragging = false;\r\n\r\n\t\t\t// ドラッグ開始時のウィンドウ座標。isDraggingがtrueになったときに設定される。\r\n\t\t\tlet initialLeft: number;\r\n\t\t\tlet initialTop: number;\r\n\r\n\t\t\t// --- ゴーストウィンドウ処理 ---\r\n\t\t\tlet ghostEl: HTMLElement | null = null;\r\n\t\t\tif (this.options.windowOptions.useGhostWindow) {\r\n\t\t\t\tghostEl = document.createElement(\"div\");\r\n\t\t\t\tghostEl.className = `${LIBRARY_NAME}-ghost-window`;\r\n\t\t\t\tthis.manager.container?.appendChild(ghostEl);\r\n\t\t\t\tghostEl.style.left = `${this.el.offsetLeft}px`;\r\n\t\t\t\tghostEl.style.top = `${this.el.offsetTop}px`;\r\n\t\t\t\tghostEl.style.width = `${this.el.offsetWidth}px`;\r\n\t\t\t\tghostEl.style.height = `${this.el.offsetHeight}px`;\r\n\t\t\t}\r\n\r\n\t\t\tthis.el.classList.add(`${LIBRARY_NAME}-is-dragging`);\r\n\r\n\t\t\tconst onPointerMove = (moveE: PointerEvent) => {\r\n\t\t\t\tif (!this.el?.isConnected) return;\r\n\t\t\t\tif (!isDragging) {\r\n\t\t\t\t\tconst deltaX = Math.abs(moveE.clientX - startX);\r\n\t\t\t\t\tconst deltaY = Math.abs(moveE.clientY - startY);\r\n\r\n\t\t\t\t\t// 閾値を超えたらドラッグモードを開始\r\n\t\t\t\t\tif (deltaX > this.DRAG_THRESHOLD || deltaY > this.DRAG_THRESHOLD) {\r\n\t\t\t\t\t\tisDragging = true;\r\n\t\t\t\t\t\tthis.el.setPointerCapture(e.pointerId);\r\n\t\t\t\t\t\tthis.contentEl.style.pointerEvents = \"none\";\r\n\r\n\t\t\t\t\t\tthis.emit(\"move-start\", this);\r\n\r\n\t\t\t\t\t\t// 最大化状態からのドラッグ開始の場合、ウィンドウを復元\r\n\t\t\t\t\t\tif (this.state === \"maximized\") {\r\n\t\t\t\t\t\t\tconst restoredWidth = this.lastState.width;\r\n\t\t\t\t\t\t\tconst clickRatio = e.clientX / this.el.offsetWidth;\r\n\t\t\t\t\t\t\tconst titleBarRect = this.titleBarEl.getBoundingClientRect();\r\n\t\t\t\t\t\t\tconst offsetY = e.clientY - titleBarRect.top;\r\n\t\t\t\t\t\t\tconst posX = e.clientX - restoredWidth * clickRatio;\r\n\t\t\t\t\t\t\tconst posY = e.clientY - offsetY;\r\n\r\n\t\t\t\t\t\t\tthis.restore();\r\n\t\t\t\t\t\t\tthis.setPosition(posX, posY);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// ドラッグ開始時点の座標を記録\r\n\t\t\t\t\t\tinitialLeft = this.el.offsetLeft;\r\n\t\t\t\t\t\tinitialTop = this.el.offsetTop;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// 閾値に達していなければ何もしない\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// ドラッグ中の移動処理\r\n\t\t\t\tconst newLeft = initialLeft + moveE.clientX - startX;\r\n\t\t\t\tconst newTop = initialTop + moveE.clientY - startY;\r\n\t\t\t\tif (ghostEl) {\r\n\t\t\t\t\tghostEl.style.left = `${newLeft}px`;\r\n\t\t\t\t\tghostEl.style.top = `${newTop}px`;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.setPosition(newLeft, newTop);\r\n\t\t\t\t}\r\n\t\t\t\tthis.throttledEmitMove?.();\r\n\t\t\t};\r\n\r\n\t\t\tconst onPointerUp = () => {\r\n\t\t\t\tdocument.removeEventListener(\"pointermove\", onPointerMove);\r\n\t\t\t\tdocument.removeEventListener(\"pointerup\", onPointerUp);\r\n\r\n\t\t\t\tif (ghostEl) {\r\n\t\t\t\t\tthis.setPosition(ghostEl.offsetLeft, ghostEl.offsetTop);\r\n\t\t\t\t\tghostEl.remove();\r\n\t\t\t\t}\r\n\t\t\t\t// ドラッグが発生した場合のみ後処理とコールバック呼び出し\r\n\t\t\t\tif (isDragging) {\r\n\t\t\t\t\tthis.el.releasePointerCapture(e.pointerId);\r\n\t\t\t\t\tthis.contentEl.style.pointerEvents = \"auto\";\r\n\t\t\t\t\tthis.emit(\"move-end\", this);\r\n\t\t\t\t\t(async () => await this.manager.updateVirtualization())();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.el.classList.remove(`${LIBRARY_NAME}-is-dragging`);\r\n\t\t\t};\r\n\r\n\t\t\tdocument.addEventListener(\"pointermove\", onPointerMove, { passive: true });\r\n\t\t\tdocument.addEventListener(\"pointerup\", onPointerUp, { passive: true });\r\n\t\t};\r\n\r\n\t\tthis.titleBarEl.addEventListener(\"pointerdown\", onPointerDown, { passive: false });\r\n\r\n\t\tif (this.options.windowOptions.maximizable) {\r\n\t\t\tthis.titleBarEl.addEventListener(\"dblclick\", (e: MouseEvent) => {\r\n\t\t\t\tif (this.options.windowOptions.maximizableOnDblClick) {\r\n\t\t\t\t\tconst target = e.target as HTMLElement;\r\n\t\t\t\t\t// 操作UI（コントロールボタン、メニュー、タブ）の上では発火しないようにする\r\n\t\t\t\t\tif (target.closest(`.${LIBRARY_NAME}-control-btn, .${LIBRARY_NAME}-menu-item, .${LIBRARY_NAME}-tab`)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.toggleMaximize();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tprivate makeResizable(): void {\r\n\t\tthis.el.querySelectorAll<HTMLElement>(`.${LIBRARY_NAME}-resize-handle`).forEach((handle) => {\r\n\t\t\thandle.addEventListener(\r\n\t\t\t\t\"pointerdown\",\r\n\t\t\t\t(e: PointerEvent) => {\r\n\t\t\t\t\tif (e.button !== 0 || !handle?.isConnected) return;\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\tthis.focus();\r\n\t\t\t\t\tthis.contentEl.style.pointerEvents = \"none\";\r\n\t\t\t\t\thandle.setPointerCapture(e.pointerId);\r\n\r\n\t\t\t\t\tthis.el.classList.add(`${LIBRARY_NAME}-is-resizing`);\r\n\t\t\t\t\tthis.emit(\"resize-start\", this);\r\n\r\n\t\t\t\t\t// --- ゴーストウィンドウ処理 ---\r\n\t\t\t\t\tlet ghostEl: HTMLElement | null = null;\r\n\t\t\t\t\tif (this.options.windowOptions.useGhostWindow) {\r\n\t\t\t\t\t\tghostEl = document.createElement(\"div\");\r\n\t\t\t\t\t\tghostEl.className = `${LIBRARY_NAME}-ghost-window`;\r\n\t\t\t\t\t\tthis.manager.container?.appendChild(ghostEl);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst direction = handle.className.replace(`${LIBRARY_NAME}-resize-handle `, \"\");\r\n\t\t\t\t\tconst { clientX: startX, clientY: startY } = e;\r\n\t\t\t\t\tconst { offsetWidth: startWidth, offsetHeight: startHeight, offsetLeft: startLeft, offsetTop: startTop } = this.el;\r\n\t\t\t\t\tconst { minWidth, minHeight } = this.options;\r\n\r\n\t\t\t\t\tconst onPointerMove = (moveE: PointerEvent) => {\r\n\t\t\t\t\t\tlet newWidth = startWidth,\r\n\t\t\t\t\t\t\tnewHeight = startHeight,\r\n\t\t\t\t\t\t\tnewLeft = startLeft,\r\n\t\t\t\t\t\t\tnewTop = startTop;\r\n\t\t\t\t\t\tconst deltaX = moveE.clientX - startX;\r\n\t\t\t\t\t\tconst deltaY = moveE.clientY - startY;\r\n\r\n\t\t\t\t\t\tif (direction.includes(`${LIBRARY_NAME}-e`)) newWidth = Math.max(minWidth, startWidth + deltaX);\r\n\t\t\t\t\t\tif (direction.includes(`${LIBRARY_NAME}-w`)) {\r\n\t\t\t\t\t\t\tnewWidth = Math.max(minWidth, startWidth - deltaX);\r\n\t\t\t\t\t\t\tnewLeft = startLeft + deltaX;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (direction.includes(`${LIBRARY_NAME}-s`)) newHeight = Math.max(minHeight, startHeight + deltaY);\r\n\t\t\t\t\t\tif (direction.includes(`${LIBRARY_NAME}-n`)) {\r\n\t\t\t\t\t\t\tnewHeight = Math.max(minHeight, startHeight - deltaY);\r\n\t\t\t\t\t\t\tnewTop = startTop + deltaY;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (ghostEl) {\r\n\t\t\t\t\t\t\tghostEl.style.left = `${newLeft}px`;\r\n\t\t\t\t\t\t\tghostEl.style.top = `${newTop}px`;\r\n\t\t\t\t\t\t\tghostEl.style.width = `${newWidth}px`;\r\n\t\t\t\t\t\t\tghostEl.style.height = `${newHeight}px`;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.setSize(newWidth, newHeight);\r\n\t\t\t\t\t\t\tthis.setPosition(newLeft, newTop);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.throttledEmitResize?.();\r\n\t\t\t\t\t};\r\n\t\t\t\t\tconst onPointerUp = () => {\r\n\t\t\t\t\t\thandle.releasePointerCapture(e.pointerId);\r\n\t\t\t\t\t\tthis.contentEl.style.pointerEvents = \"auto\";\r\n\r\n\t\t\t\t\t\tif (ghostEl) {\r\n\t\t\t\t\t\t\tthis.setSize(ghostEl.offsetWidth, ghostEl.offsetHeight);\r\n\t\t\t\t\t\t\tthis.setPosition(ghostEl.offsetLeft, ghostEl.offsetTop);\r\n\t\t\t\t\t\t\tghostEl.remove();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tdocument.removeEventListener(\"pointermove\", onPointerMove);\r\n\t\t\t\t\t\tdocument.removeEventListener(\"pointerup\", onPointerUp);\r\n\t\t\t\t\t\tthis.emit(\"resize-end\", this);\r\n\t\t\t\t\t\tthis.updateDebugOverlay();\r\n\t\t\t\t\t\t(async () => await this.manager.updateVirtualization())();\r\n\r\n\t\t\t\t\t\tthis.el.classList.remove(`${LIBRARY_NAME}-is-resizing`);\r\n\t\t\t\t\t};\r\n\t\t\t\t\tdocument.addEventListener(\"pointermove\", onPointerMove, { passive: true });\r\n\t\t\t\t\tdocument.addEventListener(\"pointerup\", onPointerUp, { passive: true });\r\n\t\t\t\t},\r\n\t\t\t\t{ passive: false }\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\tpublic isFontAwesome(classStr: string): boolean {\r\n\t\tconst classes = classStr.trim().split(/\\s+/);\r\n\t\tconst hasPrefix = classes.some((c) => /^fa[bslr]?$/.test(c));\r\n\t\tconst hasIcon = classes.some((c) => /^fa-[a-z0-9-]+$/.test(c));\r\n\t\treturn hasPrefix && hasIcon;\r\n\t}\r\n\r\n\tpublic updateDebugOverlay(): void {\r\n\t\tif (this.debugOverlayEl) {\r\n\t\t\tconst pos = this.getPosition();\r\n\t\t\tconst size = this.getSize();\r\n\t\t\tthis.debugOverlayEl.textContent = `ID:    ${this.id}\r\nState: ${this.state}\r\nPos:   x:${Math.round(pos.x)}, y:${Math.round(pos.y)}\r\nSize:  w:${Math.round(size.width)}, h:${Math.round(size.height)}\r\nFocus: ${this.focused}\r\nz-idx: ${this.el.style.zIndex}\r\nVirt:  ${this.virtualizationLevel}`.trim();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * ウィンドウ内に不安全なコンテンツがあるか判定する\r\n\t */\r\n\tpublic getUnsafeContentLevel(): VirtualizationLevel {\r\n\t\tif (this.mainContentEl.querySelector(\"iframe, frame, video, audio, applet, embed, object\")) {\r\n\t\t\treturn \"frozen\";\r\n\t\t}\r\n\t\tif (this.mainContentEl.querySelector(\"img, input, textarea, select, canvas, [contentEditable=true]\")) {\r\n\t\t\treturn \"suspended\";\r\n\t\t}\r\n\t\treturn \"unloaded\";\r\n\t}\r\n\r\n\t/**\r\n\t * ウィンドウを指定されたレベルまで仮想化する\r\n\t * @param level - 仮想化の目標レベル\r\n\t */\r\n\tpublic async virtualize(level: \"none\" | \"frozen\" | \"suspended\" | \"unloaded\" | \"auto\"): Promise<void> {\r\n\t\tif (level === \"auto\") {\r\n\t\t\tlevel = this.getUnsafeContentLevel();\r\n\t\t}\r\n\t\tif (level === \"none\") {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst currentIndex = this.virtualizationHierarchy.indexOf(this.virtualizationLevel);\r\n\t\tconst targetIndex = this.virtualizationHierarchy.indexOf(level);\r\n\r\n\t\tif (targetIndex <= currentIndex) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.cleanupVirtualizationStyles();\r\n\r\n\t\t// Add lock class to disable controls during any virtualization\r\n\t\tthis.el.classList.add(`${LIBRARY_NAME}-virtualization-lock`);\r\n\r\n\t\tconst restoreMode = this.options.virtualizationRestoreMode || this.manager.getGlobalConfig().virtualizationRestoreMode || \"auto\";\r\n\t\tif (restoreMode === \"manual\" && this.options.showVirtualizationRefreshButton) {\r\n\t\t\tthis.el.classList.add(`${LIBRARY_NAME}-is-virtualized-manual`);\r\n\t\t}\r\n\r\n\t\tconst strategy = this.options.virtualizationStrategy || this.manager.getGlobalConfig().virtualizationStrategy;\r\n\r\n\t\tif (strategy === \"canvas\" && level === \"unloaded\") {\r\n\t\t\tthis.showLoader();\r\n\t\t\ttry {\r\n\t\t\t\tthis.canvasSnapshot = await this.capture();\r\n\t\t\t\tif (this.canvasOverlayEl && this.canvasSnapshot) {\r\n\t\t\t\t\tconst img = document.createElement(\"img\");\r\n\t\t\t\t\timg.src = this.canvasSnapshot;\r\n\t\t\t\t\tthis.canvasOverlayEl.innerHTML = \"\";\r\n\t\t\t\t\tthis.canvasOverlayEl.appendChild(img);\r\n\t\t\t\t\tthis.canvasOverlayEl.style.display = \"block\";\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error(\"WinLet: Canvas virtualization failed, falling back to standard.\", e);\r\n\t\t\t\tthis.canvasSnapshot = null; // Ensure fallback works\r\n\t\t\t} finally {\r\n\t\t\t\tthis.hideLoader();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.virtualizationLevel = level;\r\n\r\n\t\tif (currentIndex === 0 && targetIndex > 0) {\r\n\t\t\tthis.manager.updateTaskbarItem(this, \"virtualized\");\r\n\t\t}\r\n\r\n\t\tswitch (level) {\r\n\t\t\tcase \"frozen\":\r\n\t\t\t\tthis.el.classList.add(`${LIBRARY_NAME}-is-frozen`);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"suspended\":\r\n\t\t\t\tthis.el.classList.add(`${LIBRARY_NAME}-is-suspended`);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"unloaded\":\r\n\t\t\t\tthis.el.classList.add(`${LIBRARY_NAME}-is-virtualized`);\r\n\t\t\t\tif (this.tabs.length > 0) {\r\n\t\t\t\t\tthis.tabs.forEach((tab) => {\r\n\t\t\t\t\t\ttab.contentEl.innerHTML = \"\";\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.contentEl.innerHTML = \"\";\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tthis.updateDebugOverlay();\r\n\t}\r\n\t/**\r\n\t * ウィンドウの仮想化を解除する\r\n\t */\r\n\tpublic unvirtualize(): void {\r\n\t\tif (this.virtualizationLevel === \"none\") return;\r\n\r\n\t\tthis.el.classList.remove(`${LIBRARY_NAME}-virtualization-lock`, `${LIBRARY_NAME}-is-virtualized-manual`);\r\n\r\n\t\tif (this.canvasSnapshot && this.canvasOverlayEl) {\r\n\t\t\tthis.canvasOverlayEl.style.display = \"none\";\r\n\t\t\tthis.canvasOverlayEl.innerHTML = \"\";\r\n\t\t\tthis.canvasSnapshot = null;\r\n\t\t}\r\n\r\n\t\tthis.manager.updateTaskbarItem(this, \"unvirtualized\");\r\n\r\n\t\tconst previousLevel = this.virtualizationLevel;\r\n\t\tthis.virtualizationLevel = \"none\";\r\n\t\tthis.cleanupVirtualizationStyles();\r\n\r\n\t\tif (previousLevel === \"unloaded\") {\r\n\t\t\tthis.showLoader();\r\n\t\t\trequestAnimationFrame(() => {\r\n\t\t\t\tthis.isContentLoaded = false; // Allow re-rendering\r\n\t\t\t\tthis._renderInitialContent();\r\n\t\t\t\tthis.hideLoader();\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis.updateDebugOverlay();\r\n\t}\r\n\r\n\t/**\r\n\t * 仮想化に関連するスタイルと属性をリセットします。\r\n\t */\r\n\tprivate cleanupVirtualizationStyles(): void {\r\n\t\tthis.el.classList.remove(`${LIBRARY_NAME}-is-frozen`, `${LIBRARY_NAME}-is-suspended`, `${LIBRARY_NAME}-is-virtualized`);\r\n\t\tthis.contentEl.style.display = \"\";\r\n\t}\r\n\r\n\t// --- Public API ---\r\n\r\n\tpublic close(): void {\r\n\t\t// onBeforeCloseでfalseが返された場合は処理を中断\r\n\t\tconst results = this.emit(\"before-close\", this);\r\n\t\tif (results?.includes(false)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Clean up global event listeners\r\n\t\tif (this.boundGlobalClickHandler) {\r\n\t\t\tdocument.removeEventListener(\"click\", this.boundGlobalClickHandler);\r\n\t\t}\r\n\t\tthis.emit(\"close\", this);\r\n\t\tthis.manager.destroyWindow(this.id);\r\n\t}\r\n\r\n\tpublic minimize(options?: AnimationOptions): void {\r\n\t\tif (this.virtualizationLevel !== \"none\") {\r\n\t\t\tthis.unvirtualize();\r\n\t\t}\r\n\t\tif (this.state === \"minimized\") return;\r\n\r\n\t\tif (this.state !== \"normal\") {\r\n\t\t\tthis.restore();\r\n\t\t}\r\n\r\n\t\tconst doMinimize = () => {\r\n\t\t\tthis.state = \"minimized\";\r\n\t\t\tthis.el.classList.add(`${LIBRARY_NAME}-minimized`);\r\n\t\t\tthis.el.classList.remove(`${LIBRARY_NAME}-is-minimizing`);\r\n\t\t\tthis.el.setAttribute(\"aria-hidden\", \"true\");\r\n\t\t\tthis.manager.updateTaskbarItem(this, \"minimized\");\r\n\t\t\tthis.blur();\r\n\r\n\t\t\t// 最小化時の仮想化タイマーを開始\r\n\t\t\tconst globalConfig = this.manager.getGlobalConfig();\r\n\t\t\tif (globalConfig.enableVirtualization && this.options.virtualizable) {\r\n\t\t\t\tif (this.minimizeVirtualizeTimer) {\r\n\t\t\t\t\tclearTimeout(this.minimizeVirtualizeTimer);\r\n\t\t\t\t}\r\n\t\t\t\tthis.minimizeVirtualizeTimer = window.setTimeout(() => {\r\n\t\t\t\t\tthis.virtualize(\"auto\");\r\n\t\t\t\t}, globalConfig.virtualizationDelay ?? 5000);\r\n\t\t\t}\r\n\t\t\tthis.updateDebugOverlay();\r\n\t\t\tthis.manager.updateVirtualization();\r\n\t\t};\r\n\r\n\t\tthis.el.setAttribute(\"inert\", \"\");\r\n\t\tif (this.manager.getGlobalConfig().enableAnimations) {\r\n\t\t\tconst originPriority = [options?.origin, this.options.animationOrigin, this.manager.getGlobalConfig().animateFromTaskbar ? this.options._taskbarItem : null];\r\n\t\t\tconst origin = originPriority.find((o) => o != null);\r\n\t\t\tthis.el.style.transformOrigin = this._calculateTransformOrigin(origin);\r\n\r\n\t\t\tthis.el.classList.add(`${LIBRARY_NAME}-is-minimizing`);\r\n\t\t\tthis.el.addEventListener(\"transitionend\", doMinimize, { once: true });\r\n\t\t} else {\r\n\t\t\tdoMinimize();\r\n\t\t}\r\n\t}\r\n\r\n\tpublic toggleMaximize(): void {\r\n\t\tthis.state === \"maximized\" ? this.restore() : this.maximize();\r\n\t}\r\n\r\n\tpublic maximize(): void {\r\n\t\tif (this.virtualizationLevel !== \"none\") {\r\n\t\t\tthis.unvirtualize();\r\n\t\t}\r\n\t\tif (this.state !== \"maximized\") {\r\n\t\t\tif (this.state !== \"normal\") this.restore();\r\n\t\t\tthis.lastState = { x: this.el.offsetLeft, y: this.el.offsetTop, width: this.el.offsetWidth, height: this.el.offsetHeight };\r\n\t\t\tthis.state = \"maximized\";\r\n\t\t\tthis.el.classList.add(`${LIBRARY_NAME}-maximized`);\r\n\r\n\t\t\tconst doMaximize = () => {\r\n\t\t\t\tthis.el.classList.remove(`${LIBRARY_NAME}-is-maximizing`);\r\n\t\t\t\tthis.setPosition(0, 0);\r\n\t\t\t\tthis.setSize(\"100%\", \"100%\");\r\n\t\t\t\tthis.updateDebugOverlay();\r\n\t\t\t};\r\n\r\n\t\t\tif (this.manager.getGlobalConfig().enableAnimations) {\r\n\t\t\t\tthis.el.classList.add(`${LIBRARY_NAME}-is-maximizing`);\r\n\t\t\t\t// アニメーションのために先にサイズと位置を設定\r\n\t\t\t\tthis.el.style.top = \"0px\";\r\n\t\t\t\tthis.el.style.left = \"0px\";\r\n\t\t\t\tthis.el.style.width = \"100%\";\r\n\t\t\t\tthis.el.style.height = \"100%\";\r\n\t\t\t\tthis.el.addEventListener(\"transitionend\", doMaximize, { once: true, passive: true });\r\n\t\t\t} else {\r\n\t\t\t\tdoMaximize();\r\n\t\t\t}\r\n\r\n\t\t\tconst maxBtn = this.el.querySelector<HTMLButtonElement>(`.${LIBRARY_NAME}-maximize-btn`);\r\n\t\t\tif (maxBtn) {\r\n\t\t\t\tmaxBtn.title = \"Restore\";\r\n\t\t\t\tmaxBtn.value = \"\\u274f\";\r\n\t\t\t\tmaxBtn.setAttribute(\"aria-label\", \"Restore\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpublic restore(options?: AnimationOptions): void {\r\n\t\t// 仮想化解除タイマーをクリア\r\n\t\tif (this.minimizeVirtualizeTimer) {\r\n\t\t\tclearTimeout(this.minimizeVirtualizeTimer);\r\n\t\t\tthis.minimizeVirtualizeTimer = null;\r\n\t\t}\r\n\t\t// もし仮想化されていたら、解除する\r\n\t\tif (this.virtualizationLevel !== \"none\") {\r\n\t\t\tthis.unvirtualize();\r\n\t\t}\r\n\r\n\t\tif (this.state === \"minimized\") {\r\n\t\t\tconst doRestore = () => {\r\n\t\t\t\tthis.state = \"normal\";\r\n\t\t\t\tthis.el.classList.remove(`${LIBRARY_NAME}-is-restoring-from-minimized`);\r\n\t\t\t\t// アニメーション後に不要なスタイルをクリーンアップ\r\n\t\t\t\tthis.el.style.transformOrigin = \"\";\r\n\t\t\t\tthis.updateDebugOverlay();\r\n\t\t\t\tthis.manager.updateVirtualization();\r\n\t\t\t};\r\n\r\n\t\t\tthis.el.removeAttribute(\"aria-hidden\");\r\n\t\t\tthis.el.removeAttribute(\"inert\");\r\n\t\t\tthis.el.style.transition = \"\"; // Use CSS transition for transform/opacity\r\n\r\n\t\t\tif (this.manager.getGlobalConfig().enableAnimations) {\r\n\t\t\t\tconst originPriority = [options?.origin, this.options.animationOrigin, this.manager.getGlobalConfig().animateFromTaskbar ? this.options._taskbarItem : null];\r\n\t\t\t\tconst origin = originPriority.find((o) => o != null);\r\n\t\t\t\tthis.el.style.transformOrigin = this._calculateTransformOrigin(origin);\r\n\r\n\t\t\t\t// `minimized`クラスを削除して表示状態にし、アニメーションを開始\r\n\t\t\t\tthis.el.classList.remove(`${LIBRARY_NAME}-minimized`);\r\n\t\t\t\tthis.el.classList.add(`${LIBRARY_NAME}-is-restoring-from-minimized`);\r\n\t\t\t\tthis.el.addEventListener(\"transitionend\", doRestore, { once: true });\r\n\t\t\t} else {\r\n\t\t\t\tthis.el.classList.remove(`${LIBRARY_NAME}-minimized`);\r\n\t\t\t\tdoRestore();\r\n\t\t\t}\r\n\r\n\t\t\tthis.manager.updateTaskbarItem(this, \"restored\");\r\n\t\t\tthis.focus();\r\n\t\t} else if (this.state === \"maximized\") {\r\n\t\t\tconst doRestore = () => {\r\n\t\t\t\tthis.state = \"normal\";\r\n\t\t\t\tthis.el.classList.remove(`${LIBRARY_NAME}-maximized`, `${LIBRARY_NAME}-is-restoring`);\r\n\t\t\t\tthis.el.style.transition = \"\"; // Reset transition\r\n\t\t\t\tconst maxBtn = this.el.querySelector<HTMLButtonElement>(`.${LIBRARY_NAME}-maximize-btn`);\r\n\t\t\t\tif (maxBtn) {\r\n\t\t\t\t\tmaxBtn.title = \"Maximize\";\r\n\t\t\t\t\tmaxBtn.value = \"\\u25a1\";\r\n\t\t\t\t\tmaxBtn.setAttribute(\"aria-label\", \"Maximize\");\r\n\t\t\t\t}\r\n\t\t\t\tthis.updateDebugOverlay();\r\n\t\t\t};\r\n\r\n\t\t\tif (this.manager.getGlobalConfig().enableAnimations) {\r\n\t\t\t\tthis.el.style.transition = \"top 0.25s ease-in-out, left 0.25s ease-in-out, width 0.25s ease-in-out, height 0.25s ease-in-out\";\r\n\t\t\t\tthis.el.classList.add(`${LIBRARY_NAME}-is-restoring`);\r\n\t\t\t\tthis.setSize(this.lastState.width, this.lastState.height);\r\n\t\t\t\tthis.setPosition(this.lastState.x, this.lastState.y);\r\n\t\t\t\tthis.el.addEventListener(\"transitionend\", doRestore, { once: true });\r\n\t\t\t} else {\r\n\t\t\t\tthis.setSize(this.lastState.width, this.lastState.height);\r\n\t\t\t\tthis.setPosition(this.lastState.x, this.lastState.y);\r\n\t\t\t\tdoRestore();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.updateDebugOverlay();\r\n\t\t(async () => await this.manager.updateVirtualization())();\r\n\t}\r\n\r\n\tpublic focus(): void {\r\n\t\tif (this.focused) return;\r\n\r\n\t\tconst restoreMode = this.options.virtualizationRestoreMode || this.manager.getGlobalConfig().virtualizationRestoreMode || \"auto\";\r\n\t\tif (this.virtualizationLevel !== \"none\" && restoreMode === \"manual\") {\r\n\t\t\tthis.unvirtualize();\r\n\t\t}\r\n\r\n\t\tif (this.options.lazyLoad && !this.isContentLoaded) {\r\n\t\t\tthis._renderInitialContent();\r\n\t\t}\r\n\r\n\t\t// 階層を遡ってすべての親ウィンドウをフォーカスする\r\n\t\tif (this.parentWindow) {\r\n\t\t\tthis.parentWindow.focus();\r\n\t\t}\r\n\r\n\t\tthis.manager.focusWindow(this);\r\n\t\tthis.focused = true;\r\n\t\tthis.el.classList.add(`${LIBRARY_NAME}-active`);\r\n\t\tthis.updateDebugOverlay();\r\n\t\tthis.emit(\"focus\", this);\r\n\t}\r\n\r\n\tpublic blur(): void {\r\n\t\tif (!this.focused) return;\r\n\t\tthis.focused = false;\r\n\t\tthis.el.classList.remove(`${LIBRARY_NAME}-active`);\r\n\t\tthis.updateDebugOverlay();\r\n\t\tthis.emit(\"blur\", this);\r\n\t}\r\n\r\n\tpublic shake(): void {\r\n\t\tconst className = `${LIBRARY_NAME}-is-shaking`;\r\n\t\tif (this.el.classList.contains(className)) {\r\n\t\t\treturn; // Already shaking\r\n\t\t}\r\n\t\tthis.el.classList.add(className);\r\n\t\tthis.el.addEventListener(\r\n\t\t\t\"animationend\",\r\n\t\t\t() => {\r\n\t\t\t\tthis.el.classList.remove(className);\r\n\t\t\t},\r\n\t\t\t{ once: true, passive: true }\r\n\t\t);\r\n\t}\r\n\r\n\tpublic reload(): void {\r\n\t\t// onReloadがfalseを返した場合、デフォルトのリロード処理を中断\r\n\t\tconst results = this.emit(\"reload\", this);\r\n\t\tif (results?.includes(false)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst reloadContent = (container: HTMLElement, content: WindowContentOptions) => {\r\n\t\t\tif (Utils.isNonEmptyObject(content.iframe) && (content.iframe.src || content.iframe.srcdoc)) {\r\n\t\t\t\tconst iframe = container.querySelector(\"iframe\");\r\n\t\t\t\t// srcがあり、srcdocがない場合はiframeのreloadを試みる\r\n\t\t\t\tif (iframe && iframe.src && !content.iframe.srcdoc) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t// クロスオリジンフレームへのアクセスはエラーになる可能性がある\r\n\t\t\t\t\t\tiframe.contentWindow?.location.reload();\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t// 失敗した場合はiframe要素を再生成する\r\n\t\t\t\t\t\tconsole.warn(\"WinLet: Cross-origin iframe could not be reloaded directly. Recreating iframe element.\", e);\r\n\t\t\t\t\t\tthis.renderContent(container, content);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// srcdocの場合やiframeが見つからない場合は要素を再生成\r\n\t\t\t\t\tthis.renderContent(container, content);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// htmlまたはtemplateの場合は常に再描画\r\n\t\t\t\tthis.renderContent(container, content);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tif (this.options.tabs.length > 0) {\r\n\t\t\tconst activeTabIndex = this.tabs.findIndex((tab) => tab.tabEl.classList.contains(`${LIBRARY_NAME}-active`));\r\n\t\t\tif (activeTabIndex > -1) {\r\n\t\t\t\tconst activeTab = this.tabs[activeTabIndex];\r\n\t\t\t\tconst tabContentOptions = this.options.tabs[activeTabIndex].content;\r\n\t\t\t\treloadContent(activeTab.contentEl, tabContentOptions);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treloadContent(this.contentEl, this.options.content);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic getContent(): HTMLElement | HTMLIFrameElement {\r\n\t\tlet contentContainer: HTMLElement;\r\n\t\tconst activeTabIndex = this.tabs.findIndex((tab) => tab.tabEl.classList.contains(`${LIBRARY_NAME}-active`));\r\n\r\n\t\tif (activeTabIndex > -1) {\r\n\t\t\t// If there's an active tab, use its content element\r\n\t\t\tcontentContainer = this.tabs[activeTabIndex].contentEl;\r\n\t\t} else {\r\n\t\t\t// Otherwise, use the main content element\r\n\t\t\tcontentContainer = this.contentEl;\r\n\t\t}\r\n\r\n\t\tconst iframe = contentContainer.querySelector(\"iframe\");\r\n\t\treturn iframe || contentContainer;\r\n\t}\r\n\r\n\t/**\r\n\t * 子ウィンドウマネージャを初期化または取得します。\r\n\t */\r\n\tprivate getChildManager(): WindowManager {\r\n\t\tif (!this.childManager) {\r\n\t\t\t// WindowManagerのコンストラクタとGlobalConfigの整合性を取る必要がある\r\n\t\t\t// ここでは簡易的に空のconfigで生成\r\n\t\t\tconst childConfig = {};\r\n\t\t\tthis.childManager = new WindowManager(childConfig);\r\n\r\n\t\t\t// 子マネージャのコンテナとして、このウィンドウのcontentElを指定\r\n\t\t\tthis.childManager.applyGlobalConfig({ container: this.contentEl });\r\n\t\t\tthis.childManager.init();\r\n\t\t}\r\n\t\treturn this.childManager;\r\n\t}\r\n\r\n\t/**\r\n\t * ステータスバーのテキストを更新します。\r\n\t */\r\n\tpublic setStatusBarText(text: string): void {\r\n\t\tif (this.statusBarEl) {\r\n\t\t\tif (this.options.statusBar.allowHTML) {\r\n\t\t\t\tthis.statusBarEl.innerHTML = text;\r\n\t\t\t} else {\r\n\t\t\t\tthis.statusBarEl.textContent = text;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * ウィンドウ内検索UIを開きます。\r\n\t */\r\n\tpublic openSearch(): void {\r\n\t\tif (this.searchBarEl) {\r\n\t\t\tconst input = this.searchBarEl.querySelector<HTMLInputElement>(`.${LIBRARY_NAME}-search-input`);\r\n\t\t\tinput?.focus();\r\n\t\t\tinput?.select();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.searchBarEl = document.createElement(\"div\");\r\n\t\tthis.searchBarEl.className = `${LIBRARY_NAME}-search-bar`;\r\n\r\n\t\tconst s = this.options.search;\r\n\t\tconst caseBtn = s.showCaseSensitiveButton ? `<button class=\"${LIBRARY_NAME}-search-btn\" data-action=\"case-sensitive\" title=\"Case Sensitive\">Aa</button>` : \"\";\r\n\t\tconst regexBtn = s.showRegexButton ? `<button class=\"${LIBRARY_NAME}-search-btn\" data-action=\"regex\" title=\"Use Regular Expression\">.*</button>` : \"\";\r\n\t\tconst wordBtn = s.showWholeWordButton ? `<button class=\"${LIBRARY_NAME}-search-btn\" data-action=\"whole-word\" title=\"Match Whole Word\">ab</button>` : \"\";\r\n\r\n\t\tthis.searchBarEl.innerHTML = `\r\n\t\t\t<input type=\"text\" class=\"${LIBRARY_NAME}-search-input\" placeholder=\"Search...\">\r\n\t\t\t<span class=\"${LIBRARY_NAME}-search-results\">0/0</span>\r\n\t\t\t${caseBtn}\r\n\t\t\t${regexBtn}\r\n\t\t\t${wordBtn}\r\n\t\t\t<button class=\"${LIBRARY_NAME}-search-btn\" data-action=\"prev\" title=\"Previous Match\">&uarr;</button>\r\n\t\t\t<button class=\"${LIBRARY_NAME}-search-btn\" data-action=\"next\" title=\"Next Match\">&darr;</button>\r\n\t\t\t<button class=\"${LIBRARY_NAME}-search-btn\" data-action=\"close\" title=\"Close\">&times;</button>\r\n\t\t`;\r\n\r\n\t\tthis.contentEl.insertBefore(this.searchBarEl, this.contentEl.firstChild);\r\n\r\n\t\t// ボタンのアクティブ状態を反映\r\n\t\tthis.updateSearchButtonState();\r\n\r\n\t\tconst input = this.searchBarEl.querySelector<HTMLInputElement>(`.${LIBRARY_NAME}-search-input`)!;\r\n\t\tinput.focus();\r\n\r\n\t\tinput.addEventListener(\"input\", () => this._performSearch(), { passive: true });\r\n\t\tinput.addEventListener(\r\n\t\t\t\"keydown\",\r\n\t\t\t(e) => {\r\n\t\t\t\tif (e.key === \"Enter\") {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tif (e.shiftKey) {\r\n\t\t\t\t\t\tthis.navigateSearch(\"prev\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.navigateSearch(\"next\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{ passive: false }\r\n\t\t);\r\n\r\n\t\tthis.searchBarEl.addEventListener(\r\n\t\t\t\"click\",\r\n\t\t\t(e) => {\r\n\t\t\t\tconst target = e.target as HTMLElement;\r\n\t\t\t\tconst button = target.closest<HTMLElement>(\"[data-action]\");\r\n\t\t\t\tif (!button) return;\r\n\t\t\t\tconst action = button.dataset.action;\r\n\r\n\t\t\t\tswitch (action) {\r\n\t\t\t\t\tcase \"close\":\r\n\t\t\t\t\t\tthis.closeSearch();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"prev\":\r\n\t\t\t\t\t\tthis.navigateSearch(\"prev\");\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"next\":\r\n\t\t\t\t\t\tthis.navigateSearch(\"next\");\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"case-sensitive\":\r\n\t\t\t\t\t\tthis.searchOptionsState.caseSensitive = !this.searchOptionsState.caseSensitive;\r\n\t\t\t\t\t\tthis.updateSearchButtonState(button, this.searchOptionsState.caseSensitive);\r\n\t\t\t\t\t\tthis._performSearch();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"regex\":\r\n\t\t\t\t\t\tthis.searchOptionsState.regex = !this.searchOptionsState.regex;\r\n\t\t\t\t\t\tthis.updateSearchButtonState(button, this.searchOptionsState.regex);\r\n\t\t\t\t\t\tthis._performSearch();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"whole-word\":\r\n\t\t\t\t\t\tthis.searchOptionsState.wholeWord = !this.searchOptionsState.wholeWord;\r\n\t\t\t\t\t\tthis.updateSearchButtonState(button, this.searchOptionsState.wholeWord);\r\n\t\t\t\t\t\tthis._performSearch();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{ passive: true }\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * ウィンドウ内検索UIを閉じます。\r\n\t */\r\n\tpublic closeSearch(): void {\r\n\t\tif (this.searchBarEl) {\r\n\t\t\tthis.clearSearchHighlights();\r\n\t\t\tthis.searchBarEl.remove();\r\n\t\t\tthis.searchBarEl = null;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate navigateSearch(direction: \"next\" | \"prev\"): void {\r\n\t\tif (this.searchResults.length === 0) return;\r\n\r\n\t\tif (direction === \"next\") {\r\n\t\t\tthis.currentSearchIndex = (this.currentSearchIndex + 1) % this.searchResults.length;\r\n\t\t} else {\r\n\t\t\tthis.currentSearchIndex = (this.currentSearchIndex - 1 + this.searchResults.length) % this.searchResults.length;\r\n\t\t}\r\n\t\tthis.updateSearchResults(this.currentSearchIndex + 1, this.searchResults.length);\r\n\t\tthis.highlightCurrentResult();\r\n\t}\r\n\r\n\tprivate highlightCurrentResult(): void {\r\n\t\tthis.searchResults.forEach((el, index) => {\r\n\t\t\tel.classList.toggle(`${LIBRARY_NAME}-search-highlight-active`, index === this.currentSearchIndex);\r\n\t\t});\r\n\t\tif (this.currentSearchIndex > -1) {\r\n\t\t\tthis.searchResults[this.currentSearchIndex].scrollIntoView({\r\n\t\t\t\tbehavior: \"instant\",\r\n\t\t\t\tblock: \"nearest\",\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tprivate clearSearchHighlights(): void {\r\n\t\t// 検索対象は動的に変わるため、ハイライト解除はウィンドウ全体を対象に行う\r\n\t\tconst allContentAreas = this.el.querySelectorAll(`.${LIBRARY_NAME}-content, .${LIBRARY_NAME}-split-pane`);\r\n\t\tallContentAreas.forEach((area) => {\r\n\t\t\tconst highlights = area.querySelectorAll<HTMLElement>(`.${LIBRARY_NAME}-search-highlight`);\r\n\t\t\thighlights.forEach((el) => {\r\n\t\t\t\tconst parent = el.parentNode;\r\n\t\t\t\tif (parent) {\r\n\t\t\t\t\tparent.replaceChild(document.createTextNode(el.textContent || \"\"), el);\r\n\t\t\t\t\tparent.normalize(); // 隣接するテキストノードを結合\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tthis.searchResults = [];\r\n\t\tthis.currentSearchIndex = -1;\r\n\t}\r\n\r\n\tprivate updateSearchResults(current: number, total: number): void {\r\n\t\tif (this.searchBarEl) {\r\n\t\t\tconst resultsEl = this.searchBarEl.querySelector<HTMLElement>(`.${LIBRARY_NAME}-search-results`)!;\r\n\t\t\tresultsEl.textContent = `${total > 0 ? current : 0}/${total}`;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _performSearch(): void {\r\n\t\tif (!this.searchBarEl) return;\r\n\t\tthis.clearSearchHighlights();\r\n\r\n\t\tconst input = this.searchBarEl.querySelector<HTMLInputElement>(`.${LIBRARY_NAME}-search-input`)!;\r\n\t\tlet query = input.value;\r\n\r\n\t\tif (query.length < 1) {\r\n\t\t\tthis.updateSearchResults(0, 0);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet searchRoot: Element | null = this.contentEl;\r\n\t\tconst activeTabIndex = this.tabs.findIndex((tab) => tab.tabEl.classList.contains(`${LIBRARY_NAME}-active`));\r\n\t\tif (this.options.tabs.length > 0 && activeTabIndex !== -1 && this.tabs[activeTabIndex]) {\r\n\t\t\tsearchRoot = this.tabs[activeTabIndex].contentEl;\r\n\t\t}\r\n\t\tif (!searchRoot) return;\r\n\r\n\t\tconst contentArea = this.options.search.targetSelector ? searchRoot.querySelector(this.options.search.targetSelector) : searchRoot;\r\n\t\tif (!contentArea) return;\r\n\r\n\t\tif (!this.searchOptionsState.regex) {\r\n\t\t\tquery = Utils.escapeRegex(query);\r\n\t\t}\r\n\t\tif (this.searchOptionsState.wholeWord) {\r\n\t\t\tquery = `\\\\b${query}\\\\b`;\r\n\t\t}\r\n\r\n\t\tlet regex: RegExp;\r\n\t\ttry {\r\n\t\t\tregex = new RegExp(query, this.searchOptionsState.caseSensitive ? \"g\" : \"gi\");\r\n\t\t\tinput.style.borderColor = \"\";\r\n\t\t} catch (e) {\r\n\t\t\t// 不正な正規表現の場合は何もしない\r\n\t\t\tinput.style.borderColor = \"red\";\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst newHighlights: HTMLElement[] = [];\r\n\t\tconst nodesToModify: { node: Text; matches: RegExpMatchArray }[] = [];\r\n\r\n\t\tconst walker = document.createTreeWalker(contentArea, NodeFilter.SHOW_TEXT, (node) => {\r\n\t\t\t// スクリプトやスタイル、既存のハイライトの中は検索しない\r\n\t\t\treturn node.parentElement?.tagName === \"SCRIPT\" || node.parentElement?.tagName === \"STYLE\" || node.parentElement?.classList.contains(`${LIBRARY_NAME}-search-highlight`) ? NodeFilter.FILTER_REJECT : NodeFilter.FILTER_ACCEPT;\r\n\t\t});\r\n\r\n\t\tlet currentNode: Node | null;\r\n\t\twhile ((currentNode = walker.nextNode())) {\r\n\t\t\tconst textNode = currentNode as Text;\r\n\t\t\t// 空のテキストノードは無視\r\n\t\t\tif (!textNode.textContent?.trim()) continue;\r\n\t\t\tconst matches = textNode.textContent.match(regex);\r\n\t\t\tif (matches) {\r\n\t\t\t\tnodesToModify.push({ node: textNode, matches });\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// DOMの変更処理\r\n\t\tfor (const { node, matches } of nodesToModify) {\r\n\t\t\tconst parent = node.parentNode;\r\n\t\t\tif (!parent) continue;\r\n\r\n\t\t\tconst parts = node.textContent!.split(regex);\r\n\r\n\t\t\tparts.forEach((part, i) => {\r\n\t\t\t\tif (part) {\r\n\t\t\t\t\tparent.insertBefore(document.createTextNode(part), node);\r\n\t\t\t\t}\r\n\t\t\t\tif (i < matches.length) {\r\n\t\t\t\t\tconst highlight = document.createElement(\"span\");\r\n\t\t\t\t\thighlight.className = `${LIBRARY_NAME}-search-highlight`;\r\n\t\t\t\t\thighlight.textContent = matches[i];\r\n\t\t\t\t\tparent.insertBefore(highlight, node);\r\n\t\t\t\t\tnewHighlights.push(highlight);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tparent.removeChild(node);\r\n\t\t}\r\n\r\n\t\tthis.searchResults = newHighlights;\r\n\t\tthis.currentSearchIndex = this.searchResults.length > 0 ? 0 : -1;\r\n\t\tthis.updateSearchResults(this.currentSearchIndex + 1, this.searchResults.length);\r\n\t\tthis.highlightCurrentResult();\r\n\t}\r\n\r\n\tprivate updateSearchButtonState(button?: HTMLElement, isActive?: boolean): void {\r\n\t\tif (!this.searchBarEl) return;\r\n\t\tif (button && typeof isActive === \"boolean\") {\r\n\t\t\tbutton.classList.toggle(`${LIBRARY_NAME}-search-btn-active`, isActive);\r\n\t\t} else {\r\n\t\t\t// 初期化用\r\n\t\t\tconst s = this.searchOptionsState;\r\n\t\t\tconst caseBtn = this.searchBarEl.querySelector(`[data-action=\"case-sensitive\"]`);\r\n\t\t\tconst regexBtn = this.searchBarEl.querySelector(`[data-action=\"regex\"]`);\r\n\t\t\tconst wordBtn = this.searchBarEl.querySelector(`[data-action=\"whole-word\"]`);\r\n\t\t\tcaseBtn?.classList.toggle(`${LIBRARY_NAME}-search-btn-active`, s.caseSensitive);\r\n\t\t\tregexBtn?.classList.toggle(`${LIBRARY_NAME}-search-btn-active`, s.regex);\r\n\t\t\twordBtn?.classList.toggle(`${LIBRARY_NAME}-search-btn-active`, s.wholeWord);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * このウィンドウ内に新しいウィンドウを作成します。\r\n\t */\r\n\tpublic createWindow(options: WindowOptions = {}): IWindow {\r\n\t\t// iframeコンテンツの場合は、直接DOM操作する代わりにpostMessageを使用\r\n\t\tconst iframe = this.contentEl.querySelector(\"iframe\");\r\n\t\tif (iframe && iframe.contentWindow) {\r\n\t\t\tconst message = {\r\n\t\t\t\ttype: \"winlet:createWindow\",\r\n\t\t\t\toptions: options,\r\n\t\t\t};\r\n\t\t\t// iframeのオリジンを尊重\r\n\t\t\tiframe.contentWindow.postMessage(message, \"*\");\r\n\t\t\t// postMessageでは直接インスタンスを返せないため、暫定的にnullを返すか、Promiseベースの設計にする必要がある\r\n\t\t\t// ここでは未対応とし、コンソールに警告を出す\r\n\t\t\tconsole.warn(\"WinLet: Window creation inside an iframe is asynchronous and does not return an instance directly.\");\r\n\t\t\t// ダミーのインスタンスを返すか、APIの戻り値をvoidにするなどの検討が必要\r\n\t\t\treturn null as any; // 暫定\r\n\t\t}\r\n\r\n\t\t// 通常のHTMLコンテンツの場合\r\n\t\tconst manager = this.getChildManager();\r\n\t\t// 新しいウィンドウに自身を親として設定\r\n\t\toptions._parent = this;\r\n\t\treturn manager.createWindow(options);\r\n\t}\r\n\r\n\t/**\r\n\t * このウィンドウ内に新しいポップアップを作成します。\r\n\t */\r\n\tpublic createPopup(options: PopupOptions): IWindow {\r\n\t\tconst manager = this.getChildManager();\r\n\t\t// ポップアップにも自身を親として設定\r\n\t\tconst winOptions: WindowOptions = { _parent: this };\r\n\t\treturn manager.popup(Object.assign(options, winOptions));\r\n\t}\r\n\r\n\tpublic createAsyncPopup(options: PopupOptions): Promise<PopupResult> {\r\n\t\tconst manager = this.getChildManager();\r\n\t\tconst popupOptionsWithParent = { ...options, _parent: this };\r\n\t\treturn manager.popupAsync(popupOptionsWithParent);\r\n\t}\r\n\r\n\tpublic async capture(): Promise<string> {\r\n\t\t// HTML2Canvasがロードされているかどうかを確認します（例：CDN経由）\r\n\t\tif (typeof window.html2canvas !== \"function\") {\r\n\t\t\tconst e = new WinLetError(\"The capture() feature requires the 'html2canvas' library. Please include it from a CDN to use this feature. https://html2canvas.hertzen.com/\");\r\n\t\t\tconsole.warn(e);\r\n\t\t\treturn Promise.reject(e);\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tconst canvas = await window.html2canvas(this.el, {\r\n\t\t\t\tallowTaint: true,\r\n\t\t\t\tuseCORS: true,\r\n\t\t\t\tlogging: false,\r\n\t\t\t\tonclone: (clonedDoc: Document) => {\r\n\t\t\t\t\t// 一時的なUI要素のキャプチャを避けるため\r\n\t\t\t\t\tclonedDoc.querySelector(`#${this.id}`)?.classList.remove(`${LIBRARY_NAME}-is-resizing`, `${LIBRARY_NAME}-is-dragging`);\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t\treturn canvas.toDataURL(\"image/png\");\r\n\t\t} catch (error: any) {\r\n\t\t\tconst e = new WinLetError(`html2canvas failed to capture the window. Error: ${error.message}`);\r\n\t\t\te.stack += \"\\n\\n--- Caused by ---\\n\" + error.stack;\r\n\t\t\tconsole.error(e);\r\n\t\t\treturn Promise.reject(e);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic print(): void {\r\n\t\tconst contentSource = this.getContent();\r\n\r\n\t\t// コンテンツがiframeの場合は、直接印刷\r\n\t\tif (contentSource.tagName === \"IFRAME\") {\r\n\t\t\tconst iframe = contentSource as HTMLIFrameElement;\r\n\t\t\ttry {\r\n\t\t\t\t// 印刷する前にiframeが完全にロードされていることを確認\r\n\t\t\t\tif (document.readyState === \"complete\") {\r\n\t\t\t\t\tiframe.contentWindow?.print();\r\n\t\t\t\t} else {\r\n\t\t\t\t\twindow.addEventListener(\"load\", () => {\r\n\t\t\t\t\t\tiframe.contentWindow?.print();\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error(\"WinLet: Could not print iframe content, possibly due to cross-origin restrictions.\", e);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst size = this.getSize();\r\n\r\n\t\t// HTMLコンテンツの場合、印刷する一時的なiframeを作成します。\r\n\t\tconst printFrame = document.createElement(\"iframe\");\r\n\t\tprintFrame.style.position = \"absolute\";\r\n\t\tprintFrame.style.opacity = \"0.01\";\r\n\t\tprintFrame.style.border = \"0\";\r\n\t\tprintFrame.style.top = \"0\";\r\n\t\tprintFrame.style.left = \"0\";\r\n\t\tprintFrame.style.width = size.width + \"px\";\r\n\t\tprintFrame.style.height = size.height + \"px\";\r\n\t\tprintFrame.style.zIndex = \"1\";\r\n\t\tprintFrame.style.transform = \"scale(0.5)\";\r\n\t\tprintFrame.style.pointerEvents = \"none\";\r\n\t\tprintFrame.setAttribute(\"inert\", \"\");\r\n\t\tdocument.body.appendChild(printFrame);\r\n\r\n\t\tconst frameDoc = printFrame.contentWindow?.document;\r\n\t\tif (!frameDoc) {\r\n\t\t\tconsole.error(\"WinLet: Could not create a document for printing.\");\r\n\t\t\tdocument.body.removeChild(printFrame);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tframeDoc.open();\r\n\t\tframeDoc.write(\"<!DOCTYPE html><html><head>\");\r\n\t\tframeDoc.write(`<title>${this.getTitle()}</title>`);\r\n\r\n\t\t// メインドキュメントから印刷iframeにスタイルをコピーします\r\n\t\tconst styles = document.querySelectorAll('style, link[rel=\"stylesheet\"]');\r\n\t\tstyles.forEach((style) => {\r\n\t\t\tframeDoc.write(style.outerHTML);\r\n\t\t});\r\n\r\n\t\tframeDoc.write(\"</head><body>\");\r\n\t\tframeDoc.write(contentSource.innerHTML);\r\n\t\tframeDoc.write(\"</body></html>\");\r\n\t\tframeDoc.close();\r\n\r\n\t\tconst doPrint = async () => {\r\n\t\t\tawait new Promise((resolve) => setTimeout(resolve, 300));\r\n\t\t\ttry {\r\n\t\t\t\tprintFrame.contentWindow?.focus();\r\n\t\t\t\tprintFrame.contentWindow?.print();\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error(\"WinLet: Printing failed.\", e);\r\n\t\t\t} finally {\r\n\t\t\t\t// 印刷ダイアログが閉じられた後にiframeが削除されます（またはキャンセルされます）\r\n\t\t\t\t// タイムアウトを使用すると、印刷ダイアログが適切に開くことができます\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tdocument.body.removeChild(printFrame);\r\n\t\t\t\t}, 500);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tif (printFrame.contentWindow?.document.readyState === \"complete\") {\r\n\t\t\tdoPrint();\r\n\t\t} else {\r\n\t\t\tprintFrame.contentWindow?.addEventListener(\"load\", doPrint);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic getTitle(): string {\r\n\t\treturn this.options.title;\r\n\t}\r\n\r\n\tpublic setTitle(title: string): void {\r\n\t\tthis.options.title = title;\r\n\t\tthis.titleEl.textContent = Utils.sanitizeHTML(title);\r\n\t\tthis.titleEl.setAttribute(\"aria-label\", Utils.sanitizeHTML(title));\r\n\t\tthis.manager.updateTaskbarItem(this, \"titleChanged\");\r\n\t}\r\n\r\n\tpublic setIcon(icon: string | null): void {\r\n\t\tthis.options.icon = icon;\r\n\t\tthis.iconEl.innerHTML = \"\";\r\n\t\tif (!icon) {\r\n\t\t\tthis.manager.updateTaskbarItem(this, \"iconChanged\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.isFontAwesome(icon)) {\r\n\t\t\tconst i = document.createElement(\"i\");\r\n\t\t\ti.className = icon;\r\n\t\t\tthis.iconEl.appendChild(i);\r\n\t\t} else {\r\n\t\t\tconst img = document.createElement(\"img\");\r\n\t\t\timg.src = icon;\r\n\t\t\timg.alt = \"window icon\";\r\n\t\t\tthis.iconEl.appendChild(img);\r\n\t\t}\r\n\t\tthis.manager.updateTaskbarItem(this, \"iconChanged\");\r\n\t}\r\n\r\n\tpublic getPosition(): { x: number; y: number } {\r\n\t\tif (this.state === \"maximized\") {\r\n\t\t\treturn { x: this.lastState.x, y: this.lastState.y };\r\n\t\t}\r\n\t\treturn { x: this.el.offsetLeft, y: this.el.offsetTop };\r\n\t}\r\n\r\n\tpublic setPosition(x: number | \"center\" | \"left\" | \"right\", y: number | \"center\" | \"top\" | \"bottom\"): void {\r\n\t\t// containerが存在しない（初期化前）場合は処理を中断\r\n\t\tif (!this.manager.container) {\r\n\t\t\tconsole.warn(\"WinLet Warning: setPosition called before manager is initialized.\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst parentRect = this.manager.container.getBoundingClientRect();\r\n\t\tconst winWidth = this.el.offsetWidth;\r\n\t\tconst winHeight = this.el.offsetHeight;\r\n\r\n\t\tlet finalX: number;\r\n\t\tlet finalY: number;\r\n\r\n\t\t// X座標の計算\r\n\t\tswitch (x) {\r\n\t\t\tcase \"left\":\r\n\t\t\t\tfinalX = 0;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"center\":\r\n\t\t\t\tfinalX = (parentRect.width - winWidth) / 2;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"right\":\r\n\t\t\t\tfinalX = parentRect.width - winWidth;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tfinalX = x as number;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t// Y座標の計算\r\n\t\tswitch (y) {\r\n\t\t\tcase \"top\":\r\n\t\t\t\tfinalY = 0;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"center\":\r\n\t\t\t\tfinalY = (parentRect.height - winHeight) / 2;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"bottom\":\r\n\t\t\t\tfinalY = parentRect.height - winHeight;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tfinalY = y as number;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t// 画面外にはみ出さないようにする既存のロジックを適用\r\n\t\tthis.el.style.left = `${Math.min(Math.max(150 - winWidth, finalX), parentRect.width - 150)}px`;\r\n\t\tthis.el.style.top = `${Math.min(Math.max(0, finalY), parentRect.height - 50)}px`;\r\n\t\tthis.updateDebugOverlay();\r\n\t}\r\n\r\n\tpublic getSize(): { width: number; height: number } {\r\n\t\tif (this.state === \"maximized\") {\r\n\t\t\treturn { width: this.lastState.width, height: this.lastState.height };\r\n\t\t}\r\n\t\treturn { width: this.el.offsetWidth, height: this.el.offsetHeight };\r\n\t}\r\n\r\n\tpublic setSize(width: number | string, height: number | string): void {\r\n\t\tthis.el.style.width = typeof width === \"number\" ? `${width}px` : width;\r\n\t\tthis.el.style.height = typeof height === \"number\" ? `${height}px` : height;\r\n\t\tthis.updateDebugOverlay();\r\n\t}\r\n\r\n\tpublic setOpacity(opacity: number): void {\r\n\t\tconst clampedOpacity = Math.max(0, Math.min(1, opacity));\r\n\t\tthis.options.windowOptions.opacity = clampedOpacity;\r\n\t\tthis.el.style.opacity = clampedOpacity.toString();\r\n\t}\r\n\r\n\tpublic getOpacity(): number {\r\n\t\treturn this.options.windowOptions.opacity!;\r\n\t}\r\n\r\n\tpublic setOptions(options: Partial<WindowOptions>): void {\r\n\t\t// ifExists\r\n\t\tif (typeof options.ifExists === \"boolean\") {\r\n\t\t\tthis.options.ifExists = options.ifExists;\r\n\t\t}\r\n\t\t// タイトル\r\n\t\tif (typeof options.title === \"string\") {\r\n\t\t\tthis.setTitle(options.title);\r\n\t\t}\r\n\t\t// アイコン\r\n\t\tif (typeof options.icon === \"string\" || options.icon === null) {\r\n\t\t\tthis.setIcon(options.icon);\r\n\t\t}\r\n\t\t// 位置\r\n\t\tlet x: number | \"center\" | \"left\" | \"right\" | null = null;\r\n\t\tif (typeof options.x === \"number\" || options.x === \"center\" || options.x === \"left\" || options.x === \"right\") {\r\n\t\t\tx = options.x;\r\n\t\t}\r\n\t\tlet y: number | \"center\" | \"top\" | \"bottom\" | null = null;\r\n\t\tif (typeof options.y === \"number\" || options.y === \"center\" || options.y === \"top\" || options.y === \"bottom\") {\r\n\t\t\ty = options.y;\r\n\t\t}\r\n\t\tif (x !== null || y !== null) {\r\n\t\t\tif (x === null) {\r\n\t\t\t\tx = this.getPosition().x;\r\n\t\t\t}\r\n\t\t\tif (y === null) {\r\n\t\t\t\ty = this.getPosition().y;\r\n\t\t\t}\r\n\t\t\tthis.setPosition(x, y);\r\n\t\t}\r\n\t\t// サイズ\r\n\t\tlet width: number | string | null = null;\r\n\t\tif (typeof options.width === \"number\" || typeof options.width === \"string\") {\r\n\t\t\twidth = options.width;\r\n\t\t}\r\n\t\tlet height: number | string | null = null;\r\n\t\tif (typeof options.height === \"number\" || typeof options.height === \"string\") {\r\n\t\t\theight = options.height;\r\n\t\t}\r\n\t\tif (width !== null || height !== null) {\r\n\t\t\tif (width === null) {\r\n\t\t\t\twidth = this.getSize().width;\r\n\t\t\t}\r\n\t\t\tif (height === null) {\r\n\t\t\t\theight = this.getSize().height;\r\n\t\t\t}\r\n\t\t\tthis.setSize(width, height);\r\n\t\t}\r\n\r\n\t\tconst windowOptions = options.windowOptions || {};\r\n\r\n\t\t// 不透明度\r\n\t\tif (typeof windowOptions.opacity === \"number\") {\r\n\t\t\tthis.setOpacity(windowOptions.opacity);\r\n\t\t}\r\n\t\t// 常に手前に表示\r\n\t\tif (typeof windowOptions.alwaysOnTop === \"boolean\") {\r\n\t\t\tthis.options.windowOptions.alwaysOnTop = windowOptions.alwaysOnTop;\r\n\t\t\tthis.el.classList.toggle(`${LIBRARY_NAME}-always-on-top`, windowOptions.alwaysOnTop);\r\n\t\t\t// z-indexを再評価するためにフォーカスする\r\n\t\t\tthis.focus();\r\n\t\t}\r\n\t\t// ゴーストウィンドウ\r\n\t\tif (typeof windowOptions.useGhostWindow === \"boolean\") {\r\n\t\t\tthis.options.windowOptions.useGhostWindow = windowOptions.useGhostWindow;\r\n\t\t}\r\n\t}\r\n}\r\n","// src/WindowManager.ts\r\n\r\nimport { defaultConfig } from \"../const/config\";\r\nimport { WinLetError } from \"../const/errors\";\r\nimport { ContextMenuItem, GlobalConfigOptions, GlobalEventMap, IWindow, LIBRARY_NAME, MenuItem, PopupButton, PopupButtonPreset, PopupOptions, PopupResult, TabItem, Theme, TIMEOUT_RESULT, WindowOptions } from \"../const/types\";\r\nimport WinLetBaseClass from \"../libs/baseclass\";\r\nimport Utils from \"../libs/utils\";\r\nimport styleData from \"../style/styles\";\r\nimport { darkTheme } from \"../style/themes/dark\";\r\nimport { defaultTheme } from \"../style/themes/default\";\r\nimport { highContrastTheme } from \"../style/themes/high-contrast\";\r\nimport WinLetWindow from \"./window\";\r\n\r\nexport default class WindowManager extends WinLetBaseClass<GlobalEventMap> {\r\n\tpublic container: HTMLElement | null = null;\r\n\tprivate workspaceEl: HTMLElement | null = null;\r\n\tprivate static allWindows = new Map<string, WinLetWindow>();\r\n\tprivate windows = new Map<string, WinLetWindow>();\r\n\t// z-indexを通常と最前面で分離\r\n\tprivate zIndexCounter = 1000;\r\n\tprivate zIndexCounterOnTop = 50000;\r\n\tprivate activeWindow: WinLetWindow | null = null;\r\n\tprivate contextMenuEl: HTMLElement | null = null;\r\n\tprivate _isInitialized = false;\r\n\r\n\tprivate globalConfig: GlobalConfigOptions;\r\n\r\n\tprivate lastAutoPosition: { x: number; y: number } | null = null;\r\n\tprivate lastPopupPosition: { x: number; y: number } | null = null;\r\n\tprivate readonly CASCADE_OFFSET = 30;\r\n\r\n\tpublic draggingTabInfo: { sourceWindowId: string } | null = null;\r\n\r\n\tprivate taskbarEl: HTMLElement | null = null;\r\n\tprivate themes = new Map<string, Theme>();\r\n\tprivate activeTheme: Theme | null = null;\r\n\tprivate boundTabPressHandler: ((e: KeyboardEvent) => void) | null = null;\r\n\r\n\tprivate bootstrapThemeObserver: MutationObserver | null = null;\r\n\tprivate prefersDarkMatcher: MediaQueryList | null = null;\r\n\tprivate prefersColorSchemeListener: ((e: MediaQueryListEvent) => void) | null = null;\r\n\r\n\tprivate highContrastMatcher: MediaQueryList | null = null;\r\n\tprivate highContrastListener: ((e: MediaQueryListEvent) => void) | null = null;\r\n\r\n\tconstructor(initialConfig: GlobalConfigOptions) {\r\n\t\tsuper();\r\n\t\tthis.globalConfig = initialConfig;\r\n\t\tthis.registerTheme(defaultTheme);\r\n\t\tthis.registerTheme(darkTheme);\r\n\t\tthis.registerTheme(highContrastTheme);\r\n\t}\r\n\r\n\t/**\r\n\t * ライブラリが初期化済みかどうかを取得します。\r\n\t */\r\n\tpublic get isInitialized(): boolean {\r\n\t\treturn this._isInitialized;\r\n\t}\r\n\r\n\tpublic applyGlobalConfig(options: GlobalConfigOptions) {\r\n\t\tObject.assign(this.globalConfig, options);\r\n\t\t// アニメーション設定をコンテナクラスに反映\r\n\t\tif (this.container) {\r\n\t\t\tthis.container.classList.toggle(`${LIBRARY_NAME}-animations-disabled`, !this.globalConfig.enableAnimations);\r\n\t\t\tthis.container.classList.toggle(`${LIBRARY_NAME}-debug-mode-enabled`, !!this.globalConfig.enableDebugMode);\r\n\r\n\t\t\t// タスクバーの有効・無効切り替えとレイアウト更新\r\n\t\t\tif (this.globalConfig.enableTaskbar) {\r\n\t\t\t\tif (!this.taskbarEl) {\r\n\t\t\t\t\t// タスクバーがなければ作成\r\n\t\t\t\t\tthis.createTaskbar();\r\n\t\t\t\t}\r\n\t\t\t\tthis.updateTaskbarLayout();\r\n\t\t\t} else if (this.taskbarEl) {\r\n\t\t\t\t// 無効化された場合\r\n\t\t\t\tthis.taskbarEl.remove();\r\n\t\t\t\tthis.taskbarEl = null;\r\n\t\t\t\t// flex-directionをリセット\r\n\t\t\t\tthis.container.style.flexDirection = \"\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Bootstrapテーマ監視の開始/停止\r\n\t\tif (this.globalConfig.autoDetectBootstrapTheme) {\r\n\t\t\tthis.startBootstrapThemeObserver();\r\n\t\t} else {\r\n\t\t\tthis.stopBootstrapThemeObserver();\r\n\t\t}\r\n\t}\r\n\r\n\tpublic getGlobalConfig(): GlobalConfigOptions {\r\n\t\treturn this.globalConfig;\r\n\t}\r\n\r\n\tpublic init(): void {\r\n\t\tif (this._isInitialized) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet parentEl: HTMLElement | null = null;\r\n\t\tif (typeof this.globalConfig.container === \"string\") {\r\n\t\t\tparentEl = document.querySelector<HTMLElement>(this.globalConfig.container);\r\n\t\t\tif (!parentEl) {\r\n\t\t\t\tthrow new WinLetError(`WinLet: The specified container \"${this.globalConfig.container}\" was not found.`);\r\n\t\t\t}\r\n\t\t} else if (this.globalConfig.container instanceof HTMLElement) {\r\n\t\t\tparentEl = this.globalConfig.container;\r\n\t\t}\r\n\r\n\t\t// 親が指定されていない場合は、デフォルトでbodyに設定\r\n\t\tif (!parentEl) {\r\n\t\t\tif (!document.body) {\r\n\t\t\t\tthrow new WinLetError(\"Cannot initialize before document.body is ready. Please call WinLet.init() after DOMContentLoaded.\");\r\n\t\t\t}\r\n\t\t\tparentEl = document.body;\r\n\t\t}\r\n\r\n\t\tif (!document.getElementById(`${LIBRARY_NAME}-styles`)) {\r\n\t\t\tconst styleTag = document.createElement(\"style\");\r\n\t\t\tstyleTag.id = `${LIBRARY_NAME}-styles`;\r\n\t\t\tstyleTag.innerHTML = this.getStyleData();\r\n\t\t\tdocument.head.appendChild(styleTag);\r\n\t\t}\r\n\t\tlet containerEl = parentEl.querySelector<HTMLElement>(`.${LIBRARY_NAME}-container`);\r\n\t\tif (!containerEl) {\r\n\t\t\tcontainerEl = document.createElement(\"div\");\r\n\t\t\tcontainerEl.className = `${LIBRARY_NAME}-container`;\r\n\t\t\tparentEl.appendChild(containerEl);\r\n\t\t}\r\n\t\tthis.container = containerEl;\r\n\r\n\t\tthis.workspaceEl = document.createElement(\"div\");\r\n\t\tthis.workspaceEl.className = `${LIBRARY_NAME}-workspace`;\r\n\t\tthis.container.appendChild(this.workspaceEl);\r\n\r\n\t\t// 初期設定を適用\r\n\t\tthis.applyGlobalConfig(this.globalConfig);\r\n\r\n\t\tif (parentEl !== document.body) {\r\n\t\t\tthis.container.classList.add(`${LIBRARY_NAME}-is-nested`);\r\n\r\n\t\t\t// 親がポジショニングコンテキストとして機能できることを確認\r\n\t\t\tconst computedStyle = window.getComputedStyle(parentEl);\r\n\t\t\tif (computedStyle.position === \"static\") {\r\n\t\t\t\tparentEl.style.position = \"relative\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.globalConfig.enableTaskbar) {\r\n\t\t\tif (!this.taskbarEl) {\r\n\t\t\t\t// タスクバーがなければ作成\r\n\t\t\t\tthis.createTaskbar();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.globalConfig.theme) {\r\n\t\t\tthis.setTheme(this.globalConfig.theme);\r\n\t\t} else {\r\n\t\t\tthis.setTheme(\"default\");\r\n\t\t}\r\n\r\n\t\t(async () => await this.updateVirtualization())();\r\n\r\n\t\twindow.addEventListener(\"blur\", () =>\r\n\t\t\t// 次のイベントサイクルでアクティブな要素を取得\r\n\t\t\trequestAnimationFrame(() => {\r\n\t\t\t\tconst activeEl = document.activeElement;\r\n\t\t\t\t// フォーカスがiframeに移った場合\r\n\t\t\t\tif (activeEl?.tagName === \"IFRAME\") {\r\n\t\t\t\t\t// そのiframeがWinLetのウィンドウ内にあるか探索\r\n\t\t\t\t\tconst winEl = (activeEl as HTMLElement).closest<HTMLElement>(`.${LIBRARY_NAME}-window`);\r\n\t\t\t\t\tif (winEl) {\r\n\t\t\t\t\t\tconst win = this.windows.get(winEl.id);\r\n\t\t\t\t\t\t// 対象のウィンドウが存在し、まだアクティブでなければフォーカスする\r\n\t\t\t\t\t\tif (win && this.activeWindow !== win) {\r\n\t\t\t\t\t\t\twin.focus();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t);\r\n\t\tdocument.addEventListener(\r\n\t\t\t\"pointerdown\",\r\n\t\t\t() =>\r\n\t\t\t\trequestAnimationFrame(() => {\r\n\t\t\t\t\tconst activeEl = document.activeElement;\r\n\t\t\t\t\tif (activeEl?.tagName === \"IFRAME\") {\r\n\t\t\t\t\t\tconst winEl = (activeEl as HTMLElement).closest<HTMLElement>(`.${LIBRARY_NAME}-window`);\r\n\t\t\t\t\t\tif (winEl) {\r\n\t\t\t\t\t\t\tconst win = this.windows.get(winEl.id);\r\n\t\t\t\t\t\t\tif (win && this.activeWindow !== win) {\r\n\t\t\t\t\t\t\t\twin.focus();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\ttrue\r\n\t\t);\r\n\r\n\t\t// ウィンドウ外クリックでblurさせる処理を追加\r\n\t\tdocument.addEventListener(\"pointerdown\", (e: PointerEvent) => {\r\n\t\t\tif (!(e.target instanceof HTMLElement)) return;\r\n\r\n\t\t\tconst clickedContextMenu = e.target.closest(`.${LIBRARY_NAME}-context-menu`);\r\n\r\n\t\t\t// コンテキストメニュー以外の場所がクリックされた場合、メニューを閉じる\r\n\t\t\tif (!clickedContextMenu) {\r\n\t\t\t\tthis.hideContextMenu();\r\n\t\t\t}\r\n\r\n\t\t\t// アクティブなウィンドウがない、またはモーダルウィンドウの場合は何もしない\r\n\t\t\tif (!this.activeWindow || this.activeWindow.options.windowOptions.modal) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// クリックされた場所がウィンドウまたはタスクバーの内側かどうかを判定\r\n\t\t\tconst clickedWindow = e.target.closest(`.${LIBRARY_NAME}-window`);\r\n\t\t\tconst clickedTaskbar = e.target.closest(`.${LIBRARY_NAME}-taskbar`);\r\n\r\n\t\t\t// ウィンドウ、コンテキストメニュー、タスクバーの外側がクリックされた場合\r\n\t\t\tif (!clickedWindow && !clickedContextMenu && !clickedTaskbar) {\r\n\t\t\t\t// アクティブなウィンドウのフォーカスを外す\r\n\t\t\t\tconst active = this.activeWindow;\r\n\t\t\t\tthis.activeWindow = null;\r\n\t\t\t\tactive.blur();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\twindow.addEventListener(\"message\", (event) => {\r\n\t\t\t// メッセージの形式を検証\r\n\t\t\tif (event.data && event.data.type === \"winlet:createWindow\" && typeof event.data.options === \"object\") {\r\n\t\t\t\t// メッセージの送信元が管理下のiframeか検証（セキュリティ対策）\r\n\t\t\t\tlet isSourceValid = false;\r\n\t\t\t\tlet sourceWindow: WinLetWindow | null = null;\r\n\t\t\t\tfor (const win of this.windows.values()) {\r\n\t\t\t\t\tconst iframe = win.el.querySelector(\"iframe\");\r\n\t\t\t\t\tif (iframe && iframe.contentWindow === event.source) {\r\n\t\t\t\t\t\tisSourceValid = true;\r\n\t\t\t\t\t\t// メッセージの送信元ウィンドウを特定\r\n\t\t\t\t\t\tsourceWindow = win;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (isSourceValid) {\r\n\t\t\t\t\t// 送信元ウィンドウ(sourceWindow)が存在すれば、それは親ウィンドウであり、\r\n\t\t\t\t\t// その中に新しいウィンドウを作成する。\r\n\t\t\t\t\tif (sourceWindow) {\r\n\t\t\t\t\t\t// iframeの親ウィンドウのcreateWindowを呼び出す\r\n\t\t\t\t\t\tsourceWindow.createWindow(event.data.options);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// 通常のトップレベルでのウィンドウ作成\r\n\t\t\t\t\t\tthis.createWindow(event.data.options);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.warn(\"WinLet: Untrusted source attempted to create a window.\", event.origin);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis._isInitialized = true;\r\n\t\tthis.setupShortcutListeners();\r\n\r\n\t\t// タブ分離機能のためのグローバルなD&Dリスナー\r\n\t\tthis.workspaceEl!.addEventListener(\"dragover\", (e) => {\r\n\t\t\tif (e.dataTransfer?.types.includes(\"application/winlet-tab\")) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.workspaceEl!.addEventListener(\"drop\", (e) => {\r\n\t\t\t// ドロップ先がウィンドウやタブバーの中なら何もしない\r\n\t\t\tconst targetEl = e.target as HTMLElement;\r\n\t\t\tif (targetEl.closest(`.${LIBRARY_NAME}-window`)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tconst tabDataJSON = e.dataTransfer?.getData(\"application/winlet-tab\");\r\n\t\t\tconst sourceWindowId = e.dataTransfer?.getData(\"application/winlet-source-window-id\");\r\n\t\t\tconst sourceTabId = e.dataTransfer?.getData(\"text/plain\");\r\n\r\n\t\t\tif (tabDataJSON && sourceWindowId && sourceTabId) {\r\n\t\t\t\tconst sourceWindow = this.windows.get(sourceWindowId);\r\n\t\t\t\tif (!sourceWindow || !sourceWindow.options.tabOptions.detachable) return;\r\n\r\n\t\t\t\tconst tabData: TabItem = JSON.parse(tabDataJSON);\r\n\t\t\t\tconst newTab: TabItem = {\r\n\t\t\t\t\ttitle: tabData.title,\r\n\t\t\t\t\tcontent: tabData.content,\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Create a clean copy of the source options, removing non-serializable parts.\r\n\t\t\t\tconst cleanSourceOptions: Partial<WindowOptions> = Utils.deepCopy(sourceWindow.options);\r\n\t\t\t\tdelete cleanSourceOptions.id; // New window should get a new ID\r\n\t\t\t\tdelete cleanSourceOptions.animationOrigin; // This is often a non-serializable DOM element or event\r\n\t\t\t\tdelete cleanSourceOptions.content; // Will be replaced by the new tab content\r\n\t\t\t\tdelete cleanSourceOptions.tabs; // Will be replaced by the new tab\r\n\t\t\t\tdelete cleanSourceOptions.splitView; // A detached tab shouldn't inherit a split view\r\n\r\n\t\t\t\tconst mergedWindowOptions = Utils.deepMerge(cleanSourceOptions, {\r\n\t\t\t\t\ttabs: [newTab],\r\n\t\t\t\t\tx: e.clientX,\r\n\t\t\t\t\ty: e.clientY,\r\n\t\t\t\t\twidth: sourceWindow.getSize().width,\r\n\t\t\t\t\theight: sourceWindow.getSize().height,\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// 新しいウィンドウを作成\r\n\t\t\t\tthis.createWindow(mergedWindowOptions);\r\n\r\n\t\t\t\t// 元のウィンドウからタブを削除\r\n\t\t\t\tsourceWindow.closeTab(parseInt(sourceTabId, 10));\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t// ショートカットキーのリスナーを統合\r\n\tprivate setupShortcutListeners() {\r\n\t\tdocument.addEventListener(\r\n\t\t\t\"keydown\",\r\n\t\t\t(e) => {\r\n\t\t\t\t// --- 1. グローバルショートカット (ウィンドウ切り替え) ---\r\n\t\t\t\tif (this.globalConfig.windowSwitchShortcut) {\r\n\t\t\t\t\tconst shortcut = this.parseShortcut(this.globalConfig.windowSwitchShortcut);\r\n\r\n\t\t\t\t\tif (e.key.toLowerCase() === shortcut.key.toLowerCase() && e.ctrlKey === shortcut.ctrl && e.altKey === shortcut.alt && e.shiftKey === shortcut.shift) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tconst windows = Array.from(this.windows.values());\r\n\r\n\t\t\t\t\t\tconst currentIndex = this.activeWindow ? windows.findIndex((w) => w === this.activeWindow) : -1;\r\n\t\t\t\t\t\tconst nextIndex = (currentIndex + 1) % windows.length;\r\n\r\n\t\t\t\t\t\tconst win = windows[nextIndex];\r\n\t\t\t\t\t\tif (win.state === \"minimized\") {\r\n\t\t\t\t\t\t\twin.restore();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\twin.focus();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// --- 2. ウィンドウ固有のショートカット ---\r\n\t\t\t\tconst targetWindow = this.activeWindow;\r\n\r\n\t\t\t\t// ターゲットウィンドウがなければ何もしない\r\n\t\t\t\tif (!targetWindow || !targetWindow.options.enableShortcuts) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// --- 3. タブ切り替えショートカット (Ctrl+Shift+[1-9]) ---\r\n\t\t\t\tif (e.ctrlKey && e.shiftKey && (targetWindow.options.tabs?.length ?? 0) > 0) {\r\n\t\t\t\t\t// Shiftキーの影響を受けない e.code で判定する\r\n\t\t\t\t\tif (e.code.startsWith(\"Digit\")) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\te.stopPropagation();\r\n\r\n\t\t\t\t\t\tconst keyNum = parseInt(e.code.replace(\"Digit\", \"\"), 10);\r\n\r\n\t\t\t\t\t\tconst tabs = targetWindow.getTabs();\r\n\t\t\t\t\t\tconst numTabs = tabs.length;\r\n\t\t\t\t\t\tlet tabIndex = -1;\r\n\r\n\t\t\t\t\t\tif (keyNum >= 1 && keyNum <= 8) {\r\n\t\t\t\t\t\t\ttabIndex = keyNum - 1;\r\n\t\t\t\t\t\t} else if (keyNum === 9) {\r\n\t\t\t\t\t\t\ttabIndex = numTabs - 1;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (tabIndex >= 0 && tabIndex < numTabs) {\r\n\t\t\t\t\t\t\ttargetWindow.activateTab(tabIndex);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn; // 他のショートカットと重複しないようにreturn\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// --- 4. ショートカットキーを検索して実行 ---\r\n\t\t\t\tconst findAndExecShortcut = (menuItems: MenuItem[]) => {\r\n\t\t\t\t\tfor (const item of menuItems) {\r\n\t\t\t\t\t\tif (item.shortcut) {\r\n\t\t\t\t\t\t\tconst shortcut = this.parseShortcut(item.shortcut);\r\n\t\t\t\t\t\t\tif (e.key.toUpperCase() === shortcut.key.toUpperCase() && e.ctrlKey === shortcut.ctrl && e.altKey === shortcut.alt && e.shiftKey === shortcut.shift) {\r\n\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\t\titem.action?.(targetWindow!);\r\n\t\t\t\t\t\t\t\treturn true; // 実行したら探索終了\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (item.items && findAndExecShortcut(item.items)) {\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t};\r\n\r\n\t\t\t\tfindAndExecShortcut(targetWindow.options.menu);\r\n\t\t\t},\r\n\t\t\t{ passive: false }\r\n\t\t);\r\n\t}\r\n\r\n\t// 未初期化の場合に自動でinitを呼び出すヘルパー\r\n\tprivate ensureInitialized(): void {\r\n\t\tif (!this._isInitialized) {\r\n\t\t\tthis.init();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * スタイルシートを取得\r\n\t */\r\n\tprivate getStyleData() {\r\n\t\treturn this.replaceStringVariable(styleData);\r\n\t}\r\n\r\n\t/**\r\n\t * 変数置換\r\n\t */\r\n\tprivate replaceStringVariable(str: string) {\r\n\t\treturn str.replace(/\\$\\[(\\w+)\\]/g, (a, p) => {\r\n\t\t\tswitch (p) {\r\n\t\t\t\tcase \"prefix\":\r\n\t\t\t\t\treturn LIBRARY_NAME;\r\n\t\t\t}\r\n\t\t\treturn p;\r\n\t\t});\r\n\t}\r\n\r\n\tpublic createWindow(options: WindowOptions): WinLetWindow {\r\n\t\tthis.ensureInitialized();\r\n\r\n\t\tconst ifExists = options.ifExists ?? \"focus\";\r\n\r\n\t\tif (options.id && ifExists !== \"create\") {\r\n\t\t\tconst existingWindow = this.getWindow(options.id);\r\n\t\t\tif (existingWindow) {\r\n\t\t\t\tif (ifExists === \"prevent\") {\r\n\t\t\t\t\treturn existingWindow; // 何もせず既存インスタンスを返す\r\n\t\t\t\t}\r\n\t\t\t\tif (ifExists === \"focus\") {\r\n\t\t\t\t\tif (existingWindow.state === \"minimized\") {\r\n\t\t\t\t\t\texistingWindow.restore();\r\n\t\t\t\t\t}\r\n\t\t\t\t\texistingWindow.focus();\r\n\t\t\t\t\treturn existingWindow; // フォーカスして既存インスタンスを返す\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst creationOptions: Required<WindowOptions> = Utils.deepMerge(Utils.deepCopy(defaultConfig), options);\r\n\t\tif (creationOptions.x === \"auto\" || creationOptions.y === \"auto\") {\r\n\t\t\tconst winWidth = creationOptions.width;\r\n\t\t\tconst winHeight = creationOptions.height;\r\n\t\t\tconst containerRect = this.workspaceEl!.getBoundingClientRect();\r\n\t\t\tconst centerPos = {\r\n\t\t\t\tx: (containerRect.width - winWidth) / 2,\r\n\t\t\t\ty: (containerRect.height - winHeight) / 2,\r\n\t\t\t};\r\n\r\n\t\t\t// カスケードを中央からリセットすべきか判断\r\n\t\t\tlet resetCascade = true;\r\n\t\t\tif (this.lastAutoPosition) {\r\n\t\t\t\tlet lastPosWindowFound = false;\r\n\t\t\t\tfor (const win of this.windows.values()) {\r\n\t\t\t\t\tif (win.state === \"normal\" && !win.options._isPopup) {\r\n\t\t\t\t\t\tconst pos = win.getPosition();\r\n\t\t\t\t\t\t// 前回のカスケード位置にウィンドウが存在するかチェック\r\n\t\t\t\t\t\tif (Math.abs(pos.x - this.lastAutoPosition.x) < 5 && Math.abs(pos.y - this.lastAutoPosition.y) < 5) {\r\n\t\t\t\t\t\t\tlastPosWindowFound = true;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (lastPosWindowFound) {\r\n\t\t\t\t\tresetCascade = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlet nextPos: { x: number; y: number };\r\n\r\n\t\t\tif (resetCascade) {\r\n\t\t\t\tnextPos = centerPos;\r\n\t\t\t} else {\r\n\t\t\t\tnextPos = {\r\n\t\t\t\t\tx: this.lastAutoPosition!.x + this.CASCADE_OFFSET,\r\n\t\t\t\t\ty: this.lastAutoPosition!.y + this.CASCADE_OFFSET,\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t// 画面外にはみ出す場合は中央に戻す\r\n\t\t\tif (nextPos.x + winWidth > containerRect.width || nextPos.y + winHeight > containerRect.height) {\r\n\t\t\t\tnextPos = centerPos;\r\n\t\t\t}\r\n\r\n\t\t\t// 計算結果をオプションに反映\r\n\t\t\tcreationOptions.x = nextPos.x;\r\n\t\t\tcreationOptions.y = nextPos.y;\r\n\r\n\t\t\t// ポップアップでない場合のみ、次回のカスケード位置を保存\r\n\t\t\tif (!creationOptions._isPopup) {\r\n\t\t\t\tthis.lastAutoPosition = { x: nextPos.x, y: nextPos.y };\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst win = new WinLetWindow(creationOptions, this);\r\n\t\tthis.windows.set(win.id, win);\r\n\t\tWindowManager.allWindows.set(win.id, win);\r\n\t\tthis.workspaceEl!.appendChild(win.el);\r\n\r\n\t\tthis.emit(\"window-created\", win);\r\n\r\n\t\tif (this.taskbarEl) {\r\n\t\t\tthis.createTaskbarItem(win);\r\n\t\t}\r\n\r\n\t\twin.setPosition(creationOptions.x, creationOptions.y);\r\n\t\tif (creationOptions.windowOptions.focus) {\r\n\t\t\tthis.focusWindow(win);\r\n\t\t\twin.focus();\r\n\t\t} else {\r\n\t\t\twin.el.style.zIndex = `${(win.options.windowOptions.alwaysOnTop ? this.zIndexCounterOnTop : this.zIndexCounter) - 1}`;\r\n\t\t\tthis.updateVirtualization();\r\n\t\t\twin.updateDebugOverlay();\r\n\t\t}\r\n\t\treturn win;\r\n\t}\r\n\r\n\tpublic popup(options: PopupOptions): WinLetWindow {\r\n\t\tthis.ensureInitialized();\r\n\t\tlet buttons: PopupButton[];\r\n\t\tconst buttonPresets: { [key in PopupButtonPreset]: PopupButton[] } = {\r\n\t\t\tOk: [{ text: \"OK\", value: 1 }],\r\n\t\t\tOkCancel: [\r\n\t\t\t\t{ text: \"OK\", value: 1 },\r\n\t\t\t\t{ text: \"Cancel\", value: 2 },\r\n\t\t\t],\r\n\t\t\tYes: [{ text: \"Yes\", value: 6 }],\r\n\t\t\tYesNo: [\r\n\t\t\t\t{ text: \"Yes\", value: 6 },\r\n\t\t\t\t{ text: \"No\", value: 7 },\r\n\t\t\t],\r\n\t\t\tYesNoCancel: [\r\n\t\t\t\t{ text: \"Yes\", value: 6 },\r\n\t\t\t\t{ text: \"No\", value: 7 },\r\n\t\t\t\t{ text: \"Cancel\", value: 2 },\r\n\t\t\t],\r\n\t\t\tRetry: [{ text: \"Retry\", value: 4 }],\r\n\t\t\tRetryCancel: [\r\n\t\t\t\t{ text: \"Retry\", value: 4 },\r\n\t\t\t\t{ text: \"Cancel\", value: 2 },\r\n\t\t\t],\r\n\t\t\tAbortRetryIgnore: [\r\n\t\t\t\t{ text: \"Abort\", value: 3 },\r\n\t\t\t\t{ text: \"Retry\", value: 4 },\r\n\t\t\t\t{ text: \"Ignore\", value: 5 },\r\n\t\t\t],\r\n\t\t};\r\n\t\tif (Array.isArray(options.buttons)) {\r\n\t\t\tbuttons = options.buttons;\r\n\t\t} else {\r\n\t\t\tbuttons = buttonPresets[options.buttons || \"Ok\"] || buttonPresets.Ok;\r\n\t\t}\r\n\r\n\t\tlet timeoutId: number | null = null;\r\n\t\tconst closeCallback = (result: PopupResult) => {\r\n\t\t\tif (timeoutId) clearTimeout(timeoutId);\r\n\t\t\ttimeoutId = null;\r\n\t\t\ttry {\r\n\t\t\t\toptions.onClose?.(result);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error(e);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tconst messageHTML = `<div class=\"${LIBRARY_NAME}-popup-message\">${Utils.sanitizeHTML(options.message)}</div>`;\r\n\t\tconst buttonsHTML = buttons.map((btn, index) => `<input class=\"${LIBRARY_NAME}-popup-button\" data-index=\"${index}\" type=\"button\" value=\"${Utils.sanitizeHTML(btn.text)}\" role=\"button\"/>`).join(\"\");\r\n\t\tconst contentHTML = `${messageHTML}<div class=\"${LIBRARY_NAME}-popup-buttons\" role=\"spinbutton\">${buttonsHTML}</div>`;\r\n\r\n\t\tconst winOptions: WindowOptions = {\r\n\t\t\tid: Utils.generateId(`${LIBRARY_NAME}-popup`),\r\n\t\t\ttitle: options.title || \"\",\r\n\t\t\ticon: options.icon,\r\n\t\t\tvirtualizable: false,\r\n\t\t\twindowOptions: {\r\n\t\t\t\tresizableX: false,\r\n\t\t\t\tresizableY: false,\r\n\t\t\t\tmovable: true,\r\n\t\t\t\tclosable: true,\r\n\t\t\t\tminimizable: false,\r\n\t\t\t\tmaximizable: false,\r\n\t\t\t\tmaximizableOnDblClick: false,\r\n\t\t\t\tmodal: options.modal ?? true,\r\n\t\t\t\talwaysOnTop: options.alwaysOnTop ?? false,\r\n\t\t\t\tfocus: options.focus ?? true,\r\n\t\t\t},\r\n\t\t\tenableShortcuts: false,\r\n\t\t\tcontent: { html: contentHTML },\r\n\t\t\t_isPopup: true,\r\n\t\t};\r\n\t\tif (options.onFocus) winOptions.onFocus = options.onFocus;\r\n\t\tif (options.onBlur) winOptions.onBlur = options.onBlur;\r\n\r\n\t\tif (options.autoWidth) {\r\n\t\t\tconst temp = document.createElement(\"span\");\r\n\t\t\ttemp.style.visibility = \"hidden\";\r\n\t\t\ttemp.style.position = \"absolute\";\r\n\t\t\ttemp.style.whiteSpace = \"pre\";\r\n\t\t\ttemp.className = `${LIBRARY_NAME}-popup-message`;\r\n\t\t\ttemp.innerHTML = Utils.sanitizeHTML(options.message);\r\n\t\t\tthis.workspaceEl?.appendChild(temp);\r\n\t\t\twinOptions.width = temp.offsetWidth + 80; // メッセージ幅 + パディング\r\n\t\t\tthis.workspaceEl?.removeChild(temp);\r\n\t\t} else {\r\n\t\t\twinOptions.width = 300;\r\n\t\t}\r\n\t\twinOptions.height = 150;\r\n\r\n\t\tconst winWidth = winOptions.width!;\r\n\t\tconst winHeight = winOptions.height!;\r\n\t\tconst containerRect = this.workspaceEl!.getBoundingClientRect();\r\n\t\tconst centerPos = {\r\n\t\t\tx: (containerRect.width - winWidth) / 2,\r\n\t\t\ty: (containerRect.height - winHeight) / 2,\r\n\t\t};\r\n\r\n\t\tlet resetCascade = true;\r\n\t\tif (this.lastPopupPosition) {\r\n\t\t\tlet lastPosWindowFound = false;\r\n\t\t\tfor (const win of this.windows.values()) {\r\n\t\t\t\tif (win.options._isPopup && win.state === \"normal\") {\r\n\t\t\t\t\tconst pos = win.getPosition();\r\n\t\t\t\t\tif (Math.abs(pos.x - this.lastPopupPosition.x) < 5 && Math.abs(pos.y - this.lastPopupPosition.y) < 5) {\r\n\t\t\t\t\t\tlastPosWindowFound = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (lastPosWindowFound) {\r\n\t\t\t\tresetCascade = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet nextPos: { x: number; y: number };\r\n\t\tif (resetCascade) {\r\n\t\t\tnextPos = centerPos;\r\n\t\t} else {\r\n\t\t\tnextPos = {\r\n\t\t\t\tx: this.lastPopupPosition!.x + this.CASCADE_OFFSET,\r\n\t\t\t\ty: this.lastPopupPosition!.y + this.CASCADE_OFFSET,\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (nextPos.x + winWidth > containerRect.width || nextPos.y + winHeight > containerRect.height) {\r\n\t\t\tnextPos = centerPos;\r\n\t\t}\r\n\r\n\t\twinOptions.x = nextPos.x;\r\n\t\twinOptions.y = nextPos.y;\r\n\r\n\t\tconst win = this.createWindow(winOptions);\r\n\t\tthis.lastPopupPosition = nextPos; // Save the position for the next popup\r\n\t\twin.popupCloseCallback = closeCallback;\r\n\r\n\t\twin.el.querySelectorAll<HTMLButtonElement>(`.${LIBRARY_NAME}-popup-button`).forEach((button) => {\r\n\t\t\tbutton.addEventListener(\"click\", () => {\r\n\t\t\t\tconst index = parseInt(button.dataset.index!, 10);\r\n\t\t\t\tconst result = buttons[index].value;\r\n\t\t\t\tcloseCallback(result);\r\n\t\t\t\twin.close();\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tif (options.timeout && options.timeout > 0) {\r\n\t\t\ttimeoutId = window.setTimeout(() => {\r\n\t\t\t\tif (this.windows.has(win.id)) {\r\n\t\t\t\t\tcloseCallback(TIMEOUT_RESULT);\r\n\t\t\t\t\twin.close();\r\n\t\t\t\t}\r\n\t\t\t}, options.timeout);\r\n\t\t}\r\n\t\treturn win;\r\n\t}\r\n\r\n\tpublic popupAsync(options: PopupOptions): Promise<PopupResult> {\r\n\t\tconst opt = Utils.deepCopy(options);\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tconst tmpOnClose = opt.onClose;\r\n\t\t\topt.onClose = (result) => {\r\n\t\t\t\ttmpOnClose?.(result);\r\n\t\t\t\tresolve(result);\r\n\t\t\t};\r\n\t\t\tthis.popup(opt);\r\n\t\t});\r\n\t}\r\n\r\n\tpublic destroyWindow(id: string): void {\r\n\t\tthis.ensureInitialized();\r\n\t\tconst win = this.windows.get(id);\r\n\t\tif (win) {\r\n\t\t\tif (win.options._taskbarItem) {\r\n\t\t\t\twin.options._taskbarItem.remove();\r\n\t\t\t}\r\n\t\t\tif (win.options.windowOptions.modal) {\r\n\t\t\t\tthis.deactivateFocusTrap();\r\n\t\t\t}\r\n\r\n\t\t\tthis.emit(\"window-destroyed\", win);\r\n\t\t\twin.el.remove();\r\n\t\t\tthis.windows.delete(id);\r\n\t\t\tWindowManager.allWindows.delete(id);\r\n\t\t\tif (this.activeWindow === win) {\r\n\t\t\t\tthis.activeWindow = null;\r\n\t\t\t\tconst nextWin = Array.from(this.windows.values()).pop();\r\n\t\t\t\tif (nextWin) this.focusWindow(nextWin);\r\n\t\t\t}\r\n\t\t\t// ウィンドウ破棄後に仮想化状態を更新\r\n\t\t\t(async () => await this.updateVirtualization())();\r\n\t\t}\r\n\t}\r\n\r\n\tpublic focusWindow(win: WinLetWindow): void {\r\n\t\tthis.ensureInitialized();\r\n\t\tif (this.activeWindow === win && !win.options.windowOptions.modal) return;\r\n\r\n\t\t// 自身が管理する他のウィンドウをぼかす\r\n\t\tthis.activeWindow?.blur();\r\n\r\n\t\t// モーダルかつフォーカストラップ有効ならトラップ開始\r\n\t\tif (win.options.windowOptions.modal && this.globalConfig.enableFocusTrapping) {\r\n\t\t\tthis.activateFocusTrap(win);\r\n\t\t} else {\r\n\t\t\t// そうでなければ既存のトラップは解除\r\n\t\t\tthis.deactivateFocusTrap();\r\n\t\t}\r\n\r\n\t\tthis.activeWindow = win;\r\n\t\twin.el.style.zIndex = `${win.options.windowOptions.alwaysOnTop ? ++this.zIndexCounterOnTop : ++this.zIndexCounter}`;\r\n\r\n\t\tthis.windows.forEach((w) => w.options._taskbarItem?.classList.remove(`${LIBRARY_NAME}-active`));\r\n\t\twin.options._taskbarItem?.classList.add(`${LIBRARY_NAME}-active`);\r\n\t\t// ウィンドウのフォーカス、移動、リサイズ時に仮想化状態を即時更新\r\n\t\t(async () => await this.updateVirtualization())();\r\n\r\n\t\t// focus()はWindowクラス側で呼ばれるので不要\r\n\t}\r\n\r\n\tpublic getWindow(id: string): WinLetWindow | undefined {\r\n\t\tthis.ensureInitialized();\r\n\t\treturn this.windows.get(id);\r\n\t}\r\n\r\n\tpublic getWindowFromElement(element: HTMLElement): WinLetWindow | undefined {\r\n\t\tthis.ensureInitialized();\r\n\t\tconst winEl = element.closest<HTMLElement>(`.${LIBRARY_NAME}-window`);\r\n\t\tif (winEl?.id) {\r\n\t\t\treturn WindowManager.allWindows.get(winEl.id);\r\n\t\t}\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tpublic getActiveWindow(): WinLetWindow | null {\r\n\t\tthis.ensureInitialized();\r\n\t\treturn this.activeWindow;\r\n\t}\r\n\r\n\tpublic onTabDragStart(sourceWindowId: string): void {\r\n\t\tthis.workspaceEl?.classList.add(`${LIBRARY_NAME}-is-tab-dragging`);\r\n\t\tthis.draggingTabInfo = { sourceWindowId };\r\n\t}\r\n\r\n\tpublic onTabDragEnd(): void {\r\n\t\tthis.workspaceEl?.classList.remove(`${LIBRARY_NAME}-is-tab-dragging`);\r\n\t\tthis.draggingTabInfo = null;\r\n\t}\r\n\r\n\tpublic showContextMenu(x: number, y: number, menuItems: ContextMenuItem[], contextWindow: IWindow): void {\r\n\t\tthis.ensureInitialized();\r\n\t\tthis.hideContextMenu();\r\n\r\n\t\tthis.contextMenuEl = document.createElement(\"ul\");\r\n\t\tthis.contextMenuEl.className = `${LIBRARY_NAME}-context-menu`;\r\n\r\n\t\tmenuItems.forEach((itemData) => {\r\n\t\t\tconst itemEl = document.createElement(\"li\");\r\n\t\t\tif (itemData.separator) {\r\n\t\t\t\titemEl.className = `${LIBRARY_NAME}-separator`;\r\n\t\t\t} else {\r\n\t\t\t\titemEl.textContent = itemData.name ?? \"\";\r\n\t\t\t\titemEl.addEventListener(\"click\", (e) => {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\titemData.action?.(contextWindow);\r\n\t\t\t\t\tthis.hideContextMenu();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tthis.contextMenuEl!.appendChild(itemEl);\r\n\t\t});\r\n\r\n\t\tthis.workspaceEl!.appendChild(this.contextMenuEl);\r\n\r\n\t\tconst { offsetWidth: menuWidth, offsetHeight: menuHeight } = this.contextMenuEl;\r\n\t\tconst { innerWidth: screenWidth, innerHeight: screenHeight } = window;\r\n\r\n\t\tthis.contextMenuEl.style.left = x + menuWidth > screenWidth ? `${screenWidth - menuWidth}px` : `${x}px`;\r\n\t\tthis.contextMenuEl.style.top = y + menuHeight > screenHeight ? `${screenHeight - menuHeight}px` : `${y}px`;\r\n\t}\r\n\r\n\tpublic hideContextMenu(): void {\r\n\t\tthis.contextMenuEl?.remove();\r\n\t\tthis.contextMenuEl = null;\r\n\t}\r\n\r\n\tpublic registerTheme(theme: Theme): void {\r\n\t\tthis.themes.set(theme.name, theme);\r\n\t}\r\n\r\n\tpublic getRegisteredThemes(): string[] {\r\n\t\treturn Array.from(this.themes.keys());\r\n\t}\r\n\r\n\tpublic setTheme(theme: string | Theme): void {\r\n\t\tconst themeObj = typeof theme === \"string\" ? this.themes.get(theme.toLowerCase()) : theme;\r\n\t\tif (!themeObj) {\r\n\t\t\tconsole.warn(`WinLet: Theme \"${theme}\" not found.`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!this.container) {\r\n\t\t\tconsole.warn(\"WinLet: Container not found.\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.activeTheme) {\r\n\t\t\tfor (const [key, value] of Object.entries(this.activeTheme.variables)) {\r\n\t\t\t\tif (!(key in themeObj.variables)) {\r\n\t\t\t\t\tthis.container.style.removeProperty(this.replaceStringVariable(key));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.activeTheme = themeObj;\r\n\t\tfor (const [key, value] of Object.entries(themeObj.variables)) {\r\n\t\t\tthis.container.style.setProperty(this.replaceStringVariable(key), this.replaceStringVariable(value));\r\n\t\t}\r\n\t}\r\n\r\n\tpublic getTheme(): Theme | null {\r\n\t\treturn this.activeTheme;\r\n\t}\r\n\r\n\tprivate createTaskbar(): void {\r\n\t\tif (!this.container) return;\r\n\t\tthis.taskbarEl = document.createElement(\"div\");\r\n\t\tthis.taskbarEl.className = `${LIBRARY_NAME}-taskbar ${LIBRARY_NAME}-us-none`;\r\n\t\tthis.updateTaskbarLayout();\r\n\t\tthis.container.appendChild(this.taskbarEl);\r\n\t}\r\n\r\n\tprivate updateTaskbarLayout(): void {\r\n\t\tif (!this.taskbarEl || !this.container) return;\r\n\r\n\t\tconst taskbarOpts = this.globalConfig.taskbar || {};\r\n\t\tconst position = taskbarOpts.position || \"bottom\";\r\n\r\n\t\tswitch (position) {\r\n\t\t\tcase \"top\":\r\n\t\t\tcase \"bottom\":\r\n\t\t\tcase \"left\":\r\n\t\t\tcase \"right\":\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new WinLetError(`Invalid taskbar position: ${position}`);\r\n\t\t}\r\n\r\n\t\t// クラスを一度リセット\r\n\t\tthis.taskbarEl.className = `${LIBRARY_NAME}-taskbar ${LIBRARY_NAME}-us-none`;\r\n\r\n\t\t// 位置クラスを追加\r\n\t\tthis.taskbarEl.classList.add(`${LIBRARY_NAME}-taskbar-${position}`);\r\n\r\n\t\tif (!this.taskbarEl.isConnected) {\r\n\t\t\tthis.container.appendChild(this.taskbarEl);\r\n\t\t}\r\n\r\n\t\tthis.container.style.flexDirection = \"\";\r\n\t\tthis.taskbarEl.style.order = \"\";\r\n\t\tif (this.workspaceEl) {\r\n\t\t\tthis.workspaceEl.style.order = \"\";\r\n\t\t}\r\n\r\n\t\tthis.container.style.paddingTop = \"0\";\r\n\t\tthis.container.style.paddingBottom = \"0\";\r\n\t\tthis.container.style.paddingLeft = \"0\";\r\n\t\tthis.container.style.paddingRight = \"0\";\r\n\r\n\t\t// getComputedStyleで実際のタスクバーサイズを取得\r\n\t\tconst computedStyle = window.getComputedStyle(this.taskbarEl);\r\n\t\tconst taskbarHeight = computedStyle.height;\r\n\t\tconst taskbarWidth = computedStyle.width;\r\n\r\n\t\tswitch (position) {\r\n\t\t\tcase \"top\":\r\n\t\t\t\tthis.container.style.paddingTop = taskbarHeight;\r\n\t\t\t\tthis.container.style.flexDirection = \"column-reverse\";\r\n\t\t\t\tthis.taskbarEl.style.order = \"1\";\r\n\t\t\t\tif (this.workspaceEl) this.workspaceEl.style.order = \"2\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"bottom\":\r\n\t\t\t\tthis.container.style.paddingBottom = taskbarHeight;\r\n\t\t\t\tthis.container.style.flexDirection = \"column\";\r\n\t\t\t\tthis.taskbarEl.style.order = \"2\";\r\n\t\t\t\tif (this.workspaceEl) this.workspaceEl.style.order = \"1\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"left\":\r\n\t\t\t\tthis.container.style.paddingLeft = taskbarWidth;\r\n\t\t\t\tthis.container.style.flexDirection = \"row-reverse\";\r\n\t\t\t\tthis.taskbarEl.style.order = \"1\";\r\n\t\t\t\tif (this.workspaceEl) this.workspaceEl.style.order = \"2\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"right\":\r\n\t\t\t\tthis.container.style.paddingRight = taskbarWidth;\r\n\t\t\t\tthis.container.style.flexDirection = \"row\";\r\n\t\t\t\tthis.taskbarEl.style.order = \"2\";\r\n\t\t\t\tif (this.workspaceEl) this.workspaceEl.style.order = \"1\";\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate createTaskbarItem(win: WinLetWindow): void {\r\n\t\tif (!this.taskbarEl) return;\r\n\t\tconst item = document.createElement(\"div\");\r\n\t\titem.className = `${LIBRARY_NAME}-taskbar-item`;\r\n\t\titem.textContent = win.getTitle();\r\n\t\titem.title = win.getTitle();\r\n\t\titem.dataset.windowId = win.id;\r\n\r\n\t\tthis.updateTaskbarItemContent(item, win);\r\n\r\n\t\titem.addEventListener(\"click\", () => {\r\n\t\t\tif (win.state === \"minimized\") {\r\n\t\t\t\twin.restore({ origin: item });\r\n\t\t\t} else {\r\n\t\t\t\tif (this.activeWindow === win) {\r\n\t\t\t\t\twin.minimize({ origin: item });\r\n\t\t\t\t} else {\r\n\t\t\t\t\twin.focus();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\twin.options._taskbarItem = item;\r\n\t\tthis.taskbarEl.appendChild(item);\r\n\t}\r\n\r\n\tprivate updateTaskbarItemContent(item: HTMLElement, win: WinLetWindow) {\r\n\t\tconst { icon, taskbarOptions } = win.options;\r\n\t\titem.innerHTML = \"\"; // Clear existing content\r\n\t\titem.title = win.getTitle(); // Always set tooltip\r\n\r\n\t\tconst showIconOnly = taskbarOptions?.showIconOnly && icon;\r\n\r\n\t\titem.classList.toggle(`${LIBRARY_NAME}-icon-only`, !!showIconOnly);\r\n\r\n\t\tif (showIconOnly) {\r\n\t\t\tconst iconEl = document.createElement(\"div\");\r\n\t\t\ticonEl.className = `${LIBRARY_NAME}-taskbar-item-icon`;\r\n\t\t\tif (win.isFontAwesome(icon)) {\r\n\t\t\t\tconst i = document.createElement(\"i\");\r\n\t\t\t\ti.className = icon;\r\n\t\t\t\ticonEl.appendChild(i);\r\n\t\t\t} else {\r\n\t\t\t\tconst img = document.createElement(\"img\");\r\n\t\t\t\timg.src = icon;\r\n\t\t\t\timg.alt = win.getTitle();\r\n\t\t\t\ticonEl.appendChild(img);\r\n\t\t\t}\r\n\t\t\titem.appendChild(iconEl);\r\n\t\t} else {\r\n\t\t\titem.textContent = win.getTitle();\r\n\t\t}\r\n\t}\r\n\r\n\tpublic updateTaskbarItem(win: WinLetWindow, state: \"minimized\" | \"restored\" | \"titleChanged\" | \"iconChanged\" | \"virtualized\" | \"unvirtualized\"): void {\r\n\t\tconst item = win.options._taskbarItem;\r\n\t\tif (!item) return;\r\n\r\n\t\tswitch (state) {\r\n\t\t\tcase \"minimized\":\r\n\t\t\t\titem.classList.add(`${LIBRARY_NAME}-minimized`);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"restored\":\r\n\t\t\t\titem.classList.remove(`${LIBRARY_NAME}-minimized`);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"titleChanged\":\r\n\t\t\tcase \"iconChanged\":\r\n\t\t\t\tthis.updateTaskbarItemContent(item, win);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"virtualized\":\r\n\t\t\t\tif (this.globalConfig.indicateVirtualizationInTaskbar) {\r\n\t\t\t\t\titem.classList.add(`${LIBRARY_NAME}-virtualized`);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"unvirtualized\":\r\n\t\t\t\titem.classList.remove(`${LIBRARY_NAME}-virtualized`);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate activateFocusTrap(win: WinLetWindow): void {\r\n\t\tthis.deactivateFocusTrap(); // 念のため既存のリスナーを解除\r\n\r\n\t\tthis.boundTabPressHandler = (e: KeyboardEvent) => {\r\n\t\t\tif (e.key === \"Tab\") {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tconst focusableElements = Array.from(win.el.querySelectorAll<HTMLElement>('a[href], button, input, textarea, select, details, [tabindex]:not([tabindex=\"-1\"])')).filter((el) => !el.hasAttribute(\"disabled\") && !el.closest(\".minimized\"));\r\n\r\n\t\t\t\tif (focusableElements.length === 0) return;\r\n\r\n\t\t\t\tconst currentIndex = focusableElements.indexOf(document.activeElement as HTMLElement);\r\n\t\t\t\tlet nextIndex = e.shiftKey ? currentIndex - 1 : currentIndex + 1;\r\n\r\n\t\t\t\tif (nextIndex >= focusableElements.length) {\r\n\t\t\t\t\tnextIndex = 0;\r\n\t\t\t\t}\r\n\t\t\t\tif (nextIndex < 0) {\r\n\t\t\t\t\tnextIndex = focusableElements.length - 1;\r\n\t\t\t\t}\r\n\t\t\t\tfocusableElements[nextIndex].focus();\r\n\t\t\t}\r\n\t\t};\r\n\t\tdocument.addEventListener(\"keydown\", this.boundTabPressHandler);\r\n\t}\r\n\r\n\tprivate deactivateFocusTrap(): void {\r\n\t\tif (this.boundTabPressHandler) {\r\n\t\t\tdocument.removeEventListener(\"keydown\", this.boundTabPressHandler);\r\n\t\t\tthis.boundTabPressHandler = null;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * ショートカット文字列を解析し、修飾キーと主キーのオブジェクトを返す\r\n\t * @param shortcut - \"Ctrl+Shift+K\"のような文字列\r\n\t */\r\n\tprivate parseShortcut(shortcut: string): { ctrl: boolean; alt: boolean; shift: boolean; key: string } {\r\n\t\tconst keys = shortcut.split(\"+\");\r\n\t\tconst key = keys.pop() || \"\"; // 主キーを配列から取り出す\r\n\t\tconst ctrl = keys.includes(\"Ctrl\");\r\n\t\tconst alt = keys.includes(\"Alt\");\r\n\t\tconst shift = keys.includes(\"Shift\");\r\n\t\treturn { ctrl, alt, shift, key };\r\n\t}\r\n\r\n\t/**\r\n\t * 全てのウィンドウの可視性をチェックし、必要に応じて仮想化/復元を行う\r\n\t */\r\n\tpublic async updateVirtualization(): Promise<void> {\r\n\t\tif (!this.globalConfig.enableVirtualization || !this.workspaceEl) return;\r\n\r\n\t\tconst threshold = this.globalConfig.virtualizationThreshold ?? 5;\r\n\t\tif (this.windows.size <= threshold) {\r\n\t\t\t// しきい値以下の場合は、すべてのウィンドウが仮想化されていないことを確認\r\n\t\t\tfor (const win of this.windows.values()) {\r\n\t\t\t\tif (win.virtualizationLevel !== \"none\" && win.state !== \"minimized\") {\r\n\t\t\t\t\twin.unvirtualize();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn; // さらに処理を停止\r\n\t\t}\r\n\r\n\t\t// z-indexでソートし、奥のウィンドウから手前のウィンドウの順で並べる\r\n\t\tconst windows = Array.from(this.windows.values()).sort((a, b) => parseInt(a.el.style.zIndex || \"0\", 10) - parseInt(b.el.style.zIndex || \"0\", 10));\r\n\r\n\t\tconst viewportRect = this.workspaceEl.getBoundingClientRect();\r\n\r\n\t\tfor (let i = 0; i < windows.length; i++) {\r\n\t\t\tconst targetWin = windows[i];\r\n\r\n\t\t\t// 1. 仮想化対象外のウィンドウ、またはアクティブなウィンドウは常に非仮想化\r\n\t\t\tif (!targetWin.options.virtualizable || (targetWin.state !== \"normal\" && targetWin.state !== \"minimized\") || targetWin === this.activeWindow) {\r\n\t\t\t\ttargetWin.unvirtualize();\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tconst targetRect = targetWin.el.getBoundingClientRect();\r\n\t\t\t// 面積が非常に小さいウィンドウは非表示として扱う\r\n\t\t\tif (targetRect.width <= 1 || targetRect.height <= 1) {\r\n\t\t\t\ttargetWin.virtualize(\"auto\");\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\t// 2. 5つのサンプルポイント（四隅と中央）を定義\r\n\t\t\tconst samplePoints = [\r\n\t\t\t\t{ x: targetRect.left + 1, y: targetRect.top + 1 }, // Top-left\r\n\t\t\t\t{ x: targetRect.right - 1, y: targetRect.top + 1 }, // Top-right\r\n\t\t\t\t{ x: targetRect.right - 1, y: targetRect.bottom - 1 }, // Bottom-right\r\n\t\t\t\t{ x: targetRect.left + 1, y: targetRect.bottom - 1 }, // Bottom-left\r\n\t\t\t\t{ x: targetRect.left + targetRect.width * 0.5, y: targetRect.top + targetRect.height * 0.5 }, // Center\r\n\t\t\t];\r\n\r\n\t\t\tlet isVisible = false;\r\n\t\t\tfor (const point of samplePoints) {\r\n\t\t\t\t// ポイントがビューポート（ワークスペース）の外側なら、このポイントは不可視\r\n\t\t\t\tconst inViewport = point.x >= viewportRect.left && point.x < viewportRect.right && point.y >= viewportRect.top && point.y < viewportRect.bottom;\r\n\t\t\t\tif (!inViewport) {\r\n\t\t\t\t\tcontinue; // 次のサンプルポイントをチェック\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// ポイントが他のウィンドウに隠されているかチェック\r\n\t\t\t\tlet pointIsOccluded = false;\r\n\t\t\t\t// targetWinより手前にあるウィンドウ(occluderWin)をすべてチェック\r\n\t\t\t\tfor (let j = i + 1; j < windows.length; j++) {\r\n\t\t\t\t\tconst occluderWin = windows[j];\r\n\t\t\t\t\t// 隠す能力のないウィンドウ（最小化、透明など）はスキップ\r\n\t\t\t\t\tif (occluderWin.state !== \"normal\" || (occluderWin.getOpacity() ?? 1) < 0.9) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst occluderRect = occluderWin.el.getBoundingClientRect();\r\n\t\t\t\t\t// ポイントがoccluderWinの矩形内にあるかチェック\r\n\t\t\t\t\tif (point.x >= occluderRect.left && point.x < occluderRect.right && point.y >= occluderRect.top && point.y < occluderRect.bottom) {\r\n\t\t\t\t\t\tpointIsOccluded = true;\r\n\t\t\t\t\t\tbreak; // １つのウィンドウでも隠していれば、このポイントのチェックは終了\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// このポイントがビューポート内にあり、かつどのウィンドウにも隠されていなければ、可視と判断\r\n\t\t\t\tif (!pointIsOccluded) {\r\n\t\t\t\t\tisVisible = true;\r\n\t\t\t\t\tbreak; // １つでも可視ポイントがあれば、ウィンドウ全体のチェックは終了\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// 3. 最終的な可視性に基づいて仮想化状態を更新\r\n\t\t\tif (isVisible) {\r\n\t\t\t\tconst restoreMode = targetWin.options.virtualizationRestoreMode || this.globalConfig.virtualizationRestoreMode || \"auto\";\r\n\t\t\t\tif (restoreMode === \"auto\") {\r\n\t\t\t\t\ttargetWin.unvirtualize();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tawait targetWin.virtualize(\"auto\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Bootstrapのテーマ属性の変更を監視するMutationObserverを開始します。\r\n\t */\r\n\tprivate startBootstrapThemeObserver(): void {\r\n\t\tif (this.bootstrapThemeObserver || !this.container) return;\r\n\r\n\t\t// --- ハイコントラストのリスナー設定 ---\r\n\t\tthis.highContrastMatcher = window.matchMedia(\"(prefers-contrast: more)\");\r\n\t\tthis.highContrastListener = (e: MediaQueryListEvent) => {\r\n\t\t\t// ハイコントラストがONになったら、high-contrastテーマを強制適用\r\n\t\t\tif (e.matches) {\r\n\t\t\t\tthis.stopAutoThemeListener();\r\n\t\t\t\tthis.setTheme(\"high-contrast\");\r\n\t\t\t} else {\r\n\t\t\t\t// OFFになったら、Bootstrapのテーマ設定を再評価\r\n\t\t\t\tthis.applyBootstrapTheme(document.documentElement.getAttribute(\"data-bs-theme\"));\r\n\t\t\t}\r\n\t\t};\r\n\t\tthis.highContrastMatcher.addEventListener(\"change\", this.highContrastListener);\r\n\r\n\t\t// --- Bootstrapテーマのリスナー設定 ---\r\n\t\tconst targetNode = document.documentElement;\r\n\t\tconst config = { attributes: true, attributeFilter: [\"data-bs-theme\"] };\r\n\t\tconst callback = (mutationsList: MutationRecord[]) => {\r\n\t\t\t// ハイコントラストが有効でなければ、テーマ変更を処理\r\n\t\t\tif (!this.highContrastMatcher?.matches) {\r\n\t\t\t\tfor (const mutation of mutationsList) {\r\n\t\t\t\t\tif (mutation.type === \"attributes\" && mutation.attributeName === \"data-bs-theme\") {\r\n\t\t\t\t\t\tconst themeValue = (mutation.target as HTMLElement).getAttribute(\"data-bs-theme\");\r\n\t\t\t\t\t\tthis.applyBootstrapTheme(themeValue);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\tthis.bootstrapThemeObserver = new MutationObserver(callback);\r\n\t\tthis.bootstrapThemeObserver.observe(targetNode, config);\r\n\r\n\t\t// --- 初期チェック ---\r\n\t\t// 優先度1: ハイコントラストモード\r\n\t\tif (this.highContrastMatcher.matches) {\r\n\t\t\tthis.setTheme(\"high-contrast\");\r\n\t\t} else {\r\n\t\t\t// 優先度2: Bootstrapテーマ\r\n\t\t\tthis.applyBootstrapTheme(targetNode.getAttribute(\"data-bs-theme\"));\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Bootstrapのテーマ属性の監視を停止します。\r\n\t */\r\n\tprivate stopBootstrapThemeObserver(): void {\r\n\t\tif (this.bootstrapThemeObserver) {\r\n\t\t\tthis.bootstrapThemeObserver.disconnect();\r\n\t\t\tthis.bootstrapThemeObserver = null;\r\n\t\t}\r\n\t\tif (this.highContrastMatcher && this.highContrastListener) {\r\n\t\t\tthis.highContrastMatcher.removeEventListener(\"change\", this.highContrastListener);\r\n\t\t}\r\n\t\tthis.stopAutoThemeListener(); // OSのリスナーも停止\r\n\t}\r\n\r\n\t/**\r\n\t * 適用されたBootstrapのテーマに応じてWinLetのテーマを設定します。\r\n\t * @param themeValue - data-bs-theme属性の値 ('dark', 'light', 'auto', or null)\r\n\t */\r\n\tprivate applyBootstrapTheme(themeValue: string | null): void {\r\n\t\tthis.stopAutoThemeListener(); // 競合を避けるため、まずOSのリスナーを停止\r\n\r\n\t\tif (themeValue === \"dark\") {\r\n\t\t\tthis.setTheme(\"dark\");\r\n\t\t} else if (themeValue === \"auto\") {\r\n\t\t\tthis.startAutoThemeListener();\r\n\t\t} else {\r\n\t\t\t// 'light' または属性が存在しない場合\r\n\t\t\tthis.setTheme(\"default\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * OSのカラースキーム変更の監視を開始します。\r\n\t */\r\n\tprivate startAutoThemeListener(): void {\r\n\t\tif (this.prefersColorSchemeListener || !window.matchMedia) return;\r\n\r\n\t\tthis.prefersDarkMatcher = window.matchMedia(\"(prefers-color-scheme: dark)\");\r\n\r\n\t\tthis.prefersColorSchemeListener = (e: MediaQueryListEvent) => {\r\n\t\t\tthis.setTheme(e.matches ? \"dark\" : \"default\");\r\n\t\t};\r\n\r\n\t\tthis.prefersDarkMatcher.addEventListener(\"change\", this.prefersColorSchemeListener);\r\n\r\n\t\t// 現在のOS設定に基づいて初期テーマを適用\r\n\t\tthis.setTheme(this.prefersDarkMatcher.matches ? \"dark\" : \"default\");\r\n\t}\r\n\r\n\t/**\r\n\t * OSのカラースキーム変更の監視を停止します。\r\n\t */\r\n\tprivate stopAutoThemeListener(): void {\r\n\t\tif (this.prefersDarkMatcher && this.prefersColorSchemeListener) {\r\n\t\t\tthis.prefersDarkMatcher.removeEventListener(\"change\", this.prefersColorSchemeListener);\r\n\t\t}\r\n\t\tthis.prefersDarkMatcher = null;\r\n\t\tthis.prefersColorSchemeListener = null;\r\n\t}\r\n}\r\n","// src/index.ts\r\n\r\nimport { defaultConfig } from \"./const/config\";\r\nimport { CLOSE_BUTTON_RESULT, GlobalConfigOptions, GlobalEventMap, IWindow, ListenerOptions, PopupOptions, PopupResult, Theme, TIMEOUT_RESULT, WindowOptions, WinLetApi } from \"./const/types\";\r\nimport WinLetWindow from \"./function/window\";\r\nimport WindowManager from \"./function/window_manager\";\r\nimport Utils from \"./libs/utils\";\r\nimport { LIB_VERSION } from \"./version\";\r\n\r\nconst selfUrl = (document?.currentScript as HTMLScriptElement)?.src || \"\";\r\n\r\nconst globalConfig: GlobalConfigOptions = {\r\n\twindowSwitchShortcut: \"Ctrl+`\", // デフォルトショートカット（バッククォート）\r\n\tlibraryPath: selfUrl,\r\n\tenableAnimations: true,\r\n\tanimateFromTaskbar: true,\r\n\tenableFocusTrapping: true,\r\n\tenableVirtualization: true,\r\n\tindicateVirtualizationInTaskbar: true,\r\n\tvirtualizationThreshold: 5,\r\n\tvirtualizationDelay: 1000 * 10,\r\n\ttaskbar: {\r\n\t\tposition: \"bottom\",\r\n\t},\r\n\tautoDetectBootstrapTheme: true,\r\n\tenableDebugMode: false,\r\n};\r\n\r\n// シングルトンインスタンス\r\nconst manager = new WindowManager(globalConfig);\r\n\r\n// 公開するAPI\r\nconst api: WinLetApi = {\r\n\t/**\r\n\t * ライブラリを初期化します。DOMの準備ができた後に呼び出してください。\r\n\t * (例: document.addEventListener('DOMContentLoaded', WinLet.init);)\r\n\t *\r\n\t * @param options - グローバル設定。コンテナ要素などを指定できます。\r\n\t */\r\n\tinit: (options: GlobalConfigOptions = {}): void => {\r\n\t\tapi.setGlobalConfig(options);\r\n\t\tmanager.init();\r\n\t},\r\n\r\n\t/**\r\n\t * 新しいウィンドウを作成\r\n\t */\r\n\tcreateWindow: (options: WindowOptions = {}): IWindow => {\r\n\t\treturn manager.createWindow(options);\r\n\t},\r\n\r\n\ton<K extends keyof GlobalEventMap>(eventName: K, listener: GlobalEventMap[K], options?: ListenerOptions): void {\r\n\t\tmanager.on(eventName, listener, options);\r\n\t},\r\n\r\n\toff<K extends keyof GlobalEventMap>(eventName: K, listener: GlobalEventMap[K]): void {\r\n\t\tmanager.off(eventName, listener);\r\n\t},\r\n\r\n\temit<K extends keyof GlobalEventMap>(eventName: K, ...args: Parameters<GlobalEventMap[K]>): ReturnType<GlobalEventMap[K]>[] | undefined {\r\n\t\treturn manager.emit(eventName, ...args);\r\n\t},\r\n\r\n\t/**\r\n\t * 新しいポップアップウィンドウを作成\r\n\t */\r\n\tcreatePopup: (options: PopupOptions): IWindow => {\r\n\t\treturn manager.popup(options);\r\n\t},\r\n\r\n\t/**\r\n\t * 新しいポップアップウィンドウを作成\r\n\t */\r\n\tcreateAsyncPopup: (options: PopupOptions): Promise<PopupResult> => {\r\n\t\treturn manager.popupAsync(options);\r\n\t},\r\n\r\n\t/**\r\n\t * ウィンドウを取得\r\n\t */\r\n\tgetWindow: (id: string): IWindow | undefined => {\r\n\t\treturn manager.getWindow(id);\r\n\t},\r\n\r\n\t/**\r\n\t * 指定されたDOM要素を内包するウィンドウインスタンスを取得します。\r\n\t */\r\n\tgetWindowFromElement: (element: HTMLElement): IWindow | undefined => {\r\n\t\treturn manager.getWindowFromElement(element);\r\n\t},\r\n\r\n\t/**\r\n\t * アクティブなウィンドウを取得\r\n\t */\r\n\tgetActiveWindow: (): IWindow | null => {\r\n\t\treturn manager.getActiveWindow();\r\n\t},\r\n\r\n\t/**\r\n\t * タスクバーのアイテムを更新\r\n\t */\r\n\tupdateTaskbarItem(win: IWindow, state: \"minimized\" | \"restored\" | \"titleChanged\" | \"iconChanged\" | \"virtualized\" | \"unvirtualized\"): void {\r\n\t\tmanager.updateTaskbarItem(win as WinLetWindow, state);\r\n\t},\r\n\r\n\t/**\r\n\t * デフォルトのウィンドウ設定を変更\r\n\t */\r\n\tsetDefaultConfig: (options: WindowOptions): void => {\r\n\t\tUtils.deepMerge(defaultConfig, options);\r\n\t},\r\n\r\n\t/**\r\n\t * グローバル設定を変更\r\n\t */\r\n\tsetGlobalConfig: (options: GlobalConfigOptions): void => {\r\n\t\t// 初期化後にコンテナを変更しようとした場合は警告を出す\r\n\t\tif (manager.isInitialized && options.container) {\r\n\t\t\tconsole.warn(\"WinLet: The container cannot be changed after initialization.\");\r\n\t\t\tdelete options.container;\r\n\t\t}\r\n\t\tObject.assign(globalConfig, options);\r\n\t\tmanager.applyGlobalConfig(globalConfig);\r\n\t},\r\n\r\n\t/**\r\n\t * 表示テーマを登録します。\r\n\t */\r\n\tregisterTheme: (theme: Theme): void => {\r\n\t\tmanager.registerTheme(theme);\r\n\t},\r\n\r\n\t/**\r\n\t * 登録済みのテーマ名の配列を取得します。\r\n\t */\r\n\tgetRegisteredThemes: () => {\r\n\t\treturn manager.getRegisteredThemes();\r\n\t},\r\n\r\n\t/**\r\n\t * 表示テーマを変更します。\r\n\t */\r\n\tsetTheme: (theme: string | Theme): void => {\r\n\t\tmanager.setTheme(theme);\r\n\t},\r\n\r\n\t/**\r\n\t * 現在の表示テーマを取得します。\r\n\t */\r\n\tgetTheme: (): Theme | null => {\r\n\t\treturn manager.getTheme();\r\n\t},\r\n\r\n\t/**\r\n\t * ライブラリのバージョンを取得\r\n\t */\r\n\tget version() {\r\n\t\treturn LIB_VERSION;\r\n\t},\r\n\r\n\t/**\r\n\t * ポップアップウィンドウのタイムアウト結果\r\n\t */\r\n\tPOPUP_TIMEOUT_RESULT: TIMEOUT_RESULT,\r\n\t/**\r\n\t * ポップアップウィンドウの閉じるボタンの結果\r\n\t */\r\n\tPOPUP_CLOSE_BUTTON_RESULT: CLOSE_BUTTON_RESULT,\r\n};\r\n\r\n// グローバルスコープにAPIをアタッチ\r\nif (typeof window !== \"undefined\") {\r\n\twindow.WinLet = api;\r\n}\r\n\r\n// モジュールとしてエクスポートも可能\r\nexport default api;\r\n","import { ListenerOptions } from \"../const/types\";\r\n\r\ntype EventHandler<T extends (...args: any[]) => any> = T;\r\ninterface EventHandlerObject<T extends (...args: any[]) => any> {\r\n\thandler: EventHandler<T>;\r\n\toriginal: T;\r\n}\r\n\r\nexport default class WinLetBaseClass<EventMap extends Record<string, (...args: any[]) => any>> {\r\n\tprivate events: Map<keyof EventMap, EventHandlerObject<EventMap[keyof EventMap]>[]>;\r\n\r\n\tconstructor() {\r\n\t\tthis.events = new Map();\r\n\t}\r\n\r\n\tpublic on<K extends keyof EventMap>(eventName: K, listener: EventMap[K], options?: ListenerOptions): void {\r\n\t\tif (!this.events.has(eventName)) {\r\n\t\t\tthis.events.set(eventName, []);\r\n\t\t}\r\n\r\n\t\tlet handler: EventHandler<EventMap[K]> = listener;\r\n\t\tif (options?.once) {\r\n\t\t\thandler = ((...args: Parameters<EventMap[K]>) => {\r\n\t\t\t\tthis.off(eventName, listener);\r\n\t\t\t\tlistener(...args);\r\n\t\t\t}) as EventMap[K];\r\n\t\t}\r\n\r\n\t\tthis.events.get(eventName)!.push({\r\n\t\t\thandler: handler,\r\n\t\t\toriginal: listener,\r\n\t\t});\r\n\t}\r\n\r\n\tpublic off<K extends keyof EventMap>(eventName: K, listener: EventMap[K]): void {\r\n\t\tconst handlers = this.events.get(eventName);\r\n\t\tif (handlers) {\r\n\t\t\tconst index = handlers.findIndex((h) => h.original === listener);\r\n\t\t\tif (index > -1) {\r\n\t\t\t\thandlers.splice(index, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpublic emit<K extends keyof EventMap>(eventName: K, ...args: Parameters<EventMap[K]>): ReturnType<EventMap[K]>[] | undefined {\r\n\t\tconst handlers = this.events.get(eventName);\r\n\t\tif (handlers) {\r\n\t\t\tconst results: ReturnType<EventMap[K]>[] = [];\r\n\t\t\t[...handlers].forEach((handlerObj) => {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tresults.push(handlerObj.handler(...args));\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.error(`Error in event handler for \"${String(eventName)}\":`, e);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn results;\r\n\t\t}\r\n\t}\r\n}\r\n","export default class Utils {\r\n\t/**\r\n\t * ユニークなIDを生成します。\r\n\t * @param prefix - IDのプレフィックス\r\n\t * @returns 生成されたID\r\n\t */\r\n\tpublic static generateId(prefix: string = \"win\"): string {\r\n\t\treturn `${prefix}-${Math.random().toString(36).substring(2, 9)}`;\r\n\t}\r\n\r\n\tpublic static deepCopy<T>(value: T, seen: WeakMap<object, any> = new WeakMap()): T {\r\n\t\tif (value === null || typeof value !== \"object\") return value;\r\n\r\n\t\tif (value instanceof Date) return new Date(value.getTime()) as T;\r\n\r\n\t\tif (value instanceof Map) {\r\n\t\t\tconst copiedMap = new Map();\r\n\t\t\tvalue.forEach((v, k) => {\r\n\t\t\t\tcopiedMap.set(this.deepCopy(k, seen), this.deepCopy(v, seen));\r\n\t\t\t});\r\n\t\t\treturn copiedMap as T;\r\n\t\t}\r\n\r\n\t\tif (value instanceof Set) {\r\n\t\t\tconst copiedSet = new Set();\r\n\t\t\tvalue.forEach((v) => {\r\n\t\t\t\tcopiedSet.add(this.deepCopy(v, seen));\r\n\t\t\t});\r\n\t\t\treturn copiedSet as T;\r\n\t\t}\r\n\r\n\t\tif (Array.isArray(value)) {\r\n\t\t\tif (seen.has(value)) return seen.get(value);\r\n\t\t\tconst arrCopy: any[] = [];\r\n\t\t\tseen.set(value, arrCopy);\r\n\t\t\tfor (const item of value) {\r\n\t\t\t\tarrCopy.push(this.deepCopy(item, seen));\r\n\t\t\t}\r\n\t\t\treturn arrCopy as T;\r\n\t\t}\r\n\r\n\t\tif (seen.has(value)) return seen.get(value);\r\n\t\tconst copiedObj: { [key: string]: any } = {};\r\n\t\tseen.set(value, copiedObj);\r\n\t\tfor (const key in value) {\r\n\t\t\tif (Object.prototype.hasOwnProperty.call(value, key)) {\r\n\t\t\t\tcopiedObj[key] = this.deepCopy((value as any)[key], seen);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn copiedObj as T;\r\n\t}\r\n\r\n\t/**\r\n\t * オブジェクトをディープマージします。\r\n\t */\r\n\tpublic static deepMerge<T extends object, U extends object>(target: T, source: U): T & U {\r\n\t\tconst output = { ...target } as T & U;\r\n\r\n\t\tfor (const key in source) {\r\n\t\t\tif (Object.prototype.hasOwnProperty.call(source, key)) {\r\n\t\t\t\tconst sourceValue = source[key];\r\n\t\t\t\tconst targetValue = (target as any)[key];\r\n\r\n\t\t\t\tif (Array.isArray(sourceValue)) {\r\n\t\t\t\t\t// ソースの値が配列の場合は、そのまま上書きする\r\n\t\t\t\t\t(output as any)[key] = sourceValue;\r\n\t\t\t\t} else if (sourceValue instanceof Object && typeof sourceValue !== \"function\" && targetValue instanceof Object) {\r\n\t\t\t\t\t(output as any)[key] = this.deepMerge(targetValue, sourceValue);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t(output as any)[key] = sourceValue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn output;\r\n\t}\r\n\r\n\t/**\r\n\t * オブジェクトが空でないかとどうかを判定します。\r\n\t * @param obj - 判定するオブジェクト\r\n\t * @returns オブジェクトが空である場合はfalse、そうでない場合はtrue\r\n\t */\r\n\tpublic static isNonEmptyObject<T extends object>(obj: T | undefined): obj is T & Record<string | symbol, unknown> {\r\n\t\tif (!obj) return false;\r\n\t\tfor (const _ in obj) return true;\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * HTML文字列をサニタイズします。\r\n\t * @param str - サニタイズする文字列\r\n\t * @returns サニタイズされたHTML文字列\r\n\t */\r\n\tpublic static sanitizeHTML(str: string): string {\r\n\t\tconst temp = document.createElement(\"div\");\r\n\t\ttemp.textContent = str;\r\n\t\treturn temp.innerHTML;\r\n\t}\r\n\r\n\t/**\r\n\t * 正規表現をエスケープします。\r\n\t * @param string - エスケープする文字列\r\n\t */\r\n\tpublic static escapeRegex(string: string): string {\r\n\t\treturn string.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, \"\\\\$&\");\r\n\t}\r\n\r\n\t/**\r\n\t * 関数をスロットリングします。指定された時間内に複数回呼び出されても、最後の呼び出しから一定時間後に一度だけ実行します。\r\n\t * @param func - スロットリングする関数\r\n\t * @param delay - 遅延時間 (ミリ秒)\r\n\t * @returns スロットリングされた関数\r\n\t */\r\n\tpublic static throttle(func: (...args: any[]) => void, delay: number): (...args: any[]) => void {\r\n\t\tlet timeoutId: number | null = null;\r\n\t\tlet lastArgs: any[] | null = null;\r\n\r\n\t\treturn function (...args: any[]) {\r\n\t\t\tlastArgs = args;\r\n\t\t\tif (timeoutId === null) {\r\n\t\t\t\ttimeoutId = window.setTimeout(() => {\r\n\t\t\t\t\tif (lastArgs) {\r\n\t\t\t\t\t\tfunc(...lastArgs);\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttimeoutId = null;\r\n\t\t\t\t}, delay);\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n}\r\n","const styleData: string = `\r\n/* ========================================================================\r\n    1. 基本設定・変数\r\n   ======================================================================== */\r\n:root {\r\n    /* 基本色・シャドウ */\r\n    --$[prefix]-text-color: #000;\r\n    --$[prefix]-bg: #f0f0f0;\r\n    --$[prefix]-border: #a0a0a0;\r\n    --$[prefix]-shadow-color-light: rgba(0,0,0,0.15);\r\n    --$[prefix]-shadow-color-strong: rgba(0,0,0,0.3);\r\n    --$[prefix]-shadow-color-active: rgba(0,0,0,0.45);\r\n\r\n    /* タイトルバー */\r\n    --$[prefix]-title-bar-height: 32px;\r\n    --$[prefix]-title-bar-bg: #e0e0e0;\r\n    --$[prefix]-title-bar-active-bg: #0078d7;\r\n    --$[prefix]-title-text-color: #000;\r\n    --$[prefix]-title-text-active-color: #fff;\r\n\r\n    /* コントロールボタン */\r\n    --$[prefix]-control-bg: #d0d0d0;\r\n    --$[prefix]-control-hover-bg: #e5e5e5;\r\n    --$[prefix]-control-close-hover-bg: #e81123;\r\n    --$[prefix]-control-close-hover-color: #fff;\r\n\r\n    /* メニュー */\r\n    --$[prefix]-menu-bg: #fff;\r\n    --$[prefix]-menu-border: #ccc;\r\n    --$[prefix]-menu-item-color: #000;\r\n    --$[prefix]-menu-item-hover-bg: #0078d7;\r\n    --$[prefix]-menu-item-hover-color: #fff;\r\n    --$[prefix]-shortcut-text-color: #666;\r\n\r\n    /* タブ */\r\n    --$[prefix]-tab-bg: #dcdcdc;\r\n    --$[prefix]-tab-active-bg: #f0f0f0;\r\n    --$[prefix]-tab-border: #b0b0b0;\r\n    --$[prefix]-tab-bar-bg: #e1e1e1;\r\n    --$[prefix]-tab-close-btn-hover-bg: #ccc;\r\n    --$[prefix]-tab-active-close-btn-hover-bg: #ddd;\r\n\r\n    /* 検索ハイライト */\r\n    --$[prefix]-search-highlight-bg: yellow;\r\n    --$[prefix]-search-highlight-active-bg: orange;\r\n\r\n    /* ポップアップボタン */\r\n    --$[prefix]-popup-button-hover-bg: #e9e9e9;\r\n    --$[prefix]-popup-button-hover-border-color: #bbb;\r\n\r\n    /* リサイズハンドル */\r\n    --$[prefix]-resize-handle-size: 8px;\r\n    --$[prefix]-resize-handle-offset: -4px;\r\n\r\n    /* タスクバー */\r\n    --$[prefix]-taskbar-bg: rgba(240, 240, 240, 0.9);\r\n    --$[prefix]-taskbar-border: #a0a0a0;\r\n    --$[prefix]-taskbar-item-bg: #d0d0d0;\r\n    --$[prefix]-taskbar-item-active-bg: #0078d7;\r\n    --$[prefix]-taskbar-item-active-color: #fff;\r\n    --$[prefix]-taskbar-height: 40px;\r\n    --$[prefix]-taskbar-width: 40px;\r\n\r\n    /* ローディングインジケーター */\r\n    --$[prefix]-loader-bg: rgba(255, 255, 255, 0.7);\r\n    --$[prefix]-loader-color: var(--$[prefix]-title-bar-active-bg);\r\n\r\n    /* その他 */\r\n    --$[prefix]-scrollbar-thumb-bg: rgba(100, 100, 100, 0.5);\r\n}\r\n\r\n/* ========================================================================\r\n    2. ユーティリティクラス\r\n   ========================================================================= */\r\n/**\r\n * テキスト選択を無効化\r\n */\r\n.$[prefix]-us-none {\r\n    user-select: none;\r\n    -webkit-user-select: none;\r\n    -ms-user-select: none;\r\n}\r\n/**\r\n * テキスト選択を有効化\r\n */\r\n.$[prefix]-us-auto {\r\n    user-select: auto;\r\n    -webkit-user-select: auto;\r\n    -ms-user-select: auto;\r\n}\r\n\r\n/* ========================================================================\r\n    3. コンテナ\r\n   ========================================================================= */\r\n/**\r\n * 全てのウィンドウを内包する最上位コンテナ\r\n */\r\n.$[prefix]-container {\r\n    position: fixed;\r\n    top: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    box-sizing: border-box;\r\n    pointer-events: none;\r\n    overflow: hidden;\r\n    z-index: 999;\r\n    display: flex;\r\n    pointer-events: none;\r\n}\r\n.$[prefix]-container > * {\r\n    pointer-events: all; /* 子要素(workspace, taskbar)のイベントは有効化 */\r\n}\r\n/**\r\n * 特定の要素内にネストされた場合のコンテナ\r\n */\r\n.$[prefix]-container.$[prefix]-is-nested {\r\n    position: absolute;\r\n}\r\n\r\n.$[prefix]-workspace {\r\n    position: relative;\r\n    flex-grow: 1; /* 残りのスペースをすべて占有 */\r\n    overflow: hidden; /* ウィンドウがはみ出さないように */\r\n    min-width: 0; /* flexアイテムの縮小問題を回避 */\r\n    min-height: 0; /* flexアイテムの縮小問題を回避 */\r\n    pointer-events: none;\r\n}\r\n/**\r\n * タブのドラッグ中にポインターイベントを有効化し、ドロップを受け付ける\r\n */\r\n.$[prefix]-workspace.$[prefix]-is-tab-dragging {\r\n    pointer-events: auto;\r\n}\r\n\r\n/* ========================================================================\r\n    4. 仮想化技術\r\n   ======================================================================== */\r\n/**\r\n * 仮想化(アンロード)されたウィンドウ\r\n */\r\n.$[prefix]-window.$[prefix]-is-virtualized > .$[prefix]-main-content {\r\n    display: none;\r\n}\r\n.$[prefix]-window.$[prefix]-is-virtualized::after {\r\n    content: \"Unloaded\";\r\n    position: absolute;\r\n    top: 50%;\r\n    left: 50%;\r\n    transform: translate(-50%, -50%);\r\n    color: var(--$[prefix]-border);\r\n    font-size: 1.5em;\r\n    font-weight: bold;\r\n    pointer-events: none;\r\n}\r\n\r\n/**\r\n * 中断されたウィンドウ\r\n */\r\n.$[prefix]-window.$[prefix]-is-suspended > .$[prefix]-main-content {\r\n    display: none;\r\n}\r\n.$[prefix]-window.$[prefix]-is-suspended::after {\r\n    content: \"Suspended\";\r\n    position: absolute;\r\n    top: 50%;\r\n    left: 50%;\r\n    transform: translate(-50%, -50%);\r\n    color: var(--$[prefix]-border);\r\n    font-size: 1.5em;\r\n    font-weight: bold;\r\n    pointer-events: none;\r\n    z-index: 15;\r\n}\r\n\r\n/**\r\n * フリーズされたウィンドウ\r\n */\r\n.$[prefix]-window.$[prefix]-is-frozen > .$[prefix]-main-content {\r\n    pointer-events: none; /* コンテンツの操作を無効化 */\r\n}\r\n.$[prefix]-window.$[prefix]-is-frozen > .$[prefix]-main-content iframe {\r\n    visibility: hidden;\r\n}\r\n.$[prefix]-window.$[prefix]-is-frozen::after {\r\n    content: \"Frozen\";\r\n    position: absolute;\r\n    top: 50%;\r\n    left: 50%;\r\n    transform: translate(-50%, -50%);\r\n    color: var(--$[prefix]-border);\r\n    background: rgba(128, 128, 128, 0.1);\r\n    width: 100%;\r\n    height: 100%;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    font-size: 1.5em;\r\n    font-weight: bold;\r\n    pointer-events: none;\r\n    z-index: 15; /* ローダーより手前 */\r\n}\r\n\r\n/**\r\n * 仮想化時の操作制限\r\n */\r\n.$[prefix]-window.$[prefix]-virtualization-lock .$[prefix]-menu-bar,\r\n.$[prefix]-window.$[prefix]-virtualization-lock .$[prefix]-tab-bar,\r\n.$[prefix]-window.$[prefix]-virtualization-lock .$[prefix]-custom-control-btn {\r\n    pointer-events: none;\r\n    opacity: 0.5;\r\n}\r\n/* ========================================================================\r\n    5. ウィンドウ\r\n   ======================================================================== */\r\n/* --- ウィンドウ基本スタイル --- */\r\n.$[prefix]-window {\r\n    position: absolute;\r\n    display: flex;\r\n    flex-direction: column;\r\n    min-width: 200px;\r\n    min-height: 150px;\r\n    border: 1px solid var(--$[prefix]-border);\r\n    background-color: var(--$[prefix]-bg);\r\n    box-shadow: 0 5px 15px var(--$[prefix]-shadow-color-strong);\r\n    box-sizing: border-box;\r\n    border-radius: 5px;\r\n    overflow: hidden;\r\n    pointer-events: all;\r\n    transition: opacity 0.25s, transform 0.25s;\r\n    touch-action: none;\r\n}\r\n\r\n/* --- ウィンドウ状態別スタイル --- */\r\n/**\r\n * 最小化中のウィンドウ\r\n */\r\n.$[prefix]-window.$[prefix]-is-minimizing {\r\n    transform: scale(0);\r\n    opacity: 0;\r\n    pointer-events: none;\r\n}\r\n\r\n/**\r\n * 最小化完了状態のウィンドウ\r\n */\r\n.$[prefix]-window.$[prefix]-minimized {\r\n    /* アニメーションの最終状態を維持 */\r\n    transform: scale(0);\r\n    opacity: 0;\r\n    /* 表示と操作を無効化 */\r\n    display: none;\r\n    pointer-events: none;\r\n}\r\n/**\r\n * 最大化されたウィンドウ\r\n */\r\n.$[prefix]-window.$[prefix]-maximized {\r\n    border-radius: 0;\r\n}\r\n/**\r\n * 最大化状態ではリサイズハンドルを非表示\r\n */\r\n.$[prefix]-window.$[prefix]-maximized > .$[prefix]-resize-handle {\r\n    display: none;\r\n}\r\n/**\r\n * 復元中のアニメーション（現在は状態を示すマーカーとしてのみ利用）\r\n */\r\n.$[prefix]-window.$[prefix]-is-restoring {\r\n    /* The transition is now handled by the base .winlet-window class */\r\n}\r\n\r\n/**\r\n * ドラッグ中・リサイズ中のトランジションを短縮し、操作性を向上\r\n */\r\n.$[prefix]-window.$[prefix]-is-dragging,\r\n.$[prefix]-window.$[prefix]-is-resizing {\r\n    transition: opacity 0.1s, transform 0.1s;\r\n}\r\n\r\n/**\r\n * アクティブ（フォーカスされている）ウィンドウ\r\n */\r\n.$[prefix]-window.$[prefix]-active {\r\n    box-shadow: 0 8px 25px var(--$[prefix]-shadow-color-active); /* アクティブ時のシャドウ */\r\n}\r\n/**\r\n * アクティブ（フォーカスされている）ウィンドウのタイトルバー\r\n */\r\n.$[prefix]-window.$[prefix]-active .$[prefix]-title-bar {\r\n    background-color: var(--$[prefix]-title-bar-active-bg);\r\n    color: var(--$[prefix]-title-text-active-color);\r\n}\r\n.$[prefix]-window.$[prefix]-active .$[prefix]-title-bar .$[prefix]-title {\r\n    color: var(--$[prefix]-title-text-active-color);\r\n}\r\n\r\n/* --- ウィンドウ特殊スタイル --- */\r\n/**\r\n * 「常に手前に表示」が有効なウィンドウ\r\n */\r\n.$[prefix]-window.$[prefix]-always-on-top .$[prefix]-title-bar {\r\n    background-image: repeating-linear-gradient(\r\n        -45deg,\r\n        transparent,\r\n        transparent 4px,\r\n        rgba(255, 255, 255, 0.05) 4px,\r\n        rgba(255, 255, 255, 0.05) 8px\r\n    );\r\n}\r\n\r\n/**\r\n * ウィンドウシェイクアニメーション\r\n */\r\n@keyframes $[prefix]-shake {\r\n    10%, 90% { transform: translate3d(-1px, 0, 0); }\r\n    20%, 80% { transform: translate3d(2px, 0, 0); }\r\n    30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }\r\n    40%, 60% { transform: translate3d(4px, 0, 0); }\r\n}\r\n.$[prefix]-window.$[prefix]-is-shaking {\r\n    animation: $[prefix]-shake 0.82s cubic-bezier(.36,.07,.19,.97) both;\r\n}\r\n\r\n/* ========================================================================\r\n    6. ゴーストウィンドウ\r\n   ======================================================================== */\r\n/**\r\n * ドラッグ・リサイズ時に表示される輪郭\r\n */\r\n.$[prefix]-ghost-window {\r\n    position: absolute;\r\n    box-sizing: border-box;\r\n    border: 2px dashed var(--$[prefix]-title-bar-active-bg);\r\n    background-color: rgba(0, 120, 215, 0.1);\r\n    z-index: 99999;\r\n    pointer-events: none;\r\n}\r\n\r\n/* ========================================================================\r\n    7. タイトルバー\r\n   ======================================================================== */\r\n/* --- タイトルバー基本スタイル --- */\r\n.$[prefix]-title-bar {\r\n    display: flex;\r\n    align-items: center;\r\n    height: var(--$[prefix]-title-bar-height);\r\n    background-color: var(--$[prefix]-title-bar-bg);\r\n    color: var(--$[prefix]-title-text-color);\r\n    cursor: move;\r\n    flex-shrink: 0;\r\n    touch-action: none;\r\n}\r\n/**\r\n * コントロールが左側にある場合のタイトルバー\r\n */\r\n.$[prefix]-title-bar.$[prefix]-controls-left {\r\n    flex-direction: row-reverse;\r\n}\r\n\r\n/* --- アイコン・タイトル --- */\r\n.$[prefix]-icon {\r\n    min-width: calc(var(--$[prefix]-title-bar-height) * 0.75);\r\n    height: calc(var(--$[prefix]-title-bar-height) * 0.75);\r\n    margin: 0 4px;\r\n    pointer-events: none;\r\n    flex-shrink: 0;\r\n}\r\n\r\n.$[prefix]-icon:empty {\r\n    display: none;\r\n}\r\n\r\n.$[prefix]-icon i {\r\n    font-size: calc(var(--$[prefix]-title-bar-height) * 0.5);\r\n    line-height: calc(var(--$[prefix]-title-bar-height) * 0.75);\r\n    text-align: center;\r\n    display: block;\r\n    width: 100%;\r\n    height: 100%;\r\n}\r\n\r\n.$[prefix]-icon img {\r\n    display: block;\r\n    width: 100%;\r\n    height: 100%;\r\n}\r\n\r\n.$[prefix]-title {\r\n    flex-grow: 1;\r\n    padding: 0 8px;\r\n    font-family: sans-serif;\r\n    font-size: calc(var(--$[prefix]-title-bar-height) * 0.44);\r\n    white-space: nowrap;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n    pointer-events: none;\r\n}\r\n\r\n.$[prefix]-title-bar.$[prefix]-controls-left .$[prefix]-title {\r\n    text-align: right;\r\n}\r\n\r\n/* --- コントロールボタン --- */\r\n.$[prefix]-controls {\r\n    display: flex;\r\n    height: 100%;\r\n    margin-left: auto;\r\n    flex-shrink: 0;\r\n}\r\n\r\n.$[prefix]-title-bar.$[prefix]-controls-left .$[prefix]-controls {\r\n    margin-left: 0;\r\n    margin-right: auto;\r\n    flex-direction: row-reverse;\r\n}\r\n\r\n.$[prefix]-control-btn {\r\n    display: inline-flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    width: calc(var(--$[prefix]-title-bar-height) * 1.3);\r\n    height: 100%;\r\n    border: none;\r\n    border-radius: 0;\r\n    box-sizing: border-box;\r\n    background-color: transparent;\r\n    font-size: calc(var(--$[prefix]-title-bar-height) * 0.5);\r\n    cursor: pointer;\r\n    text-align: center;\r\n    vertical-align: middle;\r\n    font-family: sans-serif;\r\n    transition: background-color 0.2s;\r\n    touch-action: auto;\r\n    padding: 0;\r\n    margin: 0;\r\n    color: inherit;\r\n}\r\n\r\n.$[prefix]-custom-control-btn > * {\r\n    pointer-events: none;\r\n}\r\n\r\n.$[prefix]-control-btn:hover {\r\n    background-color: var(--$[prefix]-control-hover-bg);\r\n}\r\n\r\n.$[prefix]-control-btn.$[prefix]-close-btn:hover {\r\n    background-color: var(--$[prefix]-control-close-hover-bg);\r\n    color: var(--$[prefix]-control-close-hover-color);\r\n}\r\n\r\n.$[prefix]-refresh-btn {\r\n    display: none;\r\n}\r\n\r\n.$[prefix]-window.$[prefix]-is-virtualized-manual .$[prefix]-refresh-btn {\r\n    display: inline-flex;\r\n}\r\n\r\n/* ========================================================================\r\n    8. メインコンテンツエリア\r\n   ======================================================================== */\r\n.$[prefix]-main-content {\r\n    all: initial;\r\n    position: relative;\r\n    display:flex;\r\n    color: var(--$[prefix]-text-color);\r\n    flex-direction:column;\r\n    flex-grow:1;\r\n    overflow:hidden;\r\n}\r\n\r\n.$[prefix]-content {\r\n    display: flex;\r\n    flex-direction: column;\r\n    flex-grow: 1;\r\n    position: relative;\r\n    overflow: auto;\r\n    touch-action: auto;\r\n}\r\n\r\n.$[prefix]-content iframe {\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    border: none;\r\n}\r\n\r\n/* --- ローディングインジケーター --- */\r\n.$[prefix]-loader-overlay {\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: var(--$[prefix]-loader-bg);\r\n    display: none;\r\n    justify-content: center;\r\n    align-items: center;\r\n    z-index: 20;\r\n}\r\n@keyframes $[prefix]-spinner-rotation {\r\n    0% { transform: rotate(0deg); }\r\n    100% { transform: rotate(360deg); }\r\n}\r\n.$[prefix]-loader-spinner {\r\n    width: 48px;\r\n    height: 48px;\r\n    border-radius: 50%;\r\n    border: 5px solid #fff;\r\n    border-bottom-color: var(--$[prefix]-loader-color);\r\n    animation: $[prefix]-spinner-rotation 1s linear infinite;\r\n}\r\n\r\n.$[prefix]-canvas-overlay {\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    display: none;\r\n    z-index: 10;\r\n}\r\n.$[prefix]-canvas-overlay img {\r\n    width: 100%;\r\n    height: 100%;\r\n    object-fit: contain;\r\n}\r\n\r\n/* ========================================================================\r\n    9. メニューバー\r\n   ======================================================================== */\r\n.$[prefix]-menu-bar {\r\n    color: var(--$[prefix]-menu-item-color);\r\n    display: flex;\r\n    background-color: var(--$[prefix]-bg);\r\n    padding: 2px;\r\n    flex-shrink: 0;\r\n    border-bottom: 1px solid var(--$[prefix]-border);\r\n    touch-action: auto;\r\n}\r\n\r\n.$[prefix]-menu-item {\r\n    font-family: sans-serif;\r\n    font-size: clamp(0px , calc(var(--winlet-title-bar-height) * 0.6), 14px);\r\n    padding: 4px 8px;\r\n    cursor: default;\r\n    position: relative;\r\n}\r\n\r\n.$[prefix]-menu-item:hover {\r\n    background-color: var(--$[prefix]-menu-item-hover-bg);\r\n    color: var(--$[prefix]-menu-item-hover-color);\r\n}\r\n\r\n/* --- ドロップダウンメニュー --- */\r\n.$[prefix]-menu-dropdown {\r\n    color: var(--$[prefix]-menu-item-color);\r\n    display: none;\r\n    position: absolute;\r\n    top: 100%;\r\n    left: 0;\r\n    background-color: var(--$[prefix]-menu-bg);\r\n    border: 1px solid var(--$[prefix]-menu-border);\r\n    box-shadow: 0 2px 8px var(--$[prefix]-shadow-color-light);\r\n    list-style: none;\r\n    margin: 0;\r\n    padding: 4px 0;\r\n    min-width: 150px;\r\n    z-index: 10;\r\n    touch-action: auto;\r\n}\r\n\r\n.$[prefix]-menu-dropdown li {\r\n    padding: 0 20px;\r\n    font-size: 14px;\r\n    cursor: pointer;\r\n}\r\n\r\n.$[prefix]-menu-dropdown li:hover {\r\n    background-color: var(--$[prefix]-menu-item-hover-bg);\r\n    color: var(--$[prefix]-menu-item-hover-color);\r\n}\r\n\r\n.$[prefix]-menu-dropdown li.$[prefix]-separator {\r\n    height: 1px;\r\n    background-color: var(--$[prefix]-menu-border);\r\n    margin: 4px 0;\r\n    padding: 0;\r\n}\r\n\r\n.$[prefix]-menu-dropdown-item {\r\n    display: flex;\r\n    line-height: 1.6em;\r\n    flex-wrap: nowrap;\r\n    justify-content: space-between;\r\n    width: 100%;\r\n    white-space: nowrap;\r\n}\r\n\r\n/* --- サブメニュー --- */\r\n.$[prefix]-menu-dropdown li.$[prefix]-has-submenu {\r\n    position: relative;\r\n}\r\n.$[prefix]-menu-dropdown li.$[prefix]-has-submenu::after {\r\n    content: '▶';\r\n    position: absolute;\r\n    top: 50%;\r\n    right: 10px;\r\n    margin-top: calc(var(--winlet-title-bar-height) * -0.5);\r\n    font-size: 0.8em;\r\n    color: inherit;\r\n}\r\n/**\r\n * ネストされたサブメニューの表示位置\r\n */\r\n.$[prefix]-menu-dropdown li.$[prefix]-has-submenu > .$[prefix]-menu-dropdown {\r\n    top: -5px; /* liのpaddingを考慮 */\r\n    left: 100%;\r\n}\r\n/**\r\n * サブメニューはホバーで開く\r\n */\r\n.$[prefix]-menu-dropdown li.$[prefix]-has-submenu:hover > .$[prefix]-menu-dropdown {\r\n    display: block;\r\n}\r\n\r\n/* --- ショートカットテキスト --- */\r\n.$[prefix]-shortcut-text {\r\n    color: var(--$[prefix]-shortcut-text-color);\r\n    margin-left: 1em;\r\n}\r\n.$[prefix]-menu-dropdown li:hover .$[prefix]-shortcut-text {\r\n    color: inherit;\r\n}\r\n\r\n/* --- タブ --- */\r\n.$[prefix]-tab-bar {\r\n    color: var(--$[prefix]-menu-item-color);\r\n    overflow-x: auto;\r\n    overflow-y: hidden;\r\n    -ms-overflow-style: -ms-autohiding-scrollbar;\r\n    scrollbar-width: thin;\r\n    display: flex;\r\n    background-color: var(--$[prefix]-tab-bar-bg);\r\n    flex-shrink: 0;\r\n    align-items: flex-end;\r\n    touch-action: auto;\r\n}\r\n\r\n.$[prefix]-tab-bar::-webkit-scrollbar{\r\n    width: 6px;\r\n    height: 6px;\r\n}\r\n\r\n.$[prefix]-tab-bar::-webkit-scrollbar-thumb {\r\n    background-color: var(--$[prefix]-scrollbar-thumb-bg);\r\n    border-radius: 3px;\r\n}\r\n\r\n.$[prefix]-tab-bar::-webkit-scrollbar-track {\r\n    background-color: transparent;\r\n}\r\n\r\n/* --- タブ --- */\r\n.$[prefix]-tab {\r\n    white-space: nowrap;\r\n    padding: 8px 16px;\r\n    font-family: sans-serif;\r\n    font-size: 14px;\r\n    cursor: pointer;\r\n    border-right: 1px solid var(--$[prefix]-tab-border);\r\n    background-color: var(--$[prefix]-tab-bg);\r\n}\r\n\r\n.$[prefix]-tab.$[prefix]-active {\r\n    background-color: var(--$[prefix]-tab-active-bg);\r\n    border-bottom: 2px solid var(--$[prefix]-title-bar-active-bg);\r\n}\r\n\r\n.$[prefix]-tab.$[prefix]-active .$[prefix]-tab-close-btn:hover {\r\n    background-color: var(--$[prefix]-tab-active-close-btn-hover-bg);\r\n}\r\n\r\n/**\r\n * ドラッグ中のタブのスタイル\r\n */\r\n.$[prefix]-tab.$[prefix]-dragging {\r\n    opacity: 0.5;\r\n}\r\n\r\n/* --- タブ関連ボタン --- */\r\n/**\r\n * タブの閉じるボタン\r\n */\r\n.$[prefix]-tab-close-btn {\r\n    margin-left: 8px;\r\n    padding: 0 4px;\r\n    border-radius: 50%;\r\n    cursor: pointer;\r\n    font-weight: bold;\r\n    font-size: 14px;\r\n    line-height: 1;\r\n}\r\n.$[prefix]-tab-close-btn:hover {\r\n    background-color: var(--$[prefix]-tab-close-btn-hover-bg);\r\n}\r\n\r\n/**\r\n * タブ追加ボタン\r\n */\r\n.$[prefix]-tab-add-btn {\r\n    padding: 8px;\r\n    font-size: 14px;\r\n    cursor: pointer;\r\n    border-bottom: 1px solid var(--$[prefix]-tab-border);\r\n}\r\n.$[prefix]-tab-add-btn:hover {\r\n    background-color: var(--$[prefix]-title-bar-bg);\r\n}\r\n\r\n/* --- タブコンテンツ --- */\r\n.$[prefix]-tab-content {\r\n    display: none;\r\n}\r\n\r\n.$[prefix]-tab-content.$[prefix]-active {\r\n    display: block;\r\n    width: 100%;\r\n    height: 100%;\r\n}\r\n\r\n/* ========================================================================\r\n    10. 分割ビュー (Split View)\r\n   ======================================================================== */\r\n.$[prefix]-split-view {\r\n    display: flex;\r\n    width: 100%;\r\n    height: 100%;\r\n    overflow: hidden;\r\n}\r\n.$[prefix]-split-view-horizontal {\r\n    flex-direction: row;\r\n}\r\n.$[prefix]-split-view-vertical {\r\n    flex-direction: column;\r\n}\r\n.$[prefix]-split-pane {\r\n    position: relative;\r\n    overflow: auto;\r\n}\r\n.$[prefix]-split-resizer {\r\n    background-color: var(--$[prefix]-border);\r\n    flex-shrink: 0;\r\n    z-index: 1;\r\n    transition: background-color 0.2s;\r\n}\r\n.$[prefix]-split-resizer:hover {\r\n    background-color: var(--$[prefix]-title-bar-active-bg);\r\n}\r\n.$[prefix]-split-view-horizontal > .$[prefix]-split-resizer {\r\n    width: 4px;\r\n    cursor: col-resize;\r\n}\r\n.$[prefix]-split-view-vertical > .$[prefix]-split-resizer {\r\n    height: 4px;\r\n    cursor: row-resize;\r\n}\r\n\r\n/* ========================================================================\r\n    11. ステータスバー (Status Bar)\r\n   ======================================================================== */\r\n.$[prefix]-statusbar {\r\n    flex-shrink: 0;\r\n    height: 24px;\r\n    line-height: 24px;\r\n    padding: 0 8px;\r\n    background-color: var(--$[prefix]-title-bar-bg);\r\n    border-top: 1px solid var(--$[prefix]-border);\r\n    font-size: 12px;\r\n    overflow: hidden;\r\n    white-space: nowrap;\r\n    text-overflow: ellipsis;\r\n    user-select: none;\r\n}\r\n\r\n/* ========================================================================\r\n    12. ウィンドウ内検索 (In-window Search)\r\n   ======================================================================== */\r\n.$[prefix]-search-bar {\r\n    position: absolute;\r\n    top: 0;\r\n    right: 0;\r\n    background-color: var(--$[prefix]-bg);\r\n    border: 1px solid var(--$[prefix]-border);\r\n    box-shadow: var(--$[prefix]-shadow-color-light) -2px 2px 5px;\r\n    padding: 4px;\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 4px;\r\n    border-radius: 3px;\r\n    z-index: 80;\r\n}\r\n.$[prefix]-search-input {\r\n    border: 1px solid var(--$[prefix]-border);\r\n    padding: 2px 4px;\r\n    width: 150px;\r\n}\r\n.$[prefix]-search-results {\r\n    font-size: 12px;\r\n    padding: 0 4px;\r\n}\r\n.$[prefix]-search-btn {\r\n    border: 1px solid var(--$[prefix]-border);\r\n    background-color: var(--$[prefix]-bg);\r\n    cursor: pointer;\r\n    padding: 2px 4px;\r\n    font-size: 12px;\r\n    min-width: 22px;\r\n}\r\n.$[prefix]-search-btn:hover {\r\n    background-color: var(--$[prefix]-popup-button-hover-bg);\r\n}\r\n.$[prefix]-search-btn-active {\r\n    background-color: var(--$[prefix]-title-bar-active-bg);\r\n    color: var(--$[prefix]-title-bar-active-color);\r\n}\r\n.$[prefix]-search-highlight {\r\n    background-color: var(--$[prefix]-search-highlight-bg);\r\n    color: black;\r\n}\r\n.$[prefix]-search-highlight-active {\r\n    background-color: var(--$[prefix]-search-highlight-active-bg);\r\n}\r\n\r\n/* ========================================================================\r\n    13. リサイズハンドル\r\n   ======================================================================== */\r\n.$[prefix]-resize-handle {\r\n    position: absolute;\r\n    z-index: 5;\r\n    touch-action: none;\r\n}\r\n\r\n.$[prefix]-resize-handle.$[prefix]-n { top: var(--$[prefix]-resize-handle-offset); left: 0; right: 0; height: var(--$[prefix]-resize-handle-size); cursor: n-resize; }\r\n.$[prefix]-resize-handle.$[prefix]-s { bottom: var(--$[prefix]-resize-handle-offset); left: 0; right: 0; height: var(--$[prefix]-resize-handle-size); cursor: s-resize; }\r\n.$[prefix]-resize-handle.$[prefix]-w { top: 0; bottom: 0; left: var(--$[prefix]-resize-handle-offset); width: var(--$[prefix]-resize-handle-size); cursor: w-resize; }\r\n.$[prefix]-resize-handle.$[prefix]-e { top: 0; bottom: 0; right: var(--$[prefix]-resize-handle-offset); width: var(--$[prefix]-resize-handle-size); cursor: e-resize; }\r\n.$[prefix]-resize-handle.$[prefix]-nw { top: var(--$[prefix]-resize-handle-offset); left: var(--$[prefix]-resize-handle-offset); width: var(--$[prefix]-resize-handle-size); height: var(--$[prefix]-resize-handle-size); cursor: nw-resize; }\r\n.$[prefix]-resize-handle.$[prefix]-ne { top: var(--$[prefix]-resize-handle-offset); right: var(--$[prefix]-resize-handle-offset); width: var(--$[prefix]-resize-handle-size); height: var(--$[prefix]-resize-handle-size); cursor: ne-resize; }\r\n.$[prefix]-resize-handle.$[prefix]-sw { bottom: var(--$[prefix]-resize-handle-offset); left: var(--$[prefix]-resize-handle-offset); width: var(--$[prefix]-resize-handle-size); height: var(--$[prefix]-resize-handle-size); cursor: sw-resize; }\r\n.$[prefix]-resize-handle.$[prefix]-se { bottom: var(--$[prefix]-resize-handle-offset); right: var(--$[prefix]-resize-handle-offset); width: var(--$[prefix]-resize-handle-size); height: var(--$[prefix]-resize-handle-size); cursor: se-resize; }\r\n\r\n/* ========================================================================\r\n    14. コンテキストメニュー\r\n   ======================================================================== */\r\n.$[prefix]-context-menu {\r\n    color: var(--$[prefix]-menu-item-color);\r\n    pointer-events: all;\r\n    position: fixed;\r\n    z-index: 10000;\r\n    background-color: var(--$[prefix]-menu-bg);\r\n    border: 1px solid var(--$[prefix]-menu-border);\r\n    box-shadow: 0 2px 8px var(--$[prefix]-shadow-color-light);\r\n    list-style: none;\r\n    margin: 0;\r\n    padding: 4px 0;\r\n    min-width: 160px;\r\n}\r\n.$[prefix]-context-menu li {\r\n    padding: 6px 24px;\r\n    font-family: sans-serif;\r\n    font-size: 14px;\r\n    cursor: pointer;\r\n}\r\n.$[prefix]-context-menu li:hover {\r\n    background-color: var(--$[prefix]-menu-item-hover-bg);\r\n    color: var(--$[prefix]-menu-item-hover-color);\r\n}\r\n.$[prefix]-context-menu li.$[prefix]-separator {\r\n    height: 1px;\r\n    background-color: var(--$[prefix]-menu-border);\r\n    margin: 4px 0;\r\n    padding: 0;\r\n}\r\n\r\n/* ========================================================================\r\n    15. ポップアップ\r\n   ======================================================================== */\r\n.$[prefix]-popup-window .$[prefix]-content {\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-between;\r\n    padding: 20px;\r\n    box-sizing: border-box;\r\n}\r\n.$[prefix]-popup-message {\r\n    font-family: sans-serif;\r\n    font-size: 14px;\r\n    line-height: 1.5;\r\n    flex-grow: 1;\r\n    word-wrap: break-word;\r\n}\r\n.$[prefix]-popup-buttons {\r\n    display: flex;\r\n    justify-content: flex-end;\r\n    gap: 10px;\r\n    margin-top: 20px;\r\n    flex-shrink: 0;\r\n    touch-action: auto;\r\n}\r\n.$[prefix]-popup-button {\r\n    color: var(--$[prefix]-menu-item-color);\r\n    min-width: 80px;\r\n    padding: 8px 12px;\r\n    margin: 0;\r\n    border: 1px solid var(--$[prefix]-menu-border);\r\n    border-radius: 3px;\r\n    background-color: var(--$[prefix]-bg);\r\n    cursor: pointer;\r\n    font-size: 14px;\r\n    box-shadow: 0 1px 1px var(--$[prefix]-shadow-color-light);\r\n}\r\n.$[prefix]-popup-button:hover {\r\n    border-color: var(--$[prefix]-popup-button-hover-border-color);\r\n    background-color: var(--$[prefix]-popup-button-hover-bg);\r\n}\r\n.$[prefix]-popup-button:active {\r\n    background-color: var(--$[prefix]-tab-bg);\r\n}\r\n\r\n/* ========================================================================\r\n    16. 統合スタイル (Merged Styles)\r\n   ======================================================================== */\r\n/* --- メニュー/タブ統合時の基本タイトルバー --- */\r\n.$[prefix]-window.$[prefix]-menu-style-merged .$[prefix]-title-bar,\r\n.$[prefix]-window.$[prefix]-tab-style-merged .$[prefix]-title-bar {\r\n    height: auto;\r\n    align-items: flex-end;\r\n    padding: 0;\r\n}\r\n\r\n/* --- メニュー統合スタイル --- */\r\n.$[prefix]-window.$[prefix]-menu-style-merged .$[prefix]-icon {\r\n    margin-block: auto;\r\n}\r\n.$[prefix]-window.$[prefix]-menu-style-merged .$[prefix]-title {\r\n    flex-grow: 1;\r\n    margin-block: auto;\r\n}\r\n.$[prefix]-window.$[prefix]-menu-style-merged .$[prefix]-menu-bar {\r\n    border-bottom: none;\r\n    background: transparent;\r\n    padding: 0 6px;\r\n    align-self: center;\r\n}\r\n.$[prefix]-window.$[prefix]-menu-style-merged .$[prefix]-menu-item {\r\n    line-height: var(--$[prefix]-title-bar-height);\r\n    padding-top: 0;\r\n    padding-bottom: 0;\r\n}\r\n/* アクティブウィンドウの統合メニューの文字色 */\r\n.$[prefix]-window.$[prefix]-menu-style-merged.$[prefix]-active:not(.$[prefix]-tab-style-merged) .$[prefix]-menu-item {\r\n    color: var(--winlet-menu-item-hover-color);\r\n}\r\n.$[prefix]-window.$[prefix]-menu-style-merged.$[prefix]-active:not(.$[prefix]-tab-style-merged) .$[prefix]-menu-item:hover {\r\n    background-color: var(--$[prefix]-title-bar-bg);\r\n    color: var(--$[prefix]-menu-item-color);\r\n}\r\n\r\n/* --- タブ統合スタイル (Chrome風) --- */\r\n.$[prefix]-window.$[prefix]-tab-style-merged.$[prefix]-window.$[prefix]-active .$[prefix]-title-bar {\r\n    background-color: var(--$[prefix]-title-bar-bg);\r\n}\r\n.$[prefix]-window.$[prefix]-tab-style-merged .$[prefix]-title {\r\n    display: none;\r\n}\r\n\r\n.$[prefix]-window.$[prefix]-tab-style-merged .$[prefix]-tab-bar {\r\n    background-color: transparent;\r\n    flex-grow: 1;\r\n    flex-shrink: 1;\r\n    min-width: 0;\r\n    align-items: flex-end;\r\n    height: calc(var(--$[prefix]-title-bar-height) + 4px);\r\n    margin: 0;\r\n    order: 1; /* controlsより前に配置 */\r\n    -ms-overflow-style: none;\r\n    scrollbar-width: none;\r\n}\r\n.$[prefix]-window.$[prefix]-tab-style-merged .$[prefix]-tab-bar::-webkit-scrollbar{\r\n    display: none;\r\n}\r\n.$[prefix]-window.$[prefix]-title-bar.$[prefix]-controls-left .$[prefix]-tab-bar {\r\n    order: -1;\r\n}\r\n\r\n.$[prefix]-window.$[prefix]-tab-style-merged .$[prefix]-tab {\r\n    border: 1px solid var(--$[prefix]-border);\r\n    border-bottom: none;\r\n    border-radius: 6px 6px 0 0;\r\n    margin-top: 4px;\r\n    margin-left: -1px;\r\n    position: relative;\r\n    bottom: -1px;\r\n}\r\n.$[prefix]-window.$[prefix]-tab-style-merged .$[prefix]-tab.$[prefix]-active {\r\n    background-color: var(--$[prefix]-bg);\r\n    border-color: var(--$[prefix]-border);\r\n    border-bottom: 1px solid var(--$[prefix]-bg);\r\n    z-index: 2;\r\n}\r\n\r\n.$[prefix]-window.$[prefix]-tab-style-merged .$[prefix]-tab-add-btn {\r\n    border: none;\r\n    align-self: center;\r\n}\r\n.$[prefix]-window.$[prefix]-tab-style-merged .$[prefix]-main-content {\r\n    border-top: none;\r\n}\r\n\r\n/* --- 統合時のコントロールボタン --- */\r\n.$[prefix]-window.$[prefix]-tab-style-merged .$[prefix]-controls,\r\n.$[prefix]-window.$[prefix]-menu-style-merged .$[prefix]-controls {\r\n    align-self: flex-start;\r\n    order: 2;\r\n}\r\n\r\n/* ========================================================================\r\n    17. タスクバー\r\n   ======================================================================== */\r\n.$[prefix]-taskbar {\r\n    position: absolute;\r\n    background-color: var(--$[prefix]-taskbar-bg);\r\n    box-sizing: border-box;\r\n    display: flex;\r\n    align-items: center;\r\n    padding: 0 5px;\r\n    z-index: 50000;\r\n    flex-shrink: 0;\r\n    display: flex;\r\n    gap: 5px;\r\n    overflow: auto;\r\n    scrollbar-width: none;\r\n    -ms-overflow-style: none;\r\n    backdrop-filter: blur(5px);\r\n    pointer-events: all;\r\n}\r\n.$[prefix]-taskbar::-webkit-scrollbar{\r\n    display: none;\r\n}\r\n\r\n/* --- 位置 --- */\r\n.$[prefix]-taskbar.$[prefix]-taskbar-bottom {\r\n    bottom: 0;\r\n    left: 0;\r\n    border-top: 1px solid var(--$[prefix]-taskbar-border);\r\n}\r\n.$[prefix]-taskbar.$[prefix]-taskbar-top {\r\n    top: 0;\r\n    left: 0;\r\n    border-bottom: 1px solid var(--$[prefix]-taskbar-border);\r\n}\r\n.$[prefix]-taskbar.$[prefix]-taskbar-left {\r\n    top: 0;\r\n    left: 0;\r\n    border-right: 1px solid var(--$[prefix]-taskbar-border);\r\n}\r\n.$[prefix]-taskbar.$[prefix]-taskbar-right {\r\n    top: 0;\r\n    right: 0;\r\n    border-left: 1px solid var(--$[prefix]-taskbar-border);\r\n}\r\n\r\n.$[prefix]-taskbar.$[prefix]-taskbar-bottom,\r\n.$[prefix]-taskbar.$[prefix]-taskbar-top {\r\n    --$[prefix]-taskbar-icon-size: var(--$[prefix]-taskbar-height);\r\n    width: 100%;\r\n    height: var(--$[prefix]-taskbar-height);\r\n    flex-direction: row;\r\n}\r\n.$[prefix]-taskbar.$[prefix]-taskbar-left,\r\n.$[prefix]-taskbar.$[prefix]-taskbar-right {\r\n    --$[prefix]-taskbar-icon-size: var(--$[prefix]-taskbar-width);\r\n    width: var(--$[prefix]-taskbar-width);\r\n    height: 100%;\r\n    flex-direction: column;\r\n}\r\n\r\n\r\n.$[prefix]-taskbar-item {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    width: auto;\r\n    height: calc(var(--winlet-taskbar-icon-size) - 6px);\r\n    padding: 0 10px;\r\n    border-radius: 3px;\r\n    background-color: var(--$[prefix]-taskbar-item-bg);\r\n    cursor: pointer;\r\n    flex-shrink: 0;\r\n    max-width: 150px;\r\n    transition: background-color 0.2s;\r\n    font-family: sans-serif;\r\n    font-size: 14px;\r\n    white-space: nowrap;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n    box-sizing: border-box;\r\n}\r\n/* 縦向きタスクバーのアイテム */\r\n.$[prefix]-taskbar.$[prefix]-taskbar-left .$[prefix]-taskbar-item,\r\n.$[prefix]-taskbar.$[prefix]-taskbar-right .$[prefix]-taskbar-item {\r\n    width: calc(var(--winlet-taskbar-icon-size) - 6px);\r\n    height: auto;\r\n    min-height: 40px;\r\n    max-width: none;\r\n    padding: 10px 0;\r\n    writing-mode: vertical-rl;\r\n}\r\n\r\n.$[prefix]-taskbar-item-icon {\r\n    width: 100%;\r\n    height: 100%;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n}\r\n.$[prefix]-taskbar-item-icon img {\r\n    width: calc(var(--winlet-taskbar-icon-size) - 6px);\r\n    height: calc(var(--winlet-taskbar-icon-size) - 6px);\r\n    object-fit: contain;\r\n}\r\n.$[prefix]-taskbar-item-icon i {\r\n    font-size: calc((var(--winlet-taskbar-icon-size) - 12px) * 0.8);\r\n    line-height: calc(var(--winlet-taskbar-icon-size) - 18px);\r\n    text-align: center;\r\n    object-fit: contain;\r\n}\r\n.$[prefix]-taskbar-item.$[prefix]-icon-only {\r\n    width: calc(var(--winlet-taskbar-icon-size) - 6px);\r\n    height: calc(var(--winlet-taskbar-icon-size) - 6px);\r\n    padding: 6px;\r\n}\r\n/* 縦向きアイコンモード */\r\n.$[prefix]-taskbar.$[prefix]-taskbar-left .$[prefix]-taskbar-item.$[prefix]-icon-only,\r\n.$[prefix]-taskbar.$[prefix]-taskbar-right .$[prefix]-taskbar-item.$[prefix]-icon-only {\r\n    width: calc(var(--winlet-taskbar-icon-size) - 6px);\r\n    height: calc(var(--winlet-taskbar-icon-size) - 6px);\r\n}\r\n\r\n.$[prefix]-taskbar-item.$[prefix]-active {\r\n    background-color: var(--$[prefix]-taskbar-item-active-bg);\r\n    color: var(--$[prefix]-taskbar-item-active-color);\r\n}\r\n.$[prefix]-taskbar-item.$[prefix]-minimized {\r\n    opacity: 0.7;\r\n}\r\n\r\n/**\r\n * 仮想化されたウィンドウを示すタスクバーアイテム\r\n */\r\n.$[prefix]-taskbar-item.$[prefix]-virtualized {\r\n    filter: grayscale(80%);\r\n    opacity: 0.7;\r\n    font-style: italic;\r\n}\r\n.$[prefix]-taskbar-item.$[prefix]-virtualized .$[prefix]-taskbar-item-icon img {\r\n    width: calc(var(--winlet-taskbar-icon-size) - 9px);\r\n    height: calc(var(--winlet-taskbar-icon-size) - 9px);\r\n}\r\n.$[prefix]-taskbar-item.$[prefix]-virtualized .$[prefix]-taskbar-item-icon i {\r\n    font-size: calc((var(--winlet-taskbar-icon-size) - 18px) * 0.8);\r\n    line-height: calc(var(--winlet-taskbar-icon-size) - 27px);\r\n}\r\n\r\n/* ========================================================================\r\n    18. モバイル・タッチデバイス対応\r\n   ======================================================================== */\r\n@media (pointer: coarse), (max-width: 768px) {\r\n    /* リサイズハンドルとコントロールボタンを大きくして操作しやすくする */\r\n    :root {\r\n        --$[prefix]-resize-handle-size: 16px;\r\n        --$[prefix]-resize-handle-offset: -8px;\r\n    }\r\n    .$[prefix]-control-btn {\r\n        width: calc(var(--$[prefix]-title-bar-height) * 1.5);\r\n    }\r\n}\r\n\r\n/* ========================================================================\r\n    19. ハイコントラストモード対応\r\n   ======================================================================== */\r\n/* high-contrast.tsと合わせる */\r\n@media (prefers-contrast: more) {\r\n    .$[prefix]-window,\r\n    .$[prefix]-window.$[prefix]-active {\r\n        box-shadow: none;\r\n    }\r\n    .$[prefix]-window.$[prefix]-active {\r\n        border: 2px solid var(--$[prefix]-title-bar-active-bg);\r\n    }\r\n}\r\n\r\n/* ========================================================================\r\n    20. アニメーション無効化\r\n   ======================================================================== */\r\n.$[prefix]-container.$[prefix]-animations-disabled .$[prefix]-window,\r\n.$[prefix]-container.$[prefix]-animations-disabled .$[prefix]-window.$[prefix]-minimized,\r\n.$[prefix]-container.$[prefix]-animations-disabled .$[prefix]-window.$[prefix]-maximized,\r\n.$[prefix]-container.$[prefix]-animations-disabled .$[prefix]-window.$[prefix]-is-restoring {\r\n    transition: none;\r\n}\r\n\r\n/* ========================================================================\r\n    21. デバッグモード\r\n   ======================================================================== */\r\n.$[prefix]-debug-overlay {\r\n    display: none;\r\n    position: absolute;\r\n    top: calc(var(--$[prefix]-title-bar-height) + 5px);\r\n    left: 5px;\r\n    background: rgba(0,0,0,0.5);\r\n    color: #fff;\r\n    padding: 5px;\r\n    border-radius: 3px;\r\n    font-family: monospace;\r\n    font-size: 12px;\r\n    line-height: 1.4;\r\n    pointer-events: none;\r\n    z-index: 100;\r\n    white-space: pre;\r\n}\r\n\r\n.$[prefix]-container.$[prefix]-debug-mode-enabled .$[prefix]-debug-overlay {\r\n    display: block;\r\n}\r\n`;\r\n\r\nexport default styleData;\r\n","// src/themes/dark.ts\nimport { Theme } from \"../../const/types\";\n\nexport const darkTheme: Theme = {\n\tname: \"dark\",\n\tvariables: {\n\t\t// 基本色・シャドウ\n\t\t\"--$[prefix]-text-color\": \"#e0e0e0\",\n\t\t\"--$[prefix]-bg\": \"#2d2d2d\",\n\t\t\"--$[prefix]-border\": \"#555\",\n\t\t\"--$[prefix]-shadow-color-light\": \"rgba(0,0,0,0.3)\",\n\t\t\"--$[prefix]-shadow-color-strong\": \"rgba(0,0,0,0.5)\",\n\t\t\"--$[prefix]-shadow-color-active\": \"rgba(0,0,0,0.7)\",\n\n\t\t// タイトルバー\n\t\t\"--$[prefix]-title-bar-bg\": \"#3c3c3c\",\n\t\t\"--$[prefix]-title-text-color\": \"#e0e0e0\",\n\t\t\"--$[prefix]-title-text-active-color\": \"#fff\",\n\n\t\t// コントロールボタン\n\t\t\"--$[prefix]-control-bg\": \"#4a4a4a\",\n\t\t\"--$[prefix]-control-hover-bg\": \"#5a5a5a\",\n\n\t\t// メニュー\n\t\t\"--$[prefix]-menu-bg\": \"#252525\",\n\t\t\"--$[prefix]-menu-border\": \"#444\",\n\t\t\"--$[prefix]-menu-item-color\": \"#e0e0e0\",\n\t\t\"--$[prefix]-shortcut-text-color\": \"#b0b0b0\",\n\n\t\t// タブ\n\t\t\"--$[prefix]-tab-bg\": \"#383838\",\n\t\t\"--$[prefix]-tab-active-bg\": \"#2d2d2d\",\n\t\t\"--$[prefix]-tab-border\": \"#505050\",\n\t\t\"--$[prefix]-tab-bar-bg\": \"#383838\",\n\t\t\"--$[prefix]-tab-close-btn-hover-bg\": \"#5a5a5a\",\n\t\t\"--$[prefix]-tab-active-close-btn-hover-bg\": \"#6a6a6a\",\n\n\t\t// ポップアップボタン\n\t\t\"--$[prefix]-popup-button-hover-bg\": \"#5a5a5a\",\n\t\t\"--$[prefix]-popup-button-hover-border-color\": \"#777\",\n\n\t\t// タスクバー\n\t\t\"--$[prefix]-taskbar-bg\": \"rgba(45, 45, 45, 0.9)\",\n\t\t\"--$[prefix]-taskbar-border\": \"#555\",\n\t\t\"--$[prefix]-taskbar-item-bg\": \"#5a5a5a\",\n\n\t\t// その他\n\t\t\"--$[prefix]-scrollbar-thumb-bg\": \"rgba(180, 180, 180, 0.5)\",\n\t},\n};\n","// src/themes/default.ts\nimport { Theme } from \"../../const/types\";\n\nexport const defaultTheme: Theme = {\n\tname: \"default\",\n\tvariables: {\n\t\t// 基本色・シャドウ\n\t\t\"--$[prefix]-text-color\": \"#000\",\n\t\t\"--$[prefix]-bg\": \"#f0f0f0\",\n\t\t\"--$[prefix]-border\": \"#a0a0a0\",\n\t\t\"--$[prefix]-shadow-color-light\": \"rgba(0,0,0,0.15)\",\n\t\t\"--$[prefix]-shadow-color-strong\": \"rgba(0,0,0,0.3)\",\n\t\t\"--$[prefix]-shadow-color-active\": \"rgba(0,0,0,0.45)\",\n\n\t\t// タイトルバー\n\t\t\"--$[prefix]-title-bar-bg\": \"#e0e0e0\",\n\t\t\"--$[prefix]-title-bar-active-bg\": \"#0078d7\",\n\t\t\"--$[prefix]-title-text-color\": \"#000\",\n\t\t\"--$[prefix]-title-text-active-color\": \"#fff\",\n\n\t\t// コントロールボタン\n\t\t\"--$[prefix]-control-bg\": \"#d0d0d0\",\n\t\t\"--$[prefix]-control-hover-bg\": \"#e5e5e5\",\n\t\t\"--$[prefix]-control-close-hover-bg\": \"#e81123\",\n\t\t\"--$[prefix]-control-close-hover-color\": \"#fff\",\n\n\t\t// メニュー\n\t\t\"--$[prefix]-menu-bg\": \"#fff\",\n\t\t\"--$[prefix]-menu-border\": \"#ccc\",\n\t\t\"--$[prefix]-menu-item-color\": \"#000\",\n\t\t\"--$[prefix]-menu-item-hover-bg\": \"#0078d7\",\n\t\t\"--$[prefix]-menu-item-hover-color\": \"#fff\",\n\t\t\"--$[prefix]-shortcut-text-color\": \"#666\",\n\n\t\t// タブ\n\t\t\"--$[prefix]-tab-bg\": \"#dcdcdc\",\n\t\t\"--$[prefix]-tab-active-bg\": \"#f0f0f0\",\n\t\t\"--$[prefix]-tab-border\": \"#b0b0b0\",\n\t\t\"--$[prefix]-tab-bar-bg\": \"#e1e1e1\",\n\t\t\"--$[prefix]-tab-close-btn-hover-bg\": \"#ccc\",\n\t\t\"--$[prefix]-tab-active-close-btn-hover-bg\": \"#ddd\",\n\n\t\t// 検索ハイライト\n\t\t\"--$[prefix]-search-highlight-bg\": \"yellow\",\n\t\t\"--$[prefix]-search-highlight-active-bg\": \"orange\",\n\n\t\t// ポップアップボタン\n\t\t\"--$[prefix]-popup-button-hover-bg\": \"#e9e9e9\",\n\t\t\"--$[prefix]-popup-button-hover-border-color\": \"#bbb\",\n\n\t\t// タスクバー\n\t\t\"--$[prefix]-taskbar-bg\": \"rgba(240, 240, 240, 0.9)\",\n\t\t\"--$[prefix]-taskbar-border\": \"#a0a0a0\",\n\t\t\"--$[prefix]-taskbar-item-bg\": \"#d0d0d0\",\n\t\t\"--$[prefix]-taskbar-item-active-bg\": \"#0078d7\",\n\t\t\"--$[prefix]-taskbar-item-active-color\": \"#fff\",\n\n\t\t/* ローディングインジケーター */\n\t\t\"--$[prefix]-loader-bg\": \"rgba(255, 255, 255, 0.7)\",\n\t\t\"--$[prefix]-loader-color\": \"var(--$[prefix]-title-bar-active-bg)\",\n\n\t\t// その他\n\t\t\"--$[prefix]-scrollbar-thumb-bg\": \"rgba(100, 100, 100, 0.5)\",\n\t},\n};\n","import { Theme } from \"../../const/types\";\n\n/**\n * 高コントラストテーマ\n * @see https://github.com/hi2ma-bu4/winlet/blob/main/src/style/style.ts (prefers-contrast: more)\n */\nexport const highContrastTheme: Theme = {\n\tname: \"high-contrast\",\n\tvariables: {\n\t\t// 基本色・シャドウ\n\t\t\"--$[prefix]-text-color\": \"#fff\",\n\t\t\"--$[prefix]-bg\": \"#000\",\n\t\t\"--$[prefix]-border\": \"#fff\",\n\t\t\"--$[prefix]-shadow-color-light\": \"transparent\",\n\t\t\"--$[prefix]-shadow-color-strong\": \"transparent\",\n\t\t\"--$[prefix]-shadow-color-active\": \"transparent\",\n\n\t\t// タイトルバー\n\t\t\"--$[prefix]-title-bar-bg\": \"#000\",\n\t\t\"--$[prefix]-title-bar-active-bg\": \"#0000ff\",\n\t\t\"--$[prefix]-title-text-color\": \"#fff\",\n\t\t\"--$[prefix]-title-text-active-color\": \"#000\",\n\n\t\t// コントロールボタン\n\t\t\"--$[prefix]-control-bg\": \"#000\",\n\t\t\"--$[prefix]-control-hover-bg\": \"#444\",\n\t\t\"--$[prefix]-control-close-hover-bg\": \"#ff0000\",\n\t\t\"--$[prefix]-control-close-hover-color\": \"#fff\",\n\n\t\t// メニュー\n\t\t\"--$[prefix]-menu-bg\": \"#000\",\n\t\t\"--$[prefix]-menu-border\": \"#fff\",\n\t\t\"--$[prefix]-menu-item-color\": \"#fff\",\n\t\t\"--$[prefix]-menu-item-hover-bg\": \"#0000ff\",\n\t\t\"--$[prefix]-menu-item-hover-color\": \"#fff\",\n\n\t\t// タブ\n\t\t\"--$[prefix]-tab-bg\": \"#000\",\n\t\t\"--$[prefix]-tab-active-bg\": \"#000\",\n\t\t\"--$[prefix]-tab-border\": \"#fff\",\n\n\t\t// タスクバー\n\t\t\"--$[prefix]-taskbar-bg\": \"rgba(0, 0, 0, 0.9)\",\n\t\t\"--$[prefix]-taskbar-border\": \"#fff\",\n\t\t\"--$[prefix]-taskbar-item-bg\": \"#000\",\n\t\t\"--$[prefix]-taskbar-item-active-bg\": \"#0000ff\",\n\t\t\"--$[prefix]-taskbar-item-active-color\": \"#fff\",\n\t},\n};\n","// このファイルは自動生成されます\nexport const LIB_VERSION = \"v1.0.2.7\";\n"],"mappings":"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","ignoreList":[]}