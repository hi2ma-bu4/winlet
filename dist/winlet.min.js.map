{"version":3,"file":"winlet.min.js","names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","module","ReferenceError","__esModule","TypeError","isNativeReflectConstruct","setPrototypeOf","Reflect","construct","apply","arguments","push","bind","prototype","toPropertyKey","_defineProperties","enumerable","configurable","writable","Object","defineProperty","key","value","_getPrototypeOf","getPrototypeOf","__proto__","create","constructor","default","Function","toString","indexOf","_isNativeReflectConstruct","Boolean","valueOf","_typeof","assertThisInitialized","_setPrototypeOf","Symbol","toPrimitive","String","Number","iterator","isNativeFunction","_wrapNativeSuper","Map","has","get","set","Wrapper","this","defaultConfig","id","ifExists","title","icon","x","y","width","height","minWidth","minHeight","resizableX","resizableY","movable","closable","minimizable","maximizable","maximizableOnDblClick","enableShortcuts","controlsPosition","content","html","iframe","src","srcdoc","allow","referrerPolicy","loading","sandbox","template","menu","menuStyle","tabs","tabStyle","tabOptions","reorderable","addable","onAdd","undefined","contextMenu","focus","onOpen","onClose","onFocus","onBlur","onResize","onMove","onReload","WinLetBaseError","_Error","message","_this","_classCallCheck2","_callSuper","name","BuiltInError","captureStackTrace","_inherits2","_createClass2","_wrapNativeSuper2","SimpleError","_WinLetBaseError","WinLetError","_SimpleError","LIBRARY_NAME","_config","_errors","_types","_baseclass","_interopRequireDefault","_utils","_WinLetBaseClass","WinLetWindow","options","manager","_getPrototypeOf2","_possibleConstructorReturn2","_defineProperty2","generateId","existingEl","document","getElementById","classList","contains","concat","deepMerge","el","createDOM","add","titleBarEl","querySelector","iconEl","titleEl","contentEl","applyOptions","setupEventListeners","windowEl","createElement","className","handles","resizableHandlesHTML","join","hasMenu","hasTabs","isMergedMenu","isMergedTabs","controlsHTML","titleBarContentHTML","innerHTML","setTitle","setIcon","setSize","style","createTabs","renderContent","createMenu","container","tagName","appendChild","cloneNode","console","warn","isNonEmptyObject","iframeConfig","Array","isArray","setAttribute","querySelectorAll","forEach","dd","display","isMenuOpen","_this2","menuBar","menuItemData","_menuItemData$name","menuItemEl","textContent","items","dropdownEl","createDropdownMenu","addEventListener","stopPropagation","isVisible","closeAllMenus","_this3","itemData","itemEl","separator","_itemData$name","text","shortcut","_itemData$action","action","subMenuEl","_this$options$tabOpti","_this4","tabBar","tabOpts","tabData","index","createTabElement","addTabBtn","_tabOpts$onAdd","newTabItem","newIndex","activateTab","_this$options$tabOpti2","_this5","tabEl","dataset","tabId","insertBefore","closeBtn","closeTab","tabContentEl","splice","makeTabReorderable","draggable","dataTransfer","setData","remove","preventDefault","draggingEl","rect","getBoundingClientRect","isAfter","clientX","left","parent","parentNode","nextSibling","passive","tab","newActiveIndex","Math","max","toggle","_this6","boundGlobalClickHandler","close","maxBtn","toggleMaximize","minBtn","minimize","makeMovable","makeResizable","showContextMenu","clientY","pointerType","contextMenuTimer","window","setTimeout","MOBILE_CONTEXT_MENU_TIMEOUT","clearContextMenuTimer","clearTimeout","_this7","target","closest","button","initialLeft","initialTop","startX","startY","isDragging","onPointerMove","moveE","deltaX","abs","deltaY","DRAG_THRESHOLD","setPointerCapture","pointerId","pointerEvents","state","restoredWidth","lastState","clickRatio","offsetWidth","titleBarRect","offsetY","top","posX","posY","restore","setPosition","offsetLeft","offsetTop","newLeft","newTop","removeEventListener","releasePointerCapture","_this8","handle","direction","replace","_this8$el","startWidth","startHeight","offsetHeight","startLeft","startTop","_this8$options","newWidth","newHeight","includes","_onPointerUp","classStr","classes","trim","split","hasPrefix","some","test","hasIcon","destroyWindow","blur","maximize","focused","focusWindow","_this9","reloadContent","_iframe$contentWindow","contentWindow","location","reload","activeTabIndex","findIndex","activeTab","tabContentOptions","sanitizeHTML","isFontAwesome","img","alt","finalX","finalY","parentRect","winWidth","winHeight","min","_styles","_window2","_createForOfIteratorHelper","_arrayLikeToArray","slice","from","_unsupportedIterableToArray","_n","F","s","done","next","WindowManager","initialConfig","globalConfig","assign","isInitialized","body","styleTag","getStyleData","head","containerEl","requestAnimationFrame","activeEl","activeElement","winEl","win","windows","activeWindow","active","hideContextMenu","event","data","type","_typeof2","_step","isSourceValid","_iterator","values","source","err","createWindow","origin","setupShortcutListeners","windowSwitchShortcut","parseShortcut","toLowerCase","ctrlKey","ctrl","altKey","shiftKey","shift","currentIndex","w","targetWindow","_findAndExecShortcut","menuItems","_step2","_iterator2","item","_item$action","_shortcut","toUpperCase","init","_options$ifExists","ensureInitialized","existingWindow","getWindow","creationOptions","nextX","nextY","containerRect","lastAutoPosition","CASCADE_OFFSET","zIndex","zIndexCounter","nextWin","pop","_this$activeWindow","contextWindow","contextMenuEl","_this$contextMenuEl","menuWidth","menuHeight","_window","screenWidth","innerWidth","screenHeight","innerHeight","_this$contextMenuEl2","keys","_window_manager","_version","api","getActiveWindow","setDefaultConfig","setGlobalConfig","applyGlobalConfig","version","LIB_VERSION","WinLet","WinLetBaseClass","ownKeys","getOwnPropertySymbols","filter","getOwnPropertyDescriptor","Utils","random","substring","output","getOwnPropertyDescriptors","defineProperties","_objectSpread","hasOwnProperty","sourceValue","targetValue","obj","_","str","temp"],"sources":["node_modules/browser-pack/_prelude.js","node_modules/@babel/runtime/helpers/assertThisInitialized.js","node_modules/@babel/runtime/helpers/classCallCheck.js","node_modules/@babel/runtime/helpers/construct.js","node_modules/@babel/runtime/helpers/createClass.js","node_modules/@babel/runtime/helpers/defineProperty.js","node_modules/@babel/runtime/helpers/getPrototypeOf.js","node_modules/@babel/runtime/helpers/inherits.js","node_modules/@babel/runtime/helpers/interopRequireDefault.js","node_modules/@babel/runtime/helpers/isNativeFunction.js","node_modules/@babel/runtime/helpers/isNativeReflectConstruct.js","node_modules/@babel/runtime/helpers/possibleConstructorReturn.js","node_modules/@babel/runtime/helpers/setPrototypeOf.js","node_modules/@babel/runtime/helpers/toPrimitive.js","node_modules/@babel/runtime/helpers/toPropertyKey.js","node_modules/@babel/runtime/helpers/typeof.js","node_modules/@babel/runtime/helpers/wrapNativeSuper.js","src/const/config.ts","src/const/errors.ts","src/const/types.ts","src/function/window.ts","src/function/window_manager.ts","src/index.ts","src/libs/baseclass.ts","src/libs/utils.ts","src/style/styles.ts","src/version.ts"],"sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","function _assertThisInitialized(e) {\n  if (void 0 === e) throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  return e;\n}\nmodule.exports = _assertThisInitialized, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _classCallCheck(a, n) {\n  if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\");\n}\nmodule.exports = _classCallCheck, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var isNativeReflectConstruct = require(\"./isNativeReflectConstruct.js\");\nvar setPrototypeOf = require(\"./setPrototypeOf.js\");\nfunction _construct(t, e, r) {\n  if (isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments);\n  var o = [null];\n  o.push.apply(o, e);\n  var p = new (t.bind.apply(t, o))();\n  return r && setPrototypeOf(p, r.prototype), p;\n}\nmodule.exports = _construct, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var toPropertyKey = require(\"./toPropertyKey.js\");\nfunction _defineProperties(e, r) {\n  for (var t = 0; t < r.length; t++) {\n    var o = r[t];\n    o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, toPropertyKey(o.key), o);\n  }\n}\nfunction _createClass(e, r, t) {\n  return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", {\n    writable: !1\n  }), e;\n}\nmodule.exports = _createClass, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var toPropertyKey = require(\"./toPropertyKey.js\");\nfunction _defineProperty(e, r, t) {\n  return (r = toPropertyKey(r)) in e ? Object.defineProperty(e, r, {\n    value: t,\n    enumerable: !0,\n    configurable: !0,\n    writable: !0\n  }) : e[r] = t, e;\n}\nmodule.exports = _defineProperty, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _getPrototypeOf(t) {\n  return module.exports = _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) {\n    return t.__proto__ || Object.getPrototypeOf(t);\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports, _getPrototypeOf(t);\n}\nmodule.exports = _getPrototypeOf, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var setPrototypeOf = require(\"./setPrototypeOf.js\");\nfunction _inherits(t, e) {\n  if (\"function\" != typeof e && null !== e) throw new TypeError(\"Super expression must either be null or a function\");\n  t.prototype = Object.create(e && e.prototype, {\n    constructor: {\n      value: t,\n      writable: !0,\n      configurable: !0\n    }\n  }), Object.defineProperty(t, \"prototype\", {\n    writable: !1\n  }), e && setPrototypeOf(t, e);\n}\nmodule.exports = _inherits, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _interopRequireDefault(e) {\n  return e && e.__esModule ? e : {\n    \"default\": e\n  };\n}\nmodule.exports = _interopRequireDefault, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _isNativeFunction(t) {\n  try {\n    return -1 !== Function.toString.call(t).indexOf(\"[native code]\");\n  } catch (n) {\n    return \"function\" == typeof t;\n  }\n}\nmodule.exports = _isNativeFunction, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _isNativeReflectConstruct() {\n  try {\n    var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n  } catch (t) {}\n  return (module.exports = _isNativeReflectConstruct = function _isNativeReflectConstruct() {\n    return !!t;\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports)();\n}\nmodule.exports = _isNativeReflectConstruct, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var _typeof = require(\"./typeof.js\")[\"default\"];\nvar assertThisInitialized = require(\"./assertThisInitialized.js\");\nfunction _possibleConstructorReturn(t, e) {\n  if (e && (\"object\" == _typeof(e) || \"function\" == typeof e)) return e;\n  if (void 0 !== e) throw new TypeError(\"Derived constructors may only return object or undefined\");\n  return assertThisInitialized(t);\n}\nmodule.exports = _possibleConstructorReturn, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _setPrototypeOf(t, e) {\n  return module.exports = _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports, _setPrototypeOf(t, e);\n}\nmodule.exports = _setPrototypeOf, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var _typeof = require(\"./typeof.js\")[\"default\"];\nfunction toPrimitive(t, r) {\n  if (\"object\" != _typeof(t) || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != _typeof(i)) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nmodule.exports = toPrimitive, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var _typeof = require(\"./typeof.js\")[\"default\"];\nvar toPrimitive = require(\"./toPrimitive.js\");\nfunction toPropertyKey(t) {\n  var i = toPrimitive(t, \"string\");\n  return \"symbol\" == _typeof(i) ? i : i + \"\";\n}\nmodule.exports = toPropertyKey, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return module.exports = _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports, _typeof(o);\n}\nmodule.exports = _typeof, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var getPrototypeOf = require(\"./getPrototypeOf.js\");\nvar setPrototypeOf = require(\"./setPrototypeOf.js\");\nvar isNativeFunction = require(\"./isNativeFunction.js\");\nvar construct = require(\"./construct.js\");\nfunction _wrapNativeSuper(t) {\n  var r = \"function\" == typeof Map ? new Map() : void 0;\n  return module.exports = _wrapNativeSuper = function _wrapNativeSuper(t) {\n    if (null === t || !isNativeFunction(t)) return t;\n    if (\"function\" != typeof t) throw new TypeError(\"Super expression must either be null or a function\");\n    if (void 0 !== r) {\n      if (r.has(t)) return r.get(t);\n      r.set(t, Wrapper);\n    }\n    function Wrapper() {\n      return construct(t, arguments, getPrototypeOf(this).constructor);\n    }\n    return Wrapper.prototype = Object.create(t.prototype, {\n      constructor: {\n        value: Wrapper,\n        enumerable: !1,\n        writable: !0,\n        configurable: !0\n      }\n    }), setPrototypeOf(Wrapper, t);\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports, _wrapNativeSuper(t);\n}\nmodule.exports = _wrapNativeSuper, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","import { WindowOptions } from \"./types\";\n\n// Partial<WindowOptions>ではなく、全てのキーを定義して型安全にする\nexport const defaultConfig: Required<WindowOptions> = {\n\tid: null,\n\tifExists: \"focus\",\n\ttitle: \"New Window\",\n\ticon: null,\n\tx: \"auto\",\n\ty: \"auto\",\n\twidth: 500,\n\theight: 400,\n\tminWidth: 200,\n\tminHeight: 150,\n\tresizableX: true,\n\tresizableY: true,\n\tmovable: true,\n\tclosable: true,\n\tminimizable: true,\n\tmaximizable: true,\n\tmaximizableOnDblClick: true,\n\tenableShortcuts: true,\n\tcontrolsPosition: \"right\",\n\tcontent: {\n\t\thtml: \"\",\n\t\tiframe: {\n\t\t\tsrc: \"\",\n\t\t\tsrcdoc: \"\",\n\t\t\tallow: \"\",\n\t\t\treferrerPolicy: \"\",\n\t\t\tloading: \"lazy\",\n\t\t\tsandbox: \"\",\n\t\t},\n\t\ttemplate: \"\",\n\t},\n\tmenu: [],\n\tmenuStyle: \"default\",\n\ttabs: [],\n\ttabStyle: \"default\",\n\ttabOptions: {\n\t\treorderable: false,\n\t\tclosable: false,\n\t\taddable: false,\n\t\tonAdd: undefined,\n\t},\n\tcontextMenu: [],\n\tfocus: true,\n\tonOpen: () => {},\n\tonClose: () => {},\n\tonFocus: () => {},\n\tonBlur: () => {},\n\tonResize: () => {},\n\tonMove: () => {},\n\tonReload: () => {},\n};\n","interface ErrorConstructor {\n\tcaptureStackTrace?(targetObject: object, constructorOpt?: Function): void;\n}\n\n/**\n * すべてのカスタムエラーの基底クラス\n */\nexport class WinLetBaseError extends Error {\n\tconstructor(message: string) {\n\t\tsuper(message);\n\t\tthis.name = this.constructor.name;\n\n\t\tconst BuiltInError: ErrorConstructor = Error as ErrorConstructor;\n\t\tif (BuiltInError.captureStackTrace) {\n\t\t\tBuiltInError.captureStackTrace(this, this.constructor);\n\t\t}\n\t}\n}\n\n/**\n * 単純なメッセージのみのエラー\n */\nexport class SimpleError extends WinLetBaseError {\n\tconstructor(message: string) {\n\t\tsuper(message);\n\t}\n}\n\nexport class WinLetError extends SimpleError {}\n","export const LIBRARY_NAME = \"winlet\";\n\nexport type WindowState = \"normal\" | \"minimized\" | \"maximized\";\n\nexport interface WindowContentOptions {\n\t/**\n\t * 直接埋め込むHTML\n\t */\n\thtml?: string;\n\t/**\n\t * iframe設定\n\t */\n\tiframe?: {\n\t\tsrc?: HTMLIFrameElement[\"src\"];\n\t\tsrcdoc?: HTMLIFrameElement[\"srcdoc\"];\n\t\tallow?: HTMLIFrameElement[\"allow\"];\n\t\treferrerPolicy?: HTMLIFrameElement[\"referrerPolicy\"];\n\t\tloading?: HTMLIFrameElement[\"loading\"];\n\t\tsandbox?: string[] | string;\n\t};\n\t/**\n\t * HTMLテンプレートのselector\n\t */\n\ttemplate?: string;\n}\n\n// IWindowインターフェースを先に定義することで循環参照を回避\nexport interface IWindow {\n\treadonly id: string;\n\toptions: Required<WindowOptions>;\n\tel: HTMLElement;\n\tstate: WindowState;\n\n\t// --- Public API ---\n\tclose(): void;\n\tminimize(): void;\n\ttoggleMaximize(): void;\n\tmaximize(): void;\n\trestore(): void;\n\tfocus(): void;\n\tblur(): void;\n\tgetTitle(): string;\n\tsetTitle(title: string): void;\n\tsetIcon(icon: string | null): void;\n\tgetPosition(): { x: number; y: number };\n\tsetPosition(x: number | \"center\" | \"left\" | \"right\" | \"auto\", y: number | \"center\" | \"top\" | \"bottom\" | \"auto\"): void;\n\tgetSize(): { width: number; height: number };\n\tsetSize(width: number | string, height: number | string): void;\n\treload(): void;\n}\n\nexport interface MenuItem {\n\tname?: string;\n\taction?: (win: IWindow) => void;\n\titems?: MenuItem[];\n\tseparator?: boolean;\n\tshortcut?: string;\n}\n\nexport interface TabItem {\n\ttitle: string;\n\tcontent: WindowContentOptions;\n}\n\nexport interface ContextMenuItem {\n\tname?: string;\n\taction?: (win: IWindow) => void;\n\tseparator?: boolean;\n}\n\nexport interface WindowOptions {\n\t/**\n\t * ウィンドウのID\n\t */\n\tid?: string | null;\n\t/**\n\t * 既に同名のウィンドウが存在する場合の動作\n\t *\n\t * focus (デフォルト): 既存のウィンドウを復元し、フォーカスします。\n\t * prevent: 新しいウィンドウを作成せず、処理を中断します。\n\t * create: IDの重複を無視して、常に新しいウィンドウを作成します。\n\t */\n\tifExists?: \"focus\" | \"prevent\" | \"create\";\n\t/**\n\t * ウィンドウのタイトル\n\t */\n\ttitle?: string;\n\t/**\n\t * ウィンドウのアイコン\n\t *\n\t * url / font-awesomeのクラス名の指定可能\n\t */\n\ticon?: string | null;\n\t/**\n\t * ウィンドウのX座標\n\t */\n\tx?: number | \"center\" | \"left\" | \"right\" | \"auto\";\n\t/**\n\t * ウィンドウのY座標\n\t */\n\ty?: number | \"center\" | \"top\" | \"bottom\" | \"auto\";\n\t/**\n\t * ウィンドウのサイズX\n\t */\n\twidth?: number;\n\t/**\n\t * ウィンドウのサイズY\n\t */\n\theight?: number;\n\t/**\n\t * ウィンドウの最小サイズX\n\t */\n\tminWidth?: number;\n\t/**\n\t * ウィンドウの最小サイズY\n\t */\n\tminHeight?: number;\n\t/**\n\t * 水平方向のリサイズ\n\t */\n\tresizableX?: boolean;\n\t/**\n\t * 垂直方向のリサイズ\n\t */\n\tresizableY?: boolean;\n\t/**\n\t * ウィンドウの移動\n\t */\n\tmovable?: boolean;\n\t/**\n\t * ウィンドウを閉じるボタンの表示\n\t */\n\tclosable?: boolean;\n\t/**\n\t * ウィンドウを最小化するボタンの表示\n\t */\n\tminimizable?: boolean;\n\t/**\n\t * ウィンドウを最大化するボタンの表示\n\t */\n\tmaximizable?: boolean;\n\t/**\n\t * タイトルバーのダブルクリックで最大化\n\t */\n\tmaximizableOnDblClick?: boolean;\n\t/**\n\t * ショートカットキーを有効化\n\t */\n\tenableShortcuts?: boolean;\n\t/**\n\t * コントロールの位置\n\t */\n\tcontrolsPosition?: \"left\" | \"right\";\n\t/**\n\t * ウィンドウのコンテンツ\n\t */\n\tcontent?: WindowContentOptions;\n\t/**\n\t * メニュー\n\t */\n\tmenu?: MenuItem[];\n\t/**\n\t * メニューの表示形式\n\t * - default: 通常のメニューバー\n\t * - merged: タイトルバーに統合\n\t */\n\tmenuStyle?: \"default\" | \"merged\";\n\t/**\n\t * タブ\n\t */\n\ttabs?: TabItem[];\n\t/**\n\t * タブの表示形式\n\t * - default: 通常のタブバー\n\t * - merged: タイトルバーに統合されたChrome風タブ\n\t */\n\ttabStyle?: \"default\" | \"merged\";\n\ttabOptions?: {\n\t\t/**\n\t\t * タブの入れ替え\n\t\t */\n\t\treorderable?: boolean;\n\t\t/**\n\t\t * タブを閉じるボタン\n\t\t */\n\t\tclosable?: boolean;\n\t\t/**\n\t\t * タブ追加ボタン\n\t\t */\n\t\taddable?: boolean;\n\t\t/**\n\t\t * 追加ボタン押下時の処理\n\t\t */\n\t\tonAdd?: (win: IWindow) => TabItem;\n\t};\n\t/**\n\t * 右クリックメニュー\n\t */\n\tcontextMenu?: ContextMenuItem[];\n\t/**\n\t * 作成時にウィンドウにフォーカスを当てるか\n\t */\n\tfocus?: boolean;\n\t/**\n\t * ウィンドウオープン時\n\t */\n\tonOpen?: (win: IWindow) => void;\n\t/**\n\t * ウィンドウクローズ時\n\t */\n\tonClose?: (win: IWindow) => void;\n\t/**\n\t * ウィンドウフォーカス時\n\t */\n\tonFocus?: (win: IWindow) => void;\n\t/**\n\t * ウィンドウブラー時\n\t */\n\tonBlur?: (win: IWindow) => void;\n\t/**\n\t * ウィンドウリサイズ時\n\t */\n\tonResize?: (win: IWindow) => void;\n\t/**\n\t * ウィンドウ移動時\n\t */\n\tonMove?: (win: IWindow) => void;\n\t/**\n\t * ウィンドウリロード時\n\t *\n\t * デフォルトのリロード動作（iframeの再読み込みやhtmlの再描画）をキャンセルする場合は `false` を返します。\n\t */\n\tonReload?: (win: IWindow) => boolean | void;\n}\n\nexport interface GlobalConfigOptions {\n\twindowSwitchShortcut?: string | null; // 例: \"Ctrl+`\"\n}\n\n// WinLetの公開APIの型\nexport interface WinLetApi {\n\tinit: () => void;\n\tcreateWindow: (options?: WindowOptions) => IWindow;\n\tgetWindow: (id: string) => IWindow | undefined;\n\tgetActiveWindow: () => IWindow | null;\n\tsetDefaultConfig: (options: WindowOptions) => void;\n\tsetGlobalConfig: (options: GlobalConfigOptions) => void;\n\tget version(): string;\n}\n\n// グローバルスコープのWindowにWinLetプロパティを追加\ndeclare global {\n\tinterface Window {\n\t\tWinLet: WinLetApi;\n\t}\n}\n","import { defaultConfig } from \"../const/config\";\nimport { WinLetError } from \"../const/errors\";\nimport { IWindow, LIBRARY_NAME, MenuItem, TabItem, WindowContentOptions, WindowOptions, WindowState } from \"../const/types\";\nimport WinLetBaseClass from \"../libs/baseclass\";\nimport Utils from \"../libs/utils\";\nimport WindowManager from \"./window_manager\";\n\nexport default class WinLetWindow extends WinLetBaseClass implements IWindow {\n\tpublic readonly id: string;\n\tpublic options: Required<WindowOptions>;\n\tpublic el: HTMLElement;\n\tpublic state: WindowState = \"normal\";\n\n\tprivate manager: WindowManager;\n\tprivate lastState = { x: 0, y: 0, width: 0, height: 0 };\n\tprivate focused: boolean = false;\n\tprivate readonly DRAG_THRESHOLD = 5;\n\n\tprivate titleBarEl: HTMLElement;\n\tprivate iconEl: HTMLElement;\n\tprivate titleEl: HTMLElement;\n\tprivate contentEl: HTMLElement;\n\tprivate tabs: { tabEl: HTMLElement; contentEl: HTMLElement }[] = [];\n\tprivate addTabBtn: HTMLElement | null = null;\n\tprivate isMenuOpen = false;\n\tprivate boundGlobalClickHandler: ((event: MouseEvent) => void) | null = null;\n\n\t// モバイル対応\n\tprivate readonly MOBILE_CONTEXT_MENU_TIMEOUT = 700;\n\tprivate contextMenuTimer: number | null = null;\n\n\tconstructor(options: WindowOptions, manager: WindowManager) {\n\t\tsuper();\n\t\tthis.id = options.id || Utils.generateId(\"window\");\n\t\tif (options.id) {\n\t\t\tconst existingEl = document.getElementById(options.id);\n\t\t\tif (existingEl && existingEl.classList.contains(`${LIBRARY_NAME}-window`)) {\n\t\t\t\tthrow new WinLetError(`WinLet: Window with ID \"${options.id}\" already exists. New window will not be created.`);\n\t\t\t}\n\t\t}\n\t\tthis.manager = manager;\n\t\tthis.options = Utils.deepMerge(defaultConfig, options) as Required<WindowOptions>;\n\n\t\tthis.el = this.createDOM();\n\n\t\t// tabStyleとmenuStyleによってクラスを追加\n\t\tif (this.options.tabStyle === \"merged\") {\n\t\t\tthis.el.classList.add(`${LIBRARY_NAME}-tab-style-merged`);\n\t\t}\n\t\tif (this.options.menuStyle === \"merged\") {\n\t\t\tthis.el.classList.add(`${LIBRARY_NAME}-menu-style-merged`);\n\t\t}\n\n\t\tthis.titleBarEl = this.el.querySelector<HTMLElement>(`.${LIBRARY_NAME}-title-bar`)!;\n\t\tthis.iconEl = this.el.querySelector<HTMLElement>(`.${LIBRARY_NAME}-icon`)!;\n\t\tthis.titleEl = this.el.querySelector<HTMLElement>(`.${LIBRARY_NAME}-title`)!;\n\t\tthis.contentEl = this.el.querySelector<HTMLElement>(`.${LIBRARY_NAME}-content`)!;\n\n\t\tthis.applyOptions();\n\t\tthis.setupEventListeners();\n\n\t\tthis.options.onOpen(this);\n\t}\n\n\tprivate createDOM(): HTMLElement {\n\t\tconst windowEl = document.createElement(\"div\");\n\t\twindowEl.className = `${LIBRARY_NAME}-window`;\n\t\twindowEl.id = this.id;\n\n\t\tconst handles: string[] = [];\n\t\tif (this.options.resizableY) {\n\t\t\thandles.push(`<div class=\"${LIBRARY_NAME}-resize-handle n\"></div>`, `<div class=\"${LIBRARY_NAME}-resize-handle s\"></div>`);\n\t\t}\n\t\tif (this.options.resizableX) {\n\t\t\thandles.push(`<div class=\"${LIBRARY_NAME}-resize-handle w\"></div>`, `<div class=\"${LIBRARY_NAME}-resize-handle e\"></div>`);\n\t\t}\n\t\tif (this.options.resizableX && this.options.resizableY) {\n\t\t\thandles.push(`<div class=\"${LIBRARY_NAME}-resize-handle nw\"></div>`, `<div class=\"${LIBRARY_NAME}-resize-handle ne\"></div>`, `<div class=\"${LIBRARY_NAME}-resize-handle sw\"></div>`, `<div class=\"${LIBRARY_NAME}-resize-handle se\"></div>`);\n\t\t}\n\t\tconst resizableHandlesHTML = handles.join(\"\");\n\n\t\tconst hasMenu = this.options.menu.length > 0;\n\t\tconst hasTabs = this.options.tabs.length > 0;\n\t\tconst isMergedMenu = this.options.menuStyle === \"merged\" && hasMenu;\n\t\tconst isMergedTabs = this.options.tabStyle === \"merged\" && hasTabs;\n\n\t\tconst controlsHTML = `\n            <div class=\"${LIBRARY_NAME}-controls\">\n                ${this.options.minimizable ? `<input class=\"${LIBRARY_NAME}-control-btn ${LIBRARY_NAME}-minimize-btn\" type=\"button\" value=\"\\uff3f\" title=\"Minimize\" />` : \"\"}\n                ${this.options.maximizable ? `<input class=\"${LIBRARY_NAME}-control-btn ${LIBRARY_NAME}-maximize-btn\" type=\"button\" value=\"\\u25a1\" title=\"Maximize\" />` : \"\"}\n                ${this.options.closable ? `<input class=\"${LIBRARY_NAME}-control-btn ${LIBRARY_NAME}-close-btn\" type=\"button\" value=\"\\u2573\" title=\"Close\">` : \"\"}\n            </div>`;\n\n\t\tconst titleBarContentHTML = `\n            <div class=\"${LIBRARY_NAME}-icon\"></div>\n            ${isMergedMenu ? `<div class=\"${LIBRARY_NAME}-menu-bar\"></div>` : \"\"}\n            <div class=\"${LIBRARY_NAME}-title\"></div>\n            ${isMergedTabs ? `<div class=\"${LIBRARY_NAME}-tab-bar\"></div>` : \"\"}\n            ${controlsHTML}\n        `;\n\n\t\twindowEl.innerHTML = `\n            <div class=\"${LIBRARY_NAME}-title-bar ${LIBRARY_NAME}-us-none\">\n                ${titleBarContentHTML}\n            </div>\n            <div class=\"${LIBRARY_NAME}-main-content\">\n                ${!isMergedMenu && hasMenu ? `<div class=\"${LIBRARY_NAME}-menu-bar\"></div>` : \"\"}\n                ${!isMergedTabs && hasTabs ? `<div class=\"${LIBRARY_NAME}-tab-bar\"></div>` : \"\"}\n                <div class=\"${LIBRARY_NAME}-content\"></div>\n            </div>\n            ${resizableHandlesHTML}\n        `;\n\t\treturn windowEl;\n\t}\n\n\tprivate applyOptions(): void {\n\t\tthis.setTitle(this.options.title);\n\t\tthis.setIcon(this.options.icon);\n\t\tthis.setSize(this.options.width, this.options.height);\n\t\tthis.el.style.minWidth = `${this.options.minWidth}px`;\n\t\tthis.el.style.minHeight = `${this.options.minHeight}px`;\n\n\t\tif (this.options.controlsPosition === \"left\") {\n\t\t\tthis.titleBarEl.classList.add(\"controls-left\");\n\t\t}\n\n\t\tif (this.options.tabs.length > 0) {\n\t\t\tthis.createTabs();\n\t\t} else {\n\t\t\tthis.renderContent(this.contentEl, this.options.content);\n\t\t}\n\n\t\tif (this.options.menu.length > 0) {\n\t\t\tthis.createMenu();\n\t\t}\n\t}\n\n\tprivate renderContent(container: HTMLElement, content: WindowContentOptions): void {\n\t\tcontainer.innerHTML = \"\";\n\t\tif (content.template) {\n\t\t\tconst template = document.querySelector<HTMLTemplateElement>(content.template);\n\t\t\tif (template?.tagName === \"TEMPLATE\") {\n\t\t\t\tcontainer.appendChild(template.content.cloneNode(true));\n\t\t\t} else {\n\t\t\t\tcontainer.innerHTML = \"Error: Template not found or invalid.\";\n\t\t\t\tconsole.warn(\"WinLet Warning: Template not found or invalid.\");\n\t\t\t}\n\t\t} else if (content.html) {\n\t\t\tcontainer.innerHTML = content.html;\n\t\t} else if (Utils.isNonEmptyObject(content.iframe)) {\n\t\t\tconst iframe = document.createElement(\"iframe\");\n\t\t\tconst iframeConfig = content.iframe;\n\t\t\tif (iframeConfig.src) {\n\t\t\t\tiframe.src = iframeConfig.src;\n\t\t\t}\n\t\t\tif (iframeConfig.srcdoc) {\n\t\t\t\tiframe.srcdoc = iframeConfig.srcdoc;\n\t\t\t}\n\t\t\tif (iframeConfig.allow) {\n\t\t\t\tiframe.allow = iframeConfig.allow;\n\t\t\t}\n\t\t\tif (iframeConfig.referrerPolicy) {\n\t\t\t\tiframe.referrerPolicy = iframeConfig.referrerPolicy;\n\t\t\t}\n\t\t\tif (iframeConfig.loading) {\n\t\t\t\tiframe.loading = iframeConfig.loading;\n\t\t\t}\n\t\t\tif (iframeConfig.sandbox) {\n\t\t\t\tif (!Array.isArray(iframeConfig.sandbox)) {\n\t\t\t\t\tiframeConfig.sandbox = [iframeConfig.sandbox];\n\t\t\t\t}\n\t\t\t\tif (iframeConfig.sandbox.length > 0) {\n\t\t\t\t\tiframe.setAttribute(\"sandbox\", iframeConfig.sandbox.join(\" \"));\n\t\t\t\t}\n\t\t\t}\n\t\t\tcontainer.appendChild(iframe);\n\t\t}\n\t}\n\n\tprivate closeAllMenus(): void {\n\t\tthis.el.querySelectorAll<HTMLElement>(`.${LIBRARY_NAME}-menu-item > .${LIBRARY_NAME}-menu-dropdown`).forEach((dd) => {\n\t\t\tdd.style.display = \"none\";\n\t\t});\n\t\tthis.isMenuOpen = false;\n\t}\n\n\tprivate createMenu(): void {\n\t\tconst menuBar = this.el.querySelector<HTMLElement>(`.${LIBRARY_NAME}-menu-bar`)!;\n\t\tmenuBar.innerHTML = \"\";\n\n\t\tthis.options.menu.forEach((menuItemData) => {\n\t\t\tconst menuItemEl = document.createElement(\"div\");\n\t\t\tmenuItemEl.className = `${LIBRARY_NAME}-menu-item ${LIBRARY_NAME}-us-none`;\n\t\t\tmenuItemEl.textContent = menuItemData.name ?? \"\";\n\n\t\t\tif (menuItemData.items) {\n\t\t\t\tconst dropdownEl = this.createDropdownMenu(menuItemData.items);\n\n\t\t\t\tmenuItemEl.addEventListener(\"click\", (e) => {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tconst isVisible = dropdownEl.style.display === \"block\";\n\t\t\t\t\tthis.closeAllMenus();\n\t\t\t\t\tif (!isVisible) {\n\t\t\t\t\t\tdropdownEl.style.display = \"block\";\n\t\t\t\t\t\tthis.isMenuOpen = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tmenuItemEl.addEventListener(\"mouseenter\", () => {\n\t\t\t\t\tif (this.isMenuOpen) {\n\t\t\t\t\t\tthis.closeAllMenus();\n\t\t\t\t\t\tdropdownEl.style.display = \"block\";\n\t\t\t\t\t\tthis.isMenuOpen = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tmenuItemEl.appendChild(dropdownEl);\n\t\t\t}\n\t\t\tmenuBar.appendChild(menuItemEl);\n\t\t});\n\t}\n\n\tprivate createDropdownMenu(items: MenuItem[]): HTMLUListElement {\n\t\tconst dropdownEl = document.createElement(\"ul\");\n\t\tdropdownEl.className = `${LIBRARY_NAME}-menu-dropdown`;\n\n\t\titems.forEach((itemData) => {\n\t\t\tconst itemEl = document.createElement(\"li\");\n\t\t\tif (itemData.separator) {\n\t\t\t\titemEl.className = \"separator\";\n\t\t\t} else {\n\t\t\t\tlet text = itemData.name ?? \"\";\n\t\t\t\ttext = `<span>${text}</span>`;\n\t\t\t\tif (this.options.enableShortcuts && itemData.shortcut) {\n\t\t\t\t\ttext += `<span class=\"${LIBRARY_NAME}-shortcut-text\">(${itemData.shortcut})</span>`;\n\t\t\t\t}\n\t\t\t\titemEl.innerHTML = `<div class=\"${LIBRARY_NAME}-menu-dropdown-item\">${text}</div>`;\n\t\t\t\titemEl.addEventListener(\"click\", (e) => {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tthis.closeAllMenus();\n\t\t\t\t\titemData.action?.(this);\n\t\t\t\t});\n\t\t\t\tif (itemData.items) {\n\t\t\t\t\titemEl.classList.add(\"has-submenu\"); // スタイル付けのためのクラス\n\t\t\t\t\tconst subMenuEl = this.createDropdownMenu(itemData.items);\n\t\t\t\t\titemEl.appendChild(subMenuEl);\n\t\t\t\t}\n\t\t\t}\n\t\t\tdropdownEl.appendChild(itemEl);\n\t\t});\n\t\treturn dropdownEl;\n\t}\n\n\tprivate createTabs(): void {\n\t\tconst tabBar = this.el.querySelector<HTMLElement>(`.${LIBRARY_NAME}-tab-bar`)!;\n\t\ttabBar.innerHTML = \"\";\n\t\tthis.tabs = [];\n\t\tconst tabOpts = this.options.tabOptions ?? {};\n\n\t\tthis.options.tabs.forEach((tabData, index) => {\n\t\t\tthis.createTabElement(tabData, index);\n\t\t});\n\n\t\tif (tabOpts.addable) {\n\t\t\tthis.addTabBtn = document.createElement(\"div\");\n\t\t\tthis.addTabBtn.className = `${LIBRARY_NAME}-tab-add-btn`;\n\t\t\tthis.addTabBtn.textContent = \"+\";\n\t\t\tthis.addTabBtn.addEventListener(\"click\", (e) => {\n\t\t\t\tconst newTabItem = tabOpts.onAdd?.(this);\n\t\t\t\tif (newTabItem) {\n\t\t\t\t\tthis.options.tabs.push(newTabItem);\n\t\t\t\t\tconst newIndex = this.options.tabs.length - 1;\n\t\t\t\t\tthis.createTabElement(newTabItem, newIndex);\n\t\t\t\t\tthis.activateTab(newIndex);\n\t\t\t\t}\n\t\t\t});\n\t\t\ttabBar.appendChild(this.addTabBtn);\n\t\t}\n\n\t\tif (this.tabs.length > 0) this.activateTab(0);\n\t}\n\n\tprivate createTabElement(tabData: TabItem, index: number): void {\n\t\tconst tabBar = this.el.querySelector<HTMLElement>(`.${LIBRARY_NAME}-tab-bar`)!;\n\t\tconst tabOpts = this.options.tabOptions ?? {};\n\n\t\tconst tabEl = document.createElement(\"div\");\n\t\ttabEl.className = `${LIBRARY_NAME}-tab`;\n\t\ttabEl.dataset.tabId = index.toString(); // IDを紐付け\n\n\t\tconst titleEl = document.createElement(\"span\");\n\t\ttitleEl.textContent = tabData.title;\n\t\ttabEl.appendChild(titleEl);\n\n\t\t// +ボタンが存在すればその前に、なければ末尾に追加\n\t\ttabBar.insertBefore(tabEl, this.addTabBtn);\n\n\t\tif (tabOpts.closable) {\n\t\t\tconst closeBtn = document.createElement(\"span\");\n\t\t\tcloseBtn.className = `${LIBRARY_NAME}-tab-close-btn`;\n\t\t\tcloseBtn.innerHTML = \"&times;\";\n\t\t\tcloseBtn.addEventListener(\"click\", (e) => {\n\t\t\t\te.stopPropagation();\n\t\t\t\tthis.closeTab(index);\n\t\t\t});\n\t\t\ttabEl.appendChild(closeBtn);\n\t\t}\n\n\t\t// タブコンテント生成ロジック\n\t\tconst tabContentEl = document.createElement(\"div\");\n\t\ttabContentEl.className = `${LIBRARY_NAME}-tab-content`;\n\t\tthis.contentEl.appendChild(tabContentEl);\n\t\tthis.renderContent(tabContentEl, tabData.content);\n\n\t\ttabEl.addEventListener(\"click\", (e) => {\n\t\t\tthis.activateTab(+tabEl.dataset.tabId!);\n\t\t});\n\t\tthis.tabs.splice(index, 0, { tabEl, contentEl: tabContentEl }); // 指定位置に挿入\n\n\t\tif (tabOpts.reorderable) {\n\t\t\tthis.makeTabReorderable(tabEl);\n\t\t}\n\t}\n\n\tprivate makeTabReorderable(tabEl: HTMLElement) {\n\t\ttabEl.draggable = true;\n\t\ttabEl.addEventListener(\"dragstart\", (e) => {\n\t\t\te.dataTransfer!.setData(\"text/plain\", tabEl.dataset.tabId!);\n\t\t\ttabEl.classList.add(\"dragging\");\n\t\t});\n\t\ttabEl.addEventListener(\"dragend\", () => tabEl.classList.remove(\"dragging\"));\n\n\t\ttabEl.addEventListener(\n\t\t\t\"dragover\",\n\t\t\t(e) => {\n\t\t\t\te.preventDefault();\n\t\t\t\tconst draggingEl = document.querySelector<HTMLElement>(`.${LIBRARY_NAME}-tab.dragging`);\n\t\t\t\tif (draggingEl && draggingEl !== tabEl) {\n\t\t\t\t\tconst rect = tabEl.getBoundingClientRect();\n\t\t\t\t\t// カーソルの位置によって挿入位置を左右に決める\n\t\t\t\t\tconst isAfter = e.clientX > rect.left + rect.width / 2;\n\t\t\t\t\tconst parent = tabEl.parentNode!;\n\t\t\t\t\tif (isAfter) {\n\t\t\t\t\t\tparent.insertBefore(draggingEl, tabEl.nextSibling);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tparent.insertBefore(draggingEl, tabEl);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t{ passive: false }\n\t\t);\n\n\t\ttabEl.addEventListener(\n\t\t\t\"drop\",\n\t\t\t(e) => {\n\t\t\t\te.preventDefault();\n\t\t\t},\n\t\t\t{ passive: false }\n\t\t);\n\t}\n\n\t// タブを閉じるロジック\n\tprivate closeTab(index: number) {\n\t\t// DOMから要素を削除\n\t\tthis.tabs[index].tabEl.remove();\n\t\tthis.tabs[index].contentEl.remove();\n\t\t// 配列から削除\n\t\tthis.tabs.splice(index, 1);\n\t\tthis.options.tabs.splice(index, 1);\n\n\t\t// IDの再割り当て\n\t\tthis.tabs.forEach((tab, i) => (tab.tabEl.dataset.tabId = i.toString()));\n\n\t\t// アクティブなタブを再設定\n\t\tif (this.tabs.length > 0) {\n\t\t\tconst newActiveIndex = Math.max(0, index - 1);\n\t\t\tthis.activateTab(newActiveIndex);\n\t\t}\n\t}\n\n\tprivate activateTab(index: number): void {\n\t\tthis.tabs.forEach((tab, i) => {\n\t\t\ttab.tabEl.classList.toggle(\"active\", i === index);\n\t\t\ttab.contentEl.classList.toggle(\"active\", i === index);\n\t\t});\n\t}\n\n\tprivate setupEventListeners(): void {\n\t\tthis.el.addEventListener(\"click\", () => this.focus(), true);\n\n\t\t// iframeなどにフォーカスが移った際にウィンドウ自体をアクティブにする\n\t\tthis.el.addEventListener(\"focusin\", () => this.focus());\n\n\t\t// Add a global click listener to close menus when clicking outside\n\t\tthis.boundGlobalClickHandler = () => {\n\t\t\tif (this.isMenuOpen) {\n\t\t\t\tthis.closeAllMenus();\n\t\t\t}\n\t\t};\n\t\tdocument.addEventListener(\"click\", this.boundGlobalClickHandler);\n\n\t\tconst closeBtn = this.el.querySelector<HTMLButtonElement>(`.${LIBRARY_NAME}-close-btn`);\n\t\tcloseBtn?.addEventListener(\"click\", (e) => {\n\t\t\te.stopPropagation();\n\t\t\tthis.close();\n\t\t});\n\n\t\tconst maxBtn = this.el.querySelector<HTMLButtonElement>(`.${LIBRARY_NAME}-maximize-btn`);\n\t\tmaxBtn?.addEventListener(\"click\", (e) => {\n\t\t\te.stopPropagation();\n\t\t\tthis.toggleMaximize();\n\t\t});\n\n\t\tconst minBtn = this.el.querySelector<HTMLButtonElement>(`.${LIBRARY_NAME}-minimize-btn`);\n\t\tminBtn?.addEventListener(\"click\", (e) => {\n\t\t\te.stopPropagation();\n\t\t\tthis.minimize();\n\t\t});\n\n\t\tif (this.options.movable) this.makeMovable();\n\t\tif (this.options.resizableX || this.options.resizableY) this.makeResizable();\n\t\tif (this.options.contextMenu.length > 0) {\n\t\t\t// PC用: 右クリック\n\t\t\tthis.el.addEventListener(\n\t\t\t\t\"contextmenu\",\n\t\t\t\t(e) => {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.manager.showContextMenu(e.clientX, e.clientY, this.options.contextMenu, this);\n\t\t\t\t},\n\t\t\t\t{ passive: false }\n\t\t\t);\n\t\t\t// モバイル用: 長押し\n\t\t\tthis.el.addEventListener(\"pointerdown\", (e) => {\n\t\t\t\tif (e.pointerType !== \"touch\") return;\n\t\t\t\tthis.contextMenuTimer = window.setTimeout(() => {\n\t\t\t\t\tthis.contextMenuTimer = null;\n\t\t\t\t\tthis.manager.showContextMenu(e.clientX, e.clientY, this.options.contextMenu, this);\n\t\t\t\t}, this.MOBILE_CONTEXT_MENU_TIMEOUT);\n\t\t\t});\n\t\t\tconst clearContextMenuTimer = () => {\n\t\t\t\tif (this.contextMenuTimer) {\n\t\t\t\t\tclearTimeout(this.contextMenuTimer);\n\t\t\t\t\tthis.contextMenuTimer = null;\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.el.addEventListener(\"pointermove\", clearContextMenuTimer);\n\t\t\tthis.el.addEventListener(\"pointerup\", clearContextMenuTimer);\n\t\t\tthis.el.addEventListener(\"pointercancel\", clearContextMenuTimer);\n\t\t}\n\t}\n\n\tprivate makeMovable(): void {\n\t\tconst onPointerDown = (e: PointerEvent) => {\n\t\t\tconst target = e.target as HTMLElement;\n\t\t\t// 操作UI要素の上なら移動させない\n\t\t\tif (target.closest(`.${LIBRARY_NAME}-control-btn, .${LIBRARY_NAME}-resize-handle, .${LIBRARY_NAME}-menu-item, .${LIBRARY_NAME}-tab, .${LIBRARY_NAME}-tab-add-btn`)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// メインボタン（マウスの左ボタン、タッチ）でのみ移動\n\t\t\tif (e.button !== 0) return;\n\n\t\t\te.preventDefault();\n\t\t\tthis.focus();\n\n\t\t\tconst { clientX: startX, clientY: startY } = e;\n\t\t\tlet isDragging = false;\n\n\t\t\t// ドラッグ開始時のウィンドウ座標。isDraggingがtrueになったときに設定される。\n\t\t\tlet initialLeft: number;\n\t\t\tlet initialTop: number;\n\n\t\t\tconst onPointerMove = (moveE: PointerEvent) => {\n\t\t\t\tif (!isDragging) {\n\t\t\t\t\tconst deltaX = Math.abs(moveE.clientX - startX);\n\t\t\t\t\tconst deltaY = Math.abs(moveE.clientY - startY);\n\n\t\t\t\t\t// 閾値を超えたらドラッグモードを開始\n\t\t\t\t\tif (deltaX > this.DRAG_THRESHOLD || deltaY > this.DRAG_THRESHOLD) {\n\t\t\t\t\t\tisDragging = true;\n\t\t\t\t\t\tthis.el.setPointerCapture(e.pointerId);\n\t\t\t\t\t\tthis.contentEl.style.pointerEvents = \"none\";\n\n\t\t\t\t\t\t// 最大化状態からのドラッグ開始の場合、ウィンドウを復元\n\t\t\t\t\t\tif (this.state === \"maximized\") {\n\t\t\t\t\t\t\tconst restoredWidth = this.lastState.width;\n\t\t\t\t\t\t\tconst clickRatio = e.clientX / this.el.offsetWidth;\n\t\t\t\t\t\t\tconst titleBarRect = this.titleBarEl.getBoundingClientRect();\n\t\t\t\t\t\t\tconst offsetY = e.clientY - titleBarRect.top;\n\t\t\t\t\t\t\tconst posX = e.clientX - restoredWidth * clickRatio;\n\t\t\t\t\t\t\tconst posY = e.clientY - offsetY;\n\n\t\t\t\t\t\t\tthis.restore();\n\t\t\t\t\t\t\tthis.setPosition(posX, posY);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// ドラッグ開始時点の座標を記録\n\t\t\t\t\t\tinitialLeft = this.el.offsetLeft;\n\t\t\t\t\t\tinitialTop = this.el.offsetTop;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// 閾値に達していなければ何もしない\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// ドラッグ中の移動処理\n\t\t\t\tconst newLeft = initialLeft + moveE.clientX - startX;\n\t\t\t\tconst newTop = initialTop + moveE.clientY - startY;\n\t\t\t\tthis.setPosition(newLeft, newTop);\n\t\t\t};\n\n\t\t\tconst onPointerUp = () => {\n\t\t\t\tdocument.removeEventListener(\"pointermove\", onPointerMove);\n\t\t\t\tdocument.removeEventListener(\"pointerup\", onPointerMove);\n\n\t\t\t\t// ドラッグが発生した場合のみ後処理とコールバック呼び出し\n\t\t\t\tif (isDragging) {\n\t\t\t\t\tthis.el.releasePointerCapture(e.pointerId);\n\t\t\t\t\tthis.contentEl.style.pointerEvents = \"auto\";\n\t\t\t\t\tthis.options.onMove(this);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tdocument.addEventListener(\"pointermove\", onPointerMove);\n\t\t\tdocument.addEventListener(\"pointerup\", onPointerUp);\n\t\t};\n\n\t\tthis.titleBarEl.addEventListener(\"pointerdown\", onPointerDown, { passive: false });\n\n\t\tif (this.options.maximizable) {\n\t\t\tthis.titleBarEl.addEventListener(\"dblclick\", (e: MouseEvent) => {\n\t\t\t\tif (this.options.maximizableOnDblClick) {\n\t\t\t\t\tif ((e.target as HTMLElement).closest(`.${LIBRARY_NAME}-control-btn`)) return;\n\t\t\t\t\tthis.toggleMaximize();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate makeResizable(): void {\n\t\tthis.el.querySelectorAll<HTMLElement>(`.${LIBRARY_NAME}-resize-handle`).forEach((handle) => {\n\t\t\thandle.addEventListener(\n\t\t\t\t\"pointerdown\",\n\t\t\t\t(e: PointerEvent) => {\n\t\t\t\t\tif (e.button !== 0) return;\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tthis.focus();\n\t\t\t\t\tthis.contentEl.style.pointerEvents = \"none\";\n\t\t\t\t\thandle.setPointerCapture(e.pointerId);\n\n\t\t\t\t\tconst direction = handle.className.replace(`${LIBRARY_NAME}-resize-handle `, \"\");\n\t\t\t\t\tconst { clientX: startX, clientY: startY } = e;\n\t\t\t\t\tconst { offsetWidth: startWidth, offsetHeight: startHeight, offsetLeft: startLeft, offsetTop: startTop } = this.el;\n\t\t\t\t\tconst { minWidth, minHeight } = this.options;\n\n\t\t\t\t\tconst onPointerMove = (moveE: PointerEvent) => {\n\t\t\t\t\t\tlet newWidth = startWidth,\n\t\t\t\t\t\t\tnewHeight = startHeight,\n\t\t\t\t\t\t\tnewLeft = startLeft,\n\t\t\t\t\t\t\tnewTop = startTop;\n\t\t\t\t\t\tconst deltaX = moveE.clientX - startX;\n\t\t\t\t\t\tconst deltaY = moveE.clientY - startY;\n\n\t\t\t\t\t\tif (direction.includes(\"e\")) newWidth = Math.max(minWidth, startWidth + deltaX);\n\t\t\t\t\t\tif (direction.includes(\"w\")) {\n\t\t\t\t\t\t\tnewWidth = Math.max(minWidth, startWidth - deltaX);\n\t\t\t\t\t\t\tnewLeft = startLeft + deltaX;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (direction.includes(\"s\")) newHeight = Math.max(minHeight, startHeight + deltaY);\n\t\t\t\t\t\tif (direction.includes(\"n\")) {\n\t\t\t\t\t\t\tnewHeight = Math.max(minHeight, startHeight - deltaY);\n\t\t\t\t\t\t\tnewTop = startTop + deltaY;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.setSize(newWidth, newHeight);\n\t\t\t\t\t\tthis.setPosition(newLeft, newTop);\n\t\t\t\t\t};\n\t\t\t\t\tconst onPointerUp = () => {\n\t\t\t\t\t\thandle.releasePointerCapture(e.pointerId);\n\t\t\t\t\t\tthis.contentEl.style.pointerEvents = \"auto\";\n\n\t\t\t\t\t\tdocument.removeEventListener(\"pointermove\", onPointerMove);\n\t\t\t\t\t\tdocument.removeEventListener(\"pointerup\", onPointerUp);\n\t\t\t\t\t\tthis.options.onResize(this);\n\t\t\t\t\t};\n\t\t\t\t\tdocument.addEventListener(\"pointermove\", onPointerMove);\n\t\t\t\t\tdocument.addEventListener(\"pointerup\", onPointerUp);\n\t\t\t\t},\n\t\t\t\t{ passive: false }\n\t\t\t);\n\t\t});\n\t}\n\n\tprivate isFontAwesome(classStr: string): boolean {\n\t\tconst classes = classStr.trim().split(/\\s+/);\n\t\tconst hasPrefix = classes.some((c) => /^fa[bslr]?$/.test(c));\n\t\tconst hasIcon = classes.some((c) => /^fa-[a-z0-9-]+$/.test(c));\n\t\treturn hasPrefix && hasIcon;\n\t}\n\n\t// --- Public API ---\n\n\tpublic close(): void {\n\t\t// Clean up global event listeners\n\t\tif (this.boundGlobalClickHandler) {\n\t\t\tdocument.removeEventListener(\"click\", this.boundGlobalClickHandler);\n\t\t}\n\t\tthis.options.onClose(this);\n\t\tthis.manager.destroyWindow(this.id);\n\t}\n\n\tpublic minimize(): void {\n\t\tif (this.state !== \"minimized\") {\n\t\t\tif (this.state !== \"normal\") this.restore();\n\t\t\tthis.state = \"minimized\";\n\t\t\tthis.el.classList.add(\"minimized\");\n\t\t\tthis.blur();\n\t\t}\n\t}\n\n\tpublic toggleMaximize(): void {\n\t\tthis.state === \"maximized\" ? this.restore() : this.maximize();\n\t}\n\n\tpublic maximize(): void {\n\t\tif (this.state !== \"maximized\") {\n\t\t\tif (this.state !== \"normal\") this.restore();\n\t\t\tthis.lastState = { x: this.el.offsetLeft, y: this.el.offsetTop, width: this.el.offsetWidth, height: this.el.offsetHeight };\n\t\t\tthis.state = \"maximized\";\n\t\t\tthis.el.classList.add(\"maximized\");\n\t\t\tthis.setPosition(0, 0);\n\t\t\tthis.setSize(\"100%\", \"100%\");\n\t\t\tconst maxBtn = this.el.querySelector<HTMLButtonElement>(`.${LIBRARY_NAME}-maximize-btn`);\n\t\t\tif (maxBtn) {\n\t\t\t\tmaxBtn.title = \"Restore\";\n\t\t\t\tmaxBtn.value = \"\\u274f\";\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic restore(): void {\n\t\tif (this.state === \"minimized\") {\n\t\t\tthis.state = \"normal\";\n\t\t\tthis.el.classList.remove(\"minimized\");\n\t\t\tthis.focus();\n\t\t} else if (this.state === \"maximized\") {\n\t\t\tthis.state = \"normal\";\n\t\t\tthis.el.classList.remove(\"maximized\");\n\t\t\tthis.setSize(this.lastState.width, this.lastState.height);\n\t\t\tthis.setPosition(this.lastState.x, this.lastState.y);\n\t\t\tconst maxBtn = this.el.querySelector<HTMLButtonElement>(`.${LIBRARY_NAME}-maximize-btn`);\n\t\t\tif (maxBtn) {\n\t\t\t\tmaxBtn.title = \"Maximize\";\n\t\t\t\tmaxBtn.value = \"\\u25a1\";\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic focus(): void {\n\t\tif (this.focused) return;\n\t\tthis.manager.focusWindow(this);\n\t\tthis.focused = true;\n\t\tthis.el.classList.add(\"active\");\n\t\tthis.options.onFocus(this);\n\t}\n\n\tpublic blur(): void {\n\t\tif (!this.focused) return;\n\t\tthis.focused = false;\n\t\tthis.el.classList.remove(\"active\");\n\t\tthis.options.onBlur(this);\n\t}\n\n\tpublic reload(): void {\n\t\t// onReloadがfalseを返した場合、デフォルトのリロード処理を中断\n\t\tif (this.options.onReload(this) === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst reloadContent = (container: HTMLElement, content: WindowContentOptions) => {\n\t\t\tif (Utils.isNonEmptyObject(content.iframe)) {\n\t\t\t\tconst iframe = container.querySelector(\"iframe\");\n\t\t\t\t// srcがあり、srcdocがない場合はiframeのreloadを試みる\n\t\t\t\tif (iframe && iframe.src && !content.iframe.srcdoc) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// クロスオリジンフレームへのアクセスはエラーになる可能性がある\n\t\t\t\t\t\tiframe.contentWindow?.location.reload();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t// 失敗した場合はiframe要素を再生成する\n\t\t\t\t\t\tconsole.warn(\"WinLet: Cross-origin iframe could not be reloaded directly. Recreating iframe element.\", e);\n\t\t\t\t\t\tthis.renderContent(container, content);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// srcdocの場合やiframeが見つからない場合は要素を再生成\n\t\t\t\t\tthis.renderContent(container, content);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// htmlまたはtemplateの場合は常に再描画\n\t\t\t\tthis.renderContent(container, content);\n\t\t\t}\n\t\t};\n\n\t\tif (this.options.tabs.length > 0) {\n\t\t\tconst activeTabIndex = this.tabs.findIndex((tab) => tab.tabEl.classList.contains(\"active\"));\n\t\t\tif (activeTabIndex > -1) {\n\t\t\t\tconst activeTab = this.tabs[activeTabIndex];\n\t\t\t\tconst tabContentOptions = this.options.tabs[activeTabIndex].content;\n\t\t\t\treloadContent(activeTab.contentEl, tabContentOptions);\n\t\t\t}\n\t\t} else {\n\t\t\treloadContent(this.contentEl, this.options.content);\n\t\t}\n\t}\n\n\tpublic getTitle(): string {\n\t\treturn this.options.title;\n\t}\n\n\tpublic setTitle(title: string): void {\n\t\tthis.options.title = title;\n\t\tthis.titleEl.textContent = Utils.sanitizeHTML(title);\n\t}\n\n\tpublic setIcon(icon: string | null): void {\n\t\tthis.options.icon = icon;\n\t\tthis.iconEl.innerHTML = \"\";\n\t\tif (!icon) return;\n\n\t\tif (this.isFontAwesome(icon)) {\n\t\t\tconst i = document.createElement(\"i\");\n\t\t\ti.className = icon;\n\t\t\tthis.iconEl.appendChild(i);\n\t\t} else {\n\t\t\tconst img = document.createElement(\"img\");\n\t\t\timg.src = icon;\n\t\t\timg.alt = \"window icon\";\n\t\t\tthis.iconEl.appendChild(img);\n\t\t}\n\t}\n\n\tpublic getPosition(): { x: number; y: number } {\n\t\tif (this.state === \"maximized\") {\n\t\t\treturn { x: this.lastState.x, y: this.lastState.y };\n\t\t}\n\t\treturn { x: this.el.offsetLeft, y: this.el.offsetTop };\n\t}\n\n\tpublic setPosition(x: number | \"center\" | \"left\" | \"right\", y: number | \"center\" | \"top\" | \"bottom\"): void {\n\t\t// containerが存在しない（初期化前）場合は処理を中断\n\t\tif (!this.manager.container) {\n\t\t\tconsole.warn(\"WinLet Warning: setPosition called before manager is initialized.\");\n\t\t\treturn;\n\t\t}\n\t\tconst parentRect = this.manager.container.getBoundingClientRect();\n\t\tconst winWidth = this.el.offsetWidth;\n\t\tconst winHeight = this.el.offsetHeight;\n\n\t\tlet finalX: number;\n\t\tlet finalY: number;\n\n\t\t// X座標の計算\n\t\tswitch (x) {\n\t\t\tcase \"left\":\n\t\t\t\tfinalX = 0;\n\t\t\t\tbreak;\n\t\t\tcase \"center\":\n\t\t\t\tfinalX = (parentRect.width - winWidth) / 2;\n\t\t\t\tbreak;\n\t\t\tcase \"right\":\n\t\t\t\tfinalX = parentRect.width - winWidth;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tfinalX = x as number;\n\t\t\t\tbreak;\n\t\t}\n\n\t\t// Y座標の計算\n\t\tswitch (y) {\n\t\t\tcase \"top\":\n\t\t\t\tfinalY = 0;\n\t\t\t\tbreak;\n\t\t\tcase \"center\":\n\t\t\t\tfinalY = (parentRect.height - winHeight) / 2;\n\t\t\t\tbreak;\n\t\t\tcase \"bottom\":\n\t\t\t\tfinalY = parentRect.height - winHeight;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tfinalY = y as number;\n\t\t\t\tbreak;\n\t\t}\n\n\t\t// 画面外にはみ出さないようにする既存のロジックを適用\n\t\tthis.el.style.left = `${Math.min(Math.max(150 - winWidth, finalX), parentRect.width - 20)}px`;\n\t\tthis.el.style.top = `${Math.min(Math.max(0, finalY), parentRect.height - 50)}px`;\n\t}\n\n\tpublic getSize(): { width: number; height: number } {\n\t\tif (this.state === \"maximized\") {\n\t\t\treturn { width: this.lastState.width, height: this.lastState.height };\n\t\t}\n\t\treturn { width: this.el.offsetWidth, height: this.el.offsetHeight };\n\t}\n\n\tpublic setSize(width: number | string, height: number | string): void {\n\t\tthis.el.style.width = typeof width === \"number\" ? `${width}px` : width;\n\t\tthis.el.style.height = typeof height === \"number\" ? `${height}px` : height;\n\t}\n}\n","// src/WindowManager.ts\n\nimport { defaultConfig } from \"../const/config\";\nimport { WinLetError } from \"../const/errors\";\nimport { ContextMenuItem, GlobalConfigOptions, IWindow, LIBRARY_NAME, MenuItem, WindowOptions } from \"../const/types\";\nimport WinLetBaseClass from \"../libs/baseclass\";\nimport Utils from \"../libs/utils\";\nimport styleData from \"../style/styles\";\nimport WinLetWindow from \"./window\";\n\nexport default class WindowManager extends WinLetBaseClass {\n\tpublic container: HTMLElement | null = null;\n\tprivate windows = new Map<string, WinLetWindow>();\n\tprivate zIndexCounter = 1000;\n\tprivate activeWindow: WinLetWindow | null = null;\n\tprivate contextMenuEl: HTMLElement | null = null;\n\tprivate isInitialized = false;\n\n\tprivate globalConfig: Required<GlobalConfigOptions>;\n\n\tprivate lastAutoPosition: { x: number; y: number } | null = null;\n\tprivate readonly CASCADE_OFFSET = 30;\n\n\tconstructor(initialConfig: Required<GlobalConfigOptions>) {\n\t\tsuper();\n\t\tthis.globalConfig = initialConfig;\n\t}\n\n\tpublic applyGlobalConfig(options: GlobalConfigOptions) {\n\t\tObject.assign(this.globalConfig, options);\n\t}\n\n\tpublic init(): void {\n\t\tif (this.isInitialized) {\n\t\t\treturn;\n\t\t}\n\t\tif (!document.body) {\n\t\t\tthrow new WinLetError(\"Cannot initialize before document.body is ready. Please call WinLet.init() after DOMContentLoaded.\");\n\t\t}\n\n\t\tif (!document.getElementById(`${LIBRARY_NAME}-styles`)) {\n\t\t\tconst styleTag = document.createElement(\"style\");\n\t\t\tstyleTag.id = `${LIBRARY_NAME}-styles`;\n\t\t\tstyleTag.innerHTML = this.getStyleData();\n\t\t\tdocument.head.appendChild(styleTag);\n\t\t}\n\t\tlet containerEl = document.querySelector<HTMLElement>(`.${LIBRARY_NAME}-container`);\n\t\tif (!containerEl) {\n\t\t\tcontainerEl = document.createElement(\"div\");\n\t\t\tcontainerEl.className = `${LIBRARY_NAME}-container`;\n\t\t\tdocument.body.appendChild(containerEl);\n\t\t}\n\t\tthis.container = containerEl;\n\n\t\twindow.addEventListener(\"blur\", () => {\n\t\t\t// 次のイベントサイクルでアクティブな要素を取得\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tconst activeEl = document.activeElement;\n\t\t\t\t// フォーカスがiframeに移った場合\n\t\t\t\tif (activeEl?.tagName === \"IFRAME\") {\n\t\t\t\t\t// そのiframeがWinLetのウィンドウ内にあるか探索\n\t\t\t\t\tconst winEl = (activeEl as HTMLElement).closest<HTMLElement>(`.${LIBRARY_NAME}-window`);\n\t\t\t\t\tif (winEl) {\n\t\t\t\t\t\tconst win = this.windows.get(winEl.id);\n\t\t\t\t\t\t// 対象のウィンドウが存在し、まだアクティブでなければフォーカスする\n\t\t\t\t\t\tif (win && this.activeWindow !== win) {\n\t\t\t\t\t\t\twin.focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\tdocument.addEventListener(\n\t\t\t\"pointerdown\",\n\t\t\t() => {\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tconst activeEl = document.activeElement;\n\t\t\t\t\tif (activeEl?.tagName === \"IFRAME\") {\n\t\t\t\t\t\tconst winEl = (activeEl as HTMLElement).closest<HTMLElement>(`.${LIBRARY_NAME}-window`);\n\t\t\t\t\t\tif (winEl) {\n\t\t\t\t\t\t\tconst win = this.windows.get(winEl.id);\n\t\t\t\t\t\t\tif (win && this.activeWindow !== win) {\n\t\t\t\t\t\t\t\twin.focus();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\t// ウィンドウ外クリックでblurさせる処理を追加\n\t\tthis.container!.addEventListener(\"pointerdown\", (e: PointerEvent) => {\n\t\t\t// クリックされたのがコンテナ自身（ウィンドウやその中身ではない）の場合\n\t\t\tif (e.target === this.container) {\n\t\t\t\tif (this.activeWindow) {\n\t\t\t\t\tconst active = this.activeWindow;\n\t\t\t\t\tthis.activeWindow = null; // 先にnullにしてからblurを呼ぶ\n\t\t\t\t\tactive.blur();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tdocument.addEventListener(\"click\", () => this.hideContextMenu());\n\n\t\twindow.addEventListener(\"message\", (event) => {\n\t\t\t// メッセージの形式を検証\n\t\t\tif (event.data && event.data.type === \"winlet:createWindow\" && typeof event.data.options === \"object\") {\n\t\t\t\t// メッセージの送信元が管理下のiframeか検証（セキュリティ対策）\n\t\t\t\tlet isSourceValid = false;\n\t\t\t\tfor (const win of this.windows.values()) {\n\t\t\t\t\tconst iframe = win.el.querySelector(\"iframe\");\n\t\t\t\t\tif (iframe && iframe.contentWindow === event.source) {\n\t\t\t\t\t\tisSourceValid = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (isSourceValid) {\n\t\t\t\t\tthis.createWindow(event.data.options);\n\t\t\t\t} else {\n\t\t\t\t\tconsole.warn(\"WinLet: Untrusted source attempted to create a window.\", event.origin);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.isInitialized = true;\n\t\tthis.setupShortcutListeners();\n\t}\n\n\t// ショートカットキーのリスナーを統合\n\tprivate setupShortcutListeners() {\n\t\tdocument.addEventListener(\n\t\t\t\"keydown\",\n\t\t\t(e) => {\n\t\t\t\t// --- 1. グローバルショートカット (ウィンドウ切り替え) ---\n\t\t\t\tif (this.globalConfig.windowSwitchShortcut) {\n\t\t\t\t\tconst shortcut = this.parseShortcut(this.globalConfig.windowSwitchShortcut);\n\n\t\t\t\t\tif (e.key.toLowerCase() === shortcut.key.toLowerCase() && e.ctrlKey === shortcut.ctrl && e.altKey === shortcut.alt && e.shiftKey === shortcut.shift) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tconst windows = Array.from(this.windows.values());\n\n\t\t\t\t\t\tconst currentIndex = this.activeWindow ? windows.findIndex((w) => w === this.activeWindow) : -1;\n\t\t\t\t\t\tconst nextIndex = (currentIndex + 1) % windows.length;\n\n\t\t\t\t\t\tconst win = windows[nextIndex];\n\t\t\t\t\t\tif (win.state === \"minimized\") {\n\t\t\t\t\t\t\twin.restore();\n\t\t\t\t\t\t}\n\t\t\t\t\t\twin.focus();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// --- 2. ウィンドウ固有のショートカット ---\n\t\t\t\tconst targetWindow = this.activeWindow;\n\n\t\t\t\t// ターゲットウィンドウがなければ何もしない\n\t\t\t\tif (!targetWindow || !targetWindow.options.enableShortcuts) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// --- 3. ショートカットキーを検索して実行 ---\n\t\t\t\tconst findAndExecShortcut = (menuItems: MenuItem[]) => {\n\t\t\t\t\tfor (const item of menuItems) {\n\t\t\t\t\t\tif (item.shortcut) {\n\t\t\t\t\t\t\tconst shortcut = this.parseShortcut(item.shortcut);\n\t\t\t\t\t\t\tif (e.key.toUpperCase() === shortcut.key.toUpperCase() && e.ctrlKey === shortcut.ctrl && e.altKey === shortcut.alt && e.shiftKey === shortcut.shift) {\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\titem.action?.(targetWindow!);\n\t\t\t\t\t\t\t\treturn true; // 実行したら探索終了\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (item.items && findAndExecShortcut(item.items)) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t};\n\n\t\t\t\tfindAndExecShortcut(targetWindow.options.menu);\n\t\t\t},\n\t\t\t{ passive: false }\n\t\t);\n\t}\n\n\t// 未初期化の場合に自動でinitを呼び出すヘルパー\n\tprivate ensureInitialized(): void {\n\t\tif (!this.isInitialized) {\n\t\t\tthis.init();\n\t\t}\n\t}\n\n\t/**\n\t * スタイルシートを取得\n\t */\n\tprivate getStyleData() {\n\t\treturn styleData.replace(/\\$\\[(\\w+)\\]/g, (a, p) => {\n\t\t\tswitch (p) {\n\t\t\t\tcase \"prefix\":\n\t\t\t\t\treturn LIBRARY_NAME;\n\t\t\t}\n\t\t\treturn p;\n\t\t});\n\t}\n\n\tpublic createWindow(options: WindowOptions): WinLetWindow {\n\t\tthis.ensureInitialized();\n\n\t\tconst ifExists = options.ifExists ?? \"focus\";\n\n\t\tif (options.id && ifExists !== \"create\") {\n\t\t\tconst existingWindow = this.getWindow(options.id);\n\t\t\tif (existingWindow) {\n\t\t\t\tif (ifExists === \"prevent\") {\n\t\t\t\t\treturn existingWindow; // 何もせず既存インスタンスを返す\n\t\t\t\t}\n\t\t\t\tif (ifExists === \"focus\") {\n\t\t\t\t\tif (existingWindow.state === \"minimized\") {\n\t\t\t\t\t\texistingWindow.restore();\n\t\t\t\t\t}\n\t\t\t\t\texistingWindow.focus();\n\t\t\t\t\treturn existingWindow; // フォーカスして既存インスタンスを返す\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst creationOptions: Required<WindowOptions> = Utils.deepMerge(defaultConfig, options);\n\t\tif (creationOptions.x === \"auto\" || creationOptions.y === \"auto\") {\n\t\t\tconst winWidth = creationOptions.width;\n\t\t\tconst winHeight = creationOptions.height;\n\t\t\tconst containerRect = this.container!.getBoundingClientRect();\n\n\t\t\tlet nextX: number;\n\t\t\tlet nextY: number;\n\n\t\t\tif (this.lastAutoPosition === null) {\n\t\t\t\tnextX = 0;\n\t\t\t\tnextY = 0;\n\t\t\t} else {\n\t\t\t\t// 右下へカスケード\n\t\t\t\tnextX = this.lastAutoPosition.x + this.CASCADE_OFFSET;\n\t\t\t\tnextY = this.lastAutoPosition.y + this.CASCADE_OFFSET;\n\t\t\t}\n\n\t\t\t// はみ出しチェックとリセット\n\t\t\tif (nextX + winWidth > containerRect.width) {\n\t\t\t\tnextX = 0;\n\t\t\t}\n\t\t\tif (nextY + winHeight > containerRect.height) {\n\t\t\t\tnextY = 0;\n\t\t\t}\n\n\t\t\t// 計算結果をオプションに反映\n\t\t\tcreationOptions.x = nextX;\n\t\t\tcreationOptions.y = nextY;\n\n\t\t\t// 次回のために位置を保存\n\t\t\tthis.lastAutoPosition = { x: nextX, y: nextY };\n\t\t}\n\n\t\tconst win = new WinLetWindow(creationOptions, this);\n\t\tthis.windows.set(win.id, win);\n\t\tthis.container!.appendChild(win.el);\n\n\t\twin.setPosition(creationOptions.x, creationOptions.y);\n\t\tif (creationOptions.focus) {\n\t\t\tthis.focusWindow(win);\n\t\t\twin.focus();\n\t\t} else {\n\t\t\t// フォーカスしない場合でも、z-indexの管理は必要\n\t\t\twin.el.style.zIndex = `${++this.zIndexCounter}`;\n\t\t}\n\t\treturn win;\n\t}\n\n\tpublic destroyWindow(id: string): void {\n\t\tthis.ensureInitialized();\n\t\tconst win = this.windows.get(id);\n\t\tif (win) {\n\t\t\twin.el.remove();\n\t\t\tthis.windows.delete(id);\n\t\t\tif (this.activeWindow === win) {\n\t\t\t\tthis.activeWindow = null;\n\t\t\t\tconst nextWin = Array.from(this.windows.values()).pop();\n\t\t\t\tif (nextWin) this.focusWindow(nextWin);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic focusWindow(win: WinLetWindow): void {\n\t\tthis.ensureInitialized();\n\t\tif (this.activeWindow === win) return;\n\n\t\tthis.activeWindow?.blur();\n\t\tthis.activeWindow = win;\n\t\twin.el.style.zIndex = `${++this.zIndexCounter}`;\n\t\t// focus()はWindowクラス側で呼ばれるので不要\n\t}\n\n\tpublic getWindow(id: string): WinLetWindow | undefined {\n\t\tthis.ensureInitialized();\n\t\treturn this.windows.get(id);\n\t}\n\n\tpublic getActiveWindow(): WinLetWindow | null {\n\t\tthis.ensureInitialized();\n\t\treturn this.activeWindow;\n\t}\n\n\tpublic showContextMenu(x: number, y: number, menuItems: ContextMenuItem[], contextWindow: IWindow): void {\n\t\tthis.ensureInitialized();\n\t\tthis.hideContextMenu();\n\n\t\tthis.contextMenuEl = document.createElement(\"ul\");\n\t\tthis.contextMenuEl.className = `${LIBRARY_NAME}-context-menu`;\n\n\t\tmenuItems.forEach((itemData) => {\n\t\t\tconst itemEl = document.createElement(\"li\");\n\t\t\tif (itemData.separator) {\n\t\t\t\titemEl.className = \"separator\";\n\t\t\t} else {\n\t\t\t\titemEl.textContent = itemData.name ?? \"\";\n\t\t\t\titemEl.addEventListener(\"click\", (e) => {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\titemData.action?.(contextWindow);\n\t\t\t\t\tthis.hideContextMenu();\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.contextMenuEl!.appendChild(itemEl);\n\t\t});\n\n\t\tthis.container!.appendChild(this.contextMenuEl);\n\n\t\tconst { offsetWidth: menuWidth, offsetHeight: menuHeight } = this.contextMenuEl;\n\t\tconst { innerWidth: screenWidth, innerHeight: screenHeight } = window;\n\n\t\tthis.contextMenuEl.style.left = x + menuWidth > screenWidth ? `${screenWidth - menuWidth}px` : `${x}px`;\n\t\tthis.contextMenuEl.style.top = y + menuHeight > screenHeight ? `${screenHeight - menuHeight}px` : `${y}px`;\n\t}\n\n\tpublic hideContextMenu(): void {\n\t\tthis.contextMenuEl?.remove();\n\t\tthis.contextMenuEl = null;\n\t}\n\n\t/**\n\t * ショートカット文字列を解析し、修飾キーと主キーのオブジェクトを返す\n\t * @param shortcut - \"Ctrl+Shift+K\"のような文字列\n\t */\n\tprivate parseShortcut(shortcut: string): { ctrl: boolean; alt: boolean; shift: boolean; key: string } {\n\t\tconst keys = shortcut.split(\"+\");\n\t\tconst key = keys.pop() || \"\"; // 主キーを配列から取り出す\n\t\tconst ctrl = keys.includes(\"Ctrl\");\n\t\tconst alt = keys.includes(\"Alt\");\n\t\tconst shift = keys.includes(\"Shift\");\n\t\treturn { ctrl, alt, shift, key };\n\t}\n}\n","// src/index.ts\n\nimport { defaultConfig } from \"./const/config\";\nimport { GlobalConfigOptions, IWindow, WindowOptions, WinLetApi } from \"./const/types\";\nimport WindowManager from \"./function/window_manager\";\nimport Utils from \"./libs/utils\";\nimport { LIB_VERSION } from \"./version\";\n\nconst globalConfig: Required<GlobalConfigOptions> = {\n\twindowSwitchShortcut: \"Ctrl+`\", // デフォルトショートカット（バッククォート）\n};\n\n// シングルトンインスタンス\nconst manager = new WindowManager(globalConfig);\n\n// 公開するAPI\nconst api: WinLetApi = {\n\t/**\n\t * ライブラリを初期化します。DOMの準備ができた後に呼び出してください。\n\t * (例: document.addEventListener('DOMContentLoaded', WinLet.init);)\n\t */\n\tinit: (): void => {\n\t\tmanager.init();\n\t},\n\n\t/**\n\t * 新しいウィンドウを作成\n\t */\n\tcreateWindow: (options: WindowOptions = {}): IWindow => {\n\t\treturn manager.createWindow(options);\n\t},\n\n\t/**\n\t * ウィンドウを取得\n\t */\n\tgetWindow: (id: string): IWindow | undefined => {\n\t\treturn manager.getWindow(id);\n\t},\n\n\t/**\n\t * アクティブなウィンドウを取得\n\t */\n\tgetActiveWindow: (): IWindow | null => {\n\t\treturn manager.getActiveWindow();\n\t},\n\n\t/**\n\t * デフォルトのウィンドウ設定を変更\n\t */\n\tsetDefaultConfig: (options: WindowOptions): void => {\n\t\tUtils.deepMerge(defaultConfig, options);\n\t},\n\n\t/**\n\t * グローバル設定を変更\n\t */\n\tsetGlobalConfig: (options: GlobalConfigOptions): void => {\n\t\tObject.assign(globalConfig, options);\n\t\tmanager.applyGlobalConfig(globalConfig);\n\t},\n\n\t/**\n\t * ライブラリのバージョンを取得\n\t */\n\tget version() {\n\t\treturn LIB_VERSION;\n\t},\n};\n\n// グローバルスコープにAPIをアタッチ\nwindow.WinLet = api;\n\n// モジュールとしてエクスポートも可能\nexport default api;\n","export default class WinLetBaseClass {}\n","import WinLetBaseClass from \"./baseclass\";\n\nexport default class Utils extends WinLetBaseClass {\n\t/**\n\t * ユニークなIDを生成します。\n\t * @param prefix - IDのプレフィックス\n\t * @returns 生成されたID\n\t */\n\tpublic static generateId(prefix: string = \"win\"): string {\n\t\treturn `${prefix}-${Math.random().toString(36).substring(2, 9)}`;\n\t}\n\n\t/**\n\t * オブジェクトをディープマージします。\n\t */\n\tpublic static deepMerge<T extends object, U extends object>(target: T, source: U): T & U {\n\t\tconst output = { ...target } as T & U;\n\n\t\tfor (const key in source) {\n\t\t\tif (Object.prototype.hasOwnProperty.call(source, key)) {\n\t\t\t\tconst sourceValue = source[key];\n\t\t\t\tconst targetValue = (target as any)[key];\n\n\t\t\t\tif (Array.isArray(sourceValue)) {\n\t\t\t\t\t// ソースの値が配列の場合は、そのまま上書きする\n\t\t\t\t\t(output as any)[key] = sourceValue;\n\t\t\t\t} else if (sourceValue instanceof Object && typeof sourceValue !== \"function\" && targetValue instanceof Object) {\n\t\t\t\t\t(output as any)[key] = this.deepMerge(targetValue, sourceValue);\n\t\t\t\t} else {\n\t\t\t\t\t(output as any)[key] = sourceValue;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn output;\n\t}\n\n\t/**\n\t * オブジェクトが空でないかとどうかを判定します。\n\t * @param obj - 判定するオブジェクト\n\t * @returns オブジェクトが空である場合はfalse、そうでない場合はtrue\n\t */\n\tpublic static isNonEmptyObject<T extends object>(obj: T | undefined): obj is T & Record<string | symbol, unknown> {\n\t\tif (!obj) return false;\n\t\tfor (const _ in obj) return true;\n\t\treturn false;\n\t}\n\n\t/**\n\t * HTML文字列をサニタイズします。\n\t * @param str - サニタイズする文字列\n\t * @returns サニタイズされたHTML文字列\n\t */\n\tpublic static sanitizeHTML(str: string): string {\n\t\tconst temp = document.createElement(\"div\");\n\t\ttemp.textContent = str;\n\t\treturn temp.innerHTML;\n\t}\n}\n","const styleData: string = `\n:root {\n    --$[prefix]-bg: #f0f0f0;\n    --$[prefix]-border: #a0a0a0;\n    --$[prefix]-title-bar-height: 32px;\n    --$[prefix]-title-bar-bg: #e0e0e0;\n    --$[prefix]-title-bar-active-bg: #0078d7;\n    --$[prefix]-title-text-color: #000;\n    --$[prefix]-title-text-active-color: #fff;\n    --$[prefix]-control-bg: #d0d0d0;\n    --$[prefix]-control-hover-bg: #e5e5e5;\n    --$[prefix]-control-close-hover-bg: #e81123;\n    --$[prefix]-control-close-hover-color: #fff;\n    --$[prefix]-menu-bg: #fff;\n    --$[prefix]-menu-border: #ccc;\n    --$[prefix]-menu-item-color: #000;\n    --$[prefix]-menu-item-hover-bg: #0078d7;\n    --$[prefix]-menu-item-hover-color: #fff;\n    --$[prefix]-tab-bg: #dcdcdc;\n    --$[prefix]-tab-active-bg: #f0f0f0;\n    --$[prefix]-tab-border: #b0b0b0;\n    --$[prefix]-resize-handle-size: 8px;\n    --$[prefix]-resize-handle-offset: -4px;\n}\n\n.$[prefix]-us-none {\n    user-select: none;\n    -webkit-user-select: none;\n    -ms-user-select: none;\n}\n\n.$[prefix]-us-auto {\n    user-select: auto;\n    -webkit-user-select: auto;\n    -ms-user-select: auto;\n}\n\n\n.$[prefix]-container {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    pointer-events: none;\n    overflow: hidden;\n    z-index: 999;\n}\n\n.$[prefix]-window {\n    position: absolute;\n    display: flex;\n    flex-direction: column;\n    min-width: 200px;\n    min-height: 150px;\n    border: 1px solid var(--$[prefix]-border);\n    background-color: var(--$[prefix]-bg);\n    box-shadow: 0 5px 15px rgba(0,0,0,0.3);\n    border-radius: 5px;\n    overflow: hidden;\n    pointer-events: all;\n    transition: opacity 0.1s, transform 0.1s;\n    touch-action: none;\n}\n\n.$[prefix]-window.minimized {\n    display: none;\n}\n\n.$[prefix]-window.maximized {\n    border-radius: 0;\n    border: none;\n}\n\n/* Focus State */\n.$[prefix]-window.active .$[prefix]-title-bar {\n    background-color: var(--$[prefix]-title-bar-active-bg);\n    color: var(--$[prefix]-title-text-active-color);\n}\n.$[prefix]-window.active .$[prefix]-title-bar .$[prefix]-title {\n    color: var(--$[prefix]-title-text-active-color);\n}\n\n.$[prefix]-title-bar {\n    display: flex;\n    align-items: center;\n    height: var(--$[prefix]-title-bar-height);\n    background-color: var(--$[prefix]-title-bar-bg);\n    color: var(--$[prefix]-title-text-color);\n    cursor: move;\n    flex-shrink: 0;\n    touch-action: none;\n}\n\n.$[prefix]-title-bar.controls-left {\n    flex-direction: row-reverse;\n}\n\n.$[prefix]-icon {\n    min-width: calc(var(--$[prefix]-title-bar-height) * 0.75);\n    height: calc(var(--$[prefix]-title-bar-height) * 0.75);\n    margin: 0 4px;\n    pointer-events: none;\n    flex-shrink: 0;\n}\n\n.$[prefix]-icon i {\n    font-size: calc(var(--$[prefix]-title-bar-height) * 0.5);\n    line-height: calc(var(--$[prefix]-title-bar-height) * 0.75);\n    text-align: center;\n    display: block;\n    width: 100%;\n    height: 100%;\n}\n\n.$[prefix]-icon img {\n    display: block;\n    width: 100%;\n    height: 100%;\n}\n\n.$[prefix]-title {\n    flex-grow: 1;\n    padding: 0 8px;\n    font-family: sans-serif;\n    font-size: calc(var(--$[prefix]-title-bar-height) * 0.44);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    pointer-events: none;\n}\n\n.$[prefix]-title-bar.controls-left .$[prefix]-title {\n    text-align: right;\n}\n\n.$[prefix]-controls {\n    display: flex;\n    height: 100%;\n    margin-left: auto;\n    flex-shrink: 0;\n}\n\n.$[prefix]-title-bar.controls-left .$[prefix]-controls {\n    margin-left: 0;\n    margin-right: auto;\n    flex-direction: row-reverse;\n}\n\n.$[prefix]-control-btn {\n    width: calc(var(--$[prefix]-title-bar-height) * 1.3);\n    height: 100%;\n    border: none;\n    box-sizing: border-box;\n    background-color: transparent;\n    font-size: calc(var(--$[prefix]-title-bar-height) * 0.5);\n    cursor: pointer;\n    text-align: center;\n    vertical-align: middle;\n    font-family: sans-serif;\n    transition: background-color 0.2s;\n    touch-action: auto;\n}\n\n.$[prefix]-control-btn:hover {\n    background-color: var(--$[prefix]-control-hover-bg);\n}\n\n.$[prefix]-control-btn.$[prefix]-close-btn:hover {\n    background-color: var(--$[prefix]-control-close-hover-bg);\n    color: var(--$[prefix]-control-close-hover-color);\n}\n\n.$[prefix]-main-content {\n    all: initial;\n    display:flex;\n    flex-direction:column;\n    flex-grow:1;\n    overflow:hidden;\n}\n\n.$[prefix]-menu-bar {\n    color: var(--$[prefix]-menu-item-color);\n    display: flex;\n    background-color: var(--$[prefix]-bg);\n    padding: 2px;\n    flex-shrink: 0;\n    border-bottom: 1px solid var(--$[prefix]-border);\n    touch-action: auto;\n}\n\n.$[prefix]-menu-item {\n    font-family: sans-serif;\n    font-size: 14px;\n    padding: 4px 8px;\n    cursor: default;\n    position: relative;\n}\n\n.$[prefix]-menu-item:hover {\n    background-color: var(--$[prefix]-menu-item-hover-bg);\n    color: var(--$[prefix]-menu-item-hover-color);\n}\n\n.$[prefix]-menu-dropdown {\n    color: var(--$[prefix]-menu-item-color);\n    display: none;\n    position: absolute;\n    top: 100%;\n    left: 0;\n    background-color: var(--$[prefix]-menu-bg);\n    border: 1px solid var(--$[prefix]-menu-border);\n    box-shadow: 0 2px 8px rgba(0,0,0,0.15);\n    list-style: none;\n    margin: 0;\n    padding: 4px 0;\n    min-width: 150px;\n    z-index: 10;\n    touch-action: auto;\n}\n\n.$[prefix]-menu-dropdown li {\n    padding: 0 20px;\n    font-size: 14px;\n    cursor: pointer;\n}\n\n.$[prefix]-menu-dropdown li:hover {\n    background-color: var(--$[prefix]-menu-item-hover-bg);\n    color: var(--$[prefix]-menu-item-hover-color);\n}\n\n.$[prefix]-menu-dropdown li.separator {\n    height: 1px;\n    background-color: var(--$[prefix]-menu-border);\n    margin: 4px 0;\n    padding: 0;\n}\n\n.$[prefix]-menu-dropdown-item {\n    display: flex;\n    flex-wrap: nowrap;\n    justify-content: space-between;\n    width: 100%;\n    white-space: nowrap;\n}\n\n/* --- メニュー --- */\n/* サブメニューを持つ項目のスタイル */\n.$[prefix]-menu-dropdown li.has-submenu {\n    position: relative;\n}\n.$[prefix]-menu-dropdown li.has-submenu::after {\n    content: '▶';\n    position: absolute;\n    top: 50%;\n    right: 10px;\n    margin-top: -0.65em;\n    font-size: 0.8em;\n    color: inherit;\n}\n\n/* ネストされたサブメニューの表示位置 */\n.$[prefix]-menu-dropdown li.has-submenu > .$[prefix]-menu-dropdown {\n    top: -5px; /* liのpaddingを考慮 */\n    left: 100%;\n}\n\n/* サブメニューはホバーで開く */\n.$[prefix]-menu-dropdown li.has-submenu:hover > .$[prefix]-menu-dropdown {\n    display: block;\n}\n\n/* ショートカットキーテキストのスタイル */\n.$[prefix]-shortcut-text {\n    color: #666;\n    margin-left: 1em;\n}\n.$[prefix]-menu-dropdown li:hover .$[prefix]-shortcut-text {\n    color: inherit;\n}\n\n/* --- タブ --- */\n.$[prefix]-tab-bar {\n    color: var(--$[prefix]-menu-item-color);\n    overflow-x: auto;\n    overflow-y: hidden;\n    -ms-overflow-style: -ms-autohiding-scrollbar;\n    scrollbar-width: thin;\n    display: flex;\n    background-color: #e1e1e1;\n    flex-shrink: 0;\n    align-items: flex-end;\n    touch-action: auto;\n}\n\n.$[prefix]-tab-bar::-webkit-scrollbar{\n    width: 6px;\n    height: 6px;\n}\n\n.$[prefix]-tab-bar::-webkit-scrollbar-thumb {\n    background-color: rgba(100, 100, 100, 0.5);\n    border-radius: 3px;\n}\n\n.$[prefix]-tab-bar::-webkit-scrollbar-track {\n    background-color: transparent;\n}\n\n.$[prefix]-tab {\n    white-space: nowrap;\n    padding: 8px 16px;\n    font-family: sans-serif;\n    font-size: 14px;\n    cursor: pointer;\n    border-right: 1px solid var(--$[prefix]-tab-border);\n    background-color: var(--$[prefix]-tab-bg);\n}\n\n.$[prefix]-tab.active {\n    background-color: var(--$[prefix]-tab-active-bg);\n    border-bottom: 2px solid var(--$[prefix]-title-bar-active-bg);\n}\n\n.$[prefix]-tab.active .$[prefix]-tab-close-btn:hover {\n    background-color: #ddd;\n}\n\n/* ドラッグ中のタブのスタイル */\n.$[prefix]-tab.dragging {\n    opacity: 0.5;\n}\n/* タブの閉じるボタン */\n.$[prefix]-tab-close-btn {\n    margin-left: 8px;\n    padding: 0 4px;\n    border-radius: 50%;\n    cursor: pointer;\n    font-weight: bold;\n    font-size: 14px;\n    line-height: 1;\n}\n.$[prefix]-tab-close-btn:hover {\n    background-color: #ccc;\n}\n\n.$[prefix]-tab-content {\n    display: none;\n}\n\n.$[prefix]-tab-content.active {\n    display: block;\n    width: 100%;\n    height: 100%;\n}\n\n/* タブ追加ボタン */\n.$[prefix]-tab-add-btn {\n    padding: 8px;\n    font-size: 14px;\n    cursor: pointer;\n    border-bottom: 1px solid var(--$[prefix]-tab-border);\n}\n.$[prefix]-tab-add-btn:hover {\n    background-color: #e0e0e0;\n}\n\n.$[prefix]-content {\n    flex-grow: 1;\n    position: relative;\n    overflow: auto;\n    touch-action: auto;\n}\n\n.$[prefix]-content iframe {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    border: none;\n}\n\n.$[prefix]-resize-handle {\n    position: absolute;\n    z-index: 5;\n    touch-action: none;\n}\n\n.$[prefix]-resize-handle.n { top: var(--$[prefix]-resize-handle-offset); left: 0; right: 0; height: var(--$[prefix]-resize-handle-size); cursor: n-resize; }\n.$[prefix]-resize-handle.s { bottom: var(--$[prefix]-resize-handle-offset); left: 0; right: 0; height: var(--$[prefix]-resize-handle-size); cursor: s-resize; }\n.$[prefix]-resize-handle.w { top: 0; bottom: 0; left: var(--$[prefix]-resize-handle-offset); width: var(--$[prefix]-resize-handle-size); cursor: w-resize; }\n.$[prefix]-resize-handle.e { top: 0; bottom: 0; right: var(--$[prefix]-resize-handle-offset); width: var(--$[prefix]-resize-handle-size); cursor: e-resize; }\n.$[prefix]-resize-handle.nw { top: var(--$[prefix]-resize-handle-offset); left: var(--$[prefix]-resize-handle-offset); width: var(--$[prefix]-resize-handle-size); height: var(--$[prefix]-resize-handle-size); cursor: nw-resize; }\n.$[prefix]-resize-handle.ne { top: var(--$[prefix]-resize-handle-offset); right: var(--$[prefix]-resize-handle-offset); width: var(--$[prefix]-resize-handle-size); height: var(--$[prefix]-resize-handle-size); cursor: ne-resize; }\n.$[prefix]-resize-handle.sw { bottom: var(--$[prefix]-resize-handle-offset); left: var(--$[prefix]-resize-handle-offset); width: var(--$[prefix]-resize-handle-size); height: var(--$[prefix]-resize-handle-size); cursor: sw-resize; }\n.$[prefix]-resize-handle.se { bottom: var(--$[prefix]-resize-handle-offset); right: var(--$[prefix]-resize-handle-offset); width: var(--$[prefix]-resize-handle-size); height: var(--$[prefix]-resize-handle-size); cursor: se-resize; }\n\n.$[prefix]-context-menu {\n    color: var(--$[prefix]-menu-item-color);\n    pointer-events: all;\n    position: fixed;\n    z-index: 10000;\n    background-color: var(--$[prefix]-menu-bg);\n    border: 1px solid var(--$[prefix]-menu-border);\n    box-shadow: 0 2px 8px rgba(0,0,0,0.15);\n    list-style: none;\n    margin: 0;\n    padding: 4px 0;\n    min-width: 160px;\n}\n.$[prefix]-context-menu li {\n    padding: 6px 24px;\n    font-family: sans-serif;\n    font-size: 14px;\n    cursor: pointer;\n}\n.$[prefix]-context-menu li:hover {\n    background-color: var(--$[prefix]-menu-item-hover-bg);\n    color: var(--$[prefix]-menu-item-hover-color);\n}\n.$[prefix]-context-menu li.separator {\n    height: 1px;\n    background-color: var(--$[prefix]-menu-border);\n    margin: 4px 0;\n    padding: 0;\n}\n\n/* --- Merged Menu/Tab Styles --- */\n.$[prefix]-window.$[prefix]-menu-style-merged .$[prefix]-title-bar,\n.$[prefix]-window.$[prefix]-tab-style-merged .$[prefix]-title-bar {\n    height: auto;\n    align-items: flex-end;\n    padding: 0;\n}\n.$[prefix]-window.$[prefix]-tab-style-merged.$[prefix]-window.active .$[prefix]-title-bar {\n    background-color: var(--$[prefix]-title-bar-bg);\n}\n\n.$[prefix]-window.$[prefix]-menu-style-merged .$[prefix]-icon {\n    margin-block: auto;\n}\n\n.$[prefix]-window.$[prefix]-tab-style-merged .$[prefix]-title {\n    display: none;\n}\n.$[prefix]-window.$[prefix]-menu-style-merged .$[prefix]-title {\n    flex-grow: 1;\n    margin-block: auto;\n}\n\n.$[prefix]-window.$[prefix]-menu-style-merged .$[prefix]-menu-bar {\n    border-bottom: none;\n    background: transparent;\n    padding: 0 6px;\n    align-self: center;\n}\n.$[prefix]-window.$[prefix]-menu-style-merged .$[prefix]-menu-item {\n    line-height: var(--$[prefix]-title-bar-height);\n    padding-top: 0;\n    padding-bottom: 0;\n}\n\n.$[prefix]-window.$[prefix]-menu-style-merged.active:not(.$[prefix]-tab-style-merged) .$[prefix]-menu-item {\n    color: var(--winlet-menu-item-hover-color);\n}\n.$[prefix]-window.$[prefix]-menu-style-merged.active:not(.$[prefix]-tab-style-merged) .$[prefix]-menu-item:hover {\n    background-color: var(--$[prefix]-title-bar-bg);\n    color: var(--$[prefix]-menu-item-color);\n}\n\n.$[prefix]-window.$[prefix]-tab-style-merged .$[prefix]-tab-bar {\n    background-color: transparent;\n    flex-grow: 1;\n    flex-shrink: 1;\n    min-width: 0;\n    align-items: flex-end;\n    height: calc(var(--$[prefix]-title-bar-height) + 4px);\n    margin: 0;\n    order: 1; /* controlsより前に配置 */\n}\n.$[prefix]-window.$[prefix]-tab-style-merged .$[prefix]-tab-bar {\n    -ms-overflow-style: none;\n    scrollbar-width: none;\n}\n.$[prefix]-window.$[prefix]-tab-style-merged .$[prefix]-tab-bar::-webkit-scrollbar{\n    width: 0px;\n    height: 0px;\n}\n\n.$[prefix]-window.$[prefix]-title-bar.controls-left .$[prefix]-tab-bar {\n    order: -1;\n}\n\n\n.$[prefix]-window.$[prefix]-tab-style-merged .$[prefix]-tab {\n    border: 1px solid var(--$[prefix]-border);\n    border-bottom: none;\n    border-radius: 6px 6px 0 0;\n    margin-top: 4px;\n    margin-left: -1px;\n    position: relative;\n    bottom: -1px;\n}\n.$[prefix]-window.$[prefix]-tab-style-merged .$[prefix]-tab.active {\n    background-color: var(--$[prefix]-bg);\n    border-color: var(--$[prefix]-border);\n    border-bottom: 1px solid var(--$[prefix]-bg);\n    z-index: 2;\n}\n\n.$[prefix]-window.$[prefix]-tab-style-merged .$[prefix]-tab-add-btn {\n    border: none;\n    align-self: center;\n}\n.$[prefix]-window.$[prefix]-tab-style-merged .$[prefix]-main-content {\n    border-top: none;\n}\n.$[prefix]-window.$[prefix]-tab-style-merged .$[prefix]-controls,\n.$[prefix]-window.$[prefix]-menu-style-merged .$[prefix]-controls {\n    align-self: flex-start;\n    order: 2;\n}\n\n/* --- Mobile / Touch Device Adjustments --- */\n@media (pointer: coarse), (max-width: 768px) {\n    :root {\n        --$[prefix]-resize-handle-size: 16px;\n        --$[prefix]-resize-handle-offset: -8px;\n    }\n    .$[prefix]-control-btn {\n        width: calc(var(--$[prefix]-title-bar-height) * 1.5);\n    }\n}\n`;\n\nexport default styleData;\n","// このファイルは自動生成されます\nexport const LIB_VERSION = \"v1.0.1.0\";\n"],"mappings":"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","ignoreList":[]}